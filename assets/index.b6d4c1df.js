(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=r(s);fetch(s.href,o)}})();var vg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};const xd=e=>e.reduce((t,r)=>Array.isArray(r)?t.concat(xd(r)):t.concat(r),[]);var Ze=xd;const gg=e=>Object.assign({},e);var yg=gg;const bg=(e,t,r)=>(e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e);var wg=bg;const _g=()=>[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];var Qc=_g;const xg=Qc,Eg=e=>{const t=xg();return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t};var $g=Eg;const Ag=(e,t)=>(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e);var Ed=Ag;const Sg=(e,t)=>{const r=t[0],n=t[1],s=t[2],o=t[3],a=t[4],i=t[5],c=t[6],l=t[7],u=t[8],d=t[9],h=t[10],p=t[11],E=t[12],g=t[13],b=t[14],P=t[15],F=r*i-n*a,R=r*c-s*a,C=r*l-o*a,G=n*c-s*i,L=n*l-o*i,q=s*l-o*c,ee=u*g-d*E,oe=u*b-h*E,pe=u*P-p*E,Q=d*b-h*g,Te=d*P-p*g,Xe=h*P-p*b;let $e=F*Xe-R*Te+C*Q+G*pe-L*oe+q*ee;return $e?($e=1/$e,e[0]=(i*Xe-c*Te+l*Q)*$e,e[1]=(s*Te-n*Xe-o*Q)*$e,e[2]=(g*q-b*L+P*G)*$e,e[3]=(h*L-d*q-p*G)*$e,e[4]=(c*pe-a*Xe-l*oe)*$e,e[5]=(r*Xe-s*pe+o*oe)*$e,e[6]=(b*C-E*q-P*R)*$e,e[7]=(u*q-h*C+p*R)*$e,e[8]=(a*Te-i*pe+l*ee)*$e,e[9]=(n*pe-r*Te-o*ee)*$e,e[10]=(E*L-g*C+P*F)*$e,e[11]=(d*C-u*L-p*F)*$e,e[12]=(i*oe-a*Q-c*ee)*$e,e[13]=(r*Q-n*oe+s*ee)*$e,e[14]=(g*R-E*G-b*F)*$e,e[15]=(u*G-d*R+h*F)*$e,e):null};var Tg=Sg;const Pg=(e,t)=>e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15];var Mg=Pg;const Cg=1e5,Og=1e-5,Rg=1e-13;var mt={EPS:Og,NEPS:Rg,spatialResolution:Cg};const{NEPS:Lg}=mt,$d=e=>Math.abs(e)<Lg?0:e,Fg=e=>$d(Math.sin(e)),Gg=e=>$d(Math.cos(e));var qt={sin:Fg,cos:Gg};const Ng=e=>(e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e);var Ad=Ng;const{EPS:Dg}=mt,{sin:kg,cos:Ig}=qt,Bg=Ad,zg=(e,t,r)=>{let[n,s,o]=r;const a=n*n+s*s+o*o;if(Math.abs(a)<Dg)return Bg(e);const i=1/Math.sqrt(a);n*=i,s*=i,o*=i;const c=kg(t),l=Ig(t),u=1-l;return e[0]=n*n*u+l,e[1]=s*n*u+o*c,e[2]=o*n*u-s*c,e[3]=0,e[4]=n*s*u-o*c,e[5]=s*s*u+l,e[6]=o*s*u+n*c,e[7]=0,e[8]=n*o*u+s*c,e[9]=s*o*u-n*c,e[10]=o*o*u+l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e};var Sd=zg;const Vg=(e,t)=>(e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e);var qg=Vg;const{sin:Ri,cos:Li}=qt,Xg=(e,t,r,n)=>{const s=Ri(t),o=Li(t),a=Ri(r),i=Li(r),c=Ri(n),l=Li(n);return e[0]=i*o,e[1]=i*s,e[2]=-a,e[3]=0,e[4]=c*a*o-l*s,e[5]=l*o+c*a*s,e[6]=c*i,e[7]=0,e[8]=c*s+l*a*o,e[9]=l*a*s-c*o,e[10]=l*i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e};var Ug=Xg;const jg=(e,t)=>(e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e);var Hg=jg;const Yg=Qc,Zg=(e,t,r,n,s,o,a,i,c,l,u,d,h,p,E,g)=>{const b=Yg();return b[0]=e,b[1]=t,b[2]=r,b[3]=n,b[4]=s,b[5]=o,b[6]=a,b[7]=i,b[8]=c,b[9]=l,b[10]=u,b[11]=d,b[12]=h,b[13]=p,b[14]=E,b[15]=g,b};var Wg=Zg;const Qg=(e,t)=>(e[0]=Math.abs(t[0]),e[1]=Math.abs(t[1]),e[2]=Math.abs(t[2]),e);var Td=Qg;const Kg=(e,t,r)=>(e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e);var Pd=Kg;const Jg=(e,t)=>e[0]*t[0]+e[1]*t[1]+e[2]*t[2];var da=Jg;const e5=da,t5=(e,t)=>{const r=e[0],n=e[1],s=e[2],o=t[0],a=t[1],i=t[2],c=Math.sqrt(r*r+n*n+s*s),l=Math.sqrt(o*o+a*a+i*i),u=c*l,d=u&&e5(e,t)/u;return Math.acos(Math.min(Math.max(d,-1),1))};var r5=t5;const n5=()=>[0,0,0];var ha=n5;const s5=ha,o5=e=>{const t=s5();return t[0]=e[0],t[1]=e[1],t[2]=e[2],t};var a5=o5;const i5=(e,t)=>(e[0]=t[0],e[1]=t[1],e[2]=t[2],e);var Md=i5;const c5=(e,t,r)=>{const n=t[0],s=t[1],o=t[2],a=r[0],i=r[1],c=r[2];return e[0]=s*c-o*i,e[1]=o*a-n*c,e[2]=n*i-s*a,e};var Hs=c5;const l5=(e,t)=>{const r=t[0]-e[0],n=t[1]-e[1],s=t[2]-e[2];return Math.sqrt(r*r+n*n+s*s)};var Cd=l5;const f5=(e,t,r)=>(e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e);var u5=f5;const d5=(e,t)=>e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2];var h5=d5;const m5=(e,t)=>(e[0]=t,e[1]=t,e[2]=t,e);var p5=m5;const v5=ha,g5=(e,t,r)=>{const n=v5();return n[0]=e,n[1]=t,n[2]=r,n};var y5=g5;const b5=(e,t,r=0)=>(e[0]=t[0],e[1]=t[1],e[2]=r,e);var w5=b5;const _5=e=>{const t=e[0],r=e[1],n=e[2];return Math.sqrt(t*t+r*r+n*n)};var Od=_5;const x5=(e,t,r,n)=>(e[0]=t[0]+n*(r[0]-t[0]),e[1]=t[1]+n*(r[1]-t[1]),e[2]=t[2]+n*(r[2]-t[2]),e);var E5=x5;const $5=(e,t,r)=>(e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e);var Rd=$5;const A5=(e,t,r)=>(e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e);var Ld=A5;const S5=(e,t,r)=>(e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e);var T5=S5;const P5=(e,t)=>(e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e);var M5=P5;const C5=(e,t)=>{const r=t[0],n=t[1],s=t[2];let o=r*r+n*n+s*s;return o>0&&(o=1/Math.sqrt(o)),e[0]=r*o,e[1]=n*o,e[2]=s*o,e};var Kc=C5;const O5=Td,R5=ha,L5=Hs,F5=(e,t)=>{const r=O5(R5(),t),n=0+(r[0]<r[1]&&r[0]<r[2]),s=0+(r[1]<=r[0]&&r[1]<r[2]),o=0+(r[2]<=r[0]&&r[2]<=r[1]);return L5(e,t,[n,s,o])};var G5=F5;const N5=(e,t,r,n)=>{const s=[],o=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],o[0]=s[0],o[1]=s[1]*Math.cos(n)-s[2]*Math.sin(n),o[2]=s[1]*Math.sin(n)+s[2]*Math.cos(n),e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e};var D5=N5;const k5=(e,t,r,n)=>{const s=[],o=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],o[0]=s[2]*Math.sin(n)+s[0]*Math.cos(n),o[1]=s[1],o[2]=s[2]*Math.cos(n)-s[0]*Math.sin(n),e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e};var I5=k5;const B5=(e,t,r,n)=>{const s=[],o=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],o[0]=s[0]*Math.cos(n)-s[1]*Math.sin(n),o[1]=s[0]*Math.sin(n)+s[1]*Math.cos(n),e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=t[2],e};var z5=B5;const V5=(e,t,r)=>(e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e);var Fd=V5;const q5=(e,t,r)=>(e[0]=Math.round(t[0]/r)*r+0,e[1]=Math.round(t[1]/r)*r+0,e[2]=Math.round(t[2]/r)*r+0,e);var X5=q5;const U5=(e,t)=>{const r=t[0]-e[0],n=t[1]-e[1],s=t[2]-e[2];return r*r+n*n+s*s};var Gd=U5;const j5=e=>{const t=e[0],r=e[1],n=e[2];return t*t+r*r+n*n};var Nd=j5;const H5=(e,t,r)=>(e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e);var ma=H5;const Y5=e=>`[${e[0].toFixed(7)}, ${e[1].toFixed(7)}, ${e[2].toFixed(7)}]`;var Z5=Y5;const W5=(e,t,r)=>{const n=t[0],s=t[1],o=t[2];let a=r[3]*n+r[7]*s+r[11]*o+r[15];return a=a||1,e[0]=(r[0]*n+r[4]*s+r[8]*o+r[12])/a,e[1]=(r[1]*n+r[5]*s+r[9]*o+r[13])/a,e[2]=(r[2]*n+r[6]*s+r[10]*o+r[14])/a,e};var Q5=W5,ze={abs:Td,add:Pd,angle:r5,clone:a5,copy:Md,create:ha,cross:Hs,distance:Cd,divide:u5,dot:da,equals:h5,fromScalar:p5,fromValues:y5,fromVec2:w5,length:Od,lerp:E5,max:Rd,min:Ld,multiply:T5,negate:M5,normalize:Kc,orthogonal:G5,rotateX:D5,rotateY:I5,rotateZ:z5,scale:Fd,snap:X5,squaredDistance:Gd,squaredLength:Nd,subtract:ma,toString:Z5,transform:Q5};const Xr=ze,K5=Sd,J5=(e,t,r)=>{const n=Xr.normalize(Xr.create(),t),s=Xr.normalize(Xr.create(),r),o=Xr.cross(Xr.create(),s,n),a=Xr.dot(s,n);if(a===-1)return K5(e,Math.PI,Xr.orthogonal(o,n));const i=1/(1+a);return e[0]=o[0]*o[0]*i+a,e[1]=o[1]*o[0]*i-o[2],e[2]=o[2]*o[0]*i+o[1],e[3]=0,e[4]=o[0]*o[1]*i+o[2],e[5]=o[1]*o[1]*i+a,e[6]=o[2]*o[1]*i-o[0],e[7]=0,e[8]=o[0]*o[2]*i-o[1],e[9]=o[1]*o[2]*i+o[0],e[10]=o[2]*o[2]*i+a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e};var ey=J5;const{sin:ty,cos:ry}=qt,ny=(e,t)=>{const r=ty(t),n=ry(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e};var sy=ny;const{sin:oy,cos:ay}=qt,iy=(e,t)=>{const r=oy(t),n=ay(t);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e};var cy=iy;const{sin:ly,cos:fy}=qt,uy=(e,t)=>{const r=ly(t),n=fy(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e};var dy=uy;const hy=e=>e[0]===1&&e[1]===0&&e[2]===0&&e[3]===0&&e[4]===0&&e[5]===1&&e[6]===0&&e[7]===0&&e[8]===0&&e[9]===0&&e[10]===1&&e[11]===0&&e[12]===0&&e[13]===0&&e[14]===0&&e[15]===1;var my=hy;const py=e=>Or(e[1])&&Or(e[2])&&Or(e[3])&&Or(e[4])&&Or(e[6])&&Or(e[7])&&Or(e[8])&&Or(e[9])&&Or(e[11])&&e[15]===1,Or=e=>Math.abs(e)<Number.EPSILON;var vy=py;const gy=e=>{const t=e[4]*e[9]-e[8]*e[5],r=e[8]*e[1]-e[0]*e[9],n=e[0]*e[5]-e[4]*e[1];return t*e[2]+r*e[6]+n*e[10]<0};var yy=gy;const by=(e,t)=>{const[r,n,s,o]=t;return e[0]=1-2*r*r,e[1]=-2*n*r,e[2]=-2*s*r,e[3]=0,e[4]=-2*r*n,e[5]=1-2*n*n,e[6]=-2*s*n,e[7]=0,e[8]=-2*r*s,e[9]=-2*n*s,e[10]=1-2*s*s,e[11]=0,e[12]=2*r*o,e[13]=2*n*o,e[14]=2*s*o,e[15]=1,e};var wy=by;const _y=(e,t,r)=>{const n=t[0],s=t[1],o=t[2],a=t[3],i=t[4],c=t[5],l=t[6],u=t[7],d=t[8],h=t[9],p=t[10],E=t[11],g=t[12],b=t[13],P=t[14],F=t[15];let R=r[0],C=r[1],G=r[2],L=r[3];return e[0]=R*n+C*i+G*d+L*g,e[1]=R*s+C*c+G*h+L*b,e[2]=R*o+C*l+G*p+L*P,e[3]=R*a+C*u+G*E+L*F,R=r[4],C=r[5],G=r[6],L=r[7],e[4]=R*n+C*i+G*d+L*g,e[5]=R*s+C*c+G*h+L*b,e[6]=R*o+C*l+G*p+L*P,e[7]=R*a+C*u+G*E+L*F,R=r[8],C=r[9],G=r[10],L=r[11],e[8]=R*n+C*i+G*d+L*g,e[9]=R*s+C*c+G*h+L*b,e[10]=R*o+C*l+G*p+L*P,e[11]=R*a+C*u+G*E+L*F,R=r[12],C=r[13],G=r[14],L=r[15],e[12]=R*n+C*i+G*d+L*g,e[13]=R*s+C*c+G*h+L*b,e[14]=R*o+C*l+G*p+L*P,e[15]=R*a+C*u+G*E+L*F,e};var xy=_y;const{EPS:Ey}=mt,{sin:$y,cos:Ay}=qt,Sy=Ed,Ty=(e,t,r,n)=>{let[s,o,a]=n;const i=s*s+o*o+a*a;if(Math.abs(i)<Ey)return Sy(e,t);const c=1/Math.sqrt(i);s*=c,o*=c,a*=c;const l=$y(r),u=Ay(r),d=1-u,h=t[0],p=t[1],E=t[2],g=t[3],b=t[4],P=t[5],F=t[6],R=t[7],C=t[8],G=t[9],L=t[10],q=t[11],ee=s*s*d+u,oe=o*s*d+a*l,pe=a*s*d-o*l,Q=s*o*d-a*l,Te=o*o*d+u,Xe=a*o*d+s*l,$e=s*a*d+o*l,Ue=o*a*d-s*l,Ne=a*a*d+u;return e[0]=h*ee+b*oe+C*pe,e[1]=p*ee+P*oe+G*pe,e[2]=E*ee+F*oe+L*pe,e[3]=g*ee+R*oe+q*pe,e[4]=h*Q+b*Te+C*Xe,e[5]=p*Q+P*Te+G*Xe,e[6]=E*Q+F*Te+L*Xe,e[7]=g*Q+R*Te+q*Xe,e[8]=h*$e+b*Ue+C*Ne,e[9]=p*$e+P*Ue+G*Ne,e[10]=E*$e+F*Ue+L*Ne,e[11]=g*$e+R*Ue+q*Ne,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e};var Py=Ty;const{sin:My,cos:Cy}=qt,Oy=(e,t,r)=>{const n=My(r),s=Cy(r),o=t[4],a=t[5],i=t[6],c=t[7],l=t[8],u=t[9],d=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*s+l*n,e[5]=a*s+u*n,e[6]=i*s+d*n,e[7]=c*s+h*n,e[8]=l*s-o*n,e[9]=u*s-a*n,e[10]=d*s-i*n,e[11]=h*s-c*n,e};var Ry=Oy;const{sin:Ly,cos:Fy}=qt,Gy=(e,t,r)=>{const n=Ly(r),s=Fy(r),o=t[0],a=t[1],i=t[2],c=t[3],l=t[8],u=t[9],d=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*s-l*n,e[1]=a*s-u*n,e[2]=i*s-d*n,e[3]=c*s-h*n,e[8]=o*n+l*s,e[9]=a*n+u*s,e[10]=i*n+d*s,e[11]=c*n+h*s,e};var Ny=Gy;const{sin:Dy,cos:ky}=qt,Iy=(e,t,r)=>{const n=Dy(r),s=ky(r),o=t[0],a=t[1],i=t[2],c=t[3],l=t[4],u=t[5],d=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*s+l*n,e[1]=a*s+u*n,e[2]=i*s+d*n,e[3]=c*s+h*n,e[4]=l*s-o*n,e[5]=u*s-a*n,e[6]=d*s-i*n,e[7]=h*s-c*n,e};var By=Iy;const zy=(e,t,r)=>{const n=r[0],s=r[1],o=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e};var Vy=zy;const qy=(e,t,r)=>(e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e);var Xy=qy;const Uy=e=>e.map(t=>t.toFixed(7)).toString();var jy=Uy;const Hy=(e,t,r)=>{const n=r[0],s=r[1],o=r[2];let a,i,c,l,u,d,h,p,E,g,b,P;return t===e?(e[12]=t[0]*n+t[4]*s+t[8]*o+t[12],e[13]=t[1]*n+t[5]*s+t[9]*o+t[13],e[14]=t[2]*n+t[6]*s+t[10]*o+t[14],e[15]=t[3]*n+t[7]*s+t[11]*o+t[15]):(a=t[0],i=t[1],c=t[2],l=t[3],u=t[4],d=t[5],h=t[6],p=t[7],E=t[8],g=t[9],b=t[10],P=t[11],e[0]=a,e[1]=i,e[2]=c,e[3]=l,e[4]=u,e[5]=d,e[6]=h,e[7]=p,e[8]=E,e[9]=g,e[10]=b,e[11]=P,e[12]=a*n+u*s+E*o+t[12],e[13]=i*n+d*s+g*o+t[13],e[14]=c*n+h*s+b*o+t[14],e[15]=l*n+p*s+P*o+t[15]),e};var Yy=Hy,ut={add:wg,clone:$g,copy:Ed,create:Qc,invert:Tg,equals:Mg,fromRotation:Sd,fromScaling:qg,fromTaitBryanRotation:Ug,fromTranslation:Hg,fromValues:Wg,fromVectorRotation:ey,fromXRotation:sy,fromYRotation:cy,fromZRotation:dy,identity:Ad,isIdentity:my,isOnlyTransformScale:vy,isMirroring:yy,mirrorByPlane:wy,multiply:xy,rotate:Py,rotateX:Ry,rotateY:Ny,rotateZ:By,scale:Vy,subtract:Xy,toString:jy,translate:Yy};const Zy=ut,Wy=e=>(e===void 0&&(e=[]),{sides:e,transforms:Zy.create()});var pa=Wy;const Qy=(e,t)=>(e[0]=Math.abs(t[0]),e[1]=Math.abs(t[1]),e);var Ky=Qy;const Jy=(e,t,r)=>(e[0]=t[0]+r[0],e[1]=t[1]+r[1],e);var eb=Jy,Dd={exports:{}};const tb=e=>Math.atan2(e[1],e[0]);var Jc=tb;(function(e){e.exports=Jc})(Dd);const rb=Jc,nb=e=>rb(e)*57.29577951308232;var sb=nb;const ob=()=>[0,0];var va=ob;const ab=va,ib=e=>{const t=ab();return t[0]=e[0],t[1]=e[1],t};var cb=ib;const lb=(e,t)=>(e[0]=t[0],e[1]=t[1],e);var fb=lb;const ub=(e,t,r)=>(e[0]=0,e[1]=0,e[2]=t[0]*r[1]-t[1]*r[0],e);var db=ub;const hb=(e,t)=>{const r=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(r*r+n*n)};var mb=hb;const pb=(e,t,r)=>(e[0]=t[0]/r[0],e[1]=t[1]/r[1],e);var vb=pb;const gb=(e,t)=>e[0]*t[0]+e[1]*t[1];var yb=gb;const bb=(e,t)=>e[0]===t[0]&&e[1]===t[1];var wb=bb;const{sin:_b,cos:xb}=qt,Eb=(e,t)=>(e[0]=xb(t),e[1]=_b(t),e);var kd=Eb;const $b=kd,Ab=(e,t)=>$b(e,Math.PI*t/180);var Sb=Ab;const Tb=(e,t)=>(e[0]=t,e[1]=t,e);var Pb=Tb;const Mb=va,Cb=(e,t)=>{const r=Mb();return r[0]=e,r[1]=t,r};var Ob=Cb;const Rb=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]);var Lb=Rb;const Fb=(e,t,r,n)=>{const s=t[0],o=t[1];return e[0]=s+n*(r[0]-s),e[1]=o+n*(r[1]-o),e};var Gb=Fb;const Nb=(e,t,r)=>(e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e);var Db=Nb;const kb=(e,t,r)=>(e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e);var Ib=kb;const Bb=(e,t,r)=>(e[0]=t[0]*r[0],e[1]=t[1]*r[1],e);var zb=Bb;const Vb=(e,t)=>(e[0]=-t[0],e[1]=-t[1],e);var qb=Vb;const Xb=(e,t,r,n)=>{const s=t[0]-r[0],o=t[1]-r[1],a=Math.cos(n),i=Math.sin(n);return e[0]=s*a-o*i+r[0],e[1]=s*i+o*a+r[1],e};var Id=Xb;const Ub=va,jb=Id,Hb=(e,t)=>jb(e,t,Ub(),Math.PI/2);var Yb=Hb;const Zb=(e,t)=>{const r=t[0],n=t[1];let s=r*r+n*n;return s>0&&(s=1/Math.sqrt(s)),e[0]=r*s,e[1]=n*s,e};var Wb=Zb;const Qb=(e,t,r)=>(e[0]=t[0]*r,e[1]=t[1]*r,e);var Kb=Qb;const Jb=(e,t,r)=>(e[0]=Math.round(t[0]/r)*r+0,e[1]=Math.round(t[1]/r)*r+0,e);var e3=Jb;const t3=(e,t)=>{const r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n};var r3=t3;const n3=e=>{const t=e[0],r=e[1];return t*t+r*r};var s3=n3;const o3=(e,t,r)=>(e[0]=t[0]-r[0],e[1]=t[1]-r[1],e);var a3=o3;const i3=e=>`[${e[0].toFixed(7)}, ${e[1].toFixed(7)}]`;var c3=i3;const l3=(e,t,r)=>{const n=t[0],s=t[1];return e[0]=r[0]*n+r[4]*s+r[12],e[1]=r[1]*n+r[5]*s+r[13],e};var f3=l3,rt={abs:Ky,add:eb,angle:Dd.exports,angleDegrees:sb,angleRadians:Jc,clone:cb,copy:fb,create:va,cross:db,distance:mb,divide:vb,dot:yb,equals:wb,fromAngleDegrees:Sb,fromAngleRadians:kd,fromScalar:Pb,fromValues:Ob,length:Lb,lerp:Gb,max:Db,min:Ib,multiply:zb,negate:qb,normal:Yb,normalize:Wb,rotate:Id,scale:Kb,snap:e3,squaredDistance:r3,squaredLength:s3,subtract:a3,toString:c3,transform:f3};const Fi=rt,u3=pa,d3=e=>{if(!Array.isArray(e))throw new Error("the given points must be an array");let t=e.length;if(t<3)throw new Error("the given points must define a closed geometry with three or more points");Fi.equals(e[0],e[t-1])&&--t;const r=[];let n=e[t-1];for(let s=0;s<t;s++){const o=e[s];r.push([Fi.clone(n),Fi.clone(o)]),n=o}return u3(r)};var h3=d3;const m3=ut,C1=rt,p3=pa,v3=e=>{if(e[0]!==0)throw new Error("invalid compact binary data");const t=p3();t.transforms=m3.clone(e.slice(1,17));for(let r=21;r<e.length;r+=4){const n=C1.fromValues(e[r+0],e[r+1]),s=C1.fromValues(e[r+2],e[r+3]);t.sides.push([n,s])}return e[17]>=0&&(t.color=[e[17],e[18],e[19],e[20]]),t};var g3=v3;const y3=e=>!!(e&&typeof e=="object"&&"sides"in e&&"transforms"in e&&Array.isArray(e.sides)&&"length"in e.transforms);var Bd=y3;const O1=ut,Fo=rt,b3=e=>(O1.isIdentity(e.transforms)||(e.sides=e.sides.map(t=>{const r=Fo.transform(Fo.create(),t[0],e.transforms),n=Fo.transform(Fo.create(),t[1],e.transforms);return[r,n]}),e.transforms=O1.create()),e);var w3=b3;const _3=w3,x3=e=>_3(e).sides;var Ys=x3;const E3=pa,$3=Ys,A3=e=>{const r=$3(e).map(n=>[n[1],n[0]]);return r.reverse(),E3(r)};var S3=A3;const Ps=rt,T3=Ys,P3=e=>{const t=new Map,r=n=>{const s=n.toString();return t.has(s)?t.get(s):(t.set(s,n),n)};return e.map(n=>n.map(r))},M3=e=>{const t=new Map;return P3(e).forEach(n=>{t.has(n[0])?t.get(n[0]).push(n):t.set(n[0],[n])}),t},C3=e=>{const t=M3(T3(e)),r=[];for(;;){let n;for(const[a,i]of t){if(n=i.shift(),!n){t.delete(a);continue}break}if(n===void 0)break;const s=[],o=n[0];for(;;){s.push(n[0]);const a=n[1];if(a===o)break;const i=t.get(a);if(!i)throw new Error(`geometry is not closed at vertex ${a}`);const c=O3(n,i);i.length===0&&t.delete(a),n=c}s.length>0&&s.push(s.shift()),r.push(s)}return t.clear(),r},O3=(e,t)=>{if(t.length===1)return t.pop();const r=Ps.create(),n=Ps.angleDegrees(Ps.subtract(r,e[1],e[0]));let s,o;t.forEach((i,c)=>{let u=Ps.angleDegrees(Ps.subtract(r,i[1],i[0]))-n;u<-180&&(u+=360),u>=180&&(u-=360),(o===void 0||u>s)&&(o=c,s=u)});const a=t[o];return t.splice(o,1),a};var zd=C3;const R3=Ys,L3=e=>{const r=R3(e).map(n=>n[0]);return r.length>0&&r.push(r.shift()),r};var F3=L3;const R1=rt,G3=Ys,N3=e=>{const t=G3(e);let r="geom2 ("+t.length+` sides):
[
`;return t.forEach(n=>{r+="  ["+R1.toString(n[0])+", "+R1.toString(n[1])+`]
`}),r+=`]
`,r};var D3=N3;const k3=e=>{const t=e.sides,r=e.transforms;let n=[-1,-1,-1,-1];e.color&&(n=e.color);const s=new Float32Array(1+16+4+t.length*4);s[0]=0,s[1]=r[0],s[2]=r[1],s[3]=r[2],s[4]=r[3],s[5]=r[4],s[6]=r[5],s[7]=r[6],s[8]=r[7],s[9]=r[8],s[10]=r[9],s[11]=r[10],s[12]=r[11],s[13]=r[12],s[14]=r[13],s[15]=r[14],s[16]=r[15],s[17]=n[0],s[18]=n[1],s[19]=n[2],s[20]=n[3];for(let o=0;o<t.length;o++){const a=o*4+21,i=t[o][0],c=t[o][1];s[a+0]=i[0],s[a+1]=i[1],s[a+2]=c[0],s[a+3]=c[1]}return s};var I3=k3;const L1=ut,B3=(e,t)=>{const r=L1.multiply(L1.create(),e,t.transforms);return Object.assign({},t,{transforms:r})};var z3=B3;const V3=rt,q3=Bd,X3=zd,U3=e=>{if(!q3(e))throw new Error("invalid geom2 structure");if(X3(e),e.sides.forEach(t=>{if(V3.equals(t[0],t[1]))throw new Error(`geom2 self-edge ${t[0]}`)}),!e.transforms.every(Number.isFinite))throw new Error(`geom2 invalid transforms ${e.transforms}`)};var j3=U3,Je={clone:yg,create:pa,fromPoints:h3,fromCompactBinary:g3,isA:Bd,reverse:S3,toOutlines:zd,toPoints:F3,toSides:Ys,toString:D3,toCompactBinary:I3,transform:z3,validate:j3};const H3=e=>Object.assign({},e);var Y3=H3;const Z3=ut,W3=e=>(e===void 0&&(e=[]),{polygons:e,transforms:Z3.create()});var ga=W3;const Q3=e=>((e===void 0||e.length<3)&&(e=[]),{vertices:e});var is=Q3;const K3=is,J3=ze,ew=(...e)=>{let t,r;return e.length===1?(t=K3(),r=e[0]):(t=e[0],r=e[1]),t.vertices=r.vertices.map(n=>J3.clone(n)),t};var tw=ew;const rw=ze,nw=is,sw=e=>{const t=e.map(r=>rw.clone(r));return nw(t)};var ow=sw;const aw=is,iw=(e,t)=>{const r=aw(e);return r.plane=t,r};var cw=iw;const lw=()=>[0,0,0,0];var ya=lw;const fw=ya,uw=e=>{const t=fw();return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t};var Vd=uw;const dw=(e,t)=>(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e);var qd=dw;const hw=(e,t)=>e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3];var Xd=hw;const mw=(e,t)=>(e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e);var Ud=mw;const Gi=ze,pw=(e,t,r)=>{const n=Gi.normalize(Gi.create(),t),s=Gi.dot(r,n);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=s,e};var vw=pw;const gw=ya,yw=(e,t,r,n)=>{const s=gw();return s[0]=e,s[1]=t,s[2]=r,s[3]=n,s};var jd=yw;const Er=ze,bw=(e,...t)=>{const r=t.length,n=Er.create(),s=Er.create(),o=a=>{const i=t[a],c=t[(a+1)%r],l=t[(a+2)%r];return Er.subtract(n,c,i),Er.subtract(s,l,i),Er.cross(n,n,s),Er.normalize(n,n),n};return e[0]=0,e[1]=0,e[2]=0,r===3?Er.copy(e,o(0)):(t.forEach((a,i)=>{Er.add(e,e,o(i))}),Er.normalize(e,e)),e[3]=Er.dot(e,t[0]),e};var Hd=bw;const{EPS:Ni}=mt,Xt=ze,ww=(e,t,r,n)=>{let s=Xt.subtract(Xt.create(),r,t),o=Xt.subtract(Xt.create(),n,t);Xt.length(s)<Ni&&(s=Xt.orthogonal(s,o)),Xt.length(o)<Ni&&(o=Xt.orthogonal(o,s));let a=Xt.cross(Xt.create(),s,o);Xt.length(a)<Ni&&(o=Xt.orthogonal(o,s),a=Xt.cross(a,s,o)),a=Xt.normalize(a,a);const i=Xt.dot(a,t);return e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=i,e};var _w=ww;const xw=ze,Ew=(e,t)=>{const r=t[0]*e[0]+t[1]*e[1]+t[2]*e[2]-e[3],n=t[0]-r*e[0],s=t[1]-r*e[1],o=t[2]-r*e[2];return xw.fromValues(n,s,o)};var $w=Ew;const Aw=ze,Sw=(e,t)=>Aw.dot(e,t)-e[3];var Yd=Sw;const Tw=e=>`(${e[0].toFixed(9)}, ${e[1].toFixed(9)}, ${e[2].toFixed(9)}, ${e[3].toFixed(9)})`;var Zd=Tw;const Pw=ut,Ut=ze,Mw=Hd,Cw=Ud,Ow=(e,t,r)=>{const n=Pw.isMirroring(r),s=Ut.orthogonal(Ut.create(),t),o=Ut.cross(s,t,s),a=Ut.cross(Ut.create(),t,o);let i=Ut.fromScalar(Ut.create(),t[3]);Ut.multiply(i,i,t);let c=Ut.add(Ut.create(),i,o),l=Ut.add(Ut.create(),i,a);return i=Ut.transform(i,i,r),c=Ut.transform(c,c,r),l=Ut.transform(l,l,r),Mw(e,i,c,l),n&&Cw(e,e),e};var Rw=Ow,Tr={clone:Vd,copy:qd,create:ya,equals:Xd,flip:Ud,fromNormalAndPoint:vw,fromValues:jd,fromPoints:Hd,fromPointsRandom:_w,projectionOfPoint:$w,signedDistanceToPoint:Yd,toString:Zd,transform:Rw};const F1=Tr,Lw=is,Fw=e=>{const t=e.vertices.slice().reverse(),r=Lw(t);return e.plane&&(r.plane=F1.flip(F1.create(),e.plane)),r};var Gw=Fw;const Nw=e=>!!(e&&typeof e=="object"&&"vertices"in e&&Array.isArray(e.vertices));var Wd=Nw;const G1=Tr,vn=ze,Dw=e=>kw(e.vertices),kw=e=>{const t=e.length;if(t>2){const r=G1.fromPoints(G1.create(),...e);let n=e[t-2],s=e[t-1];for(let o=0;o<t;o++){const a=e[o];if(!Iw(n,s,a,r))return!1;n=s,s=a}}return!0},Iw=(e,t,r,n)=>{const s=vn.cross(vn.create(),vn.subtract(vn.create(),t,e),vn.subtract(vn.create(),r,t));return vn.dot(s,n)>=0};var Qd=Dw;const N1=Tr,Bw=e=>(e.plane||(e.plane=N1.fromPoints(N1.create(),...e.vertices)),e.plane);var el=Bw;const zw=el,Vw=e=>{const t=e.vertices.length;if(t<3)return 0;const r=e.vertices,n=zw(e),s=Math.abs(n[0]),o=Math.abs(n[1]),a=Math.abs(n[2]);if(s+o+a===0)return 0;let i=3;s>o&&s>a?i=1:o>a&&(i=2);let c=0,l=0,u=1,d=2;switch(i){case 1:for(u=1;u<t;u++)l=u-1,d=(u+1)%t,c+=r[u][1]*(r[d][2]-r[l][2]);c+=r[0][1]*(r[1][2]-r[t-1][2]),c/=2*n[0];break;case 2:for(u=1;u<t;u++)l=u-1,d=(u+1)%t,c+=r[u][2]*(r[d][0]-r[l][0]);c+=r[0][2]*(r[1][0]-r[t-1][0]),c/=2*n[1];break;case 3:default:for(u=1;u<t;u++)l=u-1,d=(u+1)%t,c+=r[u][0]*(r[d][1]-r[l][1]);c+=r[0][0]*(r[1][1]-r[t-1][1]),c/=2*n[2];break}return c};var Kd=Vw;const Ms=ze,qw=e=>{const t=e.vertices,r=t.length,n=r===0?Ms.create():Ms.clone(t[0]),s=Ms.clone(n);for(let o=1;o<r;o++)Ms.min(n,n,t[o]),Ms.max(s,s,t[o]);return[n,s]};var Xw=qw;const Uw=(e,t)=>e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3];var jw=Uw;const Hw=(e,t)=>(e[0]=t,e[1]=t,e[2]=t,e[3]=t,e);var Yw=Hw;const Zw=(e,t,r)=>{const[n,s,o,a]=t;return e[0]=r[0]*n+r[4]*s+r[8]*o+r[12]*a,e[1]=r[1]*n+r[5]*s+r[9]*o+r[13]*a,e[2]=r[2]*n+r[6]*s+r[10]*o+r[14]*a,e[3]=r[3]*n+r[7]*s+r[11]*o+r[15]*a,e};var Ww=Zw,Jd={clone:Vd,copy:qd,create:ya,dot:jw,equals:Xd,fromScalar:Yw,fromValues:jd,toString:Zd,transform:Ww};const Qw=Jd,D1=new WeakMap,Kw=e=>{let t=D1.get(e);if(t)return t;const r=e.vertices,n=Qw.create();if(r.length===0)return n[0]=0,n[1]=0,n[2]=0,n[3]=0,n;let s=r[0],o=s,a=s,i=s,c=s,l=s;r.forEach(p=>{s[0]>p[0]&&(s=p),o[1]>p[1]&&(o=p),a[2]>p[2]&&(a=p),i[0]<p[0]&&(i=p),c[1]<p[1]&&(c=p),l[2]<p[2]&&(l=p)}),n[0]=(s[0]+i[0])*.5,n[1]=(o[1]+c[1])*.5,n[2]=(a[2]+l[2])*.5;const u=n[0]-i[0],d=n[1]-c[1],h=n[2]-l[2];return n[3]=Math.sqrt(u*u+d*d+h*h),D1.set(e,n),n};var Jw=Kw;const Di=ze,e_=e=>{let t=0;const r=e.vertices,n=Di.create();for(let s=0;s<r.length-2;s++)Di.cross(n,r[s+1],r[s+2]),t+=Di.dot(r[0],n);return t/=6,t};var t_=e_;const r_=e=>e.vertices;var n_=r_;const s_=ze,o_=e=>{let t="poly3: vertices: [";return e.vertices.forEach(r=>{t+=`${s_.toString(r)}, `}),t+="]",t};var a_=o_;const i_=ut,k1=ze,c_=is,l_=(e,t)=>{const r=t.vertices.map(n=>k1.transform(k1.create(),n,e));return i_.isMirroring(e)&&r.reverse(),c_(r)};var f_=l_;const u_=Yd,{NEPS:d_}=mt,h_=ze,m_=Wd,p_=Qd,v_=Kd,g_=el,y_=e=>{if(!m_(e))throw new Error("invalid poly3 structure");if(e.vertices.length<3)throw new Error(`poly3 not enough vertices ${e.vertices.length}`);if(v_(e)<=0)throw new Error("poly3 area must be greater than zero");for(let t=0;t<e.vertices.length;t++)if(h_.equals(e.vertices[t],e.vertices[(t+1)%e.vertices.length]))throw new Error(`poly3 duplicate vertex ${e.vertices[t]}`);if(!p_(e))throw new Error("poly3 must be convex");if(e.vertices.forEach(t=>{if(!t.every(Number.isFinite))throw new Error(`poly3 invalid vertex ${t}`)}),e.vertices.length>3){const t=g_(e);e.vertices.forEach(r=>{const n=Math.abs(u_(t,r));if(n>d_)throw new Error(`poly3 must be coplanar: vertex ${r} distance ${n}`)})}};var b_=y_,st={clone:tw,create:is,fromPoints:ow,fromPointsAndPlane:cw,invert:Gw,isA:Wd,isConvex:Qd,measureArea:Kd,measureBoundingBox:Xw,measureBoundingSphere:Jw,measureSignedVolume:t_,plane:el,toPoints:n_,toString:a_,transform:f_,validate:b_};const w_=st,__=ga,x_=e=>{if(!Array.isArray(e))throw new Error("the given points must be an array");const t=e.map((n,s)=>w_.create(n));return __(t)};var E_=x_;const $_=ze,A_=ut,S_=st,T_=ga,P_=e=>{if(e[0]!==1)throw new Error("invalid compact binary data");const t=T_();t.transforms=A_.clone(e.slice(1,17));const r=e[21];let n=22,s=e.length-r*3;for(;s<e.length;){const o=e[n];n++;const a=[];for(let i=0;i<o;i++)a.push($_.fromValues(e[s],e[s+1],e[s+2])),s+=3;t.polygons.push(S_.create(a))}return e[17]>=0&&(t.color=[e[17],e[18],e[19],e[20]]),t};var M_=P_;const I1=ut,C_=st,O_=e=>(I1.isIdentity(e.transforms)||(e.polygons=e.polygons.map(t=>C_.transform(e.transforms,t)),e.transforms=I1.create()),e);var R_=O_;const L_=R_,F_=e=>L_(e).polygons;var ba=F_;const G_=st,N_=ga,D_=ba,k_=e=>{const r=D_(e).map(n=>G_.invert(n));return N_(r)};var I_=k_;const B_=e=>!!(e&&typeof e=="object"&&"polygons"in e&&"transforms"in e&&Array.isArray(e.polygons)&&"length"in e.transforms);var eh=B_;const z_=st,V_=ba,q_=e=>V_(e).map(n=>z_.toPoints(n));var X_=q_;const U_=st,j_=ba,H_=e=>{const t=j_(e);let r="geom3 ("+t.length+` polygons):
`;return t.forEach(n=>{r+="  "+U_.toString(n)+`
`}),r};var Y_=H_;const Z_=st,W_=e=>{const t=e.polygons,r=e.transforms,n=t.length,s=t.reduce((l,u)=>l+u.vertices.length,0);let o=[-1,-1,-1,-1];e.color&&(o=e.color);const a=new Float32Array(1+16+4+1+n+s*3);a[0]=1,a[1]=r[0],a[2]=r[1],a[3]=r[2],a[4]=r[3],a[5]=r[4],a[6]=r[5],a[7]=r[6],a[8]=r[7],a[9]=r[8],a[10]=r[9],a[11]=r[10],a[12]=r[11],a[13]=r[12],a[14]=r[13],a[15]=r[14],a[16]=r[15],a[17]=o[0],a[18]=o[1],a[19]=o[2],a[20]=o[3],a[21]=s;let i=22,c=i+n;return t.forEach(l=>{const u=Z_.toPoints(l);a[i]=u.length,i++;for(let d=0;d<u.length;d++){const h=u[d];a[c+0]=h[0],a[c+1]=h[1],a[c+2]=h[2],c+=3}}),a};var Q_=W_;const B1=ut,K_=(e,t)=>{const r=B1.multiply(B1.create(),e,t.transforms);return Object.assign({},t,{transforms:r})};var J_=K_;const ex=st,tx=eh,rx=e=>{if(!tx(e))throw new Error("invalid geom3 structure");if(e.polygons.forEach(ex.validate),nx(e),!e.transforms.every(Number.isFinite))throw new Error(`geom3 invalid transforms ${e.transforms}`)},nx=e=>{const t=new Map;e.polygons.forEach(({vertices:n})=>{n.forEach((s,o)=>{const a=`${s}`,i=`${n[(o+1)%n.length]}`,c=`${a}/${i}`,l=t.has(c)?t.get(c):0;t.set(c,l+1)})});const r=[];if(t.forEach((n,s)=>{const o=s.split("/").reverse().join("/"),a=t.get(o);n!==a&&r.push(s.replace("/"," -> "))}),r.length>0)throw new Error(`non-manifold edges ${r.length}
${r.join(`
`)}`)};var sx=rx,et={clone:Y3,create:ga,fromPoints:E_,fromCompactBinary:M_,invert:I_,isA:eh,toPoints:X_,toPolygons:ba,toString:Y_,toCompactBinary:Q_,transform:J_,validate:sx};const ox=e=>Object.assign({},e);var tl=ox;const{EPS:z1}=mt,ax=rt,ix=tl,cx=e=>{if(e.isClosed)return e;const t=ix(e);if(t.isClosed=!0,t.points.length>1){const r=t.points,n=r[0];let s=r[r.length-1];for(;ax.distance(n,s)<z1*z1&&(r.pop(),r.length!==1);)s=r[r.length-1]}return t};var th=cx;const lx=ut,fx=e=>(e===void 0&&(e=[]),{points:e,isClosed:!1,transforms:lx.create()});var wa=fx;const{EPS:V1}=mt,q1=rt,ux=th,dx=wa,hx=(e,t)=>{const r={closed:!1};let{closed:n}=Object.assign({},r,e),s=dx();if(s.points=t.map(o=>q1.clone(o)),s.points.length>1){const o=s.points[0],a=s.points[s.points.length-1];q1.distance(o,a)<V1*V1&&(n=!0)}return n===!0&&(s=ux(s)),s};var rl=hx;const X1=ut,U1=rt,mx=e=>(X1.isIdentity(e.transforms)||(e.points=e.points.map(t=>U1.transform(U1.create(),t,e.transforms)),e.transforms=X1.create()),e);var px=mx;const vx=px,gx=e=>vx(e).points;var cs=gx;const Ot=rt,yx=rl,bx=cs,wx=(e,t)=>{const r={radius:[0,0],xaxisrotation:0,clockwise:!1,large:!1,segments:16};let{endpoint:n,radius:s,xaxisrotation:o,clockwise:a,large:i,segments:c}=Object.assign({},r,e);if(!Array.isArray(n))throw new Error("endpoint must be an array of X and Y values");if(n.length<2)throw new Error("endpoint must contain X and Y values");if(n=Ot.clone(n),!Array.isArray(s))throw new Error("radius must be an array of X and Y values");if(s.length<2)throw new Error("radius must contain X and Y values");if(c<4)throw new Error("segments must be four or more");const l=1e5;if(t.isClosed)throw new Error("the given path cannot be closed");const u=bx(t);if(u.length<1)throw new Error("the given path must contain one or more points (as the starting point for the arc)");let d=s[0],h=s[1];const p=u[u.length-1];d=Math.round(d*l)/l,h=Math.round(h*l)/l,n=Ot.fromValues(Math.round(n[0]*l)/l,Math.round(n[1]*l)/l);const E=!a;let g=[];if(d===0||h===0)g.push(n);else{d=Math.abs(d),h=Math.abs(h);const P=o,F=Math.cos(P),R=Math.sin(P),C=Ot.subtract(Ot.create(),p,n);Ot.scale(C,C,.5);const G=Math.round((F*C[0]+R*C[1])*l)/l,L=Math.round((-R*C[0]+F*C[1])*l)/l,q=Ot.fromValues(G,L),ee=q[0]*q[0]/(d*d)+q[1]*q[1]/(h*h);if(ee>1){const Nt=Math.sqrt(ee);d*=Nt,h*=Nt,d=Math.round(d*l)/l,h=Math.round(h*l)/l}let oe=Math.sqrt((d*d*h*h-d*d*q[1]*q[1]-h*h*q[0]*q[0])/(d*d*q[1]*q[1]+h*h*q[0]*q[0]));E===i&&(oe=-oe);const pe=Ot.fromValues(d*q[1]/h,-h*q[0]/d);Ot.scale(pe,pe,oe);let Q=Ot.fromValues(F*pe[0]-R*pe[1],R*pe[0]+F*pe[1]);Q=Ot.add(Q,Q,Ot.scale(Ot.create(),Ot.add(Ot.create(),p,n),.5));const Te=Ot.fromValues((q[0]-pe[0])/d,(q[1]-pe[1])/h),Xe=Ot.fromValues((-q[0]-pe[0])/d,(-q[1]-pe[1])/h),$e=Ot.angleRadians(Te);let Ne=Ot.angleRadians(Xe)-$e;Ne=Ne%(2*Math.PI),!E&&Ne>0?Ne-=2*Math.PI:E&&Ne<0&&(Ne+=2*Math.PI);let Lt=Math.ceil(Math.abs(Ne)/(2*Math.PI)*c)+1;Lt<1&&(Lt=1);for(let Nt=1;Nt<Lt;Nt++){const Gr=$e+Nt/Lt*Ne,gr=Math.cos(Gr),Nr=Math.sin(Gr),yr=Ot.fromValues(F*d*gr-R*h*Nr,R*d*gr+F*h*Nr);Ot.add(yr,yr,Q),g.push(yr)}Lt&&g.push(e.endpoint)}return g=u.concat(g),yx({},g)};var _x=wx;const xx=rl,Ex=cs,{equals:$x}=rt,Ax=(...e)=>{let t=!1,r=[];return e.forEach((n,s)=>{const o=Ex(n).slice();if(r.length>0&&o.length>0&&$x(o[0],r[r.length-1])&&o.shift(),o.length>0&&t)throw new Error(`Cannot concatenate to a closed path; check the ${s}th path`);t=n.isClosed,r=r.concat(o)}),xx({closed:t},r)};var rh=Ax;const Sx=rh,Tx=wa,Px=(e,t)=>Sx(t,Tx(e));var nh=Px;const ar=rt,Mx=rt,Cx=nh,Ox=cs,Rx=(e,t)=>{const r={segments:16};let{controlPoints:n,segments:s}=Object.assign({},r,e);if(!Array.isArray(n))throw new Error("controlPoints must be an array of one or more points");if(n.length<1)throw new Error("controlPoints must be an array of one or more points");if(s<4)throw new Error("segments must be four or more");if(t.isClosed)throw new Error("the given geometry cannot be closed");const o=Ox(t);if(o.length<1)throw new Error("the given path must contain one or more points (as the starting point for the bezier curve)");if(n=n.slice(),n[0]===null){if(n.length<2)throw new Error("a null control point must be passed with one more control points");let L=o[o.length-2];if("lastBezierControlPoint"in t&&(L=t.lastBezierControlPoint),!Array.isArray(L))throw new Error("the given path must contain TWO or more points if given a null control point");const q=ar.scale(ar.create(),o[o.length-1],2);ar.subtract(q,q,L),n[0]=q}n.unshift(o[o.length-1]);const i=n.length-1,c=[];let l=1;for(let L=0;L<=i;++L)L>0&&(l*=L),c.push(l);const u=[];for(let L=0;L<=i;++L){const q=c[i]/(c[L]*c[i-L]);u.push(q)}const d=ar.create(),h=ar.create(),p=Mx.create(),E=L=>{let q=1,ee=Math.pow(1-L,i);const oe=L!==1?1/(1-L):1,pe=ar.create();for(let Q=0;Q<=i;++Q){Q===i&&(ee=1);const Te=u[Q]*q*ee,Xe=ar.scale(d,n[Q],Te);ar.add(pe,pe,Xe),q*=L,ee*=oe}return pe},g=[],b=[],P=i+1;for(let L=0;L<P;++L){const q=L/(P-1),ee=E(q);g.push(ee),b.push(q)}let F=1;const R=Math.PI*2/s,C=Math.sin(R);for(;F<g.length-1;){const L=ar.subtract(d,g[F],g[F-1]);ar.normalize(L,L);const q=ar.subtract(h,g[F+1],g[F]);ar.normalize(q,q);const ee=ar.cross(p,L,q);if(Math.abs(ee[2])>C){const oe=b[F-1],pe=b[F+1],Q=oe+(pe-oe)*1/3,Te=oe+(pe-oe)*2/3,Xe=E(Q),$e=E(Te);g.splice(F,1,Xe,$e),b.splice(F,1,Q,Te),F--,F<1&&(F=1)}else++F}g.shift();const G=Cx(g,t);return G.lastBezierControlPoint=n[n.length-2],G};var Lx=Rx;const Fx=rt,j1=cs,Gx=(e,t)=>{if(e.isClosed!==t.isClosed||e.points.length!==t.points.length)return!1;const r=j1(e),n=j1(t),s=r.length;let o=0;do{let a=!1;for(let i=0;i<s;i++)if(!Fx.equals(r[i],n[(i+o)%s])){a=!0;break}if(a===!1)return!0;if(!e.isClosed)return!1}while(++o<s);return!1};var Nx=Gx;const Dx=ut,kx=rt,Ix=wa,Bx=e=>{if(e[0]!==2)throw new Error("invalid compact binary data");const t=Ix();t.transforms=Dx.clone(e.slice(1,17)),t.isClosed=!!e[17];for(let r=22;r<e.length;r+=2){const n=kx.fromValues(e[r],e[r+1]);t.points.push(n)}return e[18]>=0&&(t.color=[e[18],e[19],e[20],e[21]]),t};var zx=Bx;const Vx=e=>!!(e&&typeof e=="object"&&"points"in e&&"transforms"in e&&"isClosed"in e&&Array.isArray(e.points)&&"length"in e.transforms);var sh=Vx;const qx=tl,Xx=e=>{const t=qx(e);return t.points=e.points.slice().reverse(),t};var Ux=Xx;const jx=rt,Hx=cs,Yx=e=>{const t=Hx(e);let r="path ("+t.length+" points, "+e.isClosed+`):
[
`;return t.forEach(n=>{r+="  "+jx.toString(n)+`,
`}),r+=`]
`,r};var Zx=Yx;const Wx=e=>{const t=e.points,r=e.transforms;let n=[-1,-1,-1,-1];e.color&&(n=e.color);const s=new Float32Array(1+16+1+4+t.length*2);s[0]=2,s[1]=r[0],s[2]=r[1],s[3]=r[2],s[4]=r[3],s[5]=r[4],s[6]=r[5],s[7]=r[6],s[8]=r[7],s[9]=r[8],s[10]=r[9],s[11]=r[10],s[12]=r[11],s[13]=r[12],s[14]=r[13],s[15]=r[14],s[16]=r[15],s[17]=e.isClosed?1:0,s[18]=n[0],s[19]=n[1],s[20]=n[2],s[21]=n[3];for(let o=0;o<t.length;o++){const a=o*2+22,i=t[o];s[a]=i[0],s[a+1]=i[1]}return s};var Qx=Wx;const H1=ut,Kx=(e,t)=>{const r=H1.multiply(H1.create(),e,t.transforms);return Object.assign({},t,{transforms:r})};var Jx=Kx;const eE=rt,tE=sh,rE=e=>{if(!tE(e))throw new Error("invalid path2 structure");if(e.points.length>1){for(let t=0;t<e.points.length;t++)if(eE.equals(e.points[t],e.points[(t+1)%e.points.length]))throw new Error(`path2 duplicate points ${e.points[t]}`)}if(e.points.forEach(t=>{if(!t.every(Number.isFinite))throw new Error(`path2 invalid point ${t}`)}),!e.transforms.every(Number.isFinite))throw new Error(`path2 invalid transforms ${e.transforms}`)};var nE=rE,ct={appendArc:_x,appendBezier:Lx,appendPoints:nh,clone:tl,close:th,concat:rh,create:wa,equals:Nx,fromPoints:rl,fromCompactBinary:zx,isA:sh,reverse:Ux,toPoints:cs,toString:Zx,toCompactBinary:Qx,transform:Jx,validate:nE};const sE=Ze,oh=Je,ah=et,ih=ct,ch=st,oE=(e,t)=>{const r=oh.clone(t);return r.color=e,r},aE=(e,t)=>{const r=ah.clone(t);return r.color=e,r},iE=(e,t)=>{const r=ih.clone(t);return r.color=e,r},cE=(e,t)=>{const r=ch.clone(t);return r.color=e,r},lE=(e,...t)=>{if(!Array.isArray(e))throw new Error("color must be an array");if(e.length<3)throw new Error("color must contain R, G and B values");if(e.length===3&&(e=[e[0],e[1],e[2],1]),t=sE(t),t.length===0)throw new Error("wrong number of arguments");const r=t.map(n=>oh.isA(n)?oE(e,n):ah.isA(n)?aE(e,n):ih.isA(n)?iE(e,n):ch.isA(n)?cE(e,n):(n.color=e,n));return r.length===1?r[0]:r};var fE=lE;const uE={black:[0/255,0/255,0/255],silver:[192/255,192/255,192/255],gray:[128/255,128/255,128/255],white:[255/255,255/255,255/255],maroon:[128/255,0/255,0/255],red:[255/255,0/255,0/255],purple:[128/255,0/255,128/255],fuchsia:[255/255,0/255,255/255],green:[0/255,128/255,0/255],lime:[0/255,255/255,0/255],olive:[128/255,128/255,0/255],yellow:[255/255,255/255,0/255],navy:[0/255,0/255,128/255],blue:[0/255,0/255,255/255],teal:[0/255,128/255,128/255],aqua:[0/255,255/255,255/255],aliceblue:[240/255,248/255,255/255],antiquewhite:[250/255,235/255,215/255],aquamarine:[127/255,255/255,212/255],azure:[240/255,255/255,255/255],beige:[245/255,245/255,220/255],bisque:[255/255,228/255,196/255],blanchedalmond:[255/255,235/255,205/255],blueviolet:[138/255,43/255,226/255],brown:[165/255,42/255,42/255],burlywood:[222/255,184/255,135/255],cadetblue:[95/255,158/255,160/255],chartreuse:[127/255,255/255,0/255],chocolate:[210/255,105/255,30/255],coral:[255/255,127/255,80/255],cornflowerblue:[100/255,149/255,237/255],cornsilk:[255/255,248/255,220/255],crimson:[220/255,20/255,60/255],cyan:[0/255,255/255,255/255],darkblue:[0/255,0/255,139/255],darkcyan:[0/255,139/255,139/255],darkgoldenrod:[184/255,134/255,11/255],darkgray:[169/255,169/255,169/255],darkgreen:[0/255,100/255,0/255],darkgrey:[169/255,169/255,169/255],darkkhaki:[189/255,183/255,107/255],darkmagenta:[139/255,0/255,139/255],darkolivegreen:[85/255,107/255,47/255],darkorange:[255/255,140/255,0/255],darkorchid:[153/255,50/255,204/255],darkred:[139/255,0/255,0/255],darksalmon:[233/255,150/255,122/255],darkseagreen:[143/255,188/255,143/255],darkslateblue:[72/255,61/255,139/255],darkslategray:[47/255,79/255,79/255],darkslategrey:[47/255,79/255,79/255],darkturquoise:[0/255,206/255,209/255],darkviolet:[148/255,0/255,211/255],deeppink:[255/255,20/255,147/255],deepskyblue:[0/255,191/255,255/255],dimgray:[105/255,105/255,105/255],dimgrey:[105/255,105/255,105/255],dodgerblue:[30/255,144/255,255/255],firebrick:[178/255,34/255,34/255],floralwhite:[255/255,250/255,240/255],forestgreen:[34/255,139/255,34/255],gainsboro:[220/255,220/255,220/255],ghostwhite:[248/255,248/255,255/255],gold:[255/255,215/255,0/255],goldenrod:[218/255,165/255,32/255],greenyellow:[173/255,255/255,47/255],grey:[128/255,128/255,128/255],honeydew:[240/255,255/255,240/255],hotpink:[255/255,105/255,180/255],indianred:[205/255,92/255,92/255],indigo:[75/255,0/255,130/255],ivory:[255/255,255/255,240/255],khaki:[240/255,230/255,140/255],lavender:[230/255,230/255,250/255],lavenderblush:[255/255,240/255,245/255],lawngreen:[124/255,252/255,0/255],lemonchiffon:[255/255,250/255,205/255],lightblue:[173/255,216/255,230/255],lightcoral:[240/255,128/255,128/255],lightcyan:[224/255,255/255,255/255],lightgoldenrodyellow:[250/255,250/255,210/255],lightgray:[211/255,211/255,211/255],lightgreen:[144/255,238/255,144/255],lightgrey:[211/255,211/255,211/255],lightpink:[255/255,182/255,193/255],lightsalmon:[255/255,160/255,122/255],lightseagreen:[32/255,178/255,170/255],lightskyblue:[135/255,206/255,250/255],lightslategray:[119/255,136/255,153/255],lightslategrey:[119/255,136/255,153/255],lightsteelblue:[176/255,196/255,222/255],lightyellow:[255/255,255/255,224/255],limegreen:[50/255,205/255,50/255],linen:[250/255,240/255,230/255],magenta:[255/255,0/255,255/255],mediumaquamarine:[102/255,205/255,170/255],mediumblue:[0/255,0/255,205/255],mediumorchid:[186/255,85/255,211/255],mediumpurple:[147/255,112/255,219/255],mediumseagreen:[60/255,179/255,113/255],mediumslateblue:[123/255,104/255,238/255],mediumspringgreen:[0/255,250/255,154/255],mediumturquoise:[72/255,209/255,204/255],mediumvioletred:[199/255,21/255,133/255],midnightblue:[25/255,25/255,112/255],mintcream:[245/255,255/255,250/255],mistyrose:[255/255,228/255,225/255],moccasin:[255/255,228/255,181/255],navajowhite:[255/255,222/255,173/255],oldlace:[253/255,245/255,230/255],olivedrab:[107/255,142/255,35/255],orange:[255/255,165/255,0/255],orangered:[255/255,69/255,0/255],orchid:[218/255,112/255,214/255],palegoldenrod:[238/255,232/255,170/255],palegreen:[152/255,251/255,152/255],paleturquoise:[175/255,238/255,238/255],palevioletred:[219/255,112/255,147/255],papayawhip:[255/255,239/255,213/255],peachpuff:[255/255,218/255,185/255],peru:[205/255,133/255,63/255],pink:[255/255,192/255,203/255],plum:[221/255,160/255,221/255],powderblue:[176/255,224/255,230/255],rosybrown:[188/255,143/255,143/255],royalblue:[65/255,105/255,225/255],saddlebrown:[139/255,69/255,19/255],salmon:[250/255,128/255,114/255],sandybrown:[244/255,164/255,96/255],seagreen:[46/255,139/255,87/255],seashell:[255/255,245/255,238/255],sienna:[160/255,82/255,45/255],skyblue:[135/255,206/255,235/255],slateblue:[106/255,90/255,205/255],slategray:[112/255,128/255,144/255],slategrey:[112/255,128/255,144/255],snow:[255/255,250/255,250/255],springgreen:[0/255,255/255,127/255],steelblue:[70/255,130/255,180/255],tan:[210/255,180/255,140/255],thistle:[216/255,191/255,216/255],tomato:[255/255,99/255,71/255],turquoise:[64/255,224/255,208/255],violet:[238/255,130/255,238/255],wheat:[245/255,222/255,179/255],whitesmoke:[245/255,245/255,245/255],yellowgreen:[154/255,205/255,50/255]};var lh=uE;const dE=lh,hE=e=>dE[e.toLowerCase()];var mE=hE;const pE=e=>{if(e=e.replace("#",""),e.length<6)throw new Error("the given notation must contain 3 or more hex values");const t=parseInt(e.substring(0,2),16)/255,r=parseInt(e.substring(2,4),16)/255,n=parseInt(e.substring(4,6),16)/255;if(e.length>=8){const s=parseInt(e.substring(6,8),16)/255;return[t,r,n,s]}return[t,r,n]};var vE=pE;const gE=(e,t,r)=>(r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+(t-e)*6*r:r<1/2?t:r<2/3?e+(t-e)*(2/3-r)*6:e);var fh=gE;const yE=Ze,ki=fh,bE=(...e)=>{if(e=yE(e),e.length<3)throw new Error("values must contain H, S and L values");const t=e[0],r=e[1],n=e[2];let s=n,o=n,a=n;if(r!==0){const i=n<.5?n*(1+r):n+r-n*r,c=2*n-i;s=ki(c,i,t+1/3),o=ki(c,i,t),a=ki(c,i,t-1/3)}if(e.length>3){const i=e[3];return[s,o,a,i]}return[s,o,a]};var wE=bE;const _E=Ze,xE=(...e)=>{if(e=_E(e),e.length<3)throw new Error("values must contain H, S and V values");const t=e[0],r=e[1],n=e[2];let s=0,o=0,a=0;const i=Math.floor(t*6),c=t*6-i,l=n*(1-r),u=n*(1-c*r),d=n*(1-(1-c)*r);switch(i%6){case 0:s=n,o=d,a=l;break;case 1:s=u,o=n,a=l;break;case 2:s=l,o=n,a=d;break;case 3:s=l,o=u,a=n;break;case 4:s=d,o=l,a=n;break;case 5:s=n,o=l,a=u;break}if(e.length>3){const h=e[3];return[s,o,a,h]}return[s,o,a]};var EE=xE;const $E=Ze,AE=(...e)=>{if(e=$E(e),e.length<3)throw new Error("values must contain R, G and B values");const t=e[0]*255,r=e[1]*255,n=e[2]*255;let s=`#${Number(16777216+t*65536+r*256+n).toString(16).substring(1,7)}`;return e.length>3&&(s=s+Number(e[3]*255).toString(16)),s};var SE=AE;const TE=Ze,PE=(...e)=>{if(e=TE(e),e.length<3)throw new Error("values must contain R, G and B values");const t=e[0],r=e[1],n=e[2],s=Math.max(t,r,n),o=Math.min(t,r,n);let a,i;const c=(s+o)/2;if(s===o)a=i=0;else{const l=s-o;switch(i=c>.5?l/(2-s-o):l/(s+o),s){case t:a=(r-n)/l+(r<n?6:0);break;case r:a=(n-t)/l+2;break;case n:a=(t-r)/l+4;break}a/=6}if(e.length>3){const l=e[3];return[a,i,c,l]}return[a,i,c]};var ME=PE;const CE=Ze,OE=(...e)=>{if(e=CE(e),e.length<3)throw new Error("values must contain R, G and B values");const t=e[0],r=e[1],n=e[2],s=Math.max(t,r,n),o=Math.min(t,r,n);let a;const i=s,c=s-o,l=s===0?0:c/s;if(s===o)a=0;else{switch(s){case t:a=(r-n)/c+(r<n?6:0);break;case r:a=(n-t)/c+2;break;case n:a=(t-r)/c+4;break}a/=6}if(e.length>3){const u=e[3];return[a,l,i,u]}return[a,l,i]};var RE=OE,LE={colorize:fE,colorNameToRgb:mE,cssColors:lh,hexToRgb:vE,hslToRgb:wE,hsvToRgb:EE,hueToColorComponent:fh,rgbToHex:SE,rgbToHsl:ME,rgbToHsv:RE};const FE=e=>{if(!Array.isArray(e))throw new Error("Bezier points must be a valid array/");if(e.length<2)throw new Error("Bezier points must contain at least 2 values.");const t=GE(e);return{points:e,pointType:t,dimensions:t==="float_single"?0:e[0].length,permutations:Y1(e.length-1),tangentPermutations:Y1(e.length-2)}},GE=function(e){let t=null;return e.forEach(r=>{let n="";if(Number.isFinite(r))n="float_single";else if(Array.isArray(r))r.forEach(s=>{if(!Number.isFinite(s))throw new Error("Bezier point values must all be numbers.")}),n="float_"+r.length;else throw new Error("Bezier points must all be numbers or arrays of number.");if(t==null)t=n;else if(t!==n)throw new Error("Bezier points must be either all numbers or all arrays of numbers of the same size.")}),t},Y1=function(e){const t=[];for(let r=0;r<=e;r++)t.push(Ii(e)/(Ii(r)*Ii(e-r)));return t},Ii=function(e){let t=1;for(let r=2;r<=e;r++)t*=r;return t};var NE=FE;const DE=(e,t)=>{if(e<0||e>1)throw new Error("Bezier valueAt() input must be between 0 and 1");if(t.pointType==="float_single")return Z1(t,t.points,e);{const r=[];for(let n=0;n<t.dimensions;n++){const s=[];for(let o=0;o<t.points.length;o++)s.push(t.points[o][n]);r.push(Z1(t,s,e))}return r}},Z1=function(e,t,r){const n=t.length-1;let s=0;for(let o=0;o<=n;o++)s+=e.permutations[o]*Math.pow(1-r,n-o)*Math.pow(r,o)*t[o];return s};var kE=DE;const IE=(e,t)=>{if(e<0||e>1)throw new Error("Bezier tangentAt() input must be between 0 and 1");if(t.pointType==="float_single")return W1(t,t.points,e);{const r=[];for(let n=0;n<t.dimensions;n++){const s=[];for(let o=0;o<t.points.length;o++)s.push(t.points[o][n]);r.push(W1(t,s,e))}return r}},W1=function(e,t,r){const n=t.length-1;let s=0;for(let o=0;o<n;o++){const a=n*(t[o+1]-t[o]);s+=e.tangentPermutations[o]*Math.pow(1-r,n-1-o)*Math.pow(r,o)*a}return s};var BE=IE,zE={create:NE,valueAt:kE,tangentAt:BE},VE={bezier:zE};const qE=e=>{let t=0;for(let r=0;r<e.length;r++){const n=(r+1)%e.length;t+=e[r][0]*e[n][1],t-=e[n][0]*e[r][1]}return t/2};var _a=qE;const XE=_a,UE=e=>XE(e.vertices);var uh=UE;const jE=e=>((e===void 0||e.length<3)&&(e=[]),{vertices:e});var dh=jE;const HE=dh,YE=e=>{const t=e.vertices.slice().reverse();return HE(t)};var hh=YE;const ZE=uh,WE=hh,QE=(e,t)=>{if(e.length===0)return 0;const r=t.vertices;return r.length<3?0:(ZE(t)<0&&(t=WE(t)),e.reduce((s,o)=>s+KE(o,r),0)===e.length?1:0)},KE=(e,t)=>{const r=t.length,n=e[0],s=e[1];let o=t[r-1],a=t[0],i=o[1]>s,c=0,l=0;for(let u=r+1;--u;){const d=a[1]>s;if(i!==d){const h=o[0]>n,p=a[0]>n;(h&&p||a[0]-(a[1]-s)*(o[0]-a[0])/(o[1]-a[1])>=n)&&(c=!c)}i=d,o=a,a=t[++l]}return c};var JE=QE,nl={arePointsInside:JE,create:dh,flip:hh,measureArea:uh},sl={geom2:Je,geom3:et,path2:ct,poly2:nl,poly3:st};const e$=()=>[0,1,0];var ol=e$;const t$=ol,r$=e=>{const t=t$();return t[0]=e[0],t[1]=e[1],t[2]=e[2],t};var n$=r$;const Bi=rt,s$=e=>{const t=Bi.normal(Bi.create(),e);return Bi.negate(t,t),t};var al=s$;const Q1=rt,o$=e=>Q1.scale(Q1.create(),e,e[2]);var xa=o$;const a$=rt,i$=al,c$=xa,l$=(e,t)=>{const r=c$(e),n=i$(e),s=(n[1]-r[1])/(n[0]-r[0]),o=r[1]-s*r[0],a=-1/s,c=(t[1]-a*t[0]-o)/(s-a),l=s*c+o;return a$.fromValues(c,l)};var f$=l$;const u$=(e,t)=>(e[0]=t[0],e[1]=t[1],e[2]=t[2],e);var mh=u$;const d$=rt,h$=(e,t)=>{let r=d$.dot(t,e);return r=Math.abs(r-e[2]),r};var m$=h$;const p$=(e,t)=>e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2];var v$=p$;const Cs=rt,g$=(e,t,r)=>{const n=Cs.subtract(Cs.create(),r,t);Cs.normal(n,n),Cs.normalize(n,n);const s=Cs.dot(t,n);return e[0]=n[0],e[1]=n[1],e[2]=s,e};var ph=g$;const y$=ol,b$=(e,t,r)=>{const n=y$();return n[0]=e,n[1]=t,n[2]=r,n};var vh=b$;const{NEPS:zi}=mt,w$=(e,t)=>Math.abs(e[0]-t[0])<=zi&&Math.abs(e[1]-t[1])<=zi&&Math.abs(e[2]-t[2])<=zi;var Ea=w$;const _$=(e,t,r)=>{let n=r-e[1],s=t[1]-e[1];s<0&&(n=-n,s=-s);let o;return n<=0?o=0:n>=s?o=1:s<1e-10?o=.5:o=n/s,e[0]+o*(t[0]-e[0])};var gh=_$;const x$=(e,t,r,n)=>{if(e[0]===t[0]&&e[1]===t[1]||r[0]===n[0]&&r[1]===n[1])return;const s=(n[1]-r[1])*(t[0]-e[0])-(n[0]-r[0])*(t[1]-e[1]);if(Math.abs(s)<Number.MIN_VALUE)return;const o=((n[0]-r[0])*(e[1]-r[1])-(n[1]-r[1])*(e[0]-r[0]))/s,a=((t[0]-e[0])*(e[1]-r[1])-(t[1]-e[1])*(e[0]-r[0]))/s;if(o<0||o>1||a<0||a>1)return;const i=e[0]+o*(t[0]-e[0]),c=e[1]+o*(t[1]-e[1]);return[i,c]};var yh=x$;const E$=(e,t,r,n,s,o)=>{const a=e*n-t*r,i=1/a;let c=s*n-t*o,l=-s*r+e*o;return c*=i,l*=i,[c,l]};var $$=E$,Zs={aboutEqualNormals:Ea,area:_a,cos:qt.cos,interpolateBetween2DPointsForY:gh,intersect:yh,sin:qt.sin,solve2Linear:$$};const A$=rt,{solve2Linear:S$}=Zs,T$=(e,t)=>{const r=S$(e[0],e[1],t[0],t[1],e[2],t[2]);return A$.clone(r)};var P$=T$;const K1=rt,M$=mh,C$=vh,O$=(e,t)=>{const r=K1.negate(K1.create(),t),n=-t[2];return M$(e,C$(r[0],r[1],n))};var R$=O$;const L$=e=>`line2: (${e[0].toFixed(7)}, ${e[1].toFixed(7)}, ${e[2].toFixed(7)})`;var F$=L$;const J1=rt,G$=ph,N$=xa,D$=al,k$=(e,t,r)=>{const n=N$(t),s=D$(t);return J1.transform(n,n,r),J1.transform(s,s,r),G$(e,n,s)};var I$=k$;const B$=xa,z$=(e,t)=>{let r=(e[2]-e[1]*t)/e[0];return Number.isNaN(r)&&(r=B$(e)[0]),r};var V$=z$,il={clone:n$,closestPoint:f$,copy:mh,create:ol,direction:al,distanceToPoint:m$,equals:v$,fromPoints:ph,fromValues:vh,intersectPointOfLines:P$,origin:xa,reverse:R$,toString:F$,transform:I$,xAtY:V$};const eu=ze,q$=()=>[eu.fromValues(0,0,0),eu.fromValues(0,0,1)];var bh=q$;const tu=ze,X$=bh,U$=e=>{const t=X$();return tu.copy(t[0],e[0]),tu.copy(t[1],e[1]),t};var j$=U$;const gn=ze,H$=(e,t)=>{const r=e[0],n=e[1],s=gn.dot(gn.subtract(gn.create(),t,r),n),o=gn.dot(n,n),a=s/o,i=gn.scale(gn.create(),n,a);return gn.add(i,i,r),i};var wh=H$;const ru=ze,Y$=(e,t)=>(ru.copy(e[0],t[0]),ru.copy(e[1],t[1]),e);var Z$=Y$;const W$=e=>e[1];var Q$=W$;const Vi=ze,K$=wh,J$=(e,t)=>{const r=K$(e,t),n=Vi.subtract(Vi.create(),t,r);return Vi.length(n)};var eA=J$;const nu=ze,tA=(e,t)=>!(!nu.equals(e[1],t[1])||!nu.equals(e[0],t[0]));var rA=tA;const Go=ze,nA=(e,t,r)=>{const n=Go.normalize(Go.create(),r);return Go.copy(e[0],t),Go.copy(e[1],n),e};var Ws=nA;const yn=ze,{solve2Linear:qi}=Zs,{EPS:sA}=mt,oA=Ws,aA=(e,t,r)=>{let n=yn.cross(yn.create(),t,r),s=yn.length(n);if(s<sA)throw new Error("parallel planes do not intersect");s=1/s,n=yn.scale(n,n,s);const o=Math.abs(n[0]),a=Math.abs(n[1]),i=Math.abs(n[2]);let c,l;return o>=a&&o>=i?(l=qi(t[1],t[2],r[1],r[2],t[3],r[3]),c=yn.fromValues(0,l[0],l[1])):a>=o&&a>=i?(l=qi(t[0],t[2],r[0],r[2],t[3],r[3]),c=yn.fromValues(l[0],0,l[1])):(l=qi(t[0],t[1],r[0],r[1],t[3],r[3]),c=yn.fromValues(l[0],l[1],0)),oA(e,c,n)};var iA=aA;const su=ze,cA=Ws,lA=(e,t,r)=>{const n=su.subtract(su.create(),r,t);return cA(e,t,n)};var fA=lA;const qn=ze,uA=(e,t)=>{const r=t,n=t[3],s=e[0],o=e[1],a=(n-qn.dot(r,s))/qn.dot(r,o);return qn.add(qn.create(),s,qn.scale(qn.create(),o,a))};var dA=uA;const hA=e=>e[0];var mA=hA;const Xi=ze,pA=Ws,vA=(e,t)=>{const r=Xi.clone(t[0]),n=Xi.negate(Xi.create(),t[1]);return pA(e,r,n)};var gA=vA;const yA=e=>{const t=e[0],r=e[1];return`line3: point: (${t[0].toFixed(7)}, ${t[1].toFixed(7)}, ${t[2].toFixed(7)}) direction: (${r[0].toFixed(7)}, ${r[1].toFixed(7)}, ${r[2].toFixed(7)})`};var bA=yA;const Xn=ze,wA=Ws,_A=(e,t,r)=>{const n=t[0],s=t[1],o=Xn.add(Xn.create(),n,s),a=Xn.transform(Xn.create(),n,r),i=Xn.transform(o,o,r),c=Xn.subtract(i,i,a);return wA(e,a,c)};var xA=_A,EA={clone:j$,closestPoint:wh,copy:Z$,create:bh,direction:Q$,distanceToPoint:eA,equals:rA,fromPlanes:iA,fromPointAndDirection:Ws,fromPoints:fA,intersectPointOfLineAndPlane:dA,origin:mA,reverse:gA,toString:bA,transform:xA},$A={constants:mt,line2:il,line3:EA,mat4:ut,plane:Tr,utils:Zs,vec2:rt,vec3:ze,vec4:Jd};const AA=Ze,_h=Je,xh=et,SA=ct,TA=st,sa=new WeakMap,PA=()=>0,MA=e=>{let t=sa.get(e);return t||(t=_h.toSides(e).reduce((n,s)=>n+(s[0][0]*s[1][1]-s[0][1]*s[1][0]),0),t*=.5,sa.set(e,t),t)},CA=e=>{let t=sa.get(e);return t||(t=xh.toPolygons(e).reduce((n,s)=>n+TA.measureArea(s),0),sa.set(e,t),t)},OA=(...e)=>{if(e=AA(e),e.length===0)throw new Error("wrong number of arguments");const t=e.map(r=>SA.isA(r)?PA():_h.isA(r)?MA(r):xh.isA(r)?CA(r):0);return t.length===1?t[0]:t};var Eh=OA;const RA=Ze,LA=Eh,FA=(...e)=>{if(e=RA(e),e.length===0)throw new Error("measureAggregateArea: no geometries supplied");const t=LA(e);if(e.length===1)return t;const r=0;return t.reduce((n,s)=>n+s,r)};var GA=FA;const NA=Ze,Sr=rt,Os=ze,$h=Je,Ah=et,Sh=ct,ou=st,ns=new WeakMap,DA=e=>{let t=ns.get(e);if(t)return t;const r=Sh.toPoints(e);let n;r.length===0?n=Sr.create():n=Sr.clone(r[0]);let s=Sr.clone(n);return r.forEach(o=>{Sr.min(n,n,o),Sr.max(s,s,o)}),n=[n[0],n[1],0],s=[s[0],s[1],0],t=[n,s],ns.set(e,t),t},kA=e=>{let t=ns.get(e);if(t)return t;const r=$h.toPoints(e);let n;r.length===0?n=Sr.create():n=Sr.clone(r[0]);let s=Sr.clone(n);return r.forEach(o=>{Sr.min(n,n,o),Sr.max(s,s,o)}),n=[n[0],n[1],0],s=[s[0],s[1],0],t=[n,s],ns.set(e,t),t},IA=e=>{let t=ns.get(e);if(t)return t;const r=Ah.toPolygons(e);let n=Os.create();if(r.length>0){const o=ou.toPoints(r[0]);Os.copy(n,o[0])}let s=Os.clone(n);return r.forEach(o=>{ou.toPoints(o).forEach(a=>{Os.min(n,n,a),Os.max(s,s,a)})}),n=[n[0],n[1],n[2]],s=[s[0],s[1],s[2]],t=[n,s],ns.set(e,t),t},BA=(...e)=>{if(e=NA(e),e.length===0)throw new Error("wrong number of arguments");const t=e.map(r=>Sh.isA(r)?DA(r):$h.isA(r)?kA(r):Ah.isA(r)?IA(r):[[0,0,0],[0,0,0]]);return t.length===1?t[0]:t};var Sn=BA;const zA=Ze,VA=Ld,qA=Rd,XA=Sn,UA=(...e)=>{if(e=zA(e),e.length===0)throw new Error("measureAggregateBoundingBox: no geometries supplied");const t=XA(e);if(e.length===1)return t;const r=[[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],[-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE]];return t.reduce((n,s)=>(n=[VA(n[0],n[0],s[0]),qA(n[1],n[1],s[1])],n),r)};var cl=UA;const{EPS:jA}=mt,HA=(e,t)=>{let r=0;for(let n=0;n<t;n++)r+=e[1][n]-e[0][n];return jA*r/t};var Th=HA;const YA=Ze,ZA=cl,WA=Th,{geom2:QA,geom3:KA,path2:JA}=sl,e4=(...e)=>{if(e=YA(e),e.length===0)throw new Error("measureAggregateEpsilon: no geometries supplied");const t=ZA(e);let r=0;return r=e.reduce((n,s)=>JA.isA(s)||QA.isA(s)?Math.max(n,2):KA.isA(s)?Math.max(n,3):0,r),WA(t,r)};var t4=e4;const r4=Ze,n4=Je,Ph=et,s4=ct,o4=st,au=new WeakMap,a4=()=>0,i4=()=>0,c4=e=>{let t=au.get(e);return t||(t=Ph.toPolygons(e).reduce((n,s)=>n+o4.measureSignedVolume(s),0),au.set(e,t),t)},l4=(...e)=>{if(e=r4(e),e.length===0)throw new Error("wrong number of arguments");const t=e.map(r=>s4.isA(r)?a4():n4.isA(r)?i4():Ph.isA(r)?c4(r):0);return t.length===1?t[0]:t};var Mh=l4;const f4=Ze,u4=Mh,d4=(...e)=>{if(e=f4(e),e.length===0)throw new Error("measureAggregateVolume: no geometries supplied");const t=u4(e);if(e.length===1)return t;const r=0;return t.reduce((n,s)=>n+s,r)};var h4=d4;const m4=Ze,Ch=rt,Jt=ze,Oh=Je,Rh=et,Lh=ct,iu=st,ss=new WeakMap,p4=e=>{let t=ss.get(e);if(t!==void 0)return t;const r=Jt.create();let n=0;const s=Lh.toPoints(e);if(s.length>0){let o=0;const a=Jt.create();s.forEach(i=>{Jt.add(r,r,Jt.fromVec2(a,i,0)),o++}),Jt.scale(r,r,1/o),s.forEach(i=>{n=Math.max(n,Ch.squaredDistance(r,i))}),n=Math.sqrt(n)}return t=[r,n],ss.set(e,t),t},v4=e=>{let t=ss.get(e);if(t!==void 0)return t;const r=Jt.create();let n=0;const s=Oh.toSides(e);if(s.length>0){let o=0;const a=Jt.create();s.forEach(i=>{Jt.add(r,r,Jt.fromVec2(a,i[0],0)),o++}),Jt.scale(r,r,1/o),s.forEach(i=>{n=Math.max(n,Ch.squaredDistance(r,i[0]))}),n=Math.sqrt(n)}return t=[r,n],ss.set(e,t),t},g4=e=>{let t=ss.get(e);if(t!==void 0)return t;const r=Jt.create();let n=0;const s=Rh.toPolygons(e);if(s.length>0){let o=0;s.forEach(a=>{iu.toPoints(a).forEach(i=>{Jt.add(r,r,i),o++})}),Jt.scale(r,r,1/o),s.forEach(a=>{iu.toPoints(a).forEach(i=>{n=Math.max(n,Jt.squaredDistance(r,i))})}),n=Math.sqrt(n)}return t=[r,n],ss.set(e,t),t},y4=(...e)=>{e=m4(e);const t=e.map(r=>Lh.isA(r)?p4(r):Oh.isA(r)?v4(r):Rh.isA(r)?g4(r):[[0,0,0],0]);return t.length===1?t[0]:t};var b4=y4;const w4=Ze,_4=Sn,x4=(...e)=>{e=w4(e);const t=e.map(r=>{const n=_4(r);return[n[0][0]+(n[1][0]-n[0][0])/2,n[0][1]+(n[1][1]-n[0][1])/2,n[0][2]+(n[1][2]-n[0][2])/2]});return t.length===1?t[0]:t};var E4=x4;const $4=Ze,Ar=ze,Fh=Je,Gh=et,oa=new WeakMap,A4=e=>{let t=oa.get(e);if(t!==void 0)return t;const r=Fh.toSides(e);let n=0,s=0,o=0;if(r.length>0){for(let i=0;i<r.length;i++){const c=r[i][0],l=r[i][1],u=c[0]*l[1]-c[1]*l[0];n+=u,s+=(c[0]+l[0])*u,o+=(c[1]+l[1])*u}n/=2;const a=1/(n*6);s*=a,o*=a}return t=Ar.fromValues(s,o,0),oa.set(e,t),t},S4=e=>{let t=oa.get(e);if(t!==void 0)return t;t=Ar.create();const r=Gh.toPolygons(e);if(r.length===0)return t;let n=0;const s=Ar.create();return r.forEach(o=>{const a=o.vertices;for(let i=0;i<a.length-2;i++){Ar.cross(s,a[i+1],a[i+2]);const c=Ar.dot(a[0],s)/6;n+=c,Ar.add(s,a[0],a[i+1]),Ar.add(s,s,a[i+2]);const l=Ar.scale(s,s,1/4*c);Ar.add(t,t,l)}}),Ar.scale(t,t,1/n),oa.set(e,t),t},T4=(...e)=>{e=$4(e);const t=e.map(r=>Fh.isA(r)?A4(r):Gh.isA(r)?S4(r):[0,0,0]);return t.length===1?t[0]:t};var P4=T4;const M4=Ze,C4=Sn,O4=(...e)=>{e=M4(e);const t=e.map(r=>{const n=C4(r);return[n[1][0]-n[0][0],n[1][1]-n[0][1],n[1][2]-n[0][2]]});return t.length===1?t[0]:t};var R4=O4;const L4=Ze,{geom2:F4,geom3:G4,path2:N4}=sl,ll=Th,fl=Sn,D4=e=>ll(fl(e),2),k4=e=>ll(fl(e),2),I4=e=>ll(fl(e),3),B4=(...e)=>{if(e=L4(e),e.length===0)throw new Error("wrong number of arguments");const t=e.map(r=>N4.isA(r)?D4(r):F4.isA(r)?k4(r):G4.isA(r)?I4(r):0);return t.length===1?t[0]:t};var Jr=B4,z4={measureAggregateArea:GA,measureAggregateBoundingBox:cl,measureAggregateEpsilon:t4,measureAggregateVolume:h4,measureArea:Eh,measureBoundingBox:Sn,measureBoundingSphere:b4,measureCenter:E4,measureCenterOfMass:P4,measureDimensions:R4,measureEpsilon:Jr,measureVolume:Mh};const V4=(e,t)=>Array.isArray(e)&&e.length>=t?e.every(r=>Number.isFinite(r)):!1,q4=(e,t)=>Number.isFinite(e)&&e>t,X4=(e,t)=>Number.isFinite(e)&&e>=t;var Gt={isNumberArray:V4,isGT:q4,isGTE:X4};const{EPS:cu}=mt,Rr=rt,U4=ct,{isGT:j4,isGTE:Ui,isNumberArray:H4}=Gt,Y4=e=>{const t={center:[0,0],radius:1,startAngle:0,endAngle:Math.PI*2,makeTangent:!1,segments:32};let{center:r,radius:n,startAngle:s,endAngle:o,makeTangent:a,segments:i}=Object.assign({},t,e);if(!H4(r,2))throw new Error("center must be an array of X and Y values");if(!j4(n,0))throw new Error("radius must be greater than zero");if(!Ui(s,0))throw new Error("startAngle must be positive");if(!Ui(o,0))throw new Error("endAngle must be positive");if(!Ui(i,4))throw new Error("segments must be four or more");s=s%(Math.PI*2),o=o%(Math.PI*2);let c=Math.PI*2;s<o&&(c=o-s),s>o&&(c=o+(Math.PI*2-s));const l=Math.acos((n*n+n*n-cu*cu)/(2*n*n)),u=Rr.clone(r);let d;const h=[];if(c<l)d=Rr.fromAngleRadians(Rr.create(),s),Rr.scale(d,d,n),Rr.add(d,d,u),h.push(d);else{const p=Math.max(1,Math.floor(i*(c/(Math.PI*2))))+1;let E=p*.5/c;E>.25&&(E=.25);const g=a?p+2:p;for(let b=0;b<=g;b++){let P=b;a&&(P=(b-1)*(p-2*E)/p+E,P<0&&(P=0),P>p&&(P=p));const F=s+P*(c/p);d=Rr.fromAngleRadians(Rr.create(),F),Rr.scale(d,d,n),Rr.add(d,d,u),h.push(d)}}return U4.fromPoints({closed:!1},h)};var Z4=Y4;const{EPS:lu}=mt,ji=rt,W4=Je,{sin:Q4,cos:K4}=qt,{isGTE:Hi,isNumberArray:fu}=Gt,J4=e=>{const t={center:[0,0],radius:[1,1],startAngle:0,endAngle:Math.PI*2,segments:32};let{center:r,radius:n,startAngle:s,endAngle:o,segments:a}=Object.assign({},t,e);if(!fu(r,2))throw new Error("center must be an array of X and Y values");if(!fu(n,2))throw new Error("radius must be an array of X and Y values");if(!n.every(p=>p>0))throw new Error("radius values must be greater than zero");if(!Hi(s,0))throw new Error("startAngle must be positive");if(!Hi(o,0))throw new Error("endAngle must be positive");if(!Hi(a,3))throw new Error("segments must be three or more");s=s%(Math.PI*2),o=o%(Math.PI*2);let i=Math.PI*2;s<o&&(i=o-s),s>o&&(i=o+(Math.PI*2-s));const c=Math.min(n[0],n[1]),l=Math.acos((c*c+c*c-lu*lu)/(2*c*c));if(i<l)throw new Error("startAngle and endAngle do not define a significant rotation");a=Math.floor(a*(i/(Math.PI*2)));const u=ji.clone(r),d=i/a,h=[];a=i<Math.PI*2?a+1:a;for(let p=0;p<a;p++){const E=d*p+s,g=ji.fromValues(n[0]*K4(E),n[1]*Q4(E));ji.add(g,u,g),h.push(g)}return i<Math.PI*2&&h.push(u),W4.fromPoints(h)};var Nh=J4;const eS=Nh,{isGT:tS}=Gt,rS=e=>{const t={center:[0,0],radius:1,startAngle:0,endAngle:Math.PI*2,segments:32};let{center:r,radius:n,startAngle:s,endAngle:o,segments:a}=Object.assign({},t,e);if(!tS(n,0))throw new Error("radius must be greater than zero");return n=[n,n],eS({center:r,radius:n,startAngle:s,endAngle:o,segments:a})};var Dh=rS;const nS=et,sS=st,{isNumberArray:uu}=Gt,oS=e=>{const t={center:[0,0,0],size:[2,2,2]},{center:r,size:n}=Object.assign({},t,e);if(!uu(r,3))throw new Error("center must be an array of X, Y and Z values");if(!uu(n,3))throw new Error("size must be an array of width, depth and height values");if(!n.every(o=>o>0))throw new Error("size values must be greater than zero");return nS.create([[[0,4,6,2],[-1,0,0]],[[1,3,7,5],[1,0,0]],[[0,1,5,4],[0,-1,0]],[[2,6,7,3],[0,1,0]],[[0,2,3,1],[0,0,-1]],[[4,5,7,6],[0,0,1]]].map(o=>{const a=o[0].map(i=>[r[0]+n[0]/2*(2*!!(i&1)-1),r[1]+n[1]/2*(2*!!(i&2)-1),r[2]+n[2]/2*(2*!!(i&4)-1)]);return sS.create(a)}))};var kh=oS;const aS=kh,{isGT:iS}=Gt,cS=e=>{const t={center:[0,0,0],size:2};let{center:r,size:n}=Object.assign({},t,e);if(!iS(n,0))throw new Error("size must be greater than zero");return n=[n,n,n],aS({center:r,size:n})};var lS=cS;const{EPS:du}=mt,zt=ze,fS=et,uS=st,{sin:dS,cos:hS}=qt,{isGT:mS,isGTE:Yi,isNumberArray:Zi}=Gt,pS=e=>{const t={center:[0,0,0],height:2,startRadius:[1,1],startAngle:0,endRadius:[1,1],endAngle:Math.PI*2,segments:32};let{center:r,height:n,startRadius:s,startAngle:o,endRadius:a,endAngle:i,segments:c}=Object.assign({},t,e);if(!Zi(r,3))throw new Error("center must be an array of X, Y and Z values");if(!mS(n,0))throw new Error("height must be greater then zero");if(!Zi(s,2))throw new Error("startRadius must be an array of X and Y values");if(!s.every(oe=>oe>=0))throw new Error("startRadius values must be positive");if(!Zi(a,2))throw new Error("endRadius must be an array of X and Y values");if(!a.every(oe=>oe>=0))throw new Error("endRadius values must be positive");if(a.every(oe=>oe===0)&&s.every(oe=>oe===0))throw new Error("at least one radius must be positive");if(!Yi(o,0))throw new Error("startAngle must be positive");if(!Yi(i,0))throw new Error("endAngle must be positive");if(!Yi(c,4))throw new Error("segments must be four or more");o=o%(Math.PI*2),i=i%(Math.PI*2);let l=Math.PI*2;o<i&&(l=i-o),o>i&&(l=i+(Math.PI*2-o));const u=Math.min(s[0],s[1],a[0],a[1]),d=Math.acos((u*u+u*u-du*du)/(2*u*u));if(l<d)throw new Error("startAngle and endAngle do not define a significant rotation");const h=Math.floor(c*(l/(Math.PI*2))),p=zt.fromValues(0,0,-(n/2)),E=zt.fromValues(0,0,n/2),g=zt.subtract(zt.create(),E,p),b=zt.fromValues(1,0,0),P=zt.fromValues(0,1,0),F=zt.create(),R=zt.create(),C=zt.create(),G=(oe,pe,Q)=>{const Te=pe*l+o;return zt.scale(F,b,Q[0]*hS(Te)),zt.scale(R,P,Q[1]*dS(Te)),zt.add(F,F,R),zt.scale(C,g,oe),zt.add(C,C,p),zt.add(zt.create(),F,C)},L=(...oe)=>{const pe=oe.map(Q=>zt.add(zt.create(),Q,r));return uS.create(pe)},q=[];for(let oe=0;oe<h;oe++){const pe=oe/h;let Q=(oe+1)/h;l===2*Math.PI&&oe===h-1&&(Q=0),a[0]===s[0]&&a[1]===s[1]?(q.push(L(p,G(0,Q,a),G(0,pe,a))),q.push(L(G(0,Q,a),G(1,Q,a),G(1,pe,a),G(0,pe,a))),q.push(L(E,G(1,pe,a),G(1,Q,a)))):(s[0]>0&&s[1]>0&&q.push(L(p,G(0,Q,s),G(0,pe,s))),(s[0]>0||s[1]>0)&&q.push(L(G(0,pe,s),G(0,Q,s),G(1,pe,a))),a[0]>0&&a[1]>0&&q.push(L(E,G(1,pe,a),G(1,Q,a))),(a[0]>0||a[1]>0)&&q.push(L(G(1,pe,a),G(0,Q,s),G(1,Q,a))))}return l<Math.PI*2&&(q.push(L(p,G(0,0,s),E)),q.push(L(G(0,0,s),G(1,0,a),E)),q.push(L(p,E,G(0,1,s))),q.push(L(G(0,1,s),E,G(1,1,a)))),fS.create(q)};var Ih=pS;const vS=Ih,{isGT:gS}=Gt,yS=e=>{const t={center:[0,0,0],height:2,radius:1,segments:32},{center:r,height:n,radius:s,segments:o}=Object.assign({},t,e);if(!gS(s,0))throw new Error("radius must be greater than zero");return vS({center:r,height:n,startRadius:[s,s],endRadius:[s,s],segments:o})};var bS=yS;const Ve=ze,wS=et,hu=st,{sin:mu,cos:pu}=qt,{isGTE:_S,isNumberArray:vu}=Gt,xS=e=>{const t={center:[0,0,0],radius:[1,1,1],segments:32,axes:[[1,0,0],[0,-1,0],[0,0,1]]},{center:r,radius:n,segments:s,axes:o}=Object.assign({},t,e);if(!vu(r,3))throw new Error("center must be an array of X, Y and Z values");if(!vu(n,3))throw new Error("radius must be an array of X, Y and Z values");if(!n.every(E=>E>0))throw new Error("radius values must be greater than zero");if(!_S(s,4))throw new Error("segments must be four or more");const a=Ve.scale(Ve.create(),Ve.normalize(Ve.create(),o[0]),n[0]),i=Ve.scale(Ve.create(),Ve.normalize(Ve.create(),o[1]),n[1]),c=Ve.scale(Ve.create(),Ve.normalize(Ve.create(),o[2]),n[2]),l=Math.round(s/4);let u;const d=[],h=Ve.create(),p=Ve.create();for(let E=0;E<=s;E++){const g=2*Math.PI*E/s,b=Ve.add(Ve.create(),Ve.scale(h,a,pu(g)),Ve.scale(p,i,mu(g)));if(E>0){let P,F;for(let R=0;R<=l;R++){const C=.5*Math.PI*R/l,G=pu(C),L=mu(C);if(R>0){let q=[],ee;ee=Ve.subtract(Ve.create(),Ve.scale(h,u,P),Ve.scale(p,c,F)),q.push(Ve.add(ee,ee,r)),ee=Ve.subtract(Ve.create(),Ve.scale(h,b,P),Ve.scale(p,c,F)),q.push(Ve.add(ee,ee,r)),R<l&&(ee=Ve.subtract(Ve.create(),Ve.scale(h,b,G),Ve.scale(p,c,L)),q.push(Ve.add(ee,ee,r))),ee=Ve.subtract(Ve.create(),Ve.scale(h,u,G),Ve.scale(p,c,L)),q.push(Ve.add(ee,ee,r)),d.push(hu.create(q)),q=[],ee=Ve.add(Ve.create(),Ve.scale(h,u,P),Ve.scale(p,c,F)),q.push(Ve.add(Ve.create(),r,ee)),ee=Ve.add(ee,Ve.scale(h,b,P),Ve.scale(p,c,F)),q.push(Ve.add(Ve.create(),r,ee)),R<l&&(ee=Ve.add(ee,Ve.scale(h,b,G),Ve.scale(p,c,L)),q.push(Ve.add(Ve.create(),r,ee))),ee=Ve.add(ee,Ve.scale(h,u,G),Ve.scale(p,c,L)),q.push(Ve.add(Ve.create(),r,ee)),q.reverse(),d.push(hu.create(q))}P=G,F=L}}u=b}return wS.create(d)};var Bh=xS;const ES=et,$S=st,{isNumberArray:gu}=Gt,AS=e=>{const t={points:[],faces:[],colors:void 0,orientation:"outward"},{points:r,faces:n,colors:s,orientation:o}=Object.assign({},t,e);if(!(Array.isArray(r)&&Array.isArray(n)))throw new Error("points and faces must be arrays");if(r.length<3)throw new Error("three or more points are required");if(n.length<1)throw new Error("one or more faces are required");if(s){if(!Array.isArray(s))throw new Error("colors must be an array");if(s.length!==n.length)throw new Error("faces and colors must have the same length")}r.forEach((i,c)=>{if(!gu(i,3))throw new Error(`point ${c} must be an array of X, Y, Z values`)}),n.forEach((i,c)=>{if(i.length<3)throw new Error(`face ${c} must contain 3 or more indexes`);if(!gu(i,i.length))throw new Error(`face ${c} must be an array of numbers`)}),o!=="outward"&&n.forEach(i=>i.reverse());const a=n.map((i,c)=>{const l=$S.create(i.map(u=>r[u]));return s&&s[c]&&(l.color=s[c]),l});return ES.create(a)};var zh=AS;const yu=ut,bu=ze,SS=et,TS=zh,{isGT:PS,isGTE:MS}=Gt,CS=e=>{const t={radius:1,frequency:6};let{radius:r,frequency:n}=Object.assign({},t,e);if(!PS(r,0))throw new Error("radius must be greater than zero");if(!MS(n,6))throw new Error("frequency must be six or more");n=Math.floor(n/6);const s=[[.850651,0,-.525731],[.850651,-0,.525731],[-.850651,-0,.525731],[-.850651,0,-.525731],[0,-.525731,.850651],[0,.525731,.850651],[0,.525731,-.850651],[0,-.525731,-.850651],[-.525731,-.850651,-0],[.525731,-.850651,-0],[.525731,.850651,0],[-.525731,.850651,0]],o=[[0,9,1],[1,10,0],[6,7,0],[10,6,0],[7,9,0],[5,1,4],[4,1,9],[5,10,1],[2,8,3],[3,11,2],[2,5,4],[4,8,2],[2,11,5],[3,7,6],[6,11,3],[8,7,3],[9,8,4],[11,10,5],[10,11,6],[8,9,7]],a=(h,p,E)=>{const g=h[0],b=h[1],P=h[2];let F=E;const R=[],C=[];for(let G=0;G<p;G++)for(let L=0;L<p-G;L++){const q=G/p,ee=(G+1)/p,oe=L/(p-G),pe=(L+1)/(p-G),Q=p-G-1?L/(p-G-1):1,Te=[];Te[0]=i(i(g,b,oe),P,q),Te[1]=i(i(g,b,pe),P,q),Te[2]=i(i(g,b,Q),P,ee);for(let Xe=0;Xe<3;Xe++){const $e=bu.length(Te[Xe]);for(let Ue=0;Ue<3;Ue++)Te[Xe][Ue]/=$e}if(R.push(Te[0],Te[1],Te[2]),C.push([F,F+1,F+2]),F+=3,L<p-G-1){const Xe=p-G-1?(L+1)/(p-G-1):1;Te[0]=i(i(g,b,pe),P,q),Te[1]=i(i(g,b,Xe),P,ee),Te[2]=i(i(g,b,Q),P,ee);for(let $e=0;$e<3;$e++){const Ue=bu.length(Te[$e]);for(let Ne=0;Ne<3;Ne++)Te[$e][Ne]/=Ue}R.push(Te[0],Te[1],Te[2]),C.push([F,F+1,F+2]),F+=3}}return{points:R,triangles:C,offset:F}},i=(h,p,E)=>{const g=1-E,b=[];for(let P=0;P<3;P++)b[P]=h[P]*g+p[P]*E;return b};let c=[],l=[],u=0;for(let h=0;h<o.length;h++){const p=a([s[o[h][0]],s[o[h][1]],s[o[h][2]]],n,u);c=c.concat(p.points),l=l.concat(p.triangles),u=p.offset}let d=TS({points:c,faces:l,orientation:"inward"});return r!==1&&(d=SS.transform(yu.fromScaling(yu.create(),[r,r,r]),d)),d};var OS=CS;const RS=ct,LS=e=>{if(!Array.isArray(e))throw new Error("points must be an array");return RS.fromPoints({},e)};var FS=LS;const Wi=Je,GS=e=>{const t={points:[],paths:[]},{points:r,paths:n}=Object.assign({},t,e);if(!(Array.isArray(r)&&Array.isArray(n)))throw new Error("points and paths must be arrays");let s=r;Array.isArray(r[0])&&(Array.isArray(r[0][0])||(s=[r])),s.forEach((c,l)=>{if(!Array.isArray(c))throw new Error("list of points "+l+" must be an array");if(c.length<3)throw new Error("list of points "+l+" must contain three or more points");c.forEach((u,d)=>{if(!Array.isArray(u))throw new Error("list of points "+l+", point "+d+" must be an array");if(u.length<2)throw new Error("list of points "+l+", point "+d+" must contain by X and Y values")})});let o=n;if(n.length===0){let c=0;o=s.map(l=>l.map(u=>c++))}const a=[];s.forEach(c=>c.forEach(l=>a.push(l)));let i=[];return o.forEach(c=>{const l=c.map(d=>a[d]),u=Wi.fromPoints(l);i=i.concat(Wi.toSides(u))}),Wi.create(i)};var NS=GS;const Ur=rt,DS=Je,{isNumberArray:wu}=Gt,kS=e=>{const t={center:[0,0],size:[2,2]},{center:r,size:n}=Object.assign({},t,e);if(!wu(r,2))throw new Error("center must be an array of X and Y values");if(!wu(n,2))throw new Error("size must be an array of X and Y values");if(!n.every(i=>i>0))throw new Error("size values must be greater than zero");const s=[n[0]/2,n[1]/2],o=[s[0],-s[1]],a=[Ur.subtract(Ur.create(),r,s),Ur.add(Ur.create(),r,o),Ur.add(Ur.create(),r,s),Ur.subtract(Ur.create(),r,o)];return DS.fromPoints(a)};var Vh=kS;const{EPS:ta}=mt,Qi=rt,Pt=ze,IS=et,os=st,{sin:BS,cos:zS}=qt,{isGT:VS,isGTE:qS,isNumberArray:_u}=Gt,xu=(e,t,r,n,s,o)=>{const a=Math.PI/2*s/n,i=zS(a),c=BS(a),l=n-s;let u=r*i,d=t[2]-(r-r*c);o||(d=r-r*c-t[2]),u=u>ta?u:0;const h=Pt.add(Pt.create(),e,[t[0]-r,t[1]-r,d]),p=Pt.add(Pt.create(),e,[r-t[0],t[1]-r,d]),E=Pt.add(Pt.create(),e,[r-t[0],r-t[1],d]),g=Pt.add(Pt.create(),e,[t[0]-r,r-t[1],d]),b=[],P=[],F=[],R=[];for(let C=0;C<=l;C++){const G=l>0?Math.PI/2*C/l:0,L=Qi.fromAngleRadians(Qi.create(),G);Qi.scale(L,L,u);const q=Pt.fromVec2(Pt.create(),L);b.push(Pt.add(Pt.create(),h,q)),Pt.rotateZ(q,q,[0,0,0],Math.PI/2),P.push(Pt.add(Pt.create(),p,q)),Pt.rotateZ(q,q,[0,0,0],Math.PI/2),F.push(Pt.add(Pt.create(),E,q)),Pt.rotateZ(q,q,[0,0,0],Math.PI/2),R.push(Pt.add(Pt.create(),g,q))}return o?[b,P,F,R]:(b.reverse(),P.reverse(),F.reverse(),R.reverse(),[R,F,P,b])},Eu=(e,t)=>{const r=[];for(let n=0;n<e.length;n++){const s=e[n],o=t[n];for(let a=0;a<s.length-1;a++)r.push(os.create([s[a],s[a+1],o[a]])),a<o.length-1&&r.push(os.create([o[a],s[a+1],o[a+1]]))}return r},$u=(e,t)=>{const r=[];for(let n=0;n<e.length;n++){let s=e[n],o=t[n];const a=s[s.length-1],i=o[o.length-1],c=(n+1)%e.length;s=e[c],o=t[c];const l=s[0],u=o[0];r.push(os.create([a,l,u,i]))}return r},XS=(e,t)=>{e=[e[3],e[2],e[1],e[0]],e=e.map(o=>o.slice().reverse());const r=[];e.forEach(o=>{o.forEach(a=>r.push(a))});const n=[];t.forEach(o=>{o.forEach(a=>n.push(a))});const s=[];for(let o=0;o<n.length;o++){const a=(o+1)%n.length;s.push(os.create([r[o],r[a],n[a],n[o]]))}return s},US=e=>{const t={center:[0,0,0],size:[2,2,2],roundRadius:.2,segments:32};let{center:r,size:n,roundRadius:s,segments:o}=Object.assign({},t,e);if(!_u(r,3))throw new Error("center must be an array of X, Y and Z values");if(!_u(n,3))throw new Error("size must be an array of X, Y and Z values");if(!n.every(l=>l>0))throw new Error("size values must be greater than zero");if(!VS(s,0))throw new Error("roundRadius must be greater than zero");if(!qS(o,4))throw new Error("segments must be four or more");if(n=n.map(l=>l/2),s>n[0]-ta||s>n[1]-ta||s>n[2]-ta)throw new Error("roundRadius must be smaller then the radius of all dimensions");o=Math.floor(o/4);let a=null,i=null,c=[];for(let l=0;l<=o;l++){const u=xu(r,n,s,o,l,!0),d=xu(r,n,s,o,l,!1);if(l===0&&(c=c.concat(XS(d,u))),a&&(c=c.concat(Eu(a,u),$u(a,u))),i&&(c=c.concat(Eu(i,d),$u(i,d))),l===o){let h=u.map(p=>p[0]);c.push(os.create(h)),h=d.map(p=>p[0]),c.push(os.create(h))}a=u,i=d}return IS.create(c)};var jS=US;const{EPS:Au}=mt,Re=ze,HS=et,YS=st,{sin:Su,cos:Tu}=qt,{isGT:Ki,isGTE:ZS,isNumberArray:WS}=Gt,QS=e=>{const t={center:[0,0,0],height:2,radius:1,roundRadius:.2,segments:32},{center:r,height:n,radius:s,roundRadius:o,segments:a}=Object.assign({},t,e);if(!WS(r,3))throw new Error("center must be an array of X, Y and Z values");if(!Ki(n,0))throw new Error("height must be greater then zero");if(!Ki(s,0))throw new Error("radius must be greater then zero");if(!Ki(o,0))throw new Error("roundRadius must be greater then zero");if(o>s-Au)throw new Error("roundRadius must be smaller then the radius");if(!ZS(a,4))throw new Error("segments must be four or more");const i=[0,0,-(n/2)],c=[0,0,n/2],l=Re.subtract(Re.create(),c,i),u=Re.length(l);if(2*o>u-Au)throw new Error("height must be larger than twice roundRadius");let d;Math.abs(l[0])>Math.abs(l[1])?d=Re.fromValues(0,1,0):d=Re.fromValues(1,0,0);const h=Re.scale(Re.create(),Re.normalize(Re.create(),l),o),p=Re.scale(Re.create(),Re.normalize(Re.create(),Re.cross(Re.create(),h,d)),s),E=Re.scale(Re.create(),Re.normalize(Re.create(),Re.cross(Re.create(),p,h)),s);Re.add(i,i,h),Re.subtract(c,c,h);const g=Math.floor(.25*a),b=L=>{const q=L.map(ee=>Re.add(ee,ee,r));return YS.create(q)},P=[],F=Re.create(),R=Re.create();let C;for(let L=0;L<=a;L++){const q=2*Math.PI*L/a,ee=Re.add(Re.create(),Re.scale(F,p,Tu(q)),Re.scale(R,E,Su(q)));if(L>0){let oe=[];oe.push(Re.add(Re.create(),i,ee)),oe.push(Re.add(Re.create(),i,C)),oe.push(Re.add(Re.create(),c,C)),oe.push(Re.add(Re.create(),c,ee)),P.push(b(oe));let pe,Q;for(let Te=0;Te<=g;Te++){const Xe=.5*Math.PI*Te/g,$e=Tu(Xe),Ue=Su(Xe);if(Te>0){oe=[];let Ne;Ne=Re.add(Re.create(),i,Re.subtract(F,Re.scale(F,C,pe),Re.scale(R,h,Q))),oe.push(Ne),Ne=Re.add(Re.create(),i,Re.subtract(F,Re.scale(F,ee,pe),Re.scale(R,h,Q))),oe.push(Ne),Te<g&&(Ne=Re.add(Re.create(),i,Re.subtract(F,Re.scale(F,ee,$e),Re.scale(R,h,Ue))),oe.push(Ne)),Ne=Re.add(Re.create(),i,Re.subtract(F,Re.scale(F,C,$e),Re.scale(R,h,Ue))),oe.push(Ne),P.push(b(oe)),oe=[],Ne=Re.add(Re.create(),Re.scale(F,C,pe),Re.scale(R,h,Q)),Re.add(Ne,Ne,c),oe.push(Ne),Ne=Re.add(Re.create(),Re.scale(F,ee,pe),Re.scale(R,h,Q)),Re.add(Ne,Ne,c),oe.push(Ne),Te<g&&(Ne=Re.add(Re.create(),Re.scale(F,ee,$e),Re.scale(R,h,Ue)),Re.add(Ne,Ne,c),oe.push(Ne)),Ne=Re.add(Re.create(),Re.scale(F,C,$e),Re.scale(R,h,Ue)),Re.add(Ne,Ne,c),oe.push(Ne),oe.reverse(),P.push(b(oe))}pe=$e,Q=Ue}}C=ee}return HS.create(P)};var KS=QS;const{EPS:Pu}=mt,vt=rt,JS=Je,{isGT:eT,isGTE:tT,isNumberArray:Mu}=Gt,rT=e=>{const t={center:[0,0],size:[2,2],roundRadius:.2,segments:32};let{center:r,size:n,roundRadius:s,segments:o}=Object.assign({},t,e);if(!Mu(r,2))throw new Error("center must be an array of X and Y values");if(!Mu(n,2))throw new Error("size must be an array of X and Y values");if(!n.every(g=>g>0))throw new Error("size values must be greater than zero");if(!eT(s,0))throw new Error("roundRadius must be greater than zero");if(!tT(o,4))throw new Error("segments must be four or more");if(n=n.map(g=>g/2),s>n[0]-Pu||s>n[1]-Pu)throw new Error("roundRadius must be smaller then the radius of all dimensions");const a=Math.floor(o/4),i=vt.add(vt.create(),r,[n[0]-s,n[1]-s]),c=vt.add(vt.create(),r,[s-n[0],n[1]-s]),l=vt.add(vt.create(),r,[s-n[0],s-n[1]]),u=vt.add(vt.create(),r,[n[0]-s,s-n[1]]),d=[],h=[],p=[],E=[];for(let g=0;g<=a;g++){const b=Math.PI/2*g/a,P=vt.fromAngleRadians(vt.create(),b);vt.scale(P,P,s),d.push(vt.add(vt.create(),i,P)),vt.rotate(P,P,vt.create(),Math.PI/2),h.push(vt.add(vt.create(),c,P)),vt.rotate(P,P,vt.create(),Math.PI/2),p.push(vt.add(vt.create(),l,P)),vt.rotate(P,P,vt.create(),Math.PI/2),E.push(vt.add(vt.create(),u,P))}return JS.fromPoints(d.concat(h,p,E))};var nT=rT;const sT=Bh,{isGT:oT}=Gt,aT=e=>{const t={center:[0,0,0],radius:1,segments:32,axes:[[1,0,0],[0,-1,0],[0,0,1]]};let{center:r,radius:n,segments:s,axes:o}=Object.assign({},t,e);if(!oT(n,0))throw new Error("radius must be greater than zero");return n=[n,n,n],sT({center:r,radius:n,segments:s,axes:o})};var qh=aT;const iT=Vh,{isGT:cT}=Gt,lT=e=>{const t={center:[0,0],size:2};let{center:r,size:n}=Object.assign({},t,e);if(!cT(n,0))throw new Error("size must be greater than zero");return n=[n,n],iT({center:r,size:n})};var fT=lT;const Is=rt,uT=Je,{isGT:dT,isGTE:No,isNumberArray:hT}=Gt,mT=(e,t)=>e>0&&t>1&&t<e/2?Math.cos(Math.PI*t/e)/Math.cos(Math.PI*(t-1)/e):0,Cu=(e,t,r,n)=>{const s=Math.PI*2/e,o=[];for(let a=0;a<e;a++){const i=Is.fromAngleRadians(Is.create(),s*a+r);Is.scale(i,i,t),Is.add(i,n,i),o.push(i)}return o},pT=e=>{const t={center:[0,0],vertices:5,outerRadius:1,innerRadius:0,density:2,startAngle:0};let{center:r,vertices:n,outerRadius:s,innerRadius:o,density:a,startAngle:i}=Object.assign({},t,e);if(!hT(r,2))throw new Error("center must be an array of X and Y values");if(!No(n,2))throw new Error("vertices must be two or more");if(!dT(s,0))throw new Error("outerRadius must be greater than zero");if(!No(o,0))throw new Error("innerRadius must be greater than zero");if(!No(i,0))throw new Error("startAngle must be greater than zero");if(n=Math.floor(n),a=Math.floor(a),i=i%(Math.PI*2),o===0){if(!No(a,2))throw new Error("density must be two or more");o=s*mT(n,a)}const c=Is.clone(r),l=Cu(n,s,i,c),u=Cu(n,o,i+Math.PI/n,c),d=[];for(let h=0;h<n;h++)d.push(l[h]),d.push(u[h]);return uT.fromPoints(d)};var vT=pT;const gT=Ze,Ou=ut,Ru=Tr,Lu=Je,Fu=et,Gu=ct,$a=(e,...t)=>{const r={origin:[0,0,0],normal:[0,0,1]},{origin:n,normal:s}=Object.assign({},r,e);if(t=gT(t),t.length===0)throw new Error("wrong number of arguments");const o=Ru.fromNormalAndPoint(Ru.create(),s,n);if(Number.isNaN(o[0]))throw new Error("the given origin and normal do not define a proper plane");const a=Ou.mirrorByPlane(Ou.create(),o),i=t.map(c=>Gu.isA(c)?Gu.transform(a,c):Lu.isA(c)?Lu.transform(a,c):Fu.isA(c)?Fu.transform(a,c):c);return i.length===1?i[0]:i},yT=(...e)=>$a({normal:[1,0,0]},e),bT=(...e)=>$a({normal:[0,1,0]},e),wT=(...e)=>$a({normal:[0,0,1]},e);var Bs={mirror:$a,mirrorX:yT,mirrorY:bT,mirrorZ:wT};const Nu=Tr,bn=ze,_T=e=>{const t=e.edges;if(t.length<3)throw new Error("slices must have 3 or more edges to calculate a plane");const r=t.reduce((a,i)=>bn.add(bn.create(),a,i[0]),bn.create());bn.scale(r,r,1/t.length);let n,s=0;t.forEach(a=>{if(!bn.equals(a[0],a[1])){const i=bn.squaredDistance(r,a[0]);i>s&&(n=a,s=i)}});const o=t.find(a=>bn.equals(a[1],n[0]));return Nu.fromPoints(Nu.create(),o[0],n[0],n[1])};var Xh=_T;const xT=e=>(e||(e=[]),{edges:e});var Tn=xT;const ET=Tn,Du=ze,$T=(...e)=>{let t,r;return e.length===1?(t=ET(),r=e[0]):(t=e[0],r=e[1]),t.edges=r.edges.map(n=>[Du.clone(n[0]),Du.clone(n[1])]),t};var AT=$T;const ST=ze,TT=(e,t)=>{const r=e.edges,n=t.edges;return r.length!==n.length?!1:r.reduce((o,a,i)=>{const c=n[i],l=ST.squaredDistance(a[0],c[0]);return o&&l<Number.EPSILON},!0)};var PT=TT;const Do=ze,MT=Tn,CT=e=>{if(!Array.isArray(e))throw new Error("the given points must be an array");if(e.length<3)throw new Error("the given points must contain THREE or more points");const t=[];let r=e[e.length-1];return e.forEach(n=>{n.length===2&&t.push([Do.fromVec2(Do.create(),r),Do.fromVec2(Do.create(),n)]),n.length===3&&t.push([r,n]),r=n}),MT(t)};var OT=CT;const ko=ze,RT=Tn,LT=e=>{if(!Array.isArray(e))throw new Error("the given sides must be an array");const t=[];return e.forEach(r=>{t.push([ko.fromVec2(ko.create(),r[0]),ko.fromVec2(ko.create(),r[1])])}),RT(t)};var FT=LT;const GT=e=>!!(e&&typeof e=="object"&&"edges"in e&&Array.isArray(e.edges));var NT=GT;const DT=Tn,kT=(...e)=>{let t,r;return e.length===1?(t=DT(),r=e[0]):(t=e[0],r=e[1]),t.edges=r.edges.map(n=>[n[1],n[0]]),t};var IT=kT;const BT=e=>e.edges;var zT=BT;const VT=(e,t)=>{let r,n,s,o,a,i=1;do{n=e,e=null;let c=null;for(a=0;n;){a++,s=n;let l=0;for(r=0;r<i&&(l++,s=s.nextZ,!!s);r++);let u=i;for(;l>0||u>0&&s;)l!==0&&(u===0||!s||t(n)<=t(s))?(o=n,n=n.nextZ,l--):(o=s,s=s.nextZ,u--),c?c.nextZ=o:e=o,o.prevZ=c,c=o;n=s}c.nextZ=null,i*=2}while(a>1);return e};var qT=VT;const XT=qT;class Uh{constructor(t,r,n){this.i=t,this.x=r,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}}const UT=(e,t,r,n)=>{const s=new Uh(e,t,r);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s},jT=e=>{e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)};var jh={Node:Uh,insertNode:UT,removeNode:jT,sortLinked:XT};const HT=(e,t,r,n,s,o,a,i)=>(s-a)*(t-i)-(e-a)*(o-i)>=0&&(e-a)*(n-i)-(r-a)*(t-i)>=0&&(r-a)*(o-i)-(s-a)*(n-i)>=0,YT=(e,t,r)=>(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y);var ul={area:YT,pointInTriangle:HT};const{Node:ku,insertNode:Iu,removeNode:aa}=jh,{area:er}=ul,ZT=(e,t,r,n,s)=>{let o;if(s===tP(e,t,r,n)>0)for(let a=t;a<r;a+=n)o=Iu(a,e[a],e[a+1],o);else for(let a=r-n;a>=t;a-=n)o=Iu(a,e[a],e[a+1],o);return o&&Aa(o,o.next)&&(aa(o),o=o.next),o},Hh=(e,t)=>{if(!e)return e;t||(t=e);let r=e,n;do if(n=!1,!r.steiner&&(Aa(r,r.next)||er(r.prev,r,r.next)===0)){if(aa(r),r=t=r.prev,r===r.next)break;n=!0}else r=r.next;while(n||r!==t);return t},WT=(e,t,r)=>{let n=e;do{const s=n.prev,o=n.next.next;!Aa(s,o)&&Yh(s,n,n.next,o)&&Xs(s,o)&&Xs(o,s)&&(t.push(s.i/r),t.push(n.i/r),t.push(o.i/r),aa(n),aa(n.next),n=e=o),n=n.next}while(n!==e);return Hh(n)},QT=(e,t)=>{let r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&Yh(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1},Xs=(e,t)=>er(e.prev,e,e.next)<0?er(e,t,e.next)>=0&&er(e,e.prev,t)>=0:er(e,t,e.prev)<0||er(e,e.next,t)<0,KT=(e,t)=>{let r=e,n=!1;const s=(e.x+t.x)/2,o=(e.y+t.y)/2;do r.y>o!=r.next.y>o&&r.next.y!==r.y&&s<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next;while(r!==e);return n},JT=(e,t)=>{const r=new ku(e.i,e.x,e.y),n=new ku(t.i,t.x,t.y),s=e.next,o=t.prev;return e.next=t,t.prev=e,r.next=s,s.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n},eP=(e,t)=>e.next.i!==t.i&&e.prev.i!==t.i&&!QT(e,t)&&(Xs(e,t)&&Xs(t,e)&&KT(e,t)&&(er(e.prev,e,t.prev)||er(e,t.prev,t))||Aa(e,t)&&er(e.prev,e,e.next)>0&&er(t.prev,t,t.next)>0),Yh=(e,t,r,n)=>{const s=Math.sign(er(e,t,r)),o=Math.sign(er(e,t,n)),a=Math.sign(er(r,n,e)),i=Math.sign(er(r,n,t));return!!(s!==o&&a!==i||s===0&&Io(e,r,t)||o===0&&Io(e,n,t)||a===0&&Io(r,e,n)||i===0&&Io(r,t,n))},Io=(e,t,r)=>t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y),tP=(e,t,r,n)=>{let s=0;for(let o=t,a=r-n;o<r;o+=n)s+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return s},Aa=(e,t)=>e.x===t.x&&e.y===t.y;var Zh={cureLocalIntersections:WT,filterPoints:Hh,isValidDiagonal:eP,linkedPolygon:ZT,locallyInside:Xs,splitPolygon:JT};const{filterPoints:zc,linkedPolygon:rP,locallyInside:nP,splitPolygon:sP}=Zh,{area:Bu,pointInTriangle:oP}=ul,aP=(e,t,r,n)=>{const s=[];for(let o=0,a=t.length;o<a;o++){const i=t[o]*n,c=o<a-1?t[o+1]*n:e.length,l=rP(e,i,c,n,!1);l===l.next&&(l.steiner=!0),s.push(fP(l))}s.sort((o,a)=>o.x-a.x);for(let o=0;o<s.length;o++)r=iP(s[o],r),r=zc(r,r.next);return r},iP=(e,t)=>{const r=cP(e,t);if(!r)return t;const n=sP(r,e),s=zc(r,r.next);return zc(n,n.next),t===r?s:t},cP=(e,t)=>{let r=t;const n=e.x,s=e.y;let o=-1/0,a;do{if(s<=r.y&&s>=r.next.y&&r.next.y!==r.y){const d=r.x+(s-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(d<=n&&d>o){if(o=d,d===n){if(s===r.y)return r;if(s===r.next.y)return r.next}a=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!a)return null;if(n===o)return a;const i=a,c=a.x,l=a.y;let u=1/0;r=a;do{if(n>=r.x&&r.x>=c&&n!==r.x&&oP(s<l?n:o,s,c,l,s<l?o:n,s,r.x,r.y)){const d=Math.abs(s-r.y)/(n-r.x);nP(r,e)&&(d<u||d===u&&(r.x>a.x||r.x===a.x&&lP(a,r)))&&(a=r,u=d)}r=r.next}while(r!==i);return a},lP=(e,t)=>Bu(e.prev,e,t.prev)<0&&Bu(t.next,e,e.next)<0,fP=e=>{let t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e);return r};var uP=aP;const dP=uP,{removeNode:hP,sortLinked:mP}=jh,{cureLocalIntersections:pP,filterPoints:ia,isValidDiagonal:vP,linkedPolygon:gP,splitPolygon:yP}=Zh,{area:_n,pointInTriangle:zs}=ul,bP=(e,t,r=2)=>{const n=t&&t.length,s=n?t[0]*r:e.length;let o=gP(e,0,s,r,!0);const a=[];if(!o||o.next===o.prev)return a;let i,c,l,u,d;if(n&&(o=dP(e,t,o,r)),e.length>80*r){i=l=e[0],c=u=e[1];for(let h=r;h<s;h+=r){const p=e[h],E=e[h+1];p<i&&(i=p),E<c&&(c=E),p>l&&(l=p),E>u&&(u=E)}d=Math.max(l-i,u-c),d=d!==0?1/d:0}return Us(o,a,r,i,c,d),a},Us=(e,t,r,n,s,o,a)=>{if(!e)return;!a&&o&&EP(e,n,s,o);let i=e,c,l;for(;e.prev!==e.next;){if(c=e.prev,l=e.next,o?_P(e,n,s,o):wP(e)){t.push(c.i/r),t.push(e.i/r),t.push(l.i/r),hP(e),e=l.next,i=l.next;continue}if(e=l,e===i){a?a===1?(e=pP(ia(e),t,r),Us(e,t,r,n,s,o,2)):a===2&&xP(e,t,r,n,s,o):Us(ia(e),t,r,n,s,o,1);break}}},wP=e=>{const t=e.prev,r=e,n=e.next;if(_n(t,r,n)>=0)return!1;let s=e.next.next;for(;s!==e.prev;){if(zs(t.x,t.y,r.x,r.y,n.x,n.y,s.x,s.y)&&_n(s.prev,s,s.next)>=0)return!1;s=s.next}return!0},_P=(e,t,r,n)=>{const s=e.prev,o=e,a=e.next;if(_n(s,o,a)>=0)return!1;const i=s.x<o.x?s.x<a.x?s.x:a.x:o.x<a.x?o.x:a.x,c=s.y<o.y?s.y<a.y?s.y:a.y:o.y<a.y?o.y:a.y,l=s.x>o.x?s.x>a.x?s.x:a.x:o.x>a.x?o.x:a.x,u=s.y>o.y?s.y>a.y?s.y:a.y:o.y>a.y?o.y:a.y,d=Vc(i,c,t,r,n),h=Vc(l,u,t,r,n);let p=e.prevZ,E=e.nextZ;for(;p&&p.z>=d&&E&&E.z<=h;){if(p!==e.prev&&p!==e.next&&zs(s.x,s.y,o.x,o.y,a.x,a.y,p.x,p.y)&&_n(p.prev,p,p.next)>=0||(p=p.prevZ,E!==e.prev&&E!==e.next&&zs(s.x,s.y,o.x,o.y,a.x,a.y,E.x,E.y)&&_n(E.prev,E,E.next)>=0))return!1;E=E.nextZ}for(;p&&p.z>=d;){if(p!==e.prev&&p!==e.next&&zs(s.x,s.y,o.x,o.y,a.x,a.y,p.x,p.y)&&_n(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;E&&E.z<=h;){if(E!==e.prev&&E!==e.next&&zs(s.x,s.y,o.x,o.y,a.x,a.y,E.x,E.y)&&_n(E.prev,E,E.next)>=0)return!1;E=E.nextZ}return!0},xP=(e,t,r,n,s,o)=>{let a=e;do{let i=a.next.next;for(;i!==a.prev;){if(a.i!==i.i&&vP(a,i)){let c=yP(a,i);a=ia(a,a.next),c=ia(c,c.next),Us(a,t,r,n,s,o),Us(c,t,r,n,s,o);return}i=i.next}a=a.next}while(a!==e)},EP=(e,t,r,n)=>{let s=e;do s.z===null&&(s.z=Vc(s.x,s.y,t,r,n)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==e);s.prevZ.nextZ=null,s.prevZ=null,mP(s,o=>o.z)},Vc=(e,t,r,n,s)=>(e=32767*(e-r)*s,t=32767*(t-n)*s,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1);var $P=bP;const{area:AP}=Zs,{toOutlines:SP}=Je,{arePointsInside:TP}=nl,PP=e=>{const t=SP(e),r=[],n=[];t.forEach((a,i)=>{const c=AP(a);c<0?n.push(i):c>0&&r.push(i)});const s=[],o=[];return r.forEach((a,i)=>{const c=t[a];s[i]=[],n.forEach((l,u)=>{const d=t[l];TP([d[0]],{vertices:c})&&(s[i].push(l),o[u]||(o[u]=[]),o[u].push(i))})}),n.forEach((a,i)=>{if(o[i]&&o[i].length>1){const c=MP(o[i],l=>s[l].length);o[i].forEach((l,u)=>{u!==c&&(s[l]=s[l].filter(d=>d!==a))})}}),s.map((a,i)=>({solid:t[r[i]],holes:a.map(c=>t[c])}))},MP=(e,t)=>{let r,n;return e.forEach((s,o)=>{const a=t(s);(n===void 0||a<n)&&(r=o,n=a)}),r};var CP=PP;const OP=Je,zu=Tr,RP=rt,Vt=ze,LP=Xh,FP=CP;class GP{constructor(t){this.plane=LP(t);const r=Vt.orthogonal(Vt.create(),this.plane),n=Vt.cross(Vt.create(),this.plane,r);this.v=Vt.normalize(n,n),this.u=Vt.cross(Vt.create(),this.v,this.plane),this.basisMap=new Map;const s=t.edges.map(a=>a.map(i=>this.to2D(i))),o=OP.create(s);this.roots=FP(o)}to2D(t){const r=RP.fromValues(Vt.dot(t,this.u),Vt.dot(t,this.v));return this.basisMap.set(r,t),r}to3D(t){const r=this.basisMap.get(t);if(r)return r;{console.log("Warning: point not in original slice");const n=Vt.scale(Vt.create(),this.u,t[0]),s=Vt.scale(Vt.create(),this.v,t[1]),o=Vt.scale(Vt.create(),zu,zu[3]),a=Vt.add(n,n,o);return Vt.add(s,s,a)}}}var NP=GP;const DP=st,kP=$P,IP=NP,BP=e=>{const t=new IP(e),r=[];return t.roots.forEach(({solid:n,holes:s})=>{let o=n.length;const a=[];s.forEach((d,h)=>{a.push(o),o+=d.length});const i=[n,...s].flat(),c=i.flat(),l=d=>t.to3D(i[d]),u=kP(c,a);for(let d=0;d<u.length;d+=3){const h=u.slice(d,d+3).map(l);r.push(DP.fromPointsAndPlane(h,t.plane))}}),r};var zP=BP;const Vu=ze,VP=e=>e.reduce((t,r)=>t+=`[${Vu.toString(r[0])}, ${Vu.toString(r[1])}], `,""),qP=e=>`[${VP(e.edges)}]`;var XP=qP;const Bo=ze,UP=Tn,jP=(e,t)=>{const r=t.edges.map(n=>[Bo.transform(Bo.create(),n[0],e),Bo.transform(Bo.create(),n[1],e)]);return UP(r)};var HP=jP,Qs={calculatePlane:Xh,clone:AT,create:Tn,equals:PT,fromPoints:OT,fromSides:FT,isA:NT,reverse:IT,toEdges:zT,toPolygons:zP,toString:XP,transform:HP};const qu=ze,YP=Tn,ZP=e=>{if(!e.edges)return e;let t=e.edges;const r=new Map,n=new Map;t=t.filter(a=>!qu.equals(a[0],a[1])),t.forEach(a=>{const i=a[0].toString(),c=a[1].toString();r.set(i,a[0]),r.set(c,a[1]),n.set(i,(n.get(i)||0)+1),n.set(c,(n.get(c)||0)-1)});const s=[],o=[];return n.forEach((a,i)=>{a<0&&s.push(i),a>0&&o.push(i)}),s.forEach(a=>{const i=r.get(a);let c=1/0,l;o.forEach(u=>{const d=r.get(u),h=qu.distance(i,d);h<c&&(c=h,l=d)}),console.warn(`slice.repair: repairing vertex gap ${i} to ${l} distance ${c}`),t=t.map(u=>u[0].toString()===a?[l,u[1]]:u[1].toString()===a?[u[0],l]:u)}),YP(t)};var WP=ZP;const{EPS:Xu}=mt,Un=ze,zo=st,Uu=Qs,qc=(e,t)=>e===t?e:e<t?qc(t,e):t===1?1:t===0?e:qc(t,e%t),QP=(e,t)=>e*t/qc(e,t),ju=(e,t)=>{const r=e/t.length;if(r===1)return t;const n=Un.fromValues(r,r,r),s=[];return t.forEach(o=>{const a=Un.subtract(Un.create(),o[1],o[0]);Un.divide(a,a,n);let i=o[0];for(let c=1;c<=r;++c){const l=Un.add(Un.create(),i,a);s.push([i,l]),i=l}}),s},Hu=Xu*Xu/2*Math.sin(Math.PI/3),KP=(e,t)=>{let r=Uu.toEdges(e),n=Uu.toEdges(t);if(r.length!==n.length){const o=QP(r.length,n.length);o!==r.length&&(r=ju(o,r)),o!==n.length&&(n=ju(o,n))}const s=[];return r.forEach((o,a)=>{const i=n[a],c=zo.create([o[0],o[1],i[1]]),l=zo.measureArea(c);Number.isFinite(l)&&l>Hu&&s.push(c);const u=zo.create([o[0],i[1],i[0]]),d=zo.measureArea(u);Number.isFinite(d)&&d>Hu&&s.push(u)}),s};var JP=KP;const Yu=ut,Zu=Je,eM=et,Xc=st,Kr=Qs,tM=WP,Wu=JP,rM=(e,t,r)=>{let n=null;return Zu.isA(r)&&(n=Kr.fromSides(Zu.toSides(r))),Xc.isA(r)&&(n=Kr.fromPoints(Xc.toPoints(r))),e===0||e===1?Kr.transform(Yu.fromTranslation(Yu.create(),[0,0,e]),n):null},nM=(e,t)=>{const r={numberOfSlices:2,capStart:!0,capEnd:!0,close:!1,repair:!0,callback:rM},{numberOfSlices:n,capStart:s,capEnd:o,close:a,repair:i,callback:c}=Object.assign({},r,e);if(n<2)throw new Error("numberOfSlices must be 2 or more");i&&(t=tM(t));const l=n-1;let u=null,d=null,h=null,p=[];for(let E=0;E<n;E++){const g=c(E/l,E,t);if(g){if(!Kr.isA(g))throw new Error("the callback function must return slice objects");if(Kr.toEdges(g).length===0)throw new Error("the callback function must return slices with one or more edges");h&&(p=p.concat(Wu(h,g))),E===0&&(u=g),E===n-1&&(d=g),h=g}}if(o){const E=Kr.toPolygons(d);p=p.concat(E)}if(s){const E=Kr.toPolygons(u).map(Xc.invert);p=p.concat(E)}return!s&&!o&&a&&!Kr.equals(d,u)&&(p=p.concat(Wu(d,u))),eM.create(p)};var dl=nM;const Rs=ut,{mirrorX:sM}=Bs,Ls=Je,Ji=Qs,oM=dl,aM=(e,t)=>{const r={segments:12,startAngle:0,angle:Math.PI*2,overflow:"cap"};let{segments:n,startAngle:s,angle:o,overflow:a}=Object.assign({},r,e);if(n<3)throw new Error("segments must be greater then 3");s=Math.abs(s)>Math.PI*2?s%(Math.PI*2):s,o=Math.abs(o)>Math.PI*2?o%(Math.PI*2):o;let i=s+o;if(i=Math.abs(i)>Math.PI*2?i%(Math.PI*2):i,i<s){const F=s;s=i,i=F}let c=i-s;if(c<=0&&(c=Math.PI*2),Math.abs(c)<Math.PI*2){const F=Math.PI*2/n;n=Math.floor(Math.abs(c)/F),Math.abs(c)>n*F&&n++}let l=Ls.toSides(t);if(l.length===0)throw new Error("the given geometry cannot be empty");const u=l.filter(F=>F[0][0]<0),d=l.filter(F=>F[0][0]>=0);u.length>0&&d.length>0&&a==="cap"&&(u.length>d.length?(l=l.map(F=>{let R=F[0],C=F[1];return R=[Math.min(R[0],0),R[1]],C=[Math.min(C[0],0),C[1]],[R,C]}),t=Ls.reverse(Ls.create(l)),t=sM(t)):d.length>=u.length&&(l=l.map(F=>{let R=F[0],C=F[1];return R=[Math.max(R[0],0),R[1]],C=[Math.max(C[0],0),C[1]],[R,C]}),t=Ls.create(l)));const p=c/n,E=Math.abs(c)<Math.PI*2,g=Ji.fromSides(Ls.toSides(t));Ji.reverse(g,g);const b=Rs.create(),P=(F,R,C)=>{let G=p*R+s;return c===Math.PI*2&&R===n&&(G=s),Rs.multiply(b,Rs.fromZRotation(b,G),Rs.fromXRotation(Rs.create(),Math.PI/2)),Ji.transform(b,C)};return e={numberOfSlices:n+1,capStart:E,capEnd:E,close:!E,callback:P},oM(e,g)};var Wh=aM;const iM=Ze,Qu=ut,Ku=Je,Ju=et,e0=ct,Sa=(e,...t)=>{if(!Array.isArray(e))throw new Error("angles must be an array");if(t=iM(t),t.length===0)throw new Error("wrong number of arguments");for(e=e.slice();e.length<3;)e.push(0);const r=e[2],n=e[1],s=e[0],o=Qu.fromTaitBryanRotation(Qu.create(),r,n,s),a=t.map(i=>e0.isA(i)?e0.transform(o,i):Ku.isA(i)?Ku.transform(o,i):Ju.isA(i)?Ju.transform(o,i):i);return a.length===1?a[0]:a},cM=(e,...t)=>Sa([e,0,0],t),lM=(e,...t)=>Sa([0,e,0],t),fM=(e,...t)=>Sa([0,0,e],t);var Vs={rotate:Sa,rotateX:cM,rotateY:lM,rotateZ:fM};const uM=Ze,t0=ut,r0=Je,n0=et,s0=ct,Ta=(e,...t)=>{if(!Array.isArray(e))throw new Error("offset must be an array");if(t=uM(t),t.length===0)throw new Error("wrong number of arguments");for(e=e.slice();e.length<3;)e.push(0);const r=t0.fromTranslation(t0.create(),e),n=t.map(s=>s0.isA(s)?s0.transform(r,s):r0.isA(s)?r0.transform(r,s):n0.isA(s)?n0.transform(r,s):s);return n.length===1?n[0]:n},dM=(e,...t)=>Ta([e,0,0],t),hM=(e,...t)=>Ta([0,e,0],t),mM=(e,...t)=>Ta([0,0,e],t);var En={translate:Ta,translateX:dM,translateY:hM,translateZ:mM};const pM=Wh,{rotate:vM}=Vs,{translate:gM}=En,yM=Dh,{isGT:ec,isGTE:tc}=Gt,bM=e=>{const t={innerRadius:1,innerSegments:32,outerRadius:4,outerSegments:32,innerRotation:0,startAngle:0,outerRotation:Math.PI*2},{innerRadius:r,innerSegments:n,outerRadius:s,outerSegments:o,innerRotation:a,startAngle:i,outerRotation:c}=Object.assign({},t,e);if(!ec(r,0))throw new Error("innerRadius must be greater than zero");if(!tc(n,3))throw new Error("innerSegments must be three or more");if(!ec(s,0))throw new Error("outerRadius must be greater than zero");if(!tc(o,3))throw new Error("outerSegments must be three or more");if(!tc(i,0))throw new Error("startAngle must be positive");if(!ec(c,0))throw new Error("outerRotation must be greater than zero");if(r>=s)throw new Error("inner circle is two large to rotate about the outer circle");let l=yM({radius:r,segments:n});return a!==0&&(l=vM([0,0,a],l)),l=gM([s,0],l),pM({startAngle:i,angle:c,segments:o},l)};var wM=bM;const{NEPS:as}=mt,Fs=rt,_M=Je,{isNumberArray:xM}=Gt,Uc=(e,t,r)=>Math.acos((e*e+t*t-r*r)/(2*e*t)),EM=(e,t,r)=>t>as?Math.sqrt(e*e+r*r-2*e*r*Math.cos(t)):Math.sqrt((e-r)*(e-r)+e*r*t*t*(1-t*t/12)),$M=e=>{if(Math.abs(e[0]+e[1]+e[2]-Math.PI)>as)throw new Error("AAA triangles require angles that sum to PI");const r=e[0],n=e[1],s=Math.PI-r-n,o=1,a=o/Math.sin(s)*Math.sin(r),i=o/Math.sin(s)*Math.sin(n);return ls(r,n,s,a,i,o)},AM=e=>{const t=e[0],r=e[1],n=Math.PI+as-t-r;if(n<as)throw new Error("AAS triangles require angles that sum to PI");const s=e[2],o=s/Math.sin(t)*Math.sin(r),a=s/Math.sin(t)*Math.sin(n);return ls(t,r,n,s,o,a)},SM=e=>{const t=e[0],r=e[2],n=Math.PI+as-t-r;if(n<as)throw new Error("ASA triangles require angles that sum to PI");const s=e[1],o=s/Math.sin(n)*Math.sin(t),a=s/Math.sin(n)*Math.sin(r);return ls(t,r,n,o,a,s)},TM=e=>{const t=e[0],r=e[1],n=e[2],s=EM(t,r,n),o=Uc(s,t,n),a=Math.PI-o-r;return ls(o,r,a,n,s,t)},PM=e=>{const t=e[0],r=e[1],n=e[2],s=Math.asin(r*Math.sin(n)/t),o=Math.PI-s-n,a=t/Math.sin(n)*Math.sin(o);return ls(s,o,n,r,a,t)},MM=e=>{const t=e[1],r=e[2],n=e[0];if(t+r<=n||r+n<=t||n+t<=r)throw new Error("SSS triangle is incorrect, as the longest side is longer than the sum of the other sides");const s=Uc(r,n,t),o=Uc(n,t,r),a=Math.PI-s-o;return ls(s,o,a,t,r,n)},ls=(e,t,r,n,s,o)=>{const a=Fs.fromValues(0,0),i=Fs.fromValues(o,0),c=Fs.fromValues(n,0);return Fs.add(c,Fs.rotate(c,c,[0,0],Math.PI-t),i),_M.fromPoints([a,i,c])},CM=e=>{const t={type:"SSS",values:[1,1,1]};let{type:r,values:n}=Object.assign({},t,e);if(typeof r!="string")throw new Error("triangle type must be a string");if(r=r.toUpperCase(),!((r[0]==="A"||r[0]==="S")&&(r[1]==="A"||r[1]==="S")&&(r[2]==="A"||r[2]==="S")))throw new Error("triangle type must contain three letters; A or S");if(!xM(n,3))throw new Error("triangle values must contain three values");if(!n.every(s=>s>0))throw new Error("triangle values must be greater than zero");switch(r){case"AAA":return $M(n);case"AAS":return AM(n);case"ASA":return SM(n);case"SAS":return TM(n);case"SSA":return PM(n);case"SSS":return MM(n);default:throw new Error("invalid triangle type, try again")}};var OM=CM,Qh={arc:Z4,circle:Dh,cube:lS,cuboid:kh,cylinder:bS,cylinderElliptic:Ih,ellipse:Nh,ellipsoid:Bh,geodesicSphere:OS,line:FS,polygon:NS,polyhedron:zh,rectangle:Vh,roundedCuboid:jS,roundedCylinder:KS,roundedRectangle:nT,sphere:qh,square:fT,star:vT,torus:wM,triangle:OM},RM={height:14,32:[16],33:[10,5,21,5,7,void 0,5,2,4,1,5,0,6,1,5,2],34:[16,4,21,4,14,void 0,12,21,12,14],35:[21,11,25,4,-7,void 0,17,25,10,-7,void 0,4,12,18,12,void 0,3,6,17,6],36:[20,8,25,8,-4,void 0,12,25,12,-4,void 0,17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3],37:[24,21,21,3,0,void 0,8,21,10,19,10,17,9,15,7,14,5,14,3,16,3,18,4,20,6,21,8,21,10,20,13,19,16,19,19,20,21,21,void 0,17,7,15,6,14,4,14,2,16,0,18,0,20,1,21,3,21,5,19,7,17,7],38:[26,23,12,23,13,22,14,21,14,20,13,19,11,17,6,15,3,13,1,11,0,7,0,5,1,4,2,3,4,3,6,4,8,5,9,12,13,13,14,14,16,14,18,13,20,11,21,9,20,8,18,8,16,9,13,11,10,16,3,18,1,20,0,22,0,23,1,23,2],39:[10,5,19,4,20,5,21,6,20,6,18,5,16,4,15],40:[14,11,25,9,23,7,20,5,16,4,11,4,7,5,2,7,-2,9,-5,11,-7],41:[14,3,25,5,23,7,20,9,16,10,11,10,7,9,2,7,-2,5,-5,3,-7],42:[16,8,21,8,9,void 0,3,18,13,12,void 0,13,18,3,12],43:[26,13,18,13,0,void 0,4,9,22,9],44:[10,6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4],45:[26,4,9,22,9],46:[10,5,2,4,1,5,0,6,1,5,2],47:[22,20,25,2,-7],48:[20,9,21,6,20,4,17,3,12,3,9,4,4,6,1,9,0,11,0,14,1,16,4,17,9,17,12,16,17,14,20,11,21,9,21],49:[20,6,17,8,18,11,21,11,0],50:[20,4,16,4,17,5,19,6,20,8,21,12,21,14,20,15,19,16,17,16,15,15,13,13,10,3,0,17,0],51:[20,5,21,16,21,10,13,13,13,15,12,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4],52:[20,13,21,3,7,18,7,void 0,13,21,13,0],53:[20,15,21,5,21,4,12,5,13,8,14,11,14,14,13,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4],54:[20,16,18,15,20,12,21,10,21,7,20,5,17,4,12,4,7,5,3,7,1,10,0,11,0,14,1,16,3,17,6,17,7,16,10,14,12,11,13,10,13,7,12,5,10,4,7],55:[20,17,21,7,0,void 0,3,21,17,21],56:[20,8,21,5,20,4,18,4,16,5,14,7,13,11,12,14,11,16,9,17,7,17,4,16,2,15,1,12,0,8,0,5,1,4,2,3,4,3,7,4,9,6,11,9,12,13,13,15,14,16,16,16,18,15,20,12,21,8,21],57:[20,16,14,15,11,13,9,10,8,9,8,6,9,4,11,3,14,3,15,4,18,6,20,9,21,10,21,13,20,15,18,16,14,16,9,15,4,13,1,10,0,8,0,5,1,4,3],58:[10,5,14,4,13,5,12,6,13,5,14,void 0,5,2,4,1,5,0,6,1,5,2],59:[10,5,14,4,13,5,12,6,13,5,14,void 0,6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4],60:[24,20,18,4,9,20,0],61:[26,4,12,22,12,void 0,4,6,22,6],62:[24,4,18,20,9,4,0],63:[18,3,16,3,17,4,19,5,20,7,21,11,21,13,20,14,19,15,17,15,15,14,13,13,12,9,10,9,7,void 0,9,2,8,1,9,0,10,1,9,2],64:[27,18,13,17,15,15,16,12,16,10,15,9,14,8,11,8,8,9,6,11,5,14,5,16,6,17,8,void 0,12,16,10,14,9,11,9,8,10,6,11,5,void 0,18,16,17,8,17,6,19,5,21,5,23,7,24,10,24,12,23,15,22,17,20,19,18,20,15,21,12,21,9,20,7,19,5,17,4,15,3,12,3,9,4,6,5,4,7,2,9,1,12,0,15,0,18,1,20,2,21,3,void 0,19,16,18,8,18,6,19,5],65:[18,9,21,1,0,void 0,9,21,17,0,void 0,4,7,14,7],66:[21,4,21,4,0,void 0,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,void 0,4,11,13,11,16,10,17,9,18,7,18,4,17,2,16,1,13,0,4,0],67:[21,18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5],68:[21,4,21,4,0,void 0,4,21,11,21,14,20,16,18,17,16,18,13,18,8,17,5,16,3,14,1,11,0,4,0],69:[19,4,21,4,0,void 0,4,21,17,21,void 0,4,11,12,11,void 0,4,0,17,0],70:[18,4,21,4,0,void 0,4,21,17,21,void 0,4,11,12,11],71:[21,18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,18,8,void 0,13,8,18,8],72:[22,4,21,4,0,void 0,18,21,18,0,void 0,4,11,18,11],73:[8,4,21,4,0],74:[16,12,21,12,5,11,2,10,1,8,0,6,0,4,1,3,2,2,5,2,7],75:[21,4,21,4,0,void 0,18,21,4,7,void 0,9,12,18,0],76:[17,4,21,4,0,void 0,4,0,16,0],77:[24,4,21,4,0,void 0,4,21,12,0,void 0,20,21,12,0,void 0,20,21,20,0],78:[22,4,21,4,0,void 0,4,21,18,0,void 0,18,21,18,0],79:[22,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21],80:[21,4,21,4,0,void 0,4,21,13,21,16,20,17,19,18,17,18,14,17,12,16,11,13,10,4,10],81:[22,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21,void 0,12,4,18,-2],82:[21,4,21,4,0,void 0,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,4,11,void 0,11,11,18,0],83:[20,17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3],84:[16,8,21,8,0,void 0,1,21,15,21],85:[22,4,21,4,6,5,3,7,1,10,0,12,0,15,1,17,3,18,6,18,21],86:[18,1,21,9,0,void 0,17,21,9,0],87:[24,2,21,7,0,void 0,12,21,7,0,void 0,12,21,17,0,void 0,22,21,17,0],88:[20,3,21,17,0,void 0,17,21,3,0],89:[18,1,21,9,11,9,0,void 0,17,21,9,11],90:[20,17,21,3,0,void 0,3,21,17,21,void 0,3,0,17,0],91:[14,4,25,4,-7,void 0,5,25,5,-7,void 0,4,25,11,25,void 0,4,-7,11,-7],92:[14,0,21,14,-3],93:[14,9,25,9,-7,void 0,10,25,10,-7,void 0,3,25,10,25,void 0,3,-7,10,-7],94:[16,6,15,8,18,10,15,void 0,3,12,8,17,13,12,void 0,8,17,8,0],95:[16,0,-2,16,-2],96:[10,6,21,5,20,4,18,4,16,5,15,6,16,5,17],97:[19,15,14,15,0,void 0,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],98:[19,4,21,4,0,void 0,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3],99:[18,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],100:[19,15,21,15,0,void 0,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],101:[18,3,8,15,8,15,10,14,12,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],102:[12,10,21,8,21,6,20,5,17,5,0,void 0,2,14,9,14],103:[19,15,14,15,-2,14,-5,13,-6,11,-7,8,-7,6,-6,void 0,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],104:[19,4,21,4,0,void 0,4,10,7,13,9,14,12,14,14,13,15,10,15,0],105:[8,3,21,4,20,5,21,4,22,3,21,void 0,4,14,4,0],106:[10,5,21,6,20,7,21,6,22,5,21,void 0,6,14,6,-3,5,-6,3,-7,1,-7],107:[17,4,21,4,0,void 0,14,14,4,4,void 0,8,8,15,0],108:[8,4,21,4,0],109:[30,4,14,4,0,void 0,4,10,7,13,9,14,12,14,14,13,15,10,15,0,void 0,15,10,18,13,20,14,23,14,25,13,26,10,26,0],110:[19,4,14,4,0,void 0,4,10,7,13,9,14,12,14,14,13,15,10,15,0],111:[19,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3,16,6,16,8,15,11,13,13,11,14,8,14],112:[19,4,14,4,-7,void 0,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3],113:[19,15,14,15,-7,void 0,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],114:[13,4,14,4,0,void 0,4,8,5,11,7,13,9,14,12,14],115:[17,14,11,13,13,10,14,7,14,4,13,3,11,4,9,6,8,11,7,13,6,14,4,14,3,13,1,10,0,7,0,4,1,3,3],116:[12,5,21,5,4,6,1,8,0,10,0,void 0,2,14,9,14],117:[19,4,14,4,4,5,1,7,0,10,0,12,1,15,4,void 0,15,14,15,0],118:[16,2,14,8,0,void 0,14,14,8,0],119:[22,3,14,7,0,void 0,11,14,7,0,void 0,11,14,15,0,void 0,19,14,15,0],120:[17,3,14,14,0,void 0,14,14,3,0],121:[16,2,14,8,0,void 0,14,14,8,0,6,-4,4,-6,2,-7,1,-7],122:[17,14,14,3,0,void 0,3,14,14,14,void 0,3,0,14,0],123:[14,9,25,7,24,6,23,5,21,5,19,6,17,7,16,8,14,8,12,6,10,void 0,7,24,6,22,6,20,7,18,8,17,9,15,9,13,8,11,4,9,8,7,9,5,9,3,8,1,7,0,6,-2,6,-4,7,-6,void 0,6,8,8,6,8,4,7,2,6,1,5,-1,5,-3,6,-5,7,-6,9,-7],124:[8,4,25,4,-7],125:[14,5,25,7,24,8,23,9,21,9,19,8,17,7,16,6,14,6,12,8,10,void 0,7,24,8,22,8,20,7,18,6,17,5,15,5,13,6,11,10,9,6,7,5,5,5,3,6,1,7,0,8,-2,8,-4,7,-6,void 0,8,8,6,6,6,4,7,2,8,1,9,-1,9,-3,8,-5,7,-6,5,-7],126:[24,3,6,3,8,4,11,6,12,8,12,10,11,14,8,16,7,18,7,20,8,21,10,void 0,3,8,4,10,6,11,8,11,10,10,14,7,16,6,18,6,20,7,21,10,21,12]};const LM=RM,FM={xOffset:0,yOffset:0,input:"?",align:"left",font:LM,height:14,lineSpacing:2.142857142857143,letterSpacing:1,extrudeOffset:0},GM=(e,t)=>{!t&&typeof e=="string"&&(e={input:e}),e=e||{};const r=Object.assign({},FM,e);return r.input=t||r.input,r};var Kh=GM;const NM=Kh,DM=(e,t)=>{const{xOffset:r,yOffset:n,input:s,font:o,height:a,extrudeOffset:i}=NM(e,t);let c=s.charCodeAt(0);(!c||!o[c])&&(c=63);const l=[].concat(o[c]),u=(a-i)/o.height,d=i/2,h=l.shift()*u,p=[];let E=[];for(let g=0,b=l.length;g<b;g+=2){const P=u*l[g]+r,F=u*l[g+1]+n+d;if(l[g]!==void 0){E.push([P,F]);continue}p.push(E),E=[],g--}return E.length&&p.push(E),{width:h,height:a,segments:p}};var Jh=DM;const kM=Jh,IM=Kh,o0=(e,t)=>{const{x:r,y:n}=Object.assign({x:0,y:0},e||{}),s=t.segments;let o=null,a=null;for(let i=0,c=s.length;i<c;i++){o=s[i];for(let l=0,u=o.length;l<u;l++)a=o[l],o[l]=[a[0]+r,a[1]+n]}return t},BM=(e,t)=>{const{xOffset:r,yOffset:n,input:s,font:o,height:a,align:i,extrudeOffset:c,lineSpacing:l,letterSpacing:u}=IM(e,t);let[d,h]=[r,n],p,E,g,b,P,F,R={width:0,segments:[]};const C=[];let G=[],L=0;const q=d,ee=()=>{C.push(R),L=Math.max(L,R.width),R={width:0,segments:[]}};for(p=0,E=s.length;p<E;p++){if(g=s[p],b=kM({xOffset:d,yOffset:h,font:o,height:a,extrudeOffset:c},g),g===`
`){d=q,h-=b.height*l,ee();continue}P=b.width*u,R.width+=P,d+=P,g!==" "&&(R.segments=R.segments.concat(b.segments))}for(R.segments.length&&ee(),p=0,E=C.length;p<E;p++)R=C[p],L>R.width&&(F=L-R.width,i==="right"?R=o0({x:F},R):i==="center"&&(R=o0({x:F/2},R))),G=G.concat(R.segments);return G};var zM=BM,VM={vectorChar:Jh,vectorText:zM};const qM=Je,XM=et,UM=ct,jM=e=>{let t;for(const r of e){let n=0;if(qM.isA(r)&&(n=1),XM.isA(r)&&(n=2),UM.isA(r)&&(n=3),t&&n!==t)return!1;t=n}return!0};var Ks=jM;const HM=e=>e*.017453292519943295;var YM=HM;const ZM=(e,t)=>e-t;var em=ZM;const WM=(e,t,r)=>{let n=0,s=e.length;for(;s>n;){const o=Math.floor((n+s)/2),a=e[o];r(t,a)>0?n=o+1:s=o}e.splice(n,0,t)};var QM=WM;const KM=(e,t,r)=>{const n=t>0?e*2*Math.PI/t:0,s=r>0?Math.PI*2/r:0;return Math.ceil(Math.max(n,s,4))};var JM=KM;const e8=e=>e*57.29577951308232;var t8=e8,Mt={areAllShapesTheSameType:Ks,degToRad:YM,flatten:Ze,fnNumberSort:em,insertSorted:QM,radiusToSegments:JM,radToDeg:t8};const a0=rt,r8=Je,n8=(e,t)=>{if(t.vertices.length<4)return null;const r=[],n=t.vertices.filter((a,i)=>a[2]>0?(r.push(i),!0):!1);if(n.length!==2)throw new Error("Assertion failed: fromFakePolygon: not enough points found");const s=n.map(a=>{const i=Math.round(a[0]/e)*e+0,c=Math.round(a[1]/e)*e+0;return a0.fromValues(i,c)});if(a0.equals(s[0],s[1]))return null;const o=r[1]-r[0];if(o===1||o===3)o===1&&s.reverse();else throw new Error("Assertion failed: fromFakePolygon: unknown index ordering");return s},s8=(e,t)=>{const r=t.map(n=>n8(e,n)).filter(n=>n!==null);return r8.create(r)};var hl=s8;const jr=ze,o8=Je,a8=et,i8=st,c8=(e,t,r)=>{const n=[jr.fromVec2(jr.create(),r[0],e),jr.fromVec2(jr.create(),r[1],e),jr.fromVec2(jr.create(),r[1],t),jr.fromVec2(jr.create(),r[0],t)];return i8.create(n)},l8=(e,t)=>{const n=o8.toSides(t).map(o=>c8(e.z0,e.z1,o));return a8.create(n)};var ml=l8;const i0=ut,f8=rt,Rt=ze,An=function(e,t){arguments.length<2&&(t=Rt.orthogonal(Rt.create(),e)),this.v=Rt.normalize(Rt.create(),Rt.cross(Rt.create(),e,t)),this.u=Rt.cross(Rt.create(),this.v,e),this.plane=e,this.planeorigin=Rt.scale(Rt.create(),e,e[3])};An.GetCartesian=function(e,t){const r=e+"/"+t;let n,s;if(r==="X/Y")n=[0,0,1],s=[1,0,0];else if(r==="Y/-X")n=[0,0,1],s=[0,1,0];else if(r==="-X/-Y")n=[0,0,1],s=[-1,0,0];else if(r==="-Y/X")n=[0,0,1],s=[0,-1,0];else if(r==="-X/Y")n=[0,0,-1],s=[-1,0,0];else if(r==="-Y/-X")n=[0,0,-1],s=[0,-1,0];else if(r==="X/-Y")n=[0,0,-1],s=[1,0,0];else if(r==="Y/X")n=[0,0,-1],s=[0,1,0];else if(r==="X/Z")n=[0,-1,0],s=[1,0,0];else if(r==="Z/-X")n=[0,-1,0],s=[0,0,1];else if(r==="-X/-Z")n=[0,-1,0],s=[-1,0,0];else if(r==="-Z/X")n=[0,-1,0],s=[0,0,-1];else if(r==="-X/Z")n=[0,1,0],s=[-1,0,0];else if(r==="-Z/-X")n=[0,1,0],s=[0,0,-1];else if(r==="X/-Z")n=[0,1,0],s=[1,0,0];else if(r==="Z/X")n=[0,1,0],s=[0,0,1];else if(r==="Y/Z")n=[1,0,0],s=[0,1,0];else if(r==="Z/-Y")n=[1,0,0],s=[0,0,1];else if(r==="-Y/-Z")n=[1,0,0],s=[0,-1,0];else if(r==="-Z/Y")n=[1,0,0],s=[0,0,-1];else if(r==="-Y/Z")n=[-1,0,0],s=[0,-1,0];else if(r==="-Z/-Y")n=[-1,0,0],s=[0,0,-1];else if(r==="Y/-Z")n=[-1,0,0],s=[0,1,0];else if(r==="Z/Y")n=[-1,0,0],s=[0,0,1];else throw new Error("OrthoNormalBasis.GetCartesian: invalid combination of axis identifiers. Should pass two string arguments from [X,Y,Z,-X,-Y,-Z], being two different axes.");return new An(new Plane(new Vector3D(n),0),new Vector3D(s))};An.Z0Plane=function(){const e=new Plane(new Vector3D([0,0,1]),0);return new An(e,new Vector3D([1,0,0]))};An.prototype={getProjectionMatrix:function(){return i0.fromValues(this.u[0],this.v[0],this.plane[0],0,this.u[1],this.v[1],this.plane[1],0,this.u[2],this.v[2],this.plane[2],0,0,0,-this.plane[3],1)},getInverseProjectionMatrix:function(){const e=Rt.scale(Rt.create(),this.plane,this.plane[3]);return i0.fromValues(this.u[0],this.u[1],this.u[2],0,this.v[0],this.v[1],this.v[2],0,this.plane[0],this.plane[1],this.plane[2],0,e[0],e[1],e[2],1)},to2D:function(e){return f8.fromValues(Rt.dot(e,this.u),Rt.dot(e,this.v))},to3D:function(e){const t=Rt.scale(Rt.create(),this.u,e[0]),r=Rt.scale(Rt.create(),this.v,e[1]),n=Rt.add(t,t,this.planeorigin);return Rt.add(r,r,n)},line3Dto2D:function(e){const t=e.point,r=e.direction.plus(t),n=this.to2D(t),s=this.to2D(r);return Line2D.fromPoints(n,s)},line2Dto3D:function(e){const t=e.origin(),r=e.direction().plus(t),n=this.to3D(t),s=this.to3D(r);return Line3D.fromPoints(n,s)},transform:function(e){const t=this.plane.transform(e),r=this.u.transform(e),n=new Vector3D(0,0,0).transform(e),s=r.minus(n);return new An(t,s)}};var u8=An;const{EPS:Lr}=mt,Hr=il,mr=rt,d8=u8,jn=gh,{insertSorted:h8,fnNumberSort:m8}=Mt,c0=st,p8=e=>{if(e.length<2)return e;const t=[],r=e.length,n=c0.plane(e[0]),s=new d8(n),o=[],a=[],i=new Map,c=new Map,l=new Map,u=10/Lr;for(let E=0;E<r;E++){const g=e[E];let b=[],P=g.vertices.length,F=-1;if(P>0){let R,C;for(let G=0;G<P;G++){let L=s.to2D(g.vertices[G]);const q=Math.floor(L[1]*u);let ee;l.has(q)?ee=l.get(q):l.has(q+1)?ee=l.get(q+1):l.has(q-1)?ee=l.get(q-1):(ee=L[1],l.set(q,L[1])),L=mr.fromValues(L[0],ee),b.push(L);const oe=L[1];(G===0||oe<R)&&(R=oe,F=G),(G===0||oe>C)&&(C=oe);let pe=c.get(oe);pe||(pe={},c.set(oe,pe)),pe[E]=!0}if(R>=C)b=[],P=0,F=-1;else{let G=i.get(R);G||(G=[],i.set(R,G)),G.push(E)}}b.reverse(),F=P-F-1,o.push(b),a.push(F)}const d=[];c.forEach((E,g)=>d.push(g)),d.sort(m8);let h=[],p=[];for(let E=0;E<d.length;E++){const g=[],b=d[E],P=c.get(b);for(let R=0;R<h.length;++R){const C=h[R],G=C.polygonindex;if(P[G]){const L=o[G],q=L.length;let ee=C.leftvertexindex,oe=C.rightvertexindex;for(;;){let Q=ee+1;if(Q>=q&&(Q=0),L[Q][1]!==b)break;ee=Q}let pe=oe-1;if(pe<0&&(pe=q-1),L[pe][1]===b&&(oe=pe),ee!==C.leftvertexindex&&ee===oe)h.splice(R,1),--R;else{C.leftvertexindex=ee,C.rightvertexindex=oe,C.topleft=L[ee],C.topright=L[oe];let Q=ee+1;Q>=q&&(Q=0),C.bottomleft=L[Q];let Te=oe-1;Te<0&&(Te=q-1),C.bottomright=L[Te]}}}let F;if(E>=d.length-1)h=[],F=null;else{F=Number(d[E+1]);const R=.5*(b+F),C=i.get(b);for(const G in C){const L=C[G],q=o[L],ee=q.length,oe=a[L];let pe=oe;for(;;){let Ue=pe+1;if(Ue>=ee&&(Ue=0),q[Ue][1]!==b||Ue===oe)break;pe=Ue}let Q=oe;for(;;){let Ue=Q-1;if(Ue<0&&(Ue=ee-1),q[Ue][1]!==b||Ue===pe)break;Q=Ue}let Te=pe+1;Te>=ee&&(Te=0);let Xe=Q-1;Xe<0&&(Xe=ee-1);const $e={polygonindex:L,leftvertexindex:pe,rightvertexindex:Q,topleft:q[pe],topright:q[Q],bottomleft:q[Te],bottomright:q[Xe]};h8(h,$e,(Ue,Ne)=>{const Lt=jn(Ue.topleft,Ue.bottomleft,R),Nt=jn(Ne.topleft,Ne.bottomleft,R);return Lt>Nt?1:Lt<Nt?-1:0})}}for(const R in h){const C=h[R];let G=jn(C.topleft,C.bottomleft,b);const L=mr.fromValues(G,b);G=jn(C.topright,C.bottomright,b);const q=mr.fromValues(G,b);G=jn(C.topleft,C.bottomleft,F);const ee=mr.fromValues(G,F);G=jn(C.topright,C.bottomright,F);const oe=mr.fromValues(G,F),pe={topleft:L,topright:q,bottomleft:ee,bottomright:oe,leftline:Hr.fromPoints(Hr.create(),L,ee),rightline:Hr.fromPoints(Hr.create(),oe,q)};if(g.length>0){const Q=g[g.length-1],Te=mr.distance(pe.topleft,Q.topright),Xe=mr.distance(pe.bottomleft,Q.bottomright);Te<Lr&&Xe<Lr&&(pe.topleft=Q.topleft,pe.leftline=Q.leftline,pe.bottomleft=Q.bottomleft,g.splice(g.length-1,1))}g.push(pe)}if(E>0){const R=new Set,C=new Set;for(let G=0;G<g.length;G++){const L=g[G];for(let q=0;q<p.length;q++)if(!C.has(q)){const ee=p[q];if(mr.distance(ee.bottomleft,L.topleft)<Lr&&mr.distance(ee.bottomright,L.topright)<Lr){C.add(q);const oe=Hr.direction(L.leftline),pe=Hr.direction(ee.leftline),Q=oe[0]-pe[0],Te=Hr.direction(L.rightline),Xe=Hr.direction(ee.rightline),$e=Te[0]-Xe[0],Ue=Math.abs(Q)<Lr,Ne=Math.abs($e)<Lr,Lt=Ue||Q>=0,Nt=Ne||$e>=0;Lt&&Nt&&(L.outpolygon=ee.outpolygon,L.leftlinecontinues=Ue,L.rightlinecontinues=Ne,R.add(q));break}}}for(let G=0;G<p.length;G++)if(!R.has(G)){const L=p[G];L.outpolygon.rightpoints.push(L.bottomright),mr.distance(L.bottomright,L.bottomleft)>Lr&&L.outpolygon.leftpoints.push(L.bottomleft),L.outpolygon.leftpoints.reverse();const ee=L.outpolygon.rightpoints.concat(L.outpolygon.leftpoints).map(pe=>s.to3D(pe)),oe=c0.fromPointsAndPlane(ee,n);oe.vertices.length&&t.push(oe)}}for(let R=0;R<g.length;R++){const C=g[R];C.outpolygon?(C.leftlinecontinues||C.outpolygon.leftpoints.push(C.topleft),C.rightlinecontinues||C.outpolygon.rightpoints.push(C.topright)):(C.outpolygon={leftpoints:[],rightpoints:[]},C.outpolygon.leftpoints.push(C.topleft),mr.distance(C.topleft,C.topright)>Lr&&C.outpolygon.rightpoints.push(C.topright))}p=g}return t};var v8=p8;const l0=et,f0=st,g8=Ea,y8=v8,b8=(e,t)=>Math.abs(e[3]-t[3])<15e-8?g8(e,t):!1,w8=e=>{if(e.isRetesselated)return e;const t=l0.toPolygons(e),r=[];t.forEach(o=>{const a=r.find(i=>b8(i[0],f0.plane(o)));a?a[1].push(o):r.push([f0.plane(o),[o]])});let n=[];r.forEach(o=>{const a=o[1],i=y8(a);n=n.concat(i)});const s=l0.create(n);return s.isRetesselated=!0,s};var Pa=w8;const{EPS:Hn}=mt,u0=Sn,_8=(e,t)=>{if(e.polygons.length===0||t.polygons.length===0)return!1;const r=u0(e),n=r[0],s=r[1],o=u0(t),a=o[0],i=o[1];return!(a[0]-s[0]>Hn||n[0]-i[0]>Hn||a[1]-s[1]>Hn||n[1]-i[1]>Hn||a[2]-s[2]>Hn||n[2]-i[2]>Hn)};var pl=_8;const d0=Tr,x8=st;class ca{constructor(t){this.plane=null,this.front=null,this.back=null,this.polygontreenodes=[],this.parent=t}invert(){const t=[this];let r;for(let n=0;n<t.length;n++){r=t[n],r.plane&&(r.plane=d0.flip(d0.create(),r.plane)),r.front&&t.push(r.front),r.back&&t.push(r.back);const s=r.front;r.front=r.back,r.back=s}}clipPolygons(t,r){let n={node:this,polygontreenodes:t},s;const o=[];do{if(s=n.node,t=n.polygontreenodes,s.plane){const a=s.plane,i=[],c=[],l=r?i:c,u=t.length;for(let h=0;h<u;h++){const p=t[h];p.isRemoved()||p.splitByPlane(a,l,i,c,i)}s.front&&c.length>0&&o.push({node:s.front,polygontreenodes:c});const d=i.length;if(s.back&&d>0)o.push({node:s.back,polygontreenodes:i});else for(let h=0;h<d;h++)i[h].remove()}n=o.pop()}while(n!==void 0)}clipTo(t,r){let n=this;const s=[];do n.polygontreenodes.length>0&&t.rootnode.clipPolygons(n.polygontreenodes,r),n.front&&s.push(n.front),n.back&&s.push(n.back),n=s.pop();while(n!==void 0)}addPolygonTreeNodes(t){let r={node:this,polygontreenodes:t};const n=[];do{const s=r.node,o=r.polygontreenodes;if(o.length===0){r=n.pop();continue}if(!s.plane){let l=0;l=Math.floor(o.length/2);const u=o[l].getPolygon();s.plane=x8.plane(u)}const a=[],i=[],c=o.length;for(let l=0;l<c;++l)o[l].splitByPlane(s.plane,s.polygontreenodes,i,a,i);a.length>0&&(s.front||(s.front=new ca(s)),c===a.length&&i.length===0?s.front.polygontreenodes=a:n.push({node:s.front,polygontreenodes:a})),i.length>0&&(s.back||(s.back=new ca(s)),c===i.length&&a.length===0?s.back.polygontreenodes=i:n.push({node:s.back,polygontreenodes:i})),r=n.pop()}while(r!==void 0)}}var E8=ca;const Yn=ze,$8=(e,t,r)=>{const n=Yn.subtract(Yn.create(),r,t);let s=(e[3]-Yn.dot(e,t))/Yn.dot(e,n);return Number.isNaN(s)&&(s=0),s>1&&(s=1),s<0&&(s=0),Yn.scale(n,n,s),Yn.add(n,t,n),n};var A8=$8;const{EPS:Vo}=mt,S8=Tr,qo=ze,rc=st,T8=A8,P8=(e,t)=>{const r={type:null,front:null,back:null},n=t.vertices,s=n.length,o=rc.plane(t);if(S8.equals(o,e))r.type=0;else{let a=!1,i=!1;const c=[],l=-Vo;for(let u=0;u<s;u++){const d=qo.dot(e,n[u])-e[3],h=d<l;c.push(h),d>Vo&&(a=!0),d<l&&(i=!0)}if(!a&&!i){const u=qo.dot(e,o);r.type=u>=0?0:1}else if(!i)r.type=2;else if(!a)r.type=3;else{r.type=4;const u=[],d=[];let h=c[0];for(let E=0;E<s;E++){const g=n[E];let b=E+1;b>=s&&(b=0);const P=c[b];if(h===P)h?d.push(g):u.push(g);else{const F=n[b],R=T8(e,g,F);h?(d.push(g),d.push(R),u.push(R)):(u.push(g),u.push(R),d.push(R))}h=P}const p=Vo*Vo;if(d.length>=3){let E=d[d.length-1];for(let g=0;g<d.length;g++){const b=d[g];qo.squaredDistance(b,E)<p&&(d.splice(g,1),g--),E=b}}if(u.length>=3){let E=u[u.length-1];for(let g=0;g<u.length;g++){const b=u[g];qo.squaredDistance(b,E)<p&&(u.splice(g,1),g--),E=b}}u.length>=3&&(r.front=rc.fromPointsAndPlane(u,o)),d.length>=3&&(r.back=rc.fromPointsAndPlane(d,o))}}return r};var M8=P8;const{EPS:C8}=mt,O8=ze,h0=st,R8=M8;class vl{constructor(t,r){this.parent=t,this.children=[],this.polygon=r,this.removed=!1}addPolygons(t){if(!this.isRootNode())throw new Error("Assertion failed");const r=this;t.forEach(n=>{r.addChild(n)})}remove(){if(!this.removed){this.removed=!0,this.polygon=null;const t=this.parent.children,r=t.indexOf(this);if(r<0)throw new Error("Assertion failed");t.splice(r,1),this.parent.recursivelyInvalidatePolygon()}}isRemoved(){return this.removed}isRootNode(){return!this.parent}invert(){if(!this.isRootNode())throw new Error("Assertion failed");this.invertSub()}getPolygon(){if(!this.polygon)throw new Error("Assertion failed");return this.polygon}getPolygons(t){let r=[this];const n=[r];let s,o,a,i;for(s=0;s<n.length;++s)for(r=n[s],o=0,a=r.length;o<a;o++)i=r[o],i.polygon?t.push(i.polygon):i.children.length>0&&n.push(i.children)}splitByPlane(t,r,n,s,o){if(this.children.length){const a=[this.children];let i,c,l,u,d;for(i=0;i<a.length;i++)for(d=a[i],c=0,l=d.length;c<l;c++)u=d[c],u.children.length>0?a.push(u.children):u._splitByPlane(t,r,n,s,o)}else this._splitByPlane(t,r,n,s,o)}_splitByPlane(t,r,n,s,o){const a=this.polygon;if(a){const i=h0.measureBoundingSphere(a),c=i[3]+C8,l=i,u=O8.dot(t,l)-t[3];if(u>c)s.push(this);else if(u<-c)o.push(this);else{const d=R8(t,a);switch(d.type){case 0:r.push(this);break;case 1:n.push(this);break;case 2:s.push(this);break;case 3:o.push(this);break;case 4:if(d.front){const h=this.addChild(d.front);s.push(h)}if(d.back){const h=this.addChild(d.back);o.push(h)}break}}}}addChild(t){const r=new vl(this,t);return this.children.push(r),r}invertSub(){let t=[this];const r=[t];let n,s,o,a;for(n=0;n<r.length;n++)for(t=r[n],s=0,o=t.length;s<o;s++)a=t[s],a.polygon&&(a.polygon=h0.invert(a.polygon)),a.children.length>0&&r.push(a.children)}recursivelyInvalidatePolygon(){this.polygon=null,this.parent&&this.parent.recursivelyInvalidatePolygon()}clear(){let t=[this];const r=[t];for(let n=0;n<r.length;++n){t=r[n];const s=t.length;for(let o=0;o<s;o++){const a=t[o];a.polygon&&(a.polygon=null),a.parent&&(a.parent=null),a.children.length>0&&r.push(a.children),a.children=[]}}}toString(){let t="",r=[this];const n=[r];let s,o,a,i;for(s=0;s<n.length;++s){r=n[s];const c=" ".repeat(s);for(o=0,a=r.length;o<a;o++)i=r[o],t+=`${c}PolygonTreeNode (${i.isRootNode()}): ${i.children.length}`,i.polygon?t+=`
 ${c}polygon: ${i.polygon.vertices}
`:t+=`
`,i.children.length>0&&n.push(i.children)}return t}}var L8=vl;const F8=E8,G8=L8;class N8{constructor(t){this.polygonTree=new G8,this.rootnode=new F8(null),t&&this.addPolygons(t)}invert(){this.polygonTree.invert(),this.rootnode.invert()}clipTo(t,r=!1){this.rootnode.clipTo(t,r)}allPolygons(){const t=[];return this.polygonTree.getPolygons(t),t}addPolygons(t){const r=new Array(t.length);for(let n=0;n<t.length;n++)r[n]=this.polygonTree.addChild(t[n]);this.rootnode.addPolygonTreeNodes(r)}clear(){this.polygonTree.clear()}toString(){return"Tree: "+this.polygonTree.toString("")}}var D8=N8,gl={Tree:D8};const Xo=et,k8=pl,{Tree:m0}=gl,I8=(e,t)=>{if(!k8(e,t))return Xo.create();const r=new m0(Xo.toPolygons(e)),n=new m0(Xo.toPolygons(t));r.invert(),n.clipTo(r),n.invert(),r.clipTo(n),n.clipTo(r),r.addPolygons(n.allPolygons()),r.invert();const s=r.allPolygons();return Xo.create(s)};var B8=I8;const z8=Ze,V8=Pa,q8=B8,X8=(...e)=>{e=z8(e);let t=e.shift();return e.forEach(r=>{t=q8(t,r)}),t=V8(t),t};var tm=X8;const U8=Ze,j8=et,H8=Jr,Y8=hl,Z8=ml,W8=tm,Q8=(...e)=>{e=U8(e);const t=e.map(s=>Z8({z0:-1,z1:1},s)),r=W8(t),n=H8(r);return Y8(n,j8.toPolygons(r))};var K8=Q8;const J8=Ze,e6=Ks,t6=Je,r6=et,n6=K8,s6=tm,o6=(...e)=>{if(e=J8(e),e.length===0)throw new Error("wrong number of arguments");if(!e6(e))throw new Error("only intersect of the types are supported");const t=e[0];return t6.isA(t)?n6(e):r6.isA(t)?s6(e):t};var a6=o6;const nc=ze,i6=Jr,p0=et,c6=e=>e.sort((t,r)=>t-r).filter((t,r,n)=>!r||t!==n[r-1]),l6=(e,t,r)=>{const n=`${t}`,s=e.get(n);s===void 0?e.set(n,[r]):s.push(r)},f6=(e,t)=>{const r=`${t}`;return e.get(r)},u6=e=>{const t=i6(e),r=p0.toPolygons(e),n=r.length,s=new Map,o=nc.create();r.forEach((u,d)=>{u.vertices.forEach(h=>{l6(s,nc.snap(o,h,t),d)})});const a=r.map(u=>{let d=[];return u.vertices.forEach(h=>{d=d.concat(f6(s,nc.snap(o,h,t)))}),{e:1,d:c6(d)}});s.clear();let i=0;const c=a.length;for(let u=0;u<c;u++){const d=a[u];if(d.e>0){const h=new Array(n);h[u]=!0;do i=0,h.forEach((p,E)=>{const g=a[E];if(g.e>0){g.e=-1;for(let b=0;b<g.d.length;b++)h[g.d[b]]=!0;i++}});while(i>0);d.indexes=h}}const l=[];for(let u=0;u<c;u++)if(a[u].indexes){const d=[];a[u].indexes.forEach((h,p)=>d.push(r[p])),l.push(p0.create(d))}return l};var d6=u6;const h6=Ze,m6=et,p6=d6,v6=(...e)=>{if(e=h6(e),e.length===0)throw new Error("wrong number of arguments");const t=e.map(r=>m6.isA(r)?p6(r):r);return t.length===1?t[0]:t};var g6=v6;const Uo=et,y6=pl,{Tree:v0}=gl,b6=(e,t)=>{if(!y6(e,t))return Uo.clone(e);const r=new v0(Uo.toPolygons(e)),n=new v0(Uo.toPolygons(t));r.invert(),r.clipTo(n),n.clipTo(r,!0),r.addPolygons(n.allPolygons()),r.invert();const s=r.allPolygons();return Uo.create(s)};var w6=b6;const _6=Ze,x6=Pa,E6=w6,$6=(...e)=>{e=_6(e);let t=e.shift();return e.forEach(r=>{t=E6(t,r)}),t=x6(t),t};var rm=$6;const A6=Ze,S6=et,T6=Jr,P6=hl,M6=ml,C6=rm,O6=(...e)=>{e=A6(e);const t=e.map(s=>M6({z0:-1,z1:1},s)),r=C6(t),n=T6(r);return P6(n,S6.toPolygons(r))};var R6=O6;const L6=Ze,F6=Ks,G6=Je,N6=et,D6=R6,k6=rm,I6=(...e)=>{if(e=L6(e),e.length===0)throw new Error("wrong number of arguments");if(!F6(e))throw new Error("only subtract of the types are supported");const t=e[0];return G6.isA(t)?D6(e):N6.isA(t)?k6(e):t};var B6=I6;const ts=et,z6=pl,{Tree:g0}=gl,V6=(e,t)=>{if(!z6(e,t))return q6(e,t);const r=new g0(ts.toPolygons(e)),n=new g0(ts.toPolygons(t));r.clipTo(n,!1),n.clipTo(r),n.invert(),n.clipTo(r),n.invert();const s=r.allPolygons().concat(n.allPolygons());return ts.create(s)},q6=(e,t)=>{let r=ts.toPolygons(e);return r=r.concat(ts.toPolygons(t)),ts.create(r)};var nm=V6;const X6=Ze,U6=Pa,j6=nm,H6=(...e)=>{e=X6(e);let t;for(t=1;t<e.length;t+=2)e.push(j6(e[t-1],e[t]));let r=e[t-1];return r=U6(r),r};var sm=H6;const Y6=Ze,Z6=et,W6=Jr,Q6=hl,K6=ml,J6=sm,eC=(...e)=>{e=Y6(e);const t=e.map(s=>K6({z0:-1,z1:1},s)),r=J6(t),n=W6(r);return Q6(n,Z6.toPolygons(r))};var om=eC;const tC=Ze,rC=Ks,nC=Je,sC=et,oC=om,aC=sm,iC=(...e)=>{if(e=tC(e),e.length===0)throw new Error("wrong number of arguments");if(!rC(e))throw new Error("only unions of the same type are supported");const t=e[0];return nC.isA(t)?oC(e):sC.isA(t)?aC(e):t};var yl=iC,Ma={intersect:a6,scission:g6,subtract:B6,union:yl};const{EPS:cC}=mt,y0=yh,Gs=il,bt=rt,lC=_a,fC=(e,t)=>{const r={delta:1,corners:"edge",closed:!1,segments:16};let{delta:n,corners:s,closed:o,segments:a}=Object.assign({},r,e);if(Math.abs(n)<cC)return t;let i=e.closed?lC(t):1;i===0&&(i=1);const c=i>0&&n>=0||i<0&&n<0;n=Math.abs(n);let l=null,u=[];const d=[],h=bt.create(),p=t.length;for(let E=0;E<p;E++){const g=(E+1)%p,b=t[E],P=t[g];c?bt.subtract(h,b,P):bt.subtract(h,P,b),bt.normal(h,h),bt.normalize(h,h),bt.scale(h,h,n);const F=bt.add(bt.create(),b,h),R=bt.add(bt.create(),P,h),C=[F,R];if(l!=null&&(o||!o&&g!==0)){const G=y0(l[0],l[1],C[0],C[1]);G?(u.pop(),C[0]=G):d.push({c:b,s0:l,s1:C})}l=[F,R],!(g===0&&!o)&&(u.push(C[0]),u.push(C[1]))}if(o&&l!=null){const E=u[0],g=u[1],b=y0(l[0],l[1],E,g);if(b)u[0]=b,u.pop();else{const P=t[0],F=[E,g];d.push({c:P,s0:l,s1:F})}}if(s==="edge"){const E=new Map;u.forEach((P,F)=>E.set(P,F));const g=Gs.create(),b=Gs.create();d.forEach(P=>{Gs.fromPoints(g,P.s0[0],P.s0[1]),Gs.fromPoints(b,P.s1[0],P.s1[1]);const F=Gs.intersectPointOfLines(g,b);if(Number.isFinite(F[0])&&Number.isFinite(F[1])){const R=P.s0[1],C=E.get(R);u[C]=F,u[(C+1)%u.length]=void 0}else{const R=P.s1[0],C=E.get(R);u[C]=void 0}}),u=u.filter(P=>P!==void 0)}if(s==="round"){let E=Math.floor(a/4);const g=bt.create();d.forEach(b=>{let P=bt.angle(bt.subtract(g,b.s1[0],b.c));if(P-=bt.angle(bt.subtract(g,b.s0[1],b.c)),c&&P<0&&(P=P+Math.PI,P<0&&(P=P+Math.PI)),!c&&P>0&&(P=P-Math.PI,P>0&&(P=P-Math.PI)),P!==0){E=Math.floor(a*(Math.abs(P)/(2*Math.PI)));const F=P/E,R=bt.angle(bt.subtract(g,b.s0[1],b.c)),C=[];for(let G=1;G<E;G++){const L=R+F*G,q=bt.fromAngleRadians(bt.create(),L);bt.scale(q,q,n),bt.add(q,q,b.c),C.push(q)}if(C.length>0){const G=b.s0[1];let L=u.findIndex(q=>bt.equals(G,q));L=(L+1)%u.length,u.splice(L,0,...C)}}else{const F=b.s1[0],R=u.findIndex(C=>bt.equals(F,C));u.splice(R,1)}})}return u};var Ca=fC;const jo=Je,uC=Ca,dC=(e,t)=>{const r={delta:1,corners:"edge",segments:16},{delta:n,corners:s,segments:o}=Object.assign({},r,e);if(!(s==="edge"||s==="chamfer"||s==="round"))throw new Error('corners must be "edge", "chamfer", or "round"');const c=jo.toOutlines(t).map(l=>(e={delta:n,corners:s,closed:!0,segments:o},uC(e,l))).reduce((l,u)=>l.concat(jo.toSides(jo.fromPoints(u))),[]);return jo.create(c)};var hC=dC;const b0=ut,mC=ze,pC=et,Ns=st,vC=(e,t)=>{mC.dot(Ns.plane(t),e)>0&&(t=Ns.invert(t));const n=[t],s=Ns.transform(b0.fromTranslation(b0.create(),e),t),o=t.vertices.length;for(let a=0;a<o;a++){const i=a<o-1?a+1:0,c=Ns.create([t.vertices[a],s.vertices[a],s.vertices[i],t.vertices[i]]);n.push(c)}return n.push(Ns.invert(s)),pC.create(n)};var gC=vC;const{EPS:yC}=mt,w0=ut,ft=ze,bC=em,sc=et,wn=st,wC=qh,_C=Pa,oc=nm,xC=gC,EC=(e,t,r)=>{const n=t.toString();if(e.has(n))e.get(n)[1].push(r);else{const s=[t,[r]];e.set(n,s)}},$C=(e,t,r)=>{const n=t[0].toString(),s=t[1].toString(),o=n<s?`${n},${s}`:`${s},${n}`;if(e.has(o))e.get(o)[1].push(r);else{const a=[t,[r]];e.set(o,a)}},ac=(e,t)=>{e.findIndex(n=>n===t)<0&&e.push(t)},AC=(e,t)=>{const r={delta:1,segments:12},{delta:n,segments:s}=Object.assign({},r,e);let o=sc.create();const a=new Map,i=new Map,c=ft.create(),l=ft.create();return sc.toPolygons(t).forEach((d,h)=>{const p=ft.scale(ft.create(),wn.plane(d),2*n),E=wn.transform(w0.fromTranslation(w0.create(),ft.scale(ft.create(),p,-.5)),d),g=xC(p,E);o=oc(o,g);const b=d.vertices;for(let P=0;P<b.length;P++){EC(a,b[P],wn.plane(d));const F=(P+1)%b.length,R=[b[P],b[F]];$C(i,R,wn.plane(d))}}),i.forEach(d=>{const h=d[0],p=d[1],E=h[0],g=h[1],b=ft.subtract(ft.create(),g,E);ft.normalize(b,b);const P=p[0],F=ft.cross(ft.create(),P,b);let R=[];for(let Q=0;Q<s;Q++)ac(R,Q*Math.PI*2/s);for(let Q=0,Te=p.length;Q<Te;Q++){const Xe=p[Q],$e=ft.dot(F,Xe),Ue=ft.dot(P,Xe);let Ne=Math.atan2($e,Ue);Ne<0&&(Ne+=Math.PI*2),ac(R,Ne),Ne=Math.atan2(-$e,-Ue),Ne<0&&(Ne+=Math.PI*2),ac(R,Ne)}R=R.sort(bC);const C=R.length;let G,L;const q=[],ee=[],oe=[];for(let Q=-1;Q<C;Q++){const Te=R[Q<0?Q+C:Q],Xe=Math.sin(Te),$e=Math.cos(Te);ft.scale(c,P,$e*n),ft.scale(l,F,Xe*n),ft.add(c,c,l);const Ue=ft.add(ft.create(),E,c),Ne=ft.add(ft.create(),g,c);let Lt=!1;if(Q>=0&&ft.distance(Ue,G)<yC&&(Lt=!0),!Lt){if(Q>=0){q.push(Ue),ee.push(Ne);const Nt=[L,Ne,Ue,G],Gr=wn.create(Nt);oe.push(Gr)}G=Ue,L=Ne}}ee.reverse(),oe.push(wn.create(q)),oe.push(wn.create(ee));const pe=sc.create(oe);o=oc(o,pe)}),a.forEach(d=>{const h=d[0],p=d[1],E=p[0];let g=null,b=0;for(let C=1;C<p.length;C++){const G=p[C],L=ft.cross(c,E,G),q=ft.length(L);q>.05&&q>b&&(b=q,g=G)}g||(g=ft.orthogonal(c,E));const P=ft.cross(c,E,g);ft.normalize(P,P);const F=ft.cross(l,P,E),R=wC({center:[h[0],h[1],h[2]],radius:n,segments:s,axes:[E,P,F]});o=oc(o,R)}),_C(o)};var SC=AC;const TC=et,PC=yl,MC=SC,CC=(e,t)=>{const r={delta:1,corners:"round",segments:12},{delta:n,corners:s,segments:o}=Object.assign({},r,e);if(s!=="round")throw new Error('corners must be "round" for 3D geometries');if(TC.toPolygons(t).length===0)throw new Error("the given geometry cannot be empty");e={delta:n,corners:s,segments:o};const i=MC(e,t);return PC(t,i)};var OC=CC;const RC=_a,Kt=rt,Kn=Je,qs=ct,_0=Ca,LC=e=>{let{external:t,internal:r}=e;RC(t)<0?t=t.reverse():r=r.reverse();const n=qs.fromPoints({closed:!0},t),s=qs.fromPoints({closed:!0},r),o=Kn.toSides(Kn.fromPoints(qs.toPoints(n))),a=Kn.toSides(Kn.fromPoints(qs.toPoints(s)));return o.push(...a),Kn.create(o)},FC=(e,t,r,n)=>{const{points:s,external:o,internal:a}=e,i=Math.floor(t/2),c=[],l=[];if(r==="round"&&i>0){const d=Math.PI/i,h=s[s.length-1],p=Kt.angle(Kt.subtract(Kt.create(),o[o.length-1],h)),E=s[0],g=Kt.angle(Kt.subtract(Kt.create(),a[0],E));for(let b=1;b<i;b++){let P=p+d*b,F=Kt.fromAngleRadians(Kt.create(),P);Kt.scale(F,F,n),Kt.add(F,F,h),c.push(F),P=g+d*b,F=Kt.fromAngleRadians(Kt.create(),P),Kt.scale(F,F,n),Kt.add(F,F,E),l.push(F)}}const u=[];return u.push(...o,...c,...a.reverse(),...l),Kn.fromPoints(u)},GC=(e,t)=>{e=Object.assign({},{delta:1,corners:"edge",segments:16},e);const{delta:n,corners:s,segments:o}=e;if(n<=0)throw new Error("the given delta must be positive for paths");if(!(s==="edge"||s==="chamfer"||s==="round"))throw new Error('corners must be "edge", "chamfer", or "round"');const a=t.isClosed,i=qs.toPoints(t);if(i.length===0)throw new Error("the given geometry cannot be empty");const c={points:i,external:_0({delta:n,corners:s,segments:o,closed:a},i),internal:_0({delta:-n,corners:s,segments:o,closed:a},i)};return t.isClosed?LC(c):FC(c,o,s,n)};var NC=GC;const DC=Ze,kC=Je,IC=et,BC=ct,zC=hC,VC=OC,qC=NC,XC=(e,...t)=>{if(t=DC(t),t.length===0)throw new Error("wrong number of arguments");const r=t.map(n=>BC.isA(n)?qC(e,n):kC.isA(n)?zC(e,n):IC.isA(n)?VC(e,n):n);return r.length===1?r[0]:r};var bl=XC;const Ho=Je,x0=nl,UC=Ca,jC=(e,t)=>{const r={delta:1,corners:"edge",segments:0},{delta:n,corners:s,segments:o}=Object.assign({},r,e);if(!(s==="edge"||s==="chamfer"||s==="round"))throw new Error('corners must be "edge", "chamfer", or "round"');const a=Ho.toOutlines(t),c=a.map(l=>(e={delta:a.reduce((h,p)=>h+x0.arePointsInside(l,x0.create(p)),0)%2===0?n:-n,corners:s,closed:!0,segments:o},UC(e,l))).reduce((l,u)=>l.concat(Ho.toSides(Ho.fromPoints(u))),[]);return Ho.create(c)};var HC=jC;const E0=ct,YC=Ca,ZC=(e,t)=>{const r={delta:1,corners:"edge",closed:t.isClosed,segments:16},{delta:n,corners:s,closed:o,segments:a}=Object.assign({},r,e);if(!(s==="edge"||s==="chamfer"||s==="round"))throw new Error('corners must be "edge", "chamfer", or "round"');e={delta:n,corners:s,closed:o,segments:a};const i=YC(e,E0.toPoints(t));return E0.fromPoints({closed:o},i)};var WC=ZC;const QC=Ze,KC=Je,JC=ct,eO=HC,tO=WC,rO=(e,...t)=>{if(t=QC(t),t.length===0)throw new Error("wrong number of arguments");const r=t.map(n=>JC.isA(n)?tO(e,n):KC.isA(n)?eO(e,n):n);return r.length===1?r[0]:r};var nO=rO,sO={expand:bl,offset:nO};const Ds=ut,ic=ze,oO=Je,cc=Qs,aO=dl,iO=(e,t)=>{const r={offset:[0,0,1],twistAngle:0,twistSteps:12,repair:!0};let{offset:n,twistAngle:s,twistSteps:o,repair:a}=Object.assign({},r,e);if(o<1)throw new Error("twistSteps must be 1 or more");s===0&&(o=1);const i=ic.clone(n),c=oO.toSides(t);if(c.length===0)throw new Error("the given geometry cannot be empty");const l=cc.fromSides(c);i[2]<0&&cc.reverse(l,l);const u=Ds.create(),d=(h,p,E)=>{const g=p/o*s,b=ic.scale(ic.create(),i,p/o);return Ds.multiply(u,Ds.fromZRotation(u,g),Ds.fromTranslation(Ds.create(),b)),cc.transform(u,E)};return e={numberOfSlices:o+1,capStart:!0,capEnd:!0,repair:a,callback:d},aO(e,l)};var Oa=iO;const cO=Je,lO=ct,fO=Oa,uO=(e,t)=>{if(!t.isClosed)throw new Error("extruded path must be closed");const r=lO.toPoints(t),n=cO.fromPoints(r);return fO(e,n)};var dO=uO;const hO=Ze,mO=Je,pO=ct,vO=Oa,gO=dO,yO=(e,...t)=>{const r={height:1,twistAngle:0,twistSteps:1,repair:!0},{height:n,twistAngle:s,twistSteps:o,repair:a}=Object.assign({},r,e);if(t=hO(t),t.length===0)throw new Error("wrong number of arguments");e={offset:[0,0,n],twistAngle:s,twistSteps:o,repair:a};const i=t.map(c=>pO.isA(c)?gO(e,c):mO.isA(c)?vO(e,c):c);return i.length===1?i[0]:i};var bO=yO;const wO=ct,_O=bl,xO=Oa,EO=(e,t)=>{const r={size:1,height:1},{size:n,height:s}=Object.assign({},r,e);if(e.delta=n,e.offset=[0,0,s],wO.toPoints(t).length===0)throw new Error("the given geometry cannot be empty");const a=_O(e,t);return xO(e,a)};var $O=EO;const{area:AO}=Zs,lc=Je,SO=ct,TO=bl,PO=Oa,MO=(e,t)=>{const r={size:1,height:1},{size:n,height:s}=Object.assign({},r,e);e.delta=n,e.offset=[0,0,s];const o=lc.toOutlines(t);if(o.length===0)throw new Error("the given geometry cannot be empty");const i=o.map(l=>(AO(l)<0&&l.reverse(),TO(e,SO.fromPoints({closed:!0},l)))).reduce((l,u)=>l.concat(lc.toSides(u)),[]),c=lc.create(i);return PO(e,c)};var CO=MO;const OO=Ze,RO=Je,LO=ct,FO=$O,GO=CO,NO=(e,...t)=>{const r={size:1,height:1},{size:n,height:s}=Object.assign({},r,e);if(t=OO(t),t.length===0)throw new Error("wrong number of arguments");if(n<=0)throw new Error("size must be positive");if(s<=0)throw new Error("height must be positive");const o=t.map(a=>LO.isA(a)?FO(e,a):RO.isA(a)?GO(e,a):a);return o.length===1?o[0]:o};var DO=NO;const kO=Ze,$0=Ea,fc=Tr,A0=ut,S0=Je,am=et,Zn=st,IO=Jr,BO=om,zO=(e,t)=>{const r=fc.fromNormalAndPoint(fc.create(),e.axis,e.origin);if(Number.isNaN(r[0])||Number.isNaN(r[1])||Number.isNaN(r[2])||Number.isNaN(r[3]))throw new Error("project: invalid axis or origin");const n=IO(t),s=n*n*Math.sqrt(3)/4;if(n===0)return S0.create();const o=am.toPolygons(t);let a=[];for(let c=0;c<o.length;c++){const l=o[c].vertices.map(h=>fc.projectionOfPoint(r,h)),u=Zn.create(l),d=Zn.plane(u);!$0(r,d)||Zn.measureArea(u)<s||a.push(u)}if(!$0(r,[0,0,1])){const c=A0.fromVectorRotation(A0.create(),r,[0,0,1]);a=a.map(l=>Zn.transform(c,l))}a=a.sort((c,l)=>Zn.measureArea(l)-Zn.measureArea(c));const i=a.map(c=>S0.fromPoints(c.vertices));return BO(i)},VO=(e,...t)=>{const r={axis:[0,0,1],origin:[0,0,0]},{axis:n,origin:s}=Object.assign({},r,e);if(t=kO(t),t.length===0)throw new Error("wrong number of arguments");e={axis:n,origin:s};const o=t.map(a=>am.isA(a)?zO(e,a):a);return o.length===1?o[0]:o};var qO=VO,XO={extrudeFromSlices:dl,extrudeLinear:bO,extrudeRectangular:DO,extrudeRotate:Wh,project:qO,slice:Qs};const T0=rt,UO=e=>{let t=T0.fromValues(1/0,1/0);e.forEach(s=>{(s[1]<t[1]||s[1]===t[1]&&s[0]<t[0])&&(t=s)});const r=[];e.forEach(s=>{const o=HO(s[1]-t[1],s[0]-t[0]),a=T0.squaredDistance(s,t);r.push({point:s,angle:o,distSq:a})}),r.sort((s,o)=>s.angle<o.angle?-1:s.angle>o.angle?1:s.distSq<o.distSq?-1:s.distSq>o.distSq?1:0);const n=[];return r.forEach(s=>{let o=n.length;for(;o>1&&jO(n[o-2],n[o-1],s.point)<=Number.EPSILON;)n.pop(),o=n.length;n.push(s.point)}),n},jO=(e,t,r)=>(t[0]-e[0])*(r[1]-e[1])-(t[1]-e[1])*(r[0]-e[0]),HO=(e,t)=>e===0&&t===0?-1/0:-t/e;var im=UO;const P0=Je,M0=et,C0=ct,YO=e=>{const t=new Set,r=[],n=s=>{const o=s.toString();t.has(o)||(r.push(s),t.add(o))};return e.forEach(s=>{P0.isA(s)?P0.toPoints(s).forEach(n):M0.isA(s)?M0.toPoints(s).forEach(o=>o.forEach(n)):C0.isA(s)&&C0.toPoints(s).forEach(n)}),r};var wl=YO;const ZO=Ze,WO=ct,QO=im,KO=wl,JO=(...e)=>{e=ZO(e);const t=KO(e),r=QO(t);return WO.fromPoints({closed:!0},r)};var eR=JO;const tR=Ze,O0=Je,rR=im,nR=wl,sR=(...e)=>{e=tR(e);const t=nR(e),r=rR(t);return r.length<3?O0.create():O0.fromPoints(r)};var oR=sR;const aR=Hs,R0=ma,L0=Nd,iR=(e,t,r)=>{const n=[],s=[],o=[];R0(n,r,t),R0(s,e,t);const a=L0(aR(o,s,n)),i=L0(n);if(i===0)throw Error("a and b are the same point");return a/i},cR=(e,t,r)=>Math.sqrt(iR(e,t,r));var lR=cR;const fR=Hs,uR=Kc,F0=ma,dR=(e,t,r,n)=>{const s=[0,0,0];return F0(e,t,r),F0(s,r,n),fR(e,e,s),uR(e,e)};var hR=dR;class mR{constructor(){this.head=null,this.tail=null}clear(){this.head=this.tail=null}insertBefore(t,r){r.prev=t.prev,r.next=t,r.prev?r.prev.next=r:this.head=r,t.prev=r}insertAfter(t,r){r.prev=t,r.next=t.next,r.next?r.next.prev=r:this.tail=r,t.next=r}add(t){this.head?this.tail.next=t:this.head=t,t.prev=this.tail,t.next=null,this.tail=t}addAll(t){for(this.head?this.tail.next=t:this.head=t,t.prev=this.tail;t.next;)t=t.next;this.tail=t}remove(t){t.prev?t.prev.next=t.next:this.head=t.next,t.next?t.next.prev=t.prev:this.tail=t.prev}removeChain(t,r){t.prev?t.prev.next=r.next:this.head=r.next,r.next?r.next.prev=t.prev:this.tail=t.prev}first(){return this.head}isEmpty(){return!this.head}}var pR=mR;class vR{constructor(t,r){this.point=t,this.index=r,this.next=null,this.prev=null,this.face=null}}var gR=vR;const yR=Cd,bR=Gd;class wR{constructor(t,r){this.vertex=t,this.face=r,this.next=null,this.prev=null,this.opposite=null}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){return this.tail()?yR(this.tail().point,this.head().point):-1}lengthSquared(){return this.tail()?bR(this.tail().point,this.head().point):-1}setOpposite(t){this.opposite=t,t.opposite=this}}var _R=wR;const uc=Pd,xR=Md,ER=Hs,dc=da,$R=Od,AR=Kc,Yo=Fd,hc=ma,mc=_R,cm=0,SR=1,jc=2;class _l{constructor(){this.normal=[],this.centroid=[],this.offset=0,this.outside=null,this.mark=cm,this.edge=null,this.nVertices=0}getEdge(t){if(typeof t!="number")throw Error("requires a number");let r=this.edge;for(;t>0;)r=r.next,t-=1;for(;t<0;)r=r.prev,t+=1;return r}computeNormal(){const t=this.edge,r=t.next;let n=r.next;const s=hc([],r.head().point,t.head().point),o=[],a=[];for(this.nVertices=2,this.normal=[0,0,0];n!==t;)xR(a,s),hc(s,n.head().point,t.head().point),uc(this.normal,this.normal,ER(o,a,s)),n=n.next,this.nVertices+=1;this.area=$R(this.normal),this.normal=Yo(this.normal,this.normal,1/this.area)}computeNormalMinArea(t){if(this.computeNormal(),this.area<t){let r,n=0,s=this.edge;do{const u=s.lengthSquared();u>n&&(r=s,n=u),s=s.next}while(s!==this.edge);const o=r.tail().point,a=r.head().point,i=hc([],a,o),c=Math.sqrt(n);Yo(i,i,1/c);const l=dc(this.normal,i);Yo(i,i,-l),uc(this.normal,this.normal,i),AR(this.normal,this.normal)}}computeCentroid(){this.centroid=[0,0,0];let t=this.edge;do uc(this.centroid,this.centroid,t.head().point),t=t.next;while(t!==this.edge);Yo(this.centroid,this.centroid,1/this.nVertices)}computeNormalAndCentroid(t){typeof t<"u"?this.computeNormalMinArea(t):this.computeNormal(),this.computeCentroid(),this.offset=dc(this.normal,this.centroid)}distanceToPlane(t){return dc(this.normal,t)-this.offset}connectHalfEdges(t,r){let n;if(t.opposite.face===r.opposite.face){const s=r.opposite.face;let o;t===this.edge&&(this.edge=r),s.nVertices===3?(o=r.opposite.prev.opposite,s.mark=jc,n=s):(o=r.opposite.next,s.edge===o.prev&&(s.edge=o),o.prev=o.prev.prev,o.prev.next=o),r.prev=t.prev,r.prev.next=r,r.setOpposite(o),s.computeNormalAndCentroid()}else t.next=r,r.prev=t;return n}mergeAdjacentFaces(t,r){const n=t.opposite,s=n.face;r.push(s),s.mark=jc;let o=t.prev,a=t.next,i=n.prev,c=n.next;for(;o.opposite.face===s;)o=o.prev,c=c.next;for(;a.opposite.face===s;)a=a.next,i=i.prev;let l;for(l=c;l!==i.next;l=l.next)l.face=this;this.edge=a;let u;return u=this.connectHalfEdges(i,a),u&&r.push(u),u=this.connectHalfEdges(o,c),u&&r.push(u),this.computeNormalAndCentroid(),r}collectIndices(){const t=[];let r=this.edge;do t.push(r.head().index),r=r.next;while(r!==this.edge);return t}static createTriangle(t,r,n,s=0){const o=new _l,a=new mc(t,o),i=new mc(r,o),c=new mc(n,o);return a.next=c.prev=i,i.next=a.prev=c,c.next=i.prev=a,o.edge=a,o.computeNormalAndCentroid(s),o}}var TR={VISIBLE:cm,NON_CONVEX:SR,DELETED:jc,Face:_l};const pc=da,PR=lR,MR=hR,G0=pR,CR=gR,{Face:Fr,VISIBLE:Wn,NON_CONVEX:N0,DELETED:OR}=TR,RR=1,D0=2;class LR{constructor(t){if(!Array.isArray(t))throw TypeError("input is not a valid array");if(t.length<4)throw Error("cannot build a simplex out of <4 points");this.tolerance=-1,this.nFaces=0,this.nPoints=t.length,this.faces=[],this.newFaces=[],this.claimed=new G0,this.unclaimed=new G0,this.vertices=[];for(let r=0;r<t.length;r+=1)this.vertices.push(new CR(t[r],r));this.discardedFaces=[],this.vertexPointIndices=[]}addVertexToFace(t,r){t.face=r,r.outside?this.claimed.insertBefore(r.outside,t):this.claimed.add(t),r.outside=t}removeVertexFromFace(t,r){t===r.outside&&(t.next&&t.next.face===r?r.outside=t.next:r.outside=null),this.claimed.remove(t)}removeAllVerticesFromFace(t){if(t.outside){let r=t.outside;for(;r.next&&r.next.face===t;)r=r.next;return this.claimed.removeChain(t.outside,r),r.next=null,t.outside}}deleteFaceVertices(t,r){const n=this.removeAllVerticesFromFace(t);if(n)if(!r)this.unclaimed.addAll(n);else{let s;for(let o=n;o;o=s)s=o.next,r.distanceToPlane(o.point)>this.tolerance?this.addVertexToFace(o,r):this.unclaimed.add(o)}}resolveUnclaimedPoints(t){let r=this.unclaimed.first();for(let n=r;n;n=r){r=n.next;let s=this.tolerance,o;for(let a=0;a<t.length;a+=1){const i=t[a];if(i.mark===Wn){const c=i.distanceToPlane(n.point);if(c>s&&(s=c,o=i),s>1e3*this.tolerance)break}}o&&this.addVertexToFace(n,o)}}computeExtremes(){const t=[],r=[],n=[],s=[];let o,a;for(o=0;o<3;o+=1)n[o]=s[o]=this.vertices[0];for(o=0;o<3;o+=1)t[o]=r[o]=this.vertices[0].point[o];for(o=1;o<this.vertices.length;o+=1){const i=this.vertices[o],c=i.point;for(a=0;a<3;a+=1)c[a]<t[a]&&(t[a]=c[a],n[a]=i);for(a=0;a<3;a+=1)c[a]>r[a]&&(r[a]=c[a],s[a]=i)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(t[0]),Math.abs(r[0]))+Math.max(Math.abs(t[1]),Math.abs(r[1]))+Math.max(Math.abs(t[2]),Math.abs(r[2]))),[n,s]}createInitialSimplex(){const t=this.vertices,[r,n]=this.computeExtremes();let s,o,a,i,c=0,l=0;for(a=0;a<3;a+=1){const g=n[a].point[a]-r[a].point[a];g>c&&(c=g,l=a)}const u=r[l],d=n[l];for(c=0,a=0;a<this.vertices.length;a+=1){const g=this.vertices[a];if(g!==u&&g!==d){const b=PR(g.point,u.point,d.point);b>c&&(c=b,s=g)}}const h=MR([],u.point,d.point,s.point),p=pc(u.point,h);for(c=-1,a=0;a<this.vertices.length;a+=1){const g=this.vertices[a];if(g!==u&&g!==d&&g!==s){const b=Math.abs(pc(h,g.point)-p);b>c&&(c=b,o=g)}}const E=[];if(pc(o.point,h)-p<0)for(E.push(Fr.createTriangle(u,d,s),Fr.createTriangle(o,d,u),Fr.createTriangle(o,s,d),Fr.createTriangle(o,u,s)),a=0;a<3;a+=1){const g=(a+1)%3;E[a+1].getEdge(2).setOpposite(E[0].getEdge(g)),E[a+1].getEdge(1).setOpposite(E[g+1].getEdge(0))}else for(E.push(Fr.createTriangle(u,s,d),Fr.createTriangle(o,u,d),Fr.createTriangle(o,d,s),Fr.createTriangle(o,s,u)),a=0;a<3;a+=1){const g=(a+1)%3;E[a+1].getEdge(2).setOpposite(E[0].getEdge((3-a)%3)),E[a+1].getEdge(0).setOpposite(E[g+1].getEdge(1))}for(a=0;a<4;a+=1)this.faces.push(E[a]);for(a=0;a<t.length;a+=1){const g=t[a];if(g!==u&&g!==d&&g!==s&&g!==o){c=this.tolerance;let b;for(i=0;i<4;i+=1){const P=E[i].distanceToPlane(g.point);P>c&&(c=P,b=E[i])}b&&this.addVertexToFace(g,b)}}}reindexFaceAndVertices(){const t=[];for(let r=0;r<this.faces.length;r+=1){const n=this.faces[r];n.mark===Wn&&t.push(n)}this.faces=t}collectFaces(t){const r=[];for(let n=0;n<this.faces.length;n+=1){if(this.faces[n].mark!==Wn)throw Error("attempt to include a destroyed face in the hull");const s=this.faces[n].collectIndices();if(t)r.push(s);else for(let o=0;o<s.length-2;o+=1)r.push([s[0],s[o+1],s[o+2]])}return r}nextVertexToAdd(){if(!this.claimed.isEmpty()){let t,r,n=0;const s=this.claimed.first().face;for(r=s.outside;r&&r.face===s;r=r.next){const o=s.distanceToPlane(r.point);o>n&&(n=o,t=r)}return t}}computeHorizon(t,r,n,s){this.deleteFaceVertices(n),n.mark=OR;let o;r?o=r.next:o=r=n.getEdge(0);do{const a=o.opposite,i=a.face;i.mark===Wn&&(i.distanceToPlane(t)>this.tolerance?this.computeHorizon(t,a,i,s):s.push(o)),o=o.next}while(o!==r)}addAdjoiningFace(t,r){const n=Fr.createTriangle(t,r.tail(),r.head());return this.faces.push(n),n.getEdge(-1).setOpposite(r.opposite),n.getEdge(0)}addNewFaces(t,r){this.newFaces=[];let n,s;for(let o=0;o<r.length;o+=1){const a=r[o],i=this.addAdjoiningFace(t,a);n?i.next.setOpposite(s):n=i,this.newFaces.push(i.face),s=i}n.next.setOpposite(s)}oppositeFaceDistance(t){return t.face.distanceToPlane(t.opposite.face.centroid)}doAdjacentMerge(t,r){let n=t.edge,s=!0,o=0;do{if(o>=t.nVertices)throw Error("merge recursion limit exceeded");const a=n.opposite.face;let i=!1;if(r===D0?(this.oppositeFaceDistance(n)>-this.tolerance||this.oppositeFaceDistance(n.opposite)>-this.tolerance)&&(i=!0):t.area>a.area?this.oppositeFaceDistance(n)>-this.tolerance?i=!0:this.oppositeFaceDistance(n.opposite)>-this.tolerance&&(s=!1):this.oppositeFaceDistance(n.opposite)>-this.tolerance?i=!0:this.oppositeFaceDistance(n)>-this.tolerance&&(s=!1),i){const c=t.mergeAdjacentFaces(n,[]);for(let l=0;l<c.length;l+=1)this.deleteFaceVertices(c[l],t);return!0}n=n.next,o+=1}while(n!==t.edge);return s||(t.mark=N0),!1}addVertexToHull(t){const r=[];this.unclaimed.clear(),this.removeVertexFromFace(t,t.face),this.computeHorizon(t.point,null,t.face,r),this.addNewFaces(t,r);for(let n=0;n<this.newFaces.length;n+=1){const s=this.newFaces[n];if(s.mark===Wn)for(;this.doAdjacentMerge(s,RR););}for(let n=0;n<this.newFaces.length;n+=1){const s=this.newFaces[n];if(s.mark===N0)for(s.mark=Wn;this.doAdjacentMerge(s,D0););}this.resolveUnclaimedPoints(this.newFaces)}build(){let t;for(this.createInitialSimplex();t=this.nextVertexToAdd();)this.addVertexToHull(t);this.reindexFaceAndVertices()}}var FR=LR;const GR=FR,NR=(e,t={})=>{const r=new GR(e);return r.build(),r.collectFaces(t.skipTriangulation)};var DR=NR;const kR=Ze,IR=et,BR=st,zR=DR,VR=wl,qR=(...e)=>{if(e=kR(e),e.length===1)return e[0];const t=VR(e),n=zR(t,{skipTriangulation:!0}).map(s=>{const o=s.map(a=>t[a]);return BR.create(o)});return IR.create(n)};var XR=qR;const UR=Ze,jR=Ks,HR=Je,YR=et,ZR=ct,WR=eR,QR=oR,KR=XR,JR=(...e)=>{if(e=UR(e),e.length===0)throw new Error("wrong number of arguments");if(!jR(e))throw new Error("only hulls of the same type are supported");const t=e[0];return ZR.isA(t)?WR(e):HR.isA(t)?QR(e):YR.isA(t)?KR(e):t};var lm=JR;const eL=Ze,tL=yl,rL=lm,nL=(...e)=>{if(e=eL(e),e.length<2)throw new Error("wrong number of arguments");const t=[];for(let r=1;r<e.length;r++)t.push(rL(e[r-1],e[r]));return tL(t)};var sL=nL,fm={hull:lm,hullChain:sL};const vc=ze,um=st,oL=(e,t)=>{const r=Math.abs(um.measureArea(t));return Number.isFinite(r)&&r>e},aL=(e,t)=>{let r=t.map(s=>{const o=s.vertices.map(c=>vc.snap(vc.create(),c,e)),a=[];for(let c=0;c<o.length;c++){const l=(c+1)%o.length;vc.equals(o[c],o[l])||a.push(o[c])}const i=um.create(a);return s.color&&(i.color=s.color),i});const n=e*e*Math.sqrt(3)/4;return r=r.filter(s=>oL(n,s)),r};var dm=aL;const iL=Ea,Jn=ze,la=st,cL=e=>{const t=la.toPoints(e),r=[];for(let n=0;n<t.length;n++){const s=(n+1)%t.length,o={v1:t[n],v2:t[s]};r.push(o)}for(let n=0;n<r.length;n++){const s=(n+1)%t.length;r[n].next=r[s],r[s].prev=r[n]}return r},lL=(e,t)=>{const r=`${t.v1}:${t.v2}`;e.set(r,t)},gc=(e,t)=>{const r=`${t.v1}:${t.v2}`;e.delete(r)},fL=(e,t)=>{const r=`${t.v2}:${t.v1}`;return e.get(r)},uL=(e,t,r)=>{let n=e.prev.v1,s=e.prev.v2,o=t.next.v2;const a=k0(n,s,o,r);n=t.prev.v1,s=t.prev.v2,o=e.next.v2;const i=k0(n,s,o,r);return[a,i]},dL=Jn.create(),hL=Jn.create(),k0=(e,t,r,n)=>{const s=Jn.subtract(dL,t,e),o=Jn.subtract(hL,r,t);return Jn.cross(s,s,o),Jn.dot(s,n)},mL=e=>{let t;const r=[];for(;e.next;){const n=e.next;r.push(e.v1),e.v1=null,e.v2=null,e.next=null,e.prev=null,e=n}return r.length>0&&(t=la.create(r)),t},pL=e=>{if(e.length<2)return e;const t=e[0].plane,r=e.slice(),n=new Map;for(;r.length>0;){const o=r.shift(),a=cL(o);for(let i=0;i<a.length;i++){const c=a[i],l=fL(n,c);if(l){const u=uL(c,l,t);if(u[0]>=0&&u[1]>=0){const d=l.next,h=c.next;c.prev.next=l.next,c.next.prev=l.prev,l.prev.next=c.next,l.next.prev=c.prev,c.v1=null,c.v2=null,c.next=null,c.prev=null,gc(n,l),l.v1=null,l.v2=null,l.next=null,l.prev=null;const p=(E,g,b)=>{const P={v1:b.v1,v2:g.v2,next:g.next,prev:b.prev};b.prev.next=P,g.next.prev=P,gc(E,g),g.v1=null,g.v2=null,g.next=null,g.prev=null,gc(E,b),b.v1=null,b.v2=null,b.next=null,b.prev=null};u[0]===0&&p(n,d,d.prev),u[1]===0&&p(n,h,h.prev)}}else c.next&&lL(n,c)}}const s=[];return n.forEach(o=>{const a=mL(o);a&&s.push(a)}),n.clear(),s},vL=(e,t)=>Math.abs(e[3]-t[3])<15e-8?iL(e,t):!1,gL=(e,t)=>{const r=[];t.forEach(s=>{const o=r.find(a=>vL(a[0],la.plane(s)));o?o[1].push(s):r.push([la.plane(s),[s]])});let n=[];return r.forEach(s=>{const o=s[1],a=pL(o);n=n.concat(a)}),n};var yL=gL;const I0=mt,$r=ze,bL=st,Ht=e=>`${e}`,B0=(e,t,r,n,s,o)=>{const a=Ht(n),i=Ht(s),c=`${a}/${i}`,l=`${i}/${a}`;if(e.has(l))return ra(e,t,r,s,n,null),null;const u={vertex0:n,vertex1:s,polygonindex:o};return e.has(c)?e.get(c).push(u):e.set(c,[u]),t.has(a)?t.get(a).push(c):t.set(a,[c]),r.has(i)?r.get(i).push(c):r.set(i,[c]),c},ra=(e,t,r,n,s,o)=>{const a=Ht(n),i=Ht(s),c=`${a}/${i}`;let l=-1;const u=e.get(c);for(let d=0;d<u.length;d++){const h=u[d];let p=Ht(h.vertex0);if(p===a&&(p=Ht(h.vertex1),p===i&&!(o!==null&&h.polygonindex!==o))){l=d;break}}u.splice(l,1),u.length===0&&e.delete(c),l=t.get(a).indexOf(c),t.get(a).splice(l,1),t.get(a).length===0&&t.delete(a),l=r.get(i).indexOf(c),r.get(i).splice(l,1),r.get(i).length===0&&r.delete(i)},wL=e=>{const t=new Map;for(let r=0;r<e.length;r++){const n=e[r],s=n.vertices.length;if(s>=3){let o=n.vertices[0],a=Ht(o);for(let i=0;i<s;i++){let c=i+1;c===s&&(c=0);const l=n.vertices[c],u=Ht(l),d=`${a}/${u}`,h=`${u}/${a}`;if(t.has(h)){const p=t.get(h);p.splice(-1,1),p.length===0&&t.delete(h)}else{const p={vertex0:o,vertex1:l,polygonindex:r};t.has(d)?t.get(d).push(p):t.set(d,[p])}o=l,a=u}}else console.warn("warning: invalid polygon found during insertTjunctions")}if(t.size>0){const r=new Map,n=new Map,s=new Map;for(const[a,i]of t)s.set(a,!0),i.forEach(c=>{const l=Ht(c.vertex0),u=Ht(c.vertex1);r.has(l)?r.get(l).push(a):r.set(l,[a]),n.has(u)?n.get(u).push(a):n.set(u,[a])});const o=e.slice(0);for(;t.size!==0;){for(const i of t.keys())s.set(i,!0);let a=!1;for(;;){const i=Array.from(s.keys());if(i.length===0)break;const c=i[0];let l=!0;if(t.has(c)){const d=t.get(c)[0];for(let h=0;h<2;h++){const p=h===0?d.vertex0:d.vertex1,E=h===0?d.vertex1:d.vertex0,g=Ht(p),b=Ht(E);let P=[];h===0?n.has(g)&&(P=n.get(g)):r.has(g)&&(P=r.get(g));for(let F=0;F<P.length;F++){const R=P[F],C=t.get(R)[0],G=h===0?C.vertex0:C.vertex1;if(h===0?C.vertex1:C.vertex0,Ht(G)===b){ra(t,r,n,p,E,null),ra(t,r,n,E,p,null),l=!1,h=2,a=!0;break}else{const q=p,ee=E,oe=G,pe=$r.subtract($r.create(),oe,q),Q=$r.dot($r.subtract($r.create(),ee,q),pe)/$r.dot(pe,pe);if(Q>0&&Q<1){const Te=$r.scale($r.create(),pe,Q);if($r.add(Te,Te,q),$r.squaredDistance(Te,ee)<I0.EPS*I0.EPS){const $e=C.polygonindex,Ue=o[$e],Ne=Ht(C.vertex1);let Lt=-1;for(let yr=0;yr<Ue.vertices.length;yr++)if(Ht(Ue.vertices[yr])===Ne){Lt=yr;break}const Nt=Ue.vertices.slice(0);Nt.splice(Lt,0,E);const Gr=bL.create(Nt);o[$e]=Gr,ra(t,r,n,C.vertex0,C.vertex1,$e);const gr=B0(t,r,n,C.vertex0,E,$e),Nr=B0(t,r,n,E,C.vertex1,$e);gr!==null&&s.set(gr,!0),Nr!==null&&s.set(Nr,!0),l=!1,h=2,a=!0;break}}}}}}l&&s.delete(c)}if(!a)break}e=o}return t.clear(),e};var _L=wL;const yc=ze,bc=st,xL=(e,t,r)=>{const n=t.vertices.length;if(n>3){if(n>4){const a=[0,0,0];t.vertices.forEach(i=>yc.add(a,a,i)),yc.snap(a,yc.divide(a,a,[n,n,n]),e);for(let i=0;i<n;i++){const c=bc.create([a,t.vertices[i],t.vertices[(i+1)%n]]);t.color&&(c.color=t.color),r.push(c)}return}const s=bc.create([t.vertices[0],t.vertices[1],t.vertices[2]]),o=bc.create([t.vertices[0],t.vertices[2],t.vertices[3]]);t.color&&(s.color=t.color,o.color=t.color),r.push(s,o);return}r.push(t)},EL=(e,t)=>{const r=[];return t.forEach(n=>{xL(e,n,r)}),r};var $L=EL;const AL=Ze,SL=Jr,TL=Je,hm=et,PL=ct,ML=dm,CL=yL,OL=_L,RL=$L,LL=(e,t)=>t,FL=(e,t)=>t,GL=(e,t)=>{const r={snap:!1,simplify:!1,triangulate:!1},{snap:n,simplify:s,triangulate:o}=Object.assign({},r,e),a=SL(t);let i=hm.toPolygons(t);n&&(i=ML(a,i)),s&&(i=CL(a,i)),o&&(i=OL(i),i=RL(a,i));const c=Object.assign({},t);return c.polygons=i,c},NL=(e,...t)=>{if(t=AL(t),t.length===0)throw new Error("wrong number of arguments");const r=t.map(n=>{if(PL.isA(n))return LL(e,n);if(TL.isA(n))return FL(e,n);if(hm.isA(n))return GL(e,n);throw new Error("invalid geometry")});return r.length===1?r[0]:r};var DL=NL;const kL=Ze,xn=rt,Hc=Je,Yc=et,Zc=ct,xl=Jr,IL=dm,BL=e=>{const t=xl(e),n=Zc.toPoints(e).map(s=>xn.snap(xn.create(),s,t));return Zc.create(n)},zL=e=>{const t=xl(e);let n=Hc.toSides(e).map(s=>[xn.snap(xn.create(),s[0],t),xn.snap(xn.create(),s[1],t)]);return n=n.filter(s=>!xn.equals(s[0],s[1])),Hc.create(n)},VL=e=>{const t=xl(e),r=Yc.toPolygons(e),n=IL(t,r);return Yc.create(n)},qL=(...e)=>{if(e=kL(e),e.length===0)throw new Error("wrong number of arguments");const t=e.map(r=>Zc.isA(r)?BL(r):Hc.isA(r)?zL(r):Yc.isA(r)?VL(r):r);return t.length===1?t[0]:t};var XL=qL,UL={generalize:DL,snap:XL};const jL=(e,t,r)=>{for(e=e.slice();e.length<r;)e.push(t);return e};var HL=jL;const YL=Ze,z0=HL,mm=cl,{translate:ZL}=En,WL=e=>{if(!Array.isArray(e.modes)||e.modes.length>3)throw new Error("align(): modes must be an array of length <= 3");if(e.modes=z0(e.modes,"none",3),e.modes.filter(t=>["center","max","min","none"].includes(t)).length!==3)throw new Error('align(): all modes must be one of "center", "max" or "min"');if(!Array.isArray(e.relativeTo)||e.relativeTo.length>3)throw new Error("align(): relativeTo must be an array of length <= 3");if(e.relativeTo=z0(e.relativeTo,0,3),e.relativeTo.filter(t=>Number.isFinite(t)||t==null).length!==3)throw new Error("align(): all relativeTo values must be a number, or null.");if(typeof e.grouped!="boolean")throw new Error("align(): grouped must be a boolean value.");return e},QL=(e,t,r)=>{for(let n=0;n<3;n++)e[n]==null&&(t[n]==="center"?e[n]=(r[0][n]+r[1][n])/2:t[n]==="max"?e[n]=r[1][n]:t[n]==="min"&&(e[n]=r[0][n]));return e},V0=(e,t,r)=>{const n=mm(e),s=[0,0,0];for(let o=0;o<3;o++)t[o]==="center"?s[o]=r[o]-(n[0][o]+n[1][o])/2:t[o]==="max"?s[o]=r[o]-n[1][o]:t[o]==="min"&&(s[o]=r[o]-n[0][o]);return ZL(s,e)},KL=(e,...t)=>{e=Object.assign({},{modes:["center","center","min"],relativeTo:[0,0,0],grouped:!1},e),e=WL(e);let{modes:n,relativeTo:s,grouped:o}=e;if(t=YL(t),t.length===0)throw new Error("align(): No geometries were provided to act upon");if(s.filter(a=>a==null).length){const a=mm(t);s=QL(s,n,a)}return o?t=V0(t,n,s):t=t.map(a=>V0(a,n,s)),t.length===1?t[0]:t};var JL=KL;const eF=Ze,tF=Je,rF=et,nF=ct,sF=Sn,{translate:oF}=En,wc=(e,t)=>{const r={axes:[!0,!0,!0],relativeTo:[0,0,0]},{axes:n,relativeTo:s}=Object.assign({},r,e),o=sF(t),a=[0,0,0];return n[0]&&(a[0]=s[0]-(o[0][0]+(o[1][0]-o[0][0])/2)),n[1]&&(a[1]=s[1]-(o[0][1]+(o[1][1]-o[0][1])/2)),n[2]&&(a[2]=s[2]-(o[0][2]+(o[1][2]-o[0][2])/2)),oF(a,t)},Ra=(e,...t)=>{const r={axes:[!0,!0,!0],relativeTo:[0,0,0]},{axes:n,relativeTo:s}=Object.assign({},r,e);if(t=eF(t),t.length===0)throw new Error("wrong number of arguments");if(s.length!==3)throw new Error("relativeTo must be an array of length 3");e={axes:n,relativeTo:s};const o=t.map(a=>nF.isA(a)||tF.isA(a)||rF.isA(a)?wc(e,a):a);return o.length===1?o[0]:o},aF=(...e)=>Ra({axes:[!0,!1,!1]},e),iF=(...e)=>Ra({axes:[!1,!0,!1]},e),cF=(...e)=>Ra({axes:[!1,!1,!0]},e);var Zo={center:Ra,centerX:aF,centerY:iF,centerZ:cF};const lF=Ze,q0=ut,X0=Je,U0=et,j0=ct,La=(e,...t)=>{if(!Array.isArray(e))throw new Error("factors must be an array");if(t=lF(t),t.length===0)throw new Error("wrong number of arguments");for(e=e.slice();e.length<3;)e.push(1);if(e[0]<=0||e[1]<=0||e[2]<=0)throw new Error("factors must be positive");const r=q0.fromScaling(q0.create(),e),n=t.map(s=>j0.isA(s)?j0.transform(r,s):X0.isA(s)?X0.transform(r,s):U0.isA(s)?U0.transform(r,s):s);return n.length===1?n[0]:n},fF=(e,...t)=>La([e,1,1],t),uF=(e,...t)=>La([1,e,1],t),dF=(e,...t)=>La([1,1,e],t);var Wo={scale:La,scaleX:fF,scaleY:uF,scaleZ:dF};const hF=Ze,H0=Je,Y0=et,Z0=ct,mF=(e,...t)=>{if(t=hF(t),t.length===0)throw new Error("wrong number of arguments");const r=t.map(n=>Z0.isA(n)?Z0.transform(e,n):H0.isA(n)?H0.transform(e,n):Y0.isA(n)?Y0.transform(e,n):n);return r.length===1?r[0]:r};var pF=mF,$t={align:JL,center:Zo.center,centerX:Zo.centerX,centerY:Zo.centerY,centerZ:Zo.centerZ,mirror:Bs.mirror,mirrorX:Bs.mirrorX,mirrorY:Bs.mirrorY,mirrorZ:Bs.mirrorZ,rotate:Vs.rotate,rotateX:Vs.rotateX,rotateY:Vs.rotateY,rotateZ:Vs.rotateZ,scale:Wo.scale,scaleX:Wo.scaleX,scaleY:Wo.scaleY,scaleZ:Wo.scaleZ,transform:pF,translate:En.translate,translateX:En.translateX,translateY:En.translateY,translateZ:En.translateZ},vr={colors:LE,curves:VE,geometries:sl,maths:$A,measurements:z4,primitives:Qh,text:VM,utils:Mt,booleans:Ma,expansions:sO,extrusions:XO,hulls:fm,modifiers:UL,transforms:$t};const pm=e=>e.reduce((t,r)=>Array.isArray(r)?t.concat(pm(r)):t.concat(r),[]);var vF=pm;const gF=(e,t)=>e-t;var yF=gF;const bF=e=>{if(!(!Array.isArray(e)||e.length===0))return e[0]};var wF=bF;const _F=(e,t,r)=>{let n=0,s=e.length;for(;s>n;){const o=Math.floor((n+s)/2),a=e[o];r(t,a)>0?n=o+1:s=o}return e.splice(n,0,t),e};var xF=_F;const EF=(e,t)=>{if(!(!Array.isArray(e)||e.length<t))return e[t]};var $F=EF;const AF=(e,t,r)=>{for(e=e.slice();e.length<r;)e.push(t);return e};var SF=AF;const TF=e=>Array.isArray(e)?e:e==null?[]:[e];var PF=TF,El={flatten:vF,fnNumberSort:yF,head:wF,insertSorted:xF,nth:$F,padToLength:SF,toArray:PF};const{geometries:_c}=vr,MF=(e,t)=>{t.statusCallback&&t.statusCallback({progress:0});const r=new ArrayBuffer(4),n=new Int32Array(r,0,1),s=new Int8Array(r,0,4);if(n[0]=287454020,s[0]!==68)throw new Error("Binary STL output is currently only supported on little-endian (Intel) processors");let o=0,a=0;e.forEach((b,P)=>{_c.geom3.toPolygons(b).forEach(R=>{const C=R.vertices.length;o+=C>=3?C-2:0,a+=1})});const i=new Uint8Array(80);for(let b=0;b<80;b++)i[b]=65;const c=new Uint32Array(1);c[0]=o;const l=new ArrayBuffer(50*o),u=new Int8Array(l),d=new ArrayBuffer(50),h=new Int8Array(d),p=new Float32Array(d,0,12),E=new Uint16Array(d,48,1);let g=0;return e.forEach(b=>{_c.geom3.toPolygons(b).forEach((F,R)=>{const C=F.vertices,G=C.length,L=_c.poly3.plane(F);for(let q=0;q<G-2;q++){p[0]=L[0],p[1]=L[1],p[2]=L[2];let ee=3;for(let oe=0;oe<3;oe++){const pe=oe+(oe>0?q:0),Q=C[pe];p[ee++]=Q[0],p[ee++]=Q[1],p[ee++]=Q[2]}E[0]=0,u.set(h,g),g+=50}t.statusCallback&&t.statusCallback({progress:100*R/a})})}),t.statusCallback&&t.statusCallback({progress:100}),[i.buffer,c.buffer,l]};var CF={serializeBinary:MF};const{geometries:vm}=vr,OF=(e,t)=>{t.statusCallback&&t.statusCallback({progress:0});const r=`solid JSCAD
${RF(e,t)}
endsolid JSCAD
`;return t.statusCallback&&t.statusCallback({progress:100}),[r]},RF=(e,t)=>{const r=[];return e.forEach((n,s)=>{r.push(LF(n)),t.statusCallback&&t.statusCallback({progress:100*s/e.length})}),r.join(`
`)},LF=(e,t)=>{const r=[];return vm.geom3.toPolygons(e).forEach((s,o)=>{r.push(FF(s))}),r.join(`
`)},gm=e=>`${e[0]} ${e[1]} ${e[2]}`,xc=e=>`vertex ${gm(e)}`,FF=e=>{const t=[];if(e.vertices.length>=3){const r=xc(e.vertices[0]);for(let n=0;n<e.vertices.length-2;n++){const s=`facet normal ${gm(vm.poly3.plane(e))}
outer loop
${r}
${xc(e.vertices[n+1])}
${xc(e.vertices[n+2])}
endloop
endfacet`;t.push(s)}}return t.join(`
`)};var GF={serializeText:OF};const{geometries:NF,modifiers:DF}=vr,{flatten:kF,toArray:IF}=El,{serializeBinary:BF}=CF,{serializeText:zF}=GF,VF="application/sla",qF=(e,...t)=>{e=Object.assign({},{binary:!0,statusCallback:null},e),t=kF(t);let n=t.filter(s=>NF.geom3.isA(s));if(n.length===0)throw new Error("only 3D geometries can be serialized to STL");return t.length!==n.length&&console.warn("some objects could not be serialized to STL"),n=IF(DF.generalize({snap:!0,triangulate:!0},n)),e.binary?BF(n,e):zF(n,e)};var XF={mimeType:VF,serialize:qF};const{cylinder:W0,cuboid:LD,polygon:FD}=vr.primitives,{translateZ:GD,translate:Q0,translateY:ND,translateX:DD,rotateZ:kD,rotate:ID}=vr.transforms,{subtract:UF,intersect:BD,union:jF}=vr.booleans,HF=({radius:e,height:t,wallThickness:r})=>UF([W0({height:t,radius:e+r,segments:6}),W0({height:t,radius:e-r,segments:6})]),YF=({size:e,height:t,wallThickness:r,rows:n,cols:s})=>{const o=[],a=ZF(e),i=e*2;for(let c=0;c<n;c++){const l=i*c*.75;for(let u=0;u<s;u++){const d=a/2*(c%2)+u*a;o.push(Q0([l,d,0],HF({radius:e,height:t,wallThickness:r})))}}return Q0([0,0,t/2],jF(o))},ZF=e=>Math.sqrt(3)*e,{translate:wt,scale:WF,mirrorX:zD,rotateX:es}=vr.transforms,{cylinder:Zt,cuboid:it,triangle:ym}=vr.primitives,{hull:QF}=vr.hulls,{subtract:pr,union:fr}=vr.booleans,{extrudeLinear:bm}=vr.extrusions,K0=()=>$t.translateY(1,es(Mt.degToRad(90),bm({height:2},ym({type:"AAS",values:[Mt.degToRad(90),Mt.degToRad(60),24]})))),J0=()=>pr(fr(wt([1,0,6],it({size:[2,10,22]})),wt([2,4,-4],K0()),wt([2,-4,-4],K0())),it({size:[10,3,5.5],center:[0,0,12]})),Ec=e=>$t.rotateZ(Mt.degToRad(90),fr($t.translateZ(e/2,Zt({height:e,radius:11,segments:32})),it({size:[30,25,e],center:[0,-7.5,e/2]}))),ed=(e=22,t=8,r=18,n=18.5)=>$t.translateZ(r/2,fr(pr(it({size:[t,e,r]}),Ma.intersect($t.rotateY(Mt.degToRad(90),Zt({segments:32,height:t,radius:10})),it({size:[t,n,e]})),$t.translateZ(12,it({size:[t,n,r]})),wt([-2.5/2,0,2.5],it({size:[3.5,25,5.5]})),wt([-t/2,0,-t/2+2],$t.rotate([Mt.degToRad(90),Mt.degToRad(-45),Mt.degToRad(90)],bm({height:t},ym({type:"AAS",values:[Mt.degToRad(90),Mt.degToRad(45),e]}))))))),td=()=>fr(it({size:[Math.sqrt(2.5*2.5*2),10,1]}),pr($t.translateZ(.5,$t.rotateY(Mt.degToRad(45),it({size:[2.5,10,2.5]}))),$t.translateZ(-1,it({size:[Math.sqrt(2.5*2.5*2),10,1]})))),Qo=()=>{const n=[];for(let s=0;s<6;s++)n.push(wt([0,-2.5,-5+s*2],$t.rotate([Mt.degToRad(45),0,0],it({size:[50,2,2]}))));return wt([0,0,7.5],fr(pr(it({size:[8.5,5,15]}),it({size:[8.5-2*2,5-2,15],center:[0,-1,0]}),...n,$t.translateZ(3,td()),$t.translateZ(-5,td()))))},KF=()=>fr(Zt({height:20,radius:5,center:[5,0,10]}),it({center:[2.5,0,10],size:[5,10,20]}),es(Mt.degToRad(90),Ma.intersect(Zt({height:10,radius:20,segments:20}),it({size:[40,40,40],center:[-20,20,0]}))),Qh.sphere({radius:5,center:[5,0,20]})),JF=(e,t=12,r=3)=>pr(it({size:[t+2*r,e+6*r,r],center:[0,0,r/2]}),it({size:[t,e,r],center:[0,0,r/2]}),it({size:[t,r,r],center:[0,e/2+1.5*r,r/2]}),it({size:[t,r,r],center:[0,-e/2-1.5*r,r/2]})),eG=()=>{const c=[[-14,22.5],[-66.2,27.5],[-66.2,55.5],[-15.5,71],[-96.7,22.5],[-90.4,71],[-128.5,61.5]];return[fr(wt([2,0,2],pr(fr(wt([-16,25/2+1,1.5],es(Mt.degToRad(15),J0())),wt([-16,93.5-25/2-1,1.5],es(Mt.degToRad(-15),J0())),wt([-13-44.25,25/2,2.5],es(Mt.degToRad(15),fr(ed(25,8.5),$t.translateZ(-5,it({size:[8.5,25,10]}))))),wt([-13-44.25,93.5-25/2,2.5],es(Mt.degToRad(-15),fr(ed(25,8.5),$t.translateZ(-5,it({size:[8.5,25,10]}))))),it({size:[16,21,2],center:[-10,10.5,-2/2]}),it({size:[16,21,2],center:[-10,93.5-10.5,-2/2]}),it({size:[14,25+8,2],center:[-57,(25+8)/2,-2/2]}),it({size:[14,25+8,2],center:[-57,93.5-(25+8)/2,-2/2]}),it({size:[12,20,2],center:[-8.5,21,-2/2]}),it({size:[12,20,2],center:[-8.5,93.5-21,-2/2]})),it({size:[134,93.5,10],center:[-134/2,93.5/2,-7]}))),...c.map(([l,u])=>tG(l,u,2)),pr(fr(pr($t.translateZ(2,$c(60,93.5,2)),wt([-2,2,2],$c(60-2,93.5-4,2))),pr(Ma.intersect(wt([-134*1.5-6,10,0],YF({cols:20,rows:40,height:2,size:8.445,wallThickness:1})),fr($t.translateZ(2,$c(60,93.5,2)),$t.translateZ(2/2,rG(134,93.5,2))))),$t.translateZ(2/2,nG(134,93.5,2))),wt([-12,93.5/2,0],Ec(2)),...c.map(([l,u])=>Zt({height:2,radius:5,segments:6,center:[l,u,2/2]}))),pr(WF([1.1,1.1,1],wt([-12,93.5*1/1.1/2,0],Ec(2))),wt([-12,93.5/2,0],Ec(2)),it({size:[10,50,10],center:[5,93.5/2,0]})),wt([-11-44.25,29,2],Qo()),wt([-11-44.25,93.5-29,2],$t.rotateZ(Mt.degToRad(180),Qo())),wt([-6,22,2],Qo()),wt([-6,93.5-22,2],$t.rotateZ(Mt.degToRad(180),Qo())),wt([-134+20,93.5/2,0],KF()),wt([-134+20,93.5/2,0],JF(63.5)))]},$c=(e,t,r)=>it({size:[e,t,r],center:[-e/2,t/2,-r/2]}),tG=(e,t,r)=>pr(Zt({height:r,radius:5,segments:6,center:[e,t,r/2]}),Zt({height:r,radius:1.25,segments:32,center:[e,t,r/2]})),rG=(e,t,r)=>QF(Zt({height:r,radius:5,segments:6,center:[-60,5,0]}),Zt({height:r,radius:5,segments:6,center:[-60,t-5,0]}),Zt({height:r,radius:5,segments:6,center:[-e+5,29,0]}),Zt({height:r,radius:5,segments:6,center:[-e+5,t-29,0]})),nG=(e,t,r)=>fm.hullChain(Zt({height:r,radius:1,segments:32,center:[-62,t-1,0]}),Zt({height:r,radius:1,segments:32,center:[-e+1,t-25,0]}),Zt({height:r,radius:1,segments:32,center:[-e+1,25,0]}),Zt({height:r,radius:1,segments:32,center:[-62,1,0]}));var sG=oG;function oG(){var e=new Float32Array(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}var aG=iG;function iG(e){var t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}var cG=lG;function lG(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}var wm=fG;function fG(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}var uG=dG;function dG(e,t){if(e===t){var r=t[1],n=t[2],s=t[3],o=t[6],a=t[7],i=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=o,e[11]=t[14],e[12]=s,e[13]=a,e[14]=i}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}var hG=mG;function mG(e,t){var r=t[0],n=t[1],s=t[2],o=t[3],a=t[4],i=t[5],c=t[6],l=t[7],u=t[8],d=t[9],h=t[10],p=t[11],E=t[12],g=t[13],b=t[14],P=t[15],F=r*i-n*a,R=r*c-s*a,C=r*l-o*a,G=n*c-s*i,L=n*l-o*i,q=s*l-o*c,ee=u*g-d*E,oe=u*b-h*E,pe=u*P-p*E,Q=d*b-h*g,Te=d*P-p*g,Xe=h*P-p*b,$e=F*Xe-R*Te+C*Q+G*pe-L*oe+q*ee;return $e?($e=1/$e,e[0]=(i*Xe-c*Te+l*Q)*$e,e[1]=(s*Te-n*Xe-o*Q)*$e,e[2]=(g*q-b*L+P*G)*$e,e[3]=(h*L-d*q-p*G)*$e,e[4]=(c*pe-a*Xe-l*oe)*$e,e[5]=(r*Xe-s*pe+o*oe)*$e,e[6]=(b*C-E*q-P*R)*$e,e[7]=(u*q-h*C+p*R)*$e,e[8]=(a*Te-i*pe+l*ee)*$e,e[9]=(n*pe-r*Te-o*ee)*$e,e[10]=(E*L-g*C+P*F)*$e,e[11]=(d*C-u*L-p*F)*$e,e[12]=(i*oe-a*Q-c*ee)*$e,e[13]=(r*Q-n*oe+s*ee)*$e,e[14]=(g*R-E*G-b*F)*$e,e[15]=(u*G-d*R+h*F)*$e,e):null}var pG=vG;function vG(e,t){var r=t[0],n=t[1],s=t[2],o=t[3],a=t[4],i=t[5],c=t[6],l=t[7],u=t[8],d=t[9],h=t[10],p=t[11],E=t[12],g=t[13],b=t[14],P=t[15];return e[0]=i*(h*P-p*b)-d*(c*P-l*b)+g*(c*p-l*h),e[1]=-(n*(h*P-p*b)-d*(s*P-o*b)+g*(s*p-o*h)),e[2]=n*(c*P-l*b)-i*(s*P-o*b)+g*(s*l-o*c),e[3]=-(n*(c*p-l*h)-i*(s*p-o*h)+d*(s*l-o*c)),e[4]=-(a*(h*P-p*b)-u*(c*P-l*b)+E*(c*p-l*h)),e[5]=r*(h*P-p*b)-u*(s*P-o*b)+E*(s*p-o*h),e[6]=-(r*(c*P-l*b)-a*(s*P-o*b)+E*(s*l-o*c)),e[7]=r*(c*p-l*h)-a*(s*p-o*h)+u*(s*l-o*c),e[8]=a*(d*P-p*g)-u*(i*P-l*g)+E*(i*p-l*d),e[9]=-(r*(d*P-p*g)-u*(n*P-o*g)+E*(n*p-o*d)),e[10]=r*(i*P-l*g)-a*(n*P-o*g)+E*(n*l-o*i),e[11]=-(r*(i*p-l*d)-a*(n*p-o*d)+u*(n*l-o*i)),e[12]=-(a*(d*b-h*g)-u*(i*b-c*g)+E*(i*h-c*d)),e[13]=r*(d*b-h*g)-u*(n*b-s*g)+E*(n*h-s*d),e[14]=-(r*(i*b-c*g)-a*(n*b-s*g)+E*(n*c-s*i)),e[15]=r*(i*h-c*d)-a*(n*h-s*d)+u*(n*c-s*i),e}var gG=yG;function yG(e){var t=e[0],r=e[1],n=e[2],s=e[3],o=e[4],a=e[5],i=e[6],c=e[7],l=e[8],u=e[9],d=e[10],h=e[11],p=e[12],E=e[13],g=e[14],b=e[15],P=t*a-r*o,F=t*i-n*o,R=t*c-s*o,C=r*i-n*a,G=r*c-s*a,L=n*c-s*i,q=l*E-u*p,ee=l*g-d*p,oe=l*b-h*p,pe=u*g-d*E,Q=u*b-h*E,Te=d*b-h*g;return P*Te-F*Q+R*pe+C*oe-G*ee+L*q}var bG=wG;function wG(e,t,r){var n=t[0],s=t[1],o=t[2],a=t[3],i=t[4],c=t[5],l=t[6],u=t[7],d=t[8],h=t[9],p=t[10],E=t[11],g=t[12],b=t[13],P=t[14],F=t[15],R=r[0],C=r[1],G=r[2],L=r[3];return e[0]=R*n+C*i+G*d+L*g,e[1]=R*s+C*c+G*h+L*b,e[2]=R*o+C*l+G*p+L*P,e[3]=R*a+C*u+G*E+L*F,R=r[4],C=r[5],G=r[6],L=r[7],e[4]=R*n+C*i+G*d+L*g,e[5]=R*s+C*c+G*h+L*b,e[6]=R*o+C*l+G*p+L*P,e[7]=R*a+C*u+G*E+L*F,R=r[8],C=r[9],G=r[10],L=r[11],e[8]=R*n+C*i+G*d+L*g,e[9]=R*s+C*c+G*h+L*b,e[10]=R*o+C*l+G*p+L*P,e[11]=R*a+C*u+G*E+L*F,R=r[12],C=r[13],G=r[14],L=r[15],e[12]=R*n+C*i+G*d+L*g,e[13]=R*s+C*c+G*h+L*b,e[14]=R*o+C*l+G*p+L*P,e[15]=R*a+C*u+G*E+L*F,e}var _G=xG;function xG(e,t,r){var n=r[0],s=r[1],o=r[2],a,i,c,l,u,d,h,p,E,g,b,P;return t===e?(e[12]=t[0]*n+t[4]*s+t[8]*o+t[12],e[13]=t[1]*n+t[5]*s+t[9]*o+t[13],e[14]=t[2]*n+t[6]*s+t[10]*o+t[14],e[15]=t[3]*n+t[7]*s+t[11]*o+t[15]):(a=t[0],i=t[1],c=t[2],l=t[3],u=t[4],d=t[5],h=t[6],p=t[7],E=t[8],g=t[9],b=t[10],P=t[11],e[0]=a,e[1]=i,e[2]=c,e[3]=l,e[4]=u,e[5]=d,e[6]=h,e[7]=p,e[8]=E,e[9]=g,e[10]=b,e[11]=P,e[12]=a*n+u*s+E*o+t[12],e[13]=i*n+d*s+g*o+t[13],e[14]=c*n+h*s+b*o+t[14],e[15]=l*n+p*s+P*o+t[15]),e}var EG=$G;function $G(e,t,r){var n=r[0],s=r[1],o=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}var AG=SG;function SG(e,t,r,n){var s=n[0],o=n[1],a=n[2],i=Math.sqrt(s*s+o*o+a*a),c,l,u,d,h,p,E,g,b,P,F,R,C,G,L,q,ee,oe,pe,Q,Te,Xe,$e,Ue;return Math.abs(i)<1e-6?null:(i=1/i,s*=i,o*=i,a*=i,c=Math.sin(r),l=Math.cos(r),u=1-l,d=t[0],h=t[1],p=t[2],E=t[3],g=t[4],b=t[5],P=t[6],F=t[7],R=t[8],C=t[9],G=t[10],L=t[11],q=s*s*u+l,ee=o*s*u+a*c,oe=a*s*u-o*c,pe=s*o*u-a*c,Q=o*o*u+l,Te=a*o*u+s*c,Xe=s*a*u+o*c,$e=o*a*u-s*c,Ue=a*a*u+l,e[0]=d*q+g*ee+R*oe,e[1]=h*q+b*ee+C*oe,e[2]=p*q+P*ee+G*oe,e[3]=E*q+F*ee+L*oe,e[4]=d*pe+g*Q+R*Te,e[5]=h*pe+b*Q+C*Te,e[6]=p*pe+P*Q+G*Te,e[7]=E*pe+F*Q+L*Te,e[8]=d*Xe+g*$e+R*Ue,e[9]=h*Xe+b*$e+C*Ue,e[10]=p*Xe+P*$e+G*Ue,e[11]=E*Xe+F*$e+L*Ue,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}var TG=PG;function PG(e,t,r){var n=Math.sin(r),s=Math.cos(r),o=t[4],a=t[5],i=t[6],c=t[7],l=t[8],u=t[9],d=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*s+l*n,e[5]=a*s+u*n,e[6]=i*s+d*n,e[7]=c*s+h*n,e[8]=l*s-o*n,e[9]=u*s-a*n,e[10]=d*s-i*n,e[11]=h*s-c*n,e}var MG=CG;function CG(e,t,r){var n=Math.sin(r),s=Math.cos(r),o=t[0],a=t[1],i=t[2],c=t[3],l=t[8],u=t[9],d=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*s-l*n,e[1]=a*s-u*n,e[2]=i*s-d*n,e[3]=c*s-h*n,e[8]=o*n+l*s,e[9]=a*n+u*s,e[10]=i*n+d*s,e[11]=c*n+h*s,e}var OG=RG;function RG(e,t,r){var n=Math.sin(r),s=Math.cos(r),o=t[0],a=t[1],i=t[2],c=t[3],l=t[4],u=t[5],d=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*s+l*n,e[1]=a*s+u*n,e[2]=i*s+d*n,e[3]=c*s+h*n,e[4]=l*s-o*n,e[5]=u*s-a*n,e[6]=d*s-i*n,e[7]=h*s-c*n,e}var LG=FG;function FG(e,t,r){var n,s,o,a=r[0],i=r[1],c=r[2],l=Math.sqrt(a*a+i*i+c*c);return Math.abs(l)<1e-6?null:(l=1/l,a*=l,i*=l,c*=l,n=Math.sin(t),s=Math.cos(t),o=1-s,e[0]=a*a*o+s,e[1]=i*a*o+c*n,e[2]=c*a*o-i*n,e[3]=0,e[4]=a*i*o-c*n,e[5]=i*i*o+s,e[6]=c*i*o+a*n,e[7]=0,e[8]=a*c*o+i*n,e[9]=i*c*o-a*n,e[10]=c*c*o+s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}var GG=NG;function NG(e,t,r){var n=t[0],s=t[1],o=t[2],a=t[3],i=n+n,c=s+s,l=o+o,u=n*i,d=n*c,h=n*l,p=s*c,E=s*l,g=o*l,b=a*i,P=a*c,F=a*l;return e[0]=1-(p+g),e[1]=d+F,e[2]=h-P,e[3]=0,e[4]=d-F,e[5]=1-(u+g),e[6]=E+b,e[7]=0,e[8]=h+P,e[9]=E-b,e[10]=1-(u+p),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}var DG=kG;function kG(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}var IG=BG;function BG(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}var zG=VG;function VG(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}var qG=XG;function XG(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}var UG=jG;function jG(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}var HG=YG;function YG(e,t){var r=t[0],n=t[1],s=t[2],o=t[3],a=r+r,i=n+n,c=s+s,l=r*a,u=n*a,d=n*i,h=s*a,p=s*i,E=s*c,g=o*a,b=o*i,P=o*c;return e[0]=1-d-E,e[1]=u+P,e[2]=h-b,e[3]=0,e[4]=u-P,e[5]=1-l-E,e[6]=p+g,e[7]=0,e[8]=h+b,e[9]=p-g,e[10]=1-l-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}var ZG=WG;function WG(e,t,r,n,s,o,a){var i=1/(r-t),c=1/(s-n),l=1/(o-a);return e[0]=o*2*i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o*2*c,e[6]=0,e[7]=0,e[8]=(r+t)*i,e[9]=(s+n)*c,e[10]=(a+o)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*o*2*l,e[15]=0,e}var QG=KG;function KG(e,t,r,n,s){var o=1/Math.tan(t/2),a=1/(n-s);return e[0]=o/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(s+n)*a,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*s*n*a,e[15]=0,e}var JG=eN;function eN(e,t,r,n){var s=Math.tan(t.upDegrees*Math.PI/180),o=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),i=Math.tan(t.rightDegrees*Math.PI/180),c=2/(a+i),l=2/(s+o);return e[0]=c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l,e[6]=0,e[7]=0,e[8]=-((a-i)*c*.5),e[9]=(s-o)*l*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}var tN=rN;function rN(e,t,r,n,s,o,a){var i=1/(t-r),c=1/(n-s),l=1/(o-a);return e[0]=-2*i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+r)*i,e[13]=(s+n)*c,e[14]=(a+o)*l,e[15]=1,e}var nN=wm,sN=oN;function oN(e,t,r,n){var s,o,a,i,c,l,u,d,h,p,E=t[0],g=t[1],b=t[2],P=n[0],F=n[1],R=n[2],C=r[0],G=r[1],L=r[2];return Math.abs(E-C)<1e-6&&Math.abs(g-G)<1e-6&&Math.abs(b-L)<1e-6?nN(e):(u=E-C,d=g-G,h=b-L,p=1/Math.sqrt(u*u+d*d+h*h),u*=p,d*=p,h*=p,s=F*h-R*d,o=R*u-P*h,a=P*d-F*u,p=Math.sqrt(s*s+o*o+a*a),p?(p=1/p,s*=p,o*=p,a*=p):(s=0,o=0,a=0),i=d*a-h*o,c=h*s-u*a,l=u*o-d*s,p=Math.sqrt(i*i+c*c+l*l),p?(p=1/p,i*=p,c*=p,l*=p):(i=0,c=0,l=0),e[0]=s,e[1]=i,e[2]=u,e[3]=0,e[4]=o,e[5]=c,e[6]=d,e[7]=0,e[8]=a,e[9]=l,e[10]=h,e[11]=0,e[12]=-(s*E+o*g+a*b),e[13]=-(i*E+c*g+l*b),e[14]=-(u*E+d*g+h*b),e[15]=1,e)}var aN=iN;function iN(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}var ur={create:sG,clone:aG,copy:cG,identity:wm,transpose:uG,invert:hG,adjoint:pG,determinant:gG,multiply:bG,translate:_G,scale:EG,rotate:AG,rotateX:TG,rotateY:MG,rotateZ:OG,fromRotation:LG,fromRotationTranslation:GG,fromScaling:DG,fromTranslation:IG,fromXRotation:zG,fromYRotation:qG,fromZRotation:UG,fromQuat:HG,frustum:ZG,perspective:QG,perspectiveFromFieldOfView:JG,ortho:tN,lookAt:sN,str:aN};const Ac=ur,cN=(e,t={})=>{const{fbo:r}=t,n={cull:{enable:!0},context:{lightDirection:[.2,.2,1]},uniforms:{view:(s,o)=>o.camera.view,eye:(s,o)=>o.camera.position,projection:(s,o)=>o.camera.projection,camNear:(s,o)=>o.camera.near,camFar:(s,o)=>o.camera.far,invertedView:(s,o)=>Ac.invert([],o.camera.view),lightPosition:(s,o)=>o&&o.rendering&&o.rendering.lightPosition?o.rendering.lightPosition:[100,200,100],lightDirection:(s,o)=>o&&o.rendering&&o.rendering.lightDirection?o.rendering.lightDirection:s.lightDirection||[0,0,0],lightView:s=>Ac.lookAt([],s.lightDirection,[0,0,0],[0,0,1]),lightProjection:Ac.ortho([],-25,-25,-20,20,-25,25),lightColor:(s,o)=>o&&o.rendering&&o.rendering.lightColor?o.rendering.lightColor:[1,.8,0],ambientLightAmount:(s,o)=>o&&o.rendering&&o.rendering.ambientLightAmount?o.rendering.ambientLightAmount:.3,diffuseLightAmount:(s,o)=>o&&o.rendering&&o.rendering.diffuseLightAmount?o&&o.rendering&&o.rendering.diffuseLightAmount:.89,specularLightAmount:(s,o)=>o&&o.rendering&&o.rendering.specularLightAmount?o.rendering.specularLightAmount:.16,uMaterialShininess:(s,o)=>o&&o.rendering&&o.rendering.materialShininess?o.rendering.materialShininess:8,materialAmbient:[.5,.8,.3],materialDiffuse:[.5,.8,.3],materialSpecular:[.5,.8,.3]},framebuffer:r};return e(Object.assign({},n,t.extras))};var lN=cN,Fa={background:[1,1,1,1],meshColor:[0,.6,1,1],lightColor:[1,1,1,1],lightDirection:[.2,.2,1],lightPosition:[100,200,100],ambientLightAmount:.3,diffuseLightAmount:.89,specularLightAmount:.16,materialShininess:8},Sc={exports:{}},rd;function fN(){return rd||(rd=1,function(e,t){(function(r,n){e.exports=n()})(vg,function(){var r=function(f){return f instanceof Uint8Array||f instanceof Uint16Array||f instanceof Uint32Array||f instanceof Int8Array||f instanceof Int16Array||f instanceof Int32Array||f instanceof Float32Array||f instanceof Float64Array||f instanceof Uint8ClampedArray},n=function(f,v){for(var S=Object.keys(v),U=0;U<S.length;++U)f[S[U]]=v[S[U]];return f},s=`
`;function o(f){return typeof atob<"u"?atob(f):"base64:"+f}function a(f){var v=new Error("(regl) "+f);throw console.error(v),v}function i(f,v){f||a(v)}function c(f){return f?": "+f:""}function l(f,v,S){f in v||a("unknown parameter ("+f+")"+c(S)+". possible values: "+Object.keys(v).join())}function u(f,v){r(f)||a("invalid parameter type"+c(v)+". must be a typed array")}function d(f,v){switch(v){case"number":return typeof f=="number";case"object":return typeof f=="object";case"string":return typeof f=="string";case"boolean":return typeof f=="boolean";case"function":return typeof f=="function";case"undefined":return typeof f>"u";case"symbol":return typeof f=="symbol"}}function h(f,v,S){d(f,v)||a("invalid parameter type"+c(S)+". expected "+v+", got "+typeof f)}function p(f,v){f>=0&&(f|0)===f||a("invalid parameter type, ("+f+")"+c(v)+". must be a nonnegative integer")}function E(f,v,S){v.indexOf(f)<0&&a("invalid value"+c(S)+". must be one of: "+v)}var g=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function b(f){Object.keys(f).forEach(function(v){g.indexOf(v)<0&&a('invalid regl constructor argument "'+v+'". must be one of '+g)})}function P(f,v){for(f=f+"";f.length<v;)f=" "+f;return f}function F(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function R(f,v){this.number=f,this.line=v,this.errors=[]}function C(f,v,S){this.file=f,this.line=v,this.message=S}function G(){var f=new Error,v=(f.stack||f).toString(),S=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(v);if(S)return S[1];var U=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(v);return U?U[1]:"unknown"}function L(){var f=new Error,v=(f.stack||f).toString(),S=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(v);if(S)return S[1];var U=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(v);return U?U[1]:"unknown"}function q(f,v){var S=f.split(`
`),U=1,J=0,X={unknown:new F,0:new F};X.unknown.name=X[0].name=v||G(),X.unknown.lines.push(new R(0,""));for(var Y=0;Y<S.length;++Y){var ie=S[Y],ae=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(ie);if(ae)switch(ae[1]){case"line":var de=/(\d+)(\s+\d+)?/.exec(ae[2]);de&&(U=de[1]|0,de[2]&&(J=de[2]|0,J in X||(X[J]=new F)));break;case"define":var me=/SHADER_NAME(_B64)?\s+(.*)$/.exec(ae[2]);me&&(X[J].name=me[1]?o(me[2]):me[2]);break}X[J].lines.push(new R(U++,ie))}return Object.keys(X).forEach(function(he){var ge=X[he];ge.lines.forEach(function(ce){ge.index[ce.number]=ce})}),X}function ee(f){var v=[];return f.split(`
`).forEach(function(S){if(!(S.length<5)){var U=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(S);U?v.push(new C(U[1]|0,U[2]|0,U[3].trim())):S.length>0&&v.push(new C("unknown",0,S))}}),v}function oe(f,v){v.forEach(function(S){var U=f[S.file];if(U){var J=U.index[S.line];if(J){J.errors.push(S),U.hasErrors=!0;return}}f.unknown.hasErrors=!0,f.unknown.lines[0].errors.push(S)})}function pe(f,v,S,U,J){if(!f.getShaderParameter(v,f.COMPILE_STATUS)){var X=f.getShaderInfoLog(v),Y=U===f.FRAGMENT_SHADER?"fragment":"vertex";Lt(S,"string",Y+" shader source must be a string",J);var ie=q(S,J),ae=ee(X);oe(ie,ae),Object.keys(ie).forEach(function(de){var me=ie[de];if(!me.hasErrors)return;var he=[""],ge=[""];function ce(ue,k){he.push(ue),ge.push(k||"")}ce("file number "+de+": "+me.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),me.lines.forEach(function(ue){if(ue.errors.length>0){ce(P(ue.number,4)+"|  ","background-color:yellow; font-weight:bold"),ce(ue.line+s,"color:red; background-color:yellow; font-weight:bold");var k=0;ue.errors.forEach(function(H){var fe=H.message,Se=/^\s*'(.*)'\s*:\s*(.*)$/.exec(fe);if(Se){var se=Se[1];switch(fe=Se[2],se){case"assign":se="=";break}k=Math.max(ue.line.indexOf(se,k),0)}else k=0;ce(P("| ",6)),ce(P("^^^",k+3)+s,"font-weight:bold"),ce(P("| ",6)),ce(fe+s,"font-weight:bold")}),ce(P("| ",6)+s)}else ce(P(ue.number,4)+"|  "),ce(ue.line+s,"color:red")}),typeof document<"u"&&!window.chrome?(ge[0]=he.join("%c"),console.log.apply(console,ge)):console.log(he.join(""))}),i.raise("Error compiling "+Y+" shader, "+ie[0].name)}}function Q(f,v,S,U,J){if(!f.getProgramParameter(v,f.LINK_STATUS)){var X=f.getProgramInfoLog(v),Y=q(S,J),ie=q(U,J),ae='Error linking program with vertex shader, "'+ie[0].name+'", and fragment shader "'+Y[0].name+'"';typeof document<"u"?console.log("%c"+ae+s+"%c"+X,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(ae+s+X),i.raise(ae)}}function Te(f){f._commandRef=G()}function Xe(f,v,S,U){Te(f);function J(ae){return ae?U.id(ae):0}f._fragId=J(f.static.frag),f._vertId=J(f.static.vert);function X(ae,de){Object.keys(de).forEach(function(me){ae[U.id(me)]=!0})}var Y=f._uniformSet={};X(Y,v.static),X(Y,v.dynamic);var ie=f._attributeSet={};X(ie,S.static),X(ie,S.dynamic),f._hasCount="count"in f.static||"count"in f.dynamic||"elements"in f.static||"elements"in f.dynamic}function $e(f,v){var S=L();a(f+" in command "+(v||G())+(S==="unknown"?"":" called from "+S))}function Ue(f,v,S){f||$e(v,S||G())}function Ne(f,v,S,U){f in v||$e("unknown parameter ("+f+")"+c(S)+". possible values: "+Object.keys(v).join(),U||G())}function Lt(f,v,S,U){d(f,v)||$e("invalid parameter type"+c(S)+". expected "+v+", got "+typeof f,U||G())}function Nt(f){f()}function Gr(f,v,S){f.texture?E(f.texture._texture.internalformat,v,"unsupported texture format for attachment"):E(f.renderbuffer._renderbuffer.format,S,"unsupported renderbuffer format for attachment")}var gr=33071,Nr=9728,yr=9984,Xm=9985,Um=9986,jm=9987,Hm=5120,Ym=5121,Zm=5122,Wm=5123,Qm=5124,Km=5125,Al=5126,Sl=32819,Tl=32820,Pl=33635,Ml=34042,Jm=36193,tr={};tr[Hm]=tr[Ym]=1,tr[Zm]=tr[Wm]=tr[Jm]=tr[Pl]=tr[Sl]=tr[Tl]=2,tr[Qm]=tr[Km]=tr[Al]=tr[Ml]=4;function Cl(f,v){return f===Tl||f===Sl||f===Pl?2:f===Ml?4:tr[f]*v}function eo(f){return!(f&f-1)&&!!f}function ep(f,v,S){var U,J=v.width,X=v.height,Y=v.channels;i(J>0&&J<=S.maxTextureSize&&X>0&&X<=S.maxTextureSize,"invalid texture shape"),(f.wrapS!==gr||f.wrapT!==gr)&&i(eo(J)&&eo(X),"incompatible wrap mode for texture, both width and height must be power of 2"),v.mipmask===1?J!==1&&X!==1&&i(f.minFilter!==yr&&f.minFilter!==Um&&f.minFilter!==Xm&&f.minFilter!==jm,"min filter requires mipmap"):(i(eo(J)&&eo(X),"texture must be a square power of 2 to support mipmapping"),i(v.mipmask===(J<<1)-1,"missing or incomplete mipmap data")),v.type===Al&&(S.extensions.indexOf("oes_texture_float_linear")<0&&i(f.minFilter===Nr&&f.magFilter===Nr,"filter not supported, must enable oes_texture_float_linear"),i(!f.genMipmaps,"mipmap generation not supported with float textures"));var ie=v.images;for(U=0;U<16;++U)if(ie[U]){var ae=J>>U,de=X>>U;i(v.mipmask&1<<U,"missing mipmap data");var me=ie[U];if(i(me.width===ae&&me.height===de,"invalid shape for mip images"),i(me.format===v.format&&me.internalformat===v.internalformat&&me.type===v.type,"incompatible type for mip image"),!me.compressed)if(me.data){var he=Math.ceil(Cl(me.type,Y)*ae/me.unpackAlignment)*me.unpackAlignment;i(me.data.byteLength===he*de,"invalid data for image, buffer size is inconsistent with image format")}else me.element||me.copy}else f.genMipmaps||i((v.mipmask&1<<U)===0,"extra mipmap data");v.compressed&&i(!f.genMipmaps,"mipmap generation for compressed images not supported")}function tp(f,v,S,U){var J=f.width,X=f.height,Y=f.channels;i(J>0&&J<=U.maxTextureSize&&X>0&&X<=U.maxTextureSize,"invalid texture shape"),i(J===X,"cube map must be square"),i(v.wrapS===gr&&v.wrapT===gr,"wrap mode not supported by cube map");for(var ie=0;ie<S.length;++ie){var ae=S[ie];i(ae.width===J&&ae.height===X,"inconsistent cube map face shape"),v.genMipmaps&&(i(!ae.compressed,"can not generate mipmap for compressed textures"),i(ae.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var de=ae.images,me=0;me<16;++me){var he=de[me];if(he){var ge=J>>me,ce=X>>me;i(ae.mipmask&1<<me,"missing mipmap data"),i(he.width===ge&&he.height===ce,"invalid shape for mip images"),i(he.format===f.format&&he.internalformat===f.internalformat&&he.type===f.type,"incompatible type for mip image"),he.compressed||(he.data?i(he.data.byteLength===ge*ce*Math.max(Cl(he.type,Y),he.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):he.element||he.copy)}}}}var y=n(i,{optional:Nt,raise:a,commandRaise:$e,command:Ue,parameter:l,commandParameter:Ne,constructor:b,type:h,commandType:Lt,isTypedArray:u,nni:p,oneOf:E,shaderError:pe,linkError:Q,callSite:L,saveCommandRef:Te,saveDrawInfo:Xe,framebufferFormat:Gr,guessCommand:G,texture2D:ep,textureCube:tp}),rp=0,np=0,sp=5,op=6;function en(f,v){this.id=rp++,this.type=f,this.data=v}function Ol(f){return f.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function fs(f){if(f.length===0)return[];var v=f.charAt(0),S=f.charAt(f.length-1);if(f.length>1&&v===S&&(v==='"'||v==="'"))return['"'+Ol(f.substr(1,f.length-2))+'"'];var U=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(f);if(U)return fs(f.substr(0,U.index)).concat(fs(U[1])).concat(fs(f.substr(U.index+U[0].length)));var J=f.split(".");if(J.length===1)return['"'+Ol(f)+'"'];for(var X=[],Y=0;Y<J.length;++Y)X=X.concat(fs(J[Y]));return X}function Rl(f){return"["+fs(f).join("][")+"]"}function ap(f,v){return new en(f,Rl(v+""))}function ip(f){return typeof f=="function"&&!f._reglType||f instanceof en}function Ll(f,v){if(typeof f=="function")return new en(np,f);if(typeof f=="number"||typeof f=="boolean")return new en(sp,f);if(Array.isArray(f))return new en(op,f.map(function(S,U){return Ll(S,v+"["+U+"]")}));if(f instanceof en)return f;y(!1,"invalid option type in uniform "+v)}var rr={DynamicVariable:en,define:ap,isDynamic:ip,unbox:Ll,accessor:Rl},Ga={next:typeof requestAnimationFrame=="function"?function(f){return requestAnimationFrame(f)}:function(f){return setTimeout(f,16)},cancel:typeof cancelAnimationFrame=="function"?function(f){return cancelAnimationFrame(f)}:clearTimeout},Fl=typeof performance<"u"&&performance.now?function(){return performance.now()}:function(){return+new Date};function cp(){var f={"":0},v=[""];return{id:function(S){var U=f[S];return U||(U=f[S]=v.length,v.push(S),U)},str:function(S){return v[S]}}}function lp(f,v,S){var U=document.createElement("canvas");n(U.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),f.appendChild(U),f===document.body&&(U.style.position="absolute",n(f.style,{margin:0,padding:0}));function J(){var ie=window.innerWidth,ae=window.innerHeight;if(f!==document.body){var de=U.getBoundingClientRect();ie=de.right-de.left,ae=de.bottom-de.top}U.width=S*ie,U.height=S*ae}var X;f!==document.body&&typeof ResizeObserver=="function"?(X=new ResizeObserver(function(){setTimeout(J)}),X.observe(f)):window.addEventListener("resize",J,!1);function Y(){X?X.disconnect():window.removeEventListener("resize",J),f.removeChild(U)}return J(),{canvas:U,onDestroy:Y}}function fp(f,v){function S(U){try{return f.getContext(U,v)}catch{return null}}return S("webgl")||S("experimental-webgl")||S("webgl-experimental")}function up(f){return typeof f.nodeName=="string"&&typeof f.appendChild=="function"&&typeof f.getBoundingClientRect=="function"}function dp(f){return typeof f.drawArrays=="function"||typeof f.drawElements=="function"}function Gl(f){return typeof f=="string"?f.split():(y(Array.isArray(f),"invalid extension array"),f)}function Nl(f){return typeof f=="string"?(y(typeof document<"u","not supported outside of DOM"),document.querySelector(f)):f}function hp(f){var v=f||{},S,U,J,X,Y={},ie=[],ae=[],de=typeof window>"u"?1:window.devicePixelRatio,me=!1,he=function(ue){ue&&y.raise(ue)},ge=function(){};if(typeof v=="string"?(y(typeof document<"u","selector queries only supported in DOM enviroments"),S=document.querySelector(v),y(S,"invalid query string for element")):typeof v=="object"?up(v)?S=v:dp(v)?(X=v,J=X.canvas):(y.constructor(v),"gl"in v?X=v.gl:"canvas"in v?J=Nl(v.canvas):"container"in v&&(U=Nl(v.container)),"attributes"in v&&(Y=v.attributes,y.type(Y,"object","invalid context attributes")),"extensions"in v&&(ie=Gl(v.extensions)),"optionalExtensions"in v&&(ae=Gl(v.optionalExtensions)),"onDone"in v&&(y.type(v.onDone,"function","invalid or missing onDone callback"),he=v.onDone),"profile"in v&&(me=!!v.profile),"pixelRatio"in v&&(de=+v.pixelRatio,y(de>0,"invalid pixel ratio"))):y.raise("invalid arguments to regl"),S&&(S.nodeName.toLowerCase()==="canvas"?J=S:U=S),!X){if(!J){y(typeof document<"u","must manually specify webgl context outside of DOM environments");var ce=lp(U||document.body,he,de);if(!ce)return null;J=ce.canvas,ge=ce.onDestroy}Y.premultipliedAlpha===void 0&&(Y.premultipliedAlpha=!0),X=fp(J,Y)}return X?{gl:X,canvas:J,container:U,extensions:ie,optionalExtensions:ae,pixelRatio:de,profile:me,onDone:he,onDestroy:ge}:(ge(),he("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function mp(f,v){var S={};function U(Y){y.type(Y,"string","extension name must be string");var ie=Y.toLowerCase(),ae;try{ae=S[ie]=f.getExtension(ie)}catch{}return!!ae}for(var J=0;J<v.extensions.length;++J){var X=v.extensions[J];if(!U(X))return v.onDestroy(),v.onDone('"'+X+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return v.optionalExtensions.forEach(U),{extensions:S,restore:function(){Object.keys(S).forEach(function(Y){if(S[Y]&&!U(Y))throw new Error("(regl): error restoring extension "+Y)})}}}function nr(f,v){for(var S=Array(f),U=0;U<f;++U)S[U]=v(U);return S}var pp=5120,vp=5121,gp=5122,yp=5123,bp=5124,wp=5125,_p=5126;function xp(f){for(var v=16;v<=1<<28;v*=16)if(f<=v)return v;return 0}function Dl(f){var v,S;return v=(f>65535)<<4,f>>>=v,S=(f>255)<<3,f>>>=S,v|=S,S=(f>15)<<2,f>>>=S,v|=S,S=(f>3)<<1,f>>>=S,v|=S,v|f>>1}function kl(){var f=nr(8,function(){return[]});function v(X){var Y=xp(X),ie=f[Dl(Y)>>2];return ie.length>0?ie.pop():new ArrayBuffer(Y)}function S(X){f[Dl(X.byteLength)>>2].push(X)}function U(X,Y){var ie=null;switch(X){case pp:ie=new Int8Array(v(Y),0,Y);break;case vp:ie=new Uint8Array(v(Y),0,Y);break;case gp:ie=new Int16Array(v(2*Y),0,Y);break;case yp:ie=new Uint16Array(v(2*Y),0,Y);break;case bp:ie=new Int32Array(v(4*Y),0,Y);break;case wp:ie=new Uint32Array(v(4*Y),0,Y);break;case _p:ie=new Float32Array(v(4*Y),0,Y);break;default:return null}return ie.length!==Y?ie.subarray(0,Y):ie}function J(X){S(X.buffer)}return{alloc:v,free:S,allocType:U,freeType:J}}var _t=kl();_t.zero=kl();var Ep=3408,$p=3410,Ap=3411,Sp=3412,Tp=3413,Pp=3414,Mp=3415,Cp=33901,Op=33902,Rp=3379,Lp=3386,Fp=34921,Gp=36347,Np=36348,Dp=35661,kp=35660,Ip=34930,Bp=36349,zp=34076,Vp=34024,qp=7936,Xp=7937,Up=7938,jp=35724,Hp=34047,Yp=36063,Zp=34852,to=3553,Il=34067,Wp=34069,Qp=33984,us=6408,Na=5126,Bl=5121,Da=36160,Kp=36053,Jp=36064,e2=16384,t2=function(f,v){var S=1;v.ext_texture_filter_anisotropic&&(S=f.getParameter(Hp));var U=1,J=1;v.webgl_draw_buffers&&(U=f.getParameter(Zp),J=f.getParameter(Yp));var X=!!v.oes_texture_float;if(X){var Y=f.createTexture();f.bindTexture(to,Y),f.texImage2D(to,0,us,1,1,0,us,Na,null);var ie=f.createFramebuffer();if(f.bindFramebuffer(Da,ie),f.framebufferTexture2D(Da,Jp,to,Y,0),f.bindTexture(to,null),f.checkFramebufferStatus(Da)!==Kp)X=!1;else{f.viewport(0,0,1,1),f.clearColor(1,0,0,1),f.clear(e2);var ae=_t.allocType(Na,4);f.readPixels(0,0,1,1,us,Na,ae),f.getError()?X=!1:(f.deleteFramebuffer(ie),f.deleteTexture(Y),X=ae[0]===1),_t.freeType(ae)}}var de=typeof navigator<"u"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),me=!0;if(!de){var he=f.createTexture(),ge=_t.allocType(Bl,36);f.activeTexture(Qp),f.bindTexture(Il,he),f.texImage2D(Wp,0,us,3,3,0,us,Bl,ge),_t.freeType(ge),f.bindTexture(Il,null),f.deleteTexture(he),me=!f.getError()}return{colorBits:[f.getParameter($p),f.getParameter(Ap),f.getParameter(Sp),f.getParameter(Tp)],depthBits:f.getParameter(Pp),stencilBits:f.getParameter(Mp),subpixelBits:f.getParameter(Ep),extensions:Object.keys(v).filter(function(ce){return!!v[ce]}),maxAnisotropic:S,maxDrawbuffers:U,maxColorAttachments:J,pointSizeDims:f.getParameter(Cp),lineWidthDims:f.getParameter(Op),maxViewportDims:f.getParameter(Lp),maxCombinedTextureUnits:f.getParameter(Dp),maxCubeMapSize:f.getParameter(zp),maxRenderbufferSize:f.getParameter(Vp),maxTextureUnits:f.getParameter(Ip),maxTextureSize:f.getParameter(Rp),maxAttributes:f.getParameter(Fp),maxVertexUniforms:f.getParameter(Gp),maxVertexTextureUnits:f.getParameter(kp),maxVaryingVectors:f.getParameter(Np),maxFragmentUniforms:f.getParameter(Bp),glsl:f.getParameter(jp),renderer:f.getParameter(Xp),vendor:f.getParameter(qp),version:f.getParameter(Up),readFloat:X,npotTextureCube:me}};function dr(f){return!!f&&typeof f=="object"&&Array.isArray(f.shape)&&Array.isArray(f.stride)&&typeof f.offset=="number"&&f.shape.length===f.stride.length&&(Array.isArray(f.data)||r(f.data))}var sr=function(f){return Object.keys(f).map(function(v){return f[v]})},ro={shape:o2,flatten:s2};function r2(f,v,S){for(var U=0;U<v;++U)S[U]=f[U]}function n2(f,v,S,U){for(var J=0,X=0;X<v;++X)for(var Y=f[X],ie=0;ie<S;++ie)U[J++]=Y[ie]}function zl(f,v,S,U,J,X){for(var Y=X,ie=0;ie<v;++ie)for(var ae=f[ie],de=0;de<S;++de)for(var me=ae[de],he=0;he<U;++he)J[Y++]=me[he]}function Vl(f,v,S,U,J){for(var X=1,Y=S+1;Y<v.length;++Y)X*=v[Y];var ie=v[S];if(v.length-S===4){var ae=v[S+1],de=v[S+2],me=v[S+3];for(Y=0;Y<ie;++Y)zl(f[Y],ae,de,me,U,J),J+=X}else for(Y=0;Y<ie;++Y)Vl(f[Y],v,S+1,U,J),J+=X}function s2(f,v,S,U){var J=1;if(v.length)for(var X=0;X<v.length;++X)J*=v[X];else J=0;var Y=U||_t.allocType(S,J);switch(v.length){case 0:break;case 1:r2(f,v[0],Y);break;case 2:n2(f,v[0],v[1],Y);break;case 3:zl(f,v[0],v[1],v[2],Y,0);break;default:Vl(f,v,0,Y,0)}return Y}function o2(f){for(var v=[],S=f;S.length;S=S[0])v.push(S.length);return v}var ka={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},a2=5120,i2=5122,c2=5124,l2=5121,f2=5123,u2=5125,d2=5126,h2=5126,tn={int8:a2,int16:i2,int32:c2,uint8:l2,uint16:f2,uint32:u2,float:d2,float32:h2},m2=35048,p2=35040,no={dynamic:m2,stream:p2,static:35044},Ia=ro.flatten,ql=ro.shape,Xl=35044,v2=35040,Ba=5121,za=5126,Dr=[];Dr[5120]=1,Dr[5122]=2,Dr[5124]=4,Dr[5121]=1,Dr[5123]=2,Dr[5125]=4,Dr[5126]=4;function so(f){return ka[Object.prototype.toString.call(f)]|0}function Ul(f,v){for(var S=0;S<v.length;++S)f[S]=v[S]}function jl(f,v,S,U,J,X,Y){for(var ie=0,ae=0;ae<S;++ae)for(var de=0;de<U;++de)f[ie++]=v[J*ae+X*de+Y]}function g2(f,v,S,U){var J=0,X={};function Y(k){this.id=J++,this.buffer=f.createBuffer(),this.type=k,this.usage=Xl,this.byteLength=0,this.dimension=1,this.dtype=Ba,this.persistentData=null,S.profile&&(this.stats={size:0})}Y.prototype.bind=function(){f.bindBuffer(this.type,this.buffer)},Y.prototype.destroy=function(){ge(this)};var ie=[];function ae(k,H){var fe=ie.pop();return fe||(fe=new Y(k)),fe.bind(),he(fe,H,v2,0,1,!1),fe}function de(k){ie.push(k)}function me(k,H,fe){k.byteLength=H.byteLength,f.bufferData(k.type,H,fe)}function he(k,H,fe,Se,se,Ee){var _e;if(k.usage=fe,Array.isArray(H)){if(k.dtype=Se||za,H.length>0){var Ge;if(Array.isArray(H[0])){_e=ql(H);for(var te=1,K=1;K<_e.length;++K)te*=_e[K];k.dimension=te,Ge=Ia(H,_e,k.dtype),me(k,Ge,fe),Ee?k.persistentData=Ge:_t.freeType(Ge)}else if(typeof H[0]=="number"){k.dimension=se;var Ce=_t.allocType(k.dtype,H.length);Ul(Ce,H),me(k,Ce,fe),Ee?k.persistentData=Ce:_t.freeType(Ce)}else r(H[0])?(k.dimension=H[0].length,k.dtype=Se||so(H[0])||za,Ge=Ia(H,[H.length,H[0].length],k.dtype),me(k,Ge,fe),Ee?k.persistentData=Ge:_t.freeType(Ge)):y.raise("invalid buffer data")}}else if(r(H))k.dtype=Se||so(H),k.dimension=se,me(k,H,fe),Ee&&(k.persistentData=new Uint8Array(new Uint8Array(H.buffer)));else if(dr(H)){_e=H.shape;var ye=H.stride,le=H.offset,be=0,we=0,je=0,qe=0;_e.length===1?(be=_e[0],we=1,je=ye[0],qe=0):_e.length===2?(be=_e[0],we=_e[1],je=ye[0],qe=ye[1]):y.raise("invalid shape"),k.dtype=Se||so(H.data)||za,k.dimension=we;var xe=_t.allocType(k.dtype,be*we);jl(xe,H.data,be,we,je,qe,le),me(k,xe,fe),Ee?k.persistentData=xe:_t.freeType(xe)}else H instanceof ArrayBuffer?(k.dtype=Ba,k.dimension=se,me(k,H,fe),Ee&&(k.persistentData=new Uint8Array(new Uint8Array(H)))):y.raise("invalid buffer data")}function ge(k){v.bufferCount--,U(k);var H=k.buffer;y(H,"buffer must not be deleted already"),f.deleteBuffer(H),k.buffer=null,delete X[k.id]}function ce(k,H,fe,Se){v.bufferCount++;var se=new Y(H);X[se.id]=se;function Ee(te){var K=Xl,Ce=null,ye=0,le=0,be=1;return Array.isArray(te)||r(te)||dr(te)||te instanceof ArrayBuffer?Ce=te:typeof te=="number"?ye=te|0:te&&(y.type(te,"object","buffer arguments must be an object, a number or an array"),"data"in te&&(y(Ce===null||Array.isArray(Ce)||r(Ce)||dr(Ce),"invalid data for buffer"),Ce=te.data),"usage"in te&&(y.parameter(te.usage,no,"invalid buffer usage"),K=no[te.usage]),"type"in te&&(y.parameter(te.type,tn,"invalid buffer type"),le=tn[te.type]),"dimension"in te&&(y.type(te.dimension,"number","invalid dimension"),be=te.dimension|0),"length"in te&&(y.nni(ye,"buffer length must be a nonnegative integer"),ye=te.length|0)),se.bind(),Ce?he(se,Ce,K,le,be,Se):(ye&&f.bufferData(se.type,ye,K),se.dtype=le||Ba,se.usage=K,se.dimension=be,se.byteLength=ye),S.profile&&(se.stats.size=se.byteLength*Dr[se.dtype]),Ee}function _e(te,K){y(K+te.byteLength<=se.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+te.byteLength+" starting from offset "+K+" to a buffer of size "+se.byteLength),f.bufferSubData(se.type,K,te)}function Ge(te,K){var Ce=(K||0)|0,ye;if(se.bind(),r(te)||te instanceof ArrayBuffer)_e(te,Ce);else if(Array.isArray(te)){if(te.length>0)if(typeof te[0]=="number"){var le=_t.allocType(se.dtype,te.length);Ul(le,te),_e(le,Ce),_t.freeType(le)}else if(Array.isArray(te[0])||r(te[0])){ye=ql(te);var be=Ia(te,ye,se.dtype);_e(be,Ce),_t.freeType(be)}else y.raise("invalid buffer data")}else if(dr(te)){ye=te.shape;var we=te.stride,je=0,qe=0,xe=0,Ae=0;ye.length===1?(je=ye[0],qe=1,xe=we[0],Ae=0):ye.length===2?(je=ye[0],qe=ye[1],xe=we[0],Ae=we[1]):y.raise("invalid shape");var ke=Array.isArray(te.data)?se.dtype:so(te.data),He=_t.allocType(ke,je*qe);jl(He,te.data,je,qe,xe,Ae,te.offset),_e(He,Ce),_t.freeType(He)}else y.raise("invalid data for buffer subdata");return Ee}return fe||Ee(k),Ee._reglType="buffer",Ee._buffer=se,Ee.subdata=Ge,S.profile&&(Ee.stats=se.stats),Ee.destroy=function(){ge(se)},Ee}function ue(){sr(X).forEach(function(k){k.buffer=f.createBuffer(),f.bindBuffer(k.type,k.buffer),f.bufferData(k.type,k.persistentData||k.byteLength,k.usage)})}return S.profile&&(v.getTotalBufferSize=function(){var k=0;return Object.keys(X).forEach(function(H){k+=X[H].stats.size}),k}),{create:ce,createStream:ae,destroyStream:de,clear:function(){sr(X).forEach(ge),ie.forEach(ge)},getBuffer:function(k){return k&&k._buffer instanceof Y?k._buffer:null},restore:ue,_initBuffer:he}}var y2=0,b2=0,w2=1,_2=1,x2=4,E2=4,kr={points:y2,point:b2,lines:w2,line:_2,triangles:x2,triangle:E2,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},$2=0,A2=1,ds=4,S2=5120,Pn=5121,Hl=5122,Mn=5123,Yl=5124,rn=5125,Va=34963,T2=35040,P2=35044;function M2(f,v,S,U){var J={},X=0,Y={uint8:Pn,uint16:Mn};v.oes_element_index_uint&&(Y.uint32=rn);function ie(ue){this.id=X++,J[this.id]=this,this.buffer=ue,this.primType=ds,this.vertCount=0,this.type=0}ie.prototype.bind=function(){this.buffer.bind()};var ae=[];function de(ue){var k=ae.pop();return k||(k=new ie(S.create(null,Va,!0,!1)._buffer)),he(k,ue,T2,-1,-1,0,0),k}function me(ue){ae.push(ue)}function he(ue,k,H,fe,Se,se,Ee){ue.buffer.bind();var _e;if(k){var Ge=Ee;!Ee&&(!r(k)||dr(k)&&!r(k.data))&&(Ge=v.oes_element_index_uint?rn:Mn),S._initBuffer(ue.buffer,k,H,Ge,3)}else f.bufferData(Va,se,H),ue.buffer.dtype=_e||Pn,ue.buffer.usage=H,ue.buffer.dimension=3,ue.buffer.byteLength=se;if(_e=Ee,!Ee){switch(ue.buffer.dtype){case Pn:case S2:_e=Pn;break;case Mn:case Hl:_e=Mn;break;case rn:case Yl:_e=rn;break;default:y.raise("unsupported type for element array")}ue.buffer.dtype=_e}ue.type=_e,y(_e!==rn||!!v.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var te=Se;te<0&&(te=ue.buffer.byteLength,_e===Mn?te>>=1:_e===rn&&(te>>=2)),ue.vertCount=te;var K=fe;if(fe<0){K=ds;var Ce=ue.buffer.dimension;Ce===1&&(K=$2),Ce===2&&(K=A2),Ce===3&&(K=ds)}ue.primType=K}function ge(ue){U.elementsCount--,y(ue.buffer!==null,"must not double destroy elements"),delete J[ue.id],ue.buffer.destroy(),ue.buffer=null}function ce(ue,k){var H=S.create(null,Va,!0),fe=new ie(H._buffer);U.elementsCount++;function Se(se){if(!se)H(),fe.primType=ds,fe.vertCount=0,fe.type=Pn;else if(typeof se=="number")H(se),fe.primType=ds,fe.vertCount=se|0,fe.type=Pn;else{var Ee=null,_e=P2,Ge=-1,te=-1,K=0,Ce=0;Array.isArray(se)||r(se)||dr(se)?Ee=se:(y.type(se,"object","invalid arguments for elements"),"data"in se&&(Ee=se.data,y(Array.isArray(Ee)||r(Ee)||dr(Ee),"invalid data for element buffer")),"usage"in se&&(y.parameter(se.usage,no,"invalid element buffer usage"),_e=no[se.usage]),"primitive"in se&&(y.parameter(se.primitive,kr,"invalid element buffer primitive"),Ge=kr[se.primitive]),"count"in se&&(y(typeof se.count=="number"&&se.count>=0,"invalid vertex count for elements"),te=se.count|0),"type"in se&&(y.parameter(se.type,Y,"invalid buffer type"),Ce=Y[se.type]),"length"in se?K=se.length|0:(K=te,Ce===Mn||Ce===Hl?K*=2:(Ce===rn||Ce===Yl)&&(K*=4))),he(fe,Ee,_e,Ge,te,K,Ce)}return Se}return Se(ue),Se._reglType="elements",Se._elements=fe,Se.subdata=function(se,Ee){return H.subdata(se,Ee),Se},Se.destroy=function(){ge(fe)},Se}return{create:ce,createStream:de,destroyStream:me,getElements:function(ue){return typeof ue=="function"&&ue._elements instanceof ie?ue._elements:null},clear:function(){sr(J).forEach(ge)}}}var Zl=new Float32Array(1),C2=new Uint32Array(Zl.buffer),O2=5123;function Wl(f){for(var v=_t.allocType(O2,f.length),S=0;S<f.length;++S)if(isNaN(f[S]))v[S]=65535;else if(f[S]===1/0)v[S]=31744;else if(f[S]===-1/0)v[S]=64512;else{Zl[0]=f[S];var U=C2[0],J=U>>>31<<15,X=(U<<1>>>24)-127,Y=U>>13&(1<<10)-1;if(X<-24)v[S]=J;else if(X<-14){var ie=-14-X;v[S]=J+(Y+(1<<10)>>ie)}else X>15?v[S]=J+31744:v[S]=J+(X+15<<10)+Y}return v}function dt(f){return Array.isArray(f)||r(f)}var Ql=function(f){return!(f&f-1)&&!!f},R2=34467,br=3553,qa=34067,oo=34069,nn=6408,Xa=6406,ao=6407,hs=6409,io=6410,Kl=32854,Ua=32855,Jl=36194,L2=32819,F2=32820,G2=33635,N2=34042,ja=6402,co=34041,Ha=35904,Ya=35906,Cn=36193,Za=33776,Wa=33777,Qa=33778,Ka=33779,ef=35986,tf=35987,rf=34798,nf=35840,sf=35841,of=35842,af=35843,cf=36196,On=5121,Ja=5123,ei=5125,ms=5126,D2=10242,k2=10243,I2=10497,ti=33071,B2=33648,z2=10240,V2=10241,ri=9728,q2=9729,ni=9984,lf=9985,ff=9986,si=9987,X2=33170,lo=4352,U2=4353,j2=4354,H2=34046,Y2=3317,Z2=37440,W2=37441,Q2=37443,uf=37444,ps=33984,K2=[ni,ff,lf,si],fo=[0,hs,io,ao,nn],cr={};cr[hs]=cr[Xa]=cr[ja]=1,cr[co]=cr[io]=2,cr[ao]=cr[Ha]=3,cr[nn]=cr[Ya]=4;function Rn(f){return"[object "+f+"]"}var df=Rn("HTMLCanvasElement"),hf=Rn("OffscreenCanvas"),mf=Rn("CanvasRenderingContext2D"),pf=Rn("ImageBitmap"),vf=Rn("HTMLImageElement"),gf=Rn("HTMLVideoElement"),J2=Object.keys(ka).concat([df,hf,mf,pf,vf,gf]),Ln=[];Ln[On]=1,Ln[ms]=4,Ln[Cn]=2,Ln[Ja]=2,Ln[ei]=4;var Dt=[];Dt[Kl]=2,Dt[Ua]=2,Dt[Jl]=2,Dt[co]=4,Dt[Za]=.5,Dt[Wa]=.5,Dt[Qa]=1,Dt[Ka]=1,Dt[ef]=.5,Dt[tf]=1,Dt[rf]=1,Dt[nf]=.5,Dt[sf]=.25,Dt[of]=.5,Dt[af]=.25,Dt[cf]=.5;function yf(f){return Array.isArray(f)&&(f.length===0||typeof f[0]=="number")}function bf(f){if(!Array.isArray(f))return!1;var v=f.length;return!(v===0||!dt(f[0]))}function sn(f){return Object.prototype.toString.call(f)}function wf(f){return sn(f)===df}function _f(f){return sn(f)===hf}function ev(f){return sn(f)===mf}function tv(f){return sn(f)===pf}function rv(f){return sn(f)===vf}function nv(f){return sn(f)===gf}function oi(f){if(!f)return!1;var v=sn(f);return J2.indexOf(v)>=0?!0:yf(f)||bf(f)||dr(f)}function xf(f){return ka[Object.prototype.toString.call(f)]|0}function sv(f,v){var S=v.length;switch(f.type){case On:case Ja:case ei:case ms:var U=_t.allocType(f.type,S);U.set(v),f.data=U;break;case Cn:f.data=Wl(v);break;default:y.raise("unsupported texture type, must specify a typed array")}}function Ef(f,v){return _t.allocType(f.type===Cn?ms:f.type,v)}function $f(f,v){f.type===Cn?(f.data=Wl(v),_t.freeType(v)):f.data=v}function ov(f,v,S,U,J,X){for(var Y=f.width,ie=f.height,ae=f.channels,de=Y*ie*ae,me=Ef(f,de),he=0,ge=0;ge<ie;++ge)for(var ce=0;ce<Y;++ce)for(var ue=0;ue<ae;++ue)me[he++]=v[S*ce+U*ge+J*ue+X];$f(f,me)}function uo(f,v,S,U,J,X){var Y;if(typeof Dt[f]<"u"?Y=Dt[f]:Y=cr[f]*Ln[v],X&&(Y*=6),J){for(var ie=0,ae=S;ae>=1;)ie+=Y*ae*ae,ae/=2;return ie}else return Y*S*U}function av(f,v,S,U,J,X,Y){var ie={"don't care":lo,"dont care":lo,nice:j2,fast:U2},ae={repeat:I2,clamp:ti,mirror:B2},de={nearest:ri,linear:q2},me=n({mipmap:si,"nearest mipmap nearest":ni,"linear mipmap nearest":lf,"nearest mipmap linear":ff,"linear mipmap linear":si},de),he={none:0,browser:uf},ge={uint8:On,rgba4:L2,rgb565:G2,"rgb5 a1":F2},ce={alpha:Xa,luminance:hs,"luminance alpha":io,rgb:ao,rgba:nn,rgba4:Kl,"rgb5 a1":Ua,rgb565:Jl},ue={};v.ext_srgb&&(ce.srgb=Ha,ce.srgba=Ya),v.oes_texture_float&&(ge.float32=ge.float=ms),v.oes_texture_half_float&&(ge.float16=ge["half float"]=Cn),v.webgl_depth_texture&&(n(ce,{depth:ja,"depth stencil":co}),n(ge,{uint16:Ja,uint32:ei,"depth stencil":N2})),v.webgl_compressed_texture_s3tc&&n(ue,{"rgb s3tc dxt1":Za,"rgba s3tc dxt1":Wa,"rgba s3tc dxt3":Qa,"rgba s3tc dxt5":Ka}),v.webgl_compressed_texture_atc&&n(ue,{"rgb atc":ef,"rgba atc explicit alpha":tf,"rgba atc interpolated alpha":rf}),v.webgl_compressed_texture_pvrtc&&n(ue,{"rgb pvrtc 4bppv1":nf,"rgb pvrtc 2bppv1":sf,"rgba pvrtc 4bppv1":of,"rgba pvrtc 2bppv1":af}),v.webgl_compressed_texture_etc1&&(ue["rgb etc1"]=cf);var k=Array.prototype.slice.call(f.getParameter(R2));Object.keys(ue).forEach(function($){var j=ue[$];k.indexOf(j)>=0&&(ce[$]=j)});var H=Object.keys(ce);S.textureFormats=H;var fe=[];Object.keys(ce).forEach(function($){var j=ce[$];fe[j]=$});var Se=[];Object.keys(ge).forEach(function($){var j=ge[$];Se[j]=$});var se=[];Object.keys(de).forEach(function($){var j=de[$];se[j]=$});var Ee=[];Object.keys(me).forEach(function($){var j=me[$];Ee[j]=$});var _e=[];Object.keys(ae).forEach(function($){var j=ae[$];_e[j]=$});var Ge=H.reduce(function($,j){var V=ce[j];return V===hs||V===Xa||V===hs||V===io||V===ja||V===co||v.ext_srgb&&(V===Ha||V===Ya)?$[V]=V:V===Ua||j.indexOf("rgba")>=0?$[V]=nn:$[V]=ao,$},{});function te(){this.internalformat=nn,this.format=nn,this.type=On,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=uf,this.width=0,this.height=0,this.channels=0}function K($,j){$.internalformat=j.internalformat,$.format=j.format,$.type=j.type,$.compressed=j.compressed,$.premultiplyAlpha=j.premultiplyAlpha,$.flipY=j.flipY,$.unpackAlignment=j.unpackAlignment,$.colorSpace=j.colorSpace,$.width=j.width,$.height=j.height,$.channels=j.channels}function Ce($,j){if(!(typeof j!="object"||!j)){if("premultiplyAlpha"in j&&(y.type(j.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),$.premultiplyAlpha=j.premultiplyAlpha),"flipY"in j&&(y.type(j.flipY,"boolean","invalid texture flip"),$.flipY=j.flipY),"alignment"in j&&(y.oneOf(j.alignment,[1,2,4,8],"invalid texture unpack alignment"),$.unpackAlignment=j.alignment),"colorSpace"in j&&(y.parameter(j.colorSpace,he,"invalid colorSpace"),$.colorSpace=he[j.colorSpace]),"type"in j){var V=j.type;y(v.oes_texture_float||!(V==="float"||V==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),y(v.oes_texture_half_float||!(V==="half float"||V==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),y(v.webgl_depth_texture||!(V==="uint16"||V==="uint32"||V==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),y.parameter(V,ge,"invalid texture type"),$.type=ge[V]}var Me=$.width,We=$.height,w=$.channels,m=!1;"shape"in j?(y(Array.isArray(j.shape)&&j.shape.length>=2,"shape must be an array"),Me=j.shape[0],We=j.shape[1],j.shape.length===3&&(w=j.shape[2],y(w>0&&w<=4,"invalid number of channels"),m=!0),y(Me>=0&&Me<=S.maxTextureSize,"invalid width"),y(We>=0&&We<=S.maxTextureSize,"invalid height")):("radius"in j&&(Me=We=j.radius,y(Me>=0&&Me<=S.maxTextureSize,"invalid radius")),"width"in j&&(Me=j.width,y(Me>=0&&Me<=S.maxTextureSize,"invalid width")),"height"in j&&(We=j.height,y(We>=0&&We<=S.maxTextureSize,"invalid height")),"channels"in j&&(w=j.channels,y(w>0&&w<=4,"invalid number of channels"),m=!0)),$.width=Me|0,$.height=We|0,$.channels=w|0;var T=!1;if("format"in j){var D=j.format;y(v.webgl_depth_texture||!(D==="depth"||D==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),y.parameter(D,ce,"invalid texture format");var I=$.internalformat=ce[D];$.format=Ge[I],D in ge&&("type"in j||($.type=ge[D])),D in ue&&($.compressed=!0),T=!0}!m&&T?$.channels=cr[$.format]:m&&!T?$.channels!==fo[$.format]&&($.format=$.internalformat=fo[$.channels]):T&&m&&y($.channels===cr[$.format],"number of channels inconsistent with specified format")}}function ye($){f.pixelStorei(Z2,$.flipY),f.pixelStorei(W2,$.premultiplyAlpha),f.pixelStorei(Q2,$.colorSpace),f.pixelStorei(Y2,$.unpackAlignment)}function le(){te.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function be($,j){var V=null;if(oi(j)?V=j:j&&(y.type(j,"object","invalid pixel data type"),Ce($,j),"x"in j&&($.xOffset=j.x|0),"y"in j&&($.yOffset=j.y|0),oi(j.data)&&(V=j.data)),y(!$.compressed||V instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),j.copy){y(!V,"can not specify copy and data field for the same texture");var Me=J.viewportWidth,We=J.viewportHeight;$.width=$.width||Me-$.xOffset,$.height=$.height||We-$.yOffset,$.needsCopy=!0,y($.xOffset>=0&&$.xOffset<Me&&$.yOffset>=0&&$.yOffset<We&&$.width>0&&$.width<=Me&&$.height>0&&$.height<=We,"copy texture read out of bounds")}else if(!V)$.width=$.width||1,$.height=$.height||1,$.channels=$.channels||4;else if(r(V))$.channels=$.channels||4,$.data=V,!("type"in j)&&$.type===On&&($.type=xf(V));else if(yf(V))$.channels=$.channels||4,sv($,V),$.alignment=1,$.needsFree=!0;else if(dr(V)){var w=V.data;!Array.isArray(w)&&$.type===On&&($.type=xf(w));var m=V.shape,T=V.stride,D,I,O,M,N,_;m.length===3?(O=m[2],_=T[2]):(y(m.length===2,"invalid ndarray pixel data, must be 2 or 3D"),O=1,_=1),D=m[0],I=m[1],M=T[0],N=T[1],$.alignment=1,$.width=D,$.height=I,$.channels=O,$.format=$.internalformat=fo[O],$.needsFree=!0,ov($,w,M,N,_,V.offset)}else if(wf(V)||_f(V)||ev(V))wf(V)||_f(V)?$.element=V:$.element=V.canvas,$.width=$.element.width,$.height=$.element.height,$.channels=4;else if(tv(V))$.element=V,$.width=V.width,$.height=V.height,$.channels=4;else if(rv(V))$.element=V,$.width=V.naturalWidth,$.height=V.naturalHeight,$.channels=4;else if(nv(V))$.element=V,$.width=V.videoWidth,$.height=V.videoHeight,$.channels=4;else if(bf(V)){var A=$.width||V[0].length,x=$.height||V.length,z=$.channels;dt(V[0][0])?z=z||V[0][0].length:z=z||1;for(var B=ro.shape(V),W=1,re=0;re<B.length;++re)W*=B[re];var ve=Ef($,W);ro.flatten(V,B,"",ve),$f($,ve),$.alignment=1,$.width=A,$.height=x,$.channels=z,$.format=$.internalformat=fo[z],$.needsFree=!0}$.type===ms?y(S.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):$.type===Cn&&y(S.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function we($,j,V){var Me=$.element,We=$.data,w=$.internalformat,m=$.format,T=$.type,D=$.width,I=$.height;ye($),Me?f.texImage2D(j,V,m,m,T,Me):$.compressed?f.compressedTexImage2D(j,V,w,D,I,0,We):$.needsCopy?(U(),f.copyTexImage2D(j,V,m,$.xOffset,$.yOffset,D,I,0)):f.texImage2D(j,V,m,D,I,0,m,T,We||null)}function je($,j,V,Me,We){var w=$.element,m=$.data,T=$.internalformat,D=$.format,I=$.type,O=$.width,M=$.height;ye($),w?f.texSubImage2D(j,We,V,Me,D,I,w):$.compressed?f.compressedTexSubImage2D(j,We,V,Me,T,O,M,m):$.needsCopy?(U(),f.copyTexSubImage2D(j,We,V,Me,$.xOffset,$.yOffset,O,M)):f.texSubImage2D(j,We,V,Me,O,M,D,I,m)}var qe=[];function xe(){return qe.pop()||new le}function Ae($){$.needsFree&&_t.freeType($.data),le.call($),qe.push($)}function ke(){te.call(this),this.genMipmaps=!1,this.mipmapHint=lo,this.mipmask=0,this.images=Array(16)}function He($,j,V){var Me=$.images[0]=xe();$.mipmask=1,Me.width=$.width=j,Me.height=$.height=V,Me.channels=$.channels=4}function Qe($,j){var V=null;if(oi(j))V=$.images[0]=xe(),K(V,$),be(V,j),$.mipmask=1;else if(Ce($,j),Array.isArray(j.mipmap))for(var Me=j.mipmap,We=0;We<Me.length;++We)V=$.images[We]=xe(),K(V,$),V.width>>=We,V.height>>=We,be(V,Me[We]),$.mipmask|=1<<We;else V=$.images[0]=xe(),K(V,$),be(V,j),$.mipmask=1;K($,$.images[0]),$.compressed&&($.internalformat===Za||$.internalformat===Wa||$.internalformat===Qa||$.internalformat===Ka)&&y($.width%4===0&&$.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function ht($,j){for(var V=$.images,Me=0;Me<V.length;++Me){if(!V[Me])return;we(V[Me],j,Me)}}var pt=[];function tt(){var $=pt.pop()||new ke;te.call($),$.mipmask=0;for(var j=0;j<16;++j)$.images[j]=null;return $}function At($){for(var j=$.images,V=0;V<j.length;++V)j[V]&&Ae(j[V]),j[V]=null;pt.push($)}function lt(){this.minFilter=ri,this.magFilter=ri,this.wrapS=ti,this.wrapT=ti,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=lo}function Et($,j){if("min"in j){var V=j.min;y.parameter(V,me),$.minFilter=me[V],K2.indexOf($.minFilter)>=0&&!("faces"in j)&&($.genMipmaps=!0)}if("mag"in j){var Me=j.mag;y.parameter(Me,de),$.magFilter=de[Me]}var We=$.wrapS,w=$.wrapT;if("wrap"in j){var m=j.wrap;typeof m=="string"?(y.parameter(m,ae),We=w=ae[m]):Array.isArray(m)&&(y.parameter(m[0],ae),y.parameter(m[1],ae),We=ae[m[0]],w=ae[m[1]])}else{if("wrapS"in j){var T=j.wrapS;y.parameter(T,ae),We=ae[T]}if("wrapT"in j){var D=j.wrapT;y.parameter(D,ae),w=ae[D]}}if($.wrapS=We,$.wrapT=w,"anisotropic"in j){var I=j.anisotropic;y(typeof I=="number"&&I>=1&&I<=S.maxAnisotropic,"aniso samples must be between 1 and "),$.anisotropic=j.anisotropic}if("mipmap"in j){var O=!1;switch(typeof j.mipmap){case"string":y.parameter(j.mipmap,ie,"invalid mipmap hint"),$.mipmapHint=ie[j.mipmap],$.genMipmaps=!0,O=!0;break;case"boolean":O=$.genMipmaps=j.mipmap;break;case"object":y(Array.isArray(j.mipmap),"invalid mipmap type"),$.genMipmaps=!1,O=!0;break;default:y.raise("invalid mipmap type")}O&&!("min"in j)&&($.minFilter=ni)}}function St($,j){f.texParameteri(j,V2,$.minFilter),f.texParameteri(j,z2,$.magFilter),f.texParameteri(j,D2,$.wrapS),f.texParameteri(j,k2,$.wrapT),v.ext_texture_filter_anisotropic&&f.texParameteri(j,H2,$.anisotropic),$.genMipmaps&&(f.hint(X2,$.mipmapHint),f.generateMipmap(j))}var Tt=0,Ft={},kt=S.maxTextureUnits,gt=Array(kt).map(function(){return null});function Ye($){te.call(this),this.mipmask=0,this.internalformat=nn,this.id=Tt++,this.refCount=1,this.target=$,this.texture=f.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new lt,Y.profile&&(this.stats={size:0})}function It($){f.activeTexture(ps),f.bindTexture($.target,$.texture)}function ot(){var $=gt[0];$?f.bindTexture($.target,$.texture):f.bindTexture(br,null)}function De($){var j=$.texture;y(j,"must not double destroy texture");var V=$.unit,Me=$.target;V>=0&&(f.activeTexture(ps+V),f.bindTexture(Me,null),gt[V]=null),f.deleteTexture(j),$.texture=null,$.params=null,$.pixels=null,$.refCount=0,delete Ft[$.id],X.textureCount--}n(Ye.prototype,{bind:function(){var $=this;$.bindCount+=1;var j=$.unit;if(j<0){for(var V=0;V<kt;++V){var Me=gt[V];if(Me){if(Me.bindCount>0)continue;Me.unit=-1}gt[V]=$,j=V;break}j>=kt&&y.raise("insufficient number of texture units"),Y.profile&&X.maxTextureUnits<j+1&&(X.maxTextureUnits=j+1),$.unit=j,f.activeTexture(ps+j),f.bindTexture($.target,$.texture)}return j},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&De(this)}});function Ke($,j){var V=new Ye(br);Ft[V.id]=V,X.textureCount++;function Me(m,T){var D=V.texInfo;lt.call(D);var I=tt();return typeof m=="number"?typeof T=="number"?He(I,m|0,T|0):He(I,m|0,m|0):m?(y.type(m,"object","invalid arguments to regl.texture"),Et(D,m),Qe(I,m)):He(I,1,1),D.genMipmaps&&(I.mipmask=(I.width<<1)-1),V.mipmask=I.mipmask,K(V,I),y.texture2D(D,I,S),V.internalformat=I.internalformat,Me.width=I.width,Me.height=I.height,It(V),ht(I,br),St(D,br),ot(),At(I),Y.profile&&(V.stats.size=uo(V.internalformat,V.type,I.width,I.height,D.genMipmaps,!1)),Me.format=fe[V.internalformat],Me.type=Se[V.type],Me.mag=se[D.magFilter],Me.min=Ee[D.minFilter],Me.wrapS=_e[D.wrapS],Me.wrapT=_e[D.wrapT],Me}function We(m,T,D,I){y(!!m,"must specify image data");var O=T|0,M=D|0,N=I|0,_=xe();return K(_,V),_.width=0,_.height=0,be(_,m),_.width=_.width||(V.width>>N)-O,_.height=_.height||(V.height>>N)-M,y(V.type===_.type&&V.format===_.format&&V.internalformat===_.internalformat,"incompatible format for texture.subimage"),y(O>=0&&M>=0&&O+_.width<=V.width&&M+_.height<=V.height,"texture.subimage write out of bounds"),y(V.mipmask&1<<N,"missing mipmap data"),y(_.data||_.element||_.needsCopy,"missing image data"),It(V),je(_,br,O,M,N),ot(),Ae(_),Me}function w(m,T){var D=m|0,I=T|0||D;if(D===V.width&&I===V.height)return Me;Me.width=V.width=D,Me.height=V.height=I,It(V);for(var O=0;V.mipmask>>O;++O){var M=D>>O,N=I>>O;if(!M||!N)break;f.texImage2D(br,O,V.format,M,N,0,V.format,V.type,null)}return ot(),Y.profile&&(V.stats.size=uo(V.internalformat,V.type,D,I,!1,!1)),Me}return Me($,j),Me.subimage=We,Me.resize=w,Me._reglType="texture2d",Me._texture=V,Y.profile&&(Me.stats=V.stats),Me.destroy=function(){V.decRef()},Me}function nt($,j,V,Me,We,w){var m=new Ye(qa);Ft[m.id]=m,X.cubeCount++;var T=new Array(6);function D(M,N,_,A,x,z){var B,W=m.texInfo;for(lt.call(W),B=0;B<6;++B)T[B]=tt();if(typeof M=="number"||!M){var re=M|0||1;for(B=0;B<6;++B)He(T[B],re,re)}else if(typeof M=="object")if(N)Qe(T[0],M),Qe(T[1],N),Qe(T[2],_),Qe(T[3],A),Qe(T[4],x),Qe(T[5],z);else if(Et(W,M),Ce(m,M),"faces"in M){var ve=M.faces;for(y(Array.isArray(ve)&&ve.length===6,"cube faces must be a length 6 array"),B=0;B<6;++B)y(typeof ve[B]=="object"&&!!ve[B],"invalid input for cube map face"),K(T[B],m),Qe(T[B],ve[B])}else for(B=0;B<6;++B)Qe(T[B],M);else y.raise("invalid arguments to cube map");for(K(m,T[0]),y.optional(function(){S.npotTextureCube||y(Ql(m.width)&&Ql(m.height),"your browser does not support non power or two texture dimensions")}),W.genMipmaps?m.mipmask=(T[0].width<<1)-1:m.mipmask=T[0].mipmask,y.textureCube(m,W,T,S),m.internalformat=T[0].internalformat,D.width=T[0].width,D.height=T[0].height,It(m),B=0;B<6;++B)ht(T[B],oo+B);for(St(W,qa),ot(),Y.profile&&(m.stats.size=uo(m.internalformat,m.type,D.width,D.height,W.genMipmaps,!0)),D.format=fe[m.internalformat],D.type=Se[m.type],D.mag=se[W.magFilter],D.min=Ee[W.minFilter],D.wrapS=_e[W.wrapS],D.wrapT=_e[W.wrapT],B=0;B<6;++B)At(T[B]);return D}function I(M,N,_,A,x){y(!!N,"must specify image data"),y(typeof M=="number"&&M===(M|0)&&M>=0&&M<6,"invalid face");var z=_|0,B=A|0,W=x|0,re=xe();return K(re,m),re.width=0,re.height=0,be(re,N),re.width=re.width||(m.width>>W)-z,re.height=re.height||(m.height>>W)-B,y(m.type===re.type&&m.format===re.format&&m.internalformat===re.internalformat,"incompatible format for texture.subimage"),y(z>=0&&B>=0&&z+re.width<=m.width&&B+re.height<=m.height,"texture.subimage write out of bounds"),y(m.mipmask&1<<W,"missing mipmap data"),y(re.data||re.element||re.needsCopy,"missing image data"),It(m),je(re,oo+M,z,B,W),ot(),Ae(re),D}function O(M){var N=M|0;if(N!==m.width){D.width=m.width=N,D.height=m.height=N,It(m);for(var _=0;_<6;++_)for(var A=0;m.mipmask>>A;++A)f.texImage2D(oo+_,A,m.format,N>>A,N>>A,0,m.format,m.type,null);return ot(),Y.profile&&(m.stats.size=uo(m.internalformat,m.type,D.width,D.height,!1,!0)),D}}return D($,j,V,Me,We,w),D.subimage=I,D.resize=O,D._reglType="textureCube",D._texture=m,Y.profile&&(D.stats=m.stats),D.destroy=function(){m.decRef()},D}function yt(){for(var $=0;$<kt;++$)f.activeTexture(ps+$),f.bindTexture(br,null),gt[$]=null;sr(Ft).forEach(De),X.cubeCount=0,X.textureCount=0}Y.profile&&(X.getTotalTextureSize=function(){var $=0;return Object.keys(Ft).forEach(function(j){$+=Ft[j].stats.size}),$});function _r(){for(var $=0;$<kt;++$){var j=gt[$];j&&(j.bindCount=0,j.unit=-1,gt[$]=null)}sr(Ft).forEach(function(V){V.texture=f.createTexture(),f.bindTexture(V.target,V.texture);for(var Me=0;Me<32;++Me)if((V.mipmask&1<<Me)!==0)if(V.target===br)f.texImage2D(br,Me,V.internalformat,V.width>>Me,V.height>>Me,0,V.internalformat,V.type,null);else for(var We=0;We<6;++We)f.texImage2D(oo+We,Me,V.internalformat,V.width>>Me,V.height>>Me,0,V.internalformat,V.type,null);St(V.texInfo,V.target)})}function dn(){for(var $=0;$<kt;++$){var j=gt[$];j&&(j.bindCount=0,j.unit=-1,gt[$]=null),f.activeTexture(ps+$),f.bindTexture(br,null),f.bindTexture(qa,null)}}return{create2D:Ke,createCube:nt,clear:yt,getTexture:function($){return null},restore:_r,refresh:dn}}var Ir=36161,ho=32854,Af=32855,Sf=36194,Tf=33189,Pf=36168,Mf=34041,Cf=35907,Of=34836,Rf=34842,Lf=34843,hr=[];hr[ho]=2,hr[Af]=2,hr[Sf]=2,hr[Tf]=2,hr[Pf]=1,hr[Mf]=4,hr[Cf]=4,hr[Of]=16,hr[Rf]=8,hr[Lf]=6;function Ff(f,v,S){return hr[f]*v*S}var iv=function(f,v,S,U,J){var X={rgba4:ho,rgb565:Sf,"rgb5 a1":Af,depth:Tf,stencil:Pf,"depth stencil":Mf};v.ext_srgb&&(X.srgba=Cf),v.ext_color_buffer_half_float&&(X.rgba16f=Rf,X.rgb16f=Lf),v.webgl_color_buffer_float&&(X.rgba32f=Of);var Y=[];Object.keys(X).forEach(function(ce){var ue=X[ce];Y[ue]=ce});var ie=0,ae={};function de(ce){this.id=ie++,this.refCount=1,this.renderbuffer=ce,this.format=ho,this.width=0,this.height=0,J.profile&&(this.stats={size:0})}de.prototype.decRef=function(){--this.refCount<=0&&me(this)};function me(ce){var ue=ce.renderbuffer;y(ue,"must not double destroy renderbuffer"),f.bindRenderbuffer(Ir,null),f.deleteRenderbuffer(ue),ce.renderbuffer=null,ce.refCount=0,delete ae[ce.id],U.renderbufferCount--}function he(ce,ue){var k=new de(f.createRenderbuffer());ae[k.id]=k,U.renderbufferCount++;function H(Se,se){var Ee=0,_e=0,Ge=ho;if(typeof Se=="object"&&Se){var te=Se;if("shape"in te){var K=te.shape;y(Array.isArray(K)&&K.length>=2,"invalid renderbuffer shape"),Ee=K[0]|0,_e=K[1]|0}else"radius"in te&&(Ee=_e=te.radius|0),"width"in te&&(Ee=te.width|0),"height"in te&&(_e=te.height|0);"format"in te&&(y.parameter(te.format,X,"invalid renderbuffer format"),Ge=X[te.format])}else typeof Se=="number"?(Ee=Se|0,typeof se=="number"?_e=se|0:_e=Ee):Se?y.raise("invalid arguments to renderbuffer constructor"):Ee=_e=1;if(y(Ee>0&&_e>0&&Ee<=S.maxRenderbufferSize&&_e<=S.maxRenderbufferSize,"invalid renderbuffer size"),!(Ee===k.width&&_e===k.height&&Ge===k.format))return H.width=k.width=Ee,H.height=k.height=_e,k.format=Ge,f.bindRenderbuffer(Ir,k.renderbuffer),f.renderbufferStorage(Ir,Ge,Ee,_e),y(f.getError()===0,"invalid render buffer format"),J.profile&&(k.stats.size=Ff(k.format,k.width,k.height)),H.format=Y[k.format],H}function fe(Se,se){var Ee=Se|0,_e=se|0||Ee;return Ee===k.width&&_e===k.height||(y(Ee>0&&_e>0&&Ee<=S.maxRenderbufferSize&&_e<=S.maxRenderbufferSize,"invalid renderbuffer size"),H.width=k.width=Ee,H.height=k.height=_e,f.bindRenderbuffer(Ir,k.renderbuffer),f.renderbufferStorage(Ir,k.format,Ee,_e),y(f.getError()===0,"invalid render buffer format"),J.profile&&(k.stats.size=Ff(k.format,k.width,k.height))),H}return H(ce,ue),H.resize=fe,H._reglType="renderbuffer",H._renderbuffer=k,J.profile&&(H.stats=k.stats),H.destroy=function(){k.decRef()},H}J.profile&&(U.getTotalRenderbufferSize=function(){var ce=0;return Object.keys(ae).forEach(function(ue){ce+=ae[ue].stats.size}),ce});function ge(){sr(ae).forEach(function(ce){ce.renderbuffer=f.createRenderbuffer(),f.bindRenderbuffer(Ir,ce.renderbuffer),f.renderbufferStorage(Ir,ce.format,ce.width,ce.height)}),f.bindRenderbuffer(Ir,null)}return{create:he,clear:function(){sr(ae).forEach(me)},restore:ge}},Pr=36160,ai=36161,on=3553,mo=34069,Gf=36064,Nf=36096,Df=36128,kf=33306,If=36053,cv=36054,lv=36055,fv=36057,uv=36061,dv=36193,hv=5121,mv=5126,Bf=6407,zf=6408,pv=6402,vv=[Bf,zf],ii=[];ii[zf]=4,ii[Bf]=3;var po=[];po[hv]=1,po[mv]=4,po[dv]=2;var gv=32854,yv=32855,bv=36194,wv=33189,_v=36168,Vf=34041,xv=35907,Ev=34836,$v=34842,Av=34843,Sv=[gv,yv,bv,xv,$v,Av,Ev],Fn={};Fn[If]="complete",Fn[cv]="incomplete attachment",Fn[fv]="incomplete dimensions",Fn[lv]="incomplete, missing attachment",Fn[uv]="unsupported";function Tv(f,v,S,U,J,X){var Y={cur:null,next:null,dirty:!1,setFBO:null},ie=["rgba"],ae=["rgba4","rgb565","rgb5 a1"];v.ext_srgb&&ae.push("srgba"),v.ext_color_buffer_half_float&&ae.push("rgba16f","rgb16f"),v.webgl_color_buffer_float&&ae.push("rgba32f");var de=["uint8"];v.oes_texture_half_float&&de.push("half float","float16"),v.oes_texture_float&&de.push("float","float32");function me(le,be,we){this.target=le,this.texture=be,this.renderbuffer=we;var je=0,qe=0;be?(je=be.width,qe=be.height):we&&(je=we.width,qe=we.height),this.width=je,this.height=qe}function he(le){le&&(le.texture&&le.texture._texture.decRef(),le.renderbuffer&&le.renderbuffer._renderbuffer.decRef())}function ge(le,be,we){if(!!le)if(le.texture){var je=le.texture._texture,qe=Math.max(1,je.width),xe=Math.max(1,je.height);y(qe===be&&xe===we,"inconsistent width/height for supplied texture"),je.refCount+=1}else{var Ae=le.renderbuffer._renderbuffer;y(Ae.width===be&&Ae.height===we,"inconsistent width/height for renderbuffer"),Ae.refCount+=1}}function ce(le,be){be&&(be.texture?f.framebufferTexture2D(Pr,le,be.target,be.texture._texture.texture,0):f.framebufferRenderbuffer(Pr,le,ai,be.renderbuffer._renderbuffer.renderbuffer))}function ue(le){var be=on,we=null,je=null,qe=le;typeof le=="object"&&(qe=le.data,"target"in le&&(be=le.target|0)),y.type(qe,"function","invalid attachment data");var xe=qe._reglType;return xe==="texture2d"?(we=qe,y(be===on)):xe==="textureCube"?(we=qe,y(be>=mo&&be<mo+6,"invalid cube map target")):xe==="renderbuffer"?(je=qe,be=ai):y.raise("invalid regl object for attachment"),new me(be,we,je)}function k(le,be,we,je,qe){if(we){var xe=U.create2D({width:le,height:be,format:je,type:qe});return xe._texture.refCount=0,new me(on,xe,null)}else{var Ae=J.create({width:le,height:be,format:je});return Ae._renderbuffer.refCount=0,new me(ai,null,Ae)}}function H(le){return le&&(le.texture||le.renderbuffer)}function fe(le,be,we){le&&(le.texture?le.texture.resize(be,we):le.renderbuffer&&le.renderbuffer.resize(be,we),le.width=be,le.height=we)}var Se=0,se={};function Ee(){this.id=Se++,se[this.id]=this,this.framebuffer=f.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function _e(le){le.colorAttachments.forEach(he),he(le.depthAttachment),he(le.stencilAttachment),he(le.depthStencilAttachment)}function Ge(le){var be=le.framebuffer;y(be,"must not double destroy framebuffer"),f.deleteFramebuffer(be),le.framebuffer=null,X.framebufferCount--,delete se[le.id]}function te(le){var be;f.bindFramebuffer(Pr,le.framebuffer);var we=le.colorAttachments;for(be=0;be<we.length;++be)ce(Gf+be,we[be]);for(be=we.length;be<S.maxColorAttachments;++be)f.framebufferTexture2D(Pr,Gf+be,on,null,0);f.framebufferTexture2D(Pr,kf,on,null,0),f.framebufferTexture2D(Pr,Nf,on,null,0),f.framebufferTexture2D(Pr,Df,on,null,0),ce(Nf,le.depthAttachment),ce(Df,le.stencilAttachment),ce(kf,le.depthStencilAttachment);var je=f.checkFramebufferStatus(Pr);!f.isContextLost()&&je!==If&&y.raise("framebuffer configuration not supported, status = "+Fn[je]),f.bindFramebuffer(Pr,Y.next?Y.next.framebuffer:null),Y.cur=Y.next,f.getError()}function K(le,be){var we=new Ee;X.framebufferCount++;function je(xe,Ae){var ke;y(Y.next!==we,"can not update framebuffer which is currently in use");var He=0,Qe=0,ht=!0,pt=!0,tt=null,At=!0,lt="rgba",Et="uint8",St=1,Tt=null,Ft=null,kt=null,gt=!1;if(typeof xe=="number")He=xe|0,Qe=Ae|0||He;else if(!xe)He=Qe=1;else{y.type(xe,"object","invalid arguments for framebuffer");var Ye=xe;if("shape"in Ye){var It=Ye.shape;y(Array.isArray(It)&&It.length>=2,"invalid shape for framebuffer"),He=It[0],Qe=It[1]}else"radius"in Ye&&(He=Qe=Ye.radius),"width"in Ye&&(He=Ye.width),"height"in Ye&&(Qe=Ye.height);("color"in Ye||"colors"in Ye)&&(tt=Ye.color||Ye.colors,Array.isArray(tt)&&y(tt.length===1||v.webgl_draw_buffers,"multiple render targets not supported")),tt||("colorCount"in Ye&&(St=Ye.colorCount|0,y(St>0,"invalid color buffer count")),"colorTexture"in Ye&&(At=!!Ye.colorTexture,lt="rgba4"),"colorType"in Ye&&(Et=Ye.colorType,At?(y(v.oes_texture_float||!(Et==="float"||Et==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),y(v.oes_texture_half_float||!(Et==="half float"||Et==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Et==="half float"||Et==="float16"?(y(v.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),lt="rgba16f"):(Et==="float"||Et==="float32")&&(y(v.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),lt="rgba32f"),y.oneOf(Et,de,"invalid color type")),"colorFormat"in Ye&&(lt=Ye.colorFormat,ie.indexOf(lt)>=0?At=!0:ae.indexOf(lt)>=0?At=!1:y.optional(function(){At?y.oneOf(Ye.colorFormat,ie,"invalid color format for texture"):y.oneOf(Ye.colorFormat,ae,"invalid color format for renderbuffer")}))),("depthTexture"in Ye||"depthStencilTexture"in Ye)&&(gt=!!(Ye.depthTexture||Ye.depthStencilTexture),y(!gt||v.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in Ye&&(typeof Ye.depth=="boolean"?ht=Ye.depth:(Tt=Ye.depth,pt=!1)),"stencil"in Ye&&(typeof Ye.stencil=="boolean"?pt=Ye.stencil:(Ft=Ye.stencil,ht=!1)),"depthStencil"in Ye&&(typeof Ye.depthStencil=="boolean"?ht=pt=Ye.depthStencil:(kt=Ye.depthStencil,ht=!1,pt=!1))}var ot=null,De=null,Ke=null,nt=null;if(Array.isArray(tt))ot=tt.map(ue);else if(tt)ot=[ue(tt)];else for(ot=new Array(St),ke=0;ke<St;++ke)ot[ke]=k(He,Qe,At,lt,Et);y(v.webgl_draw_buffers||ot.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),y(ot.length<=S.maxColorAttachments,"too many color attachments, not supported"),He=He||ot[0].width,Qe=Qe||ot[0].height,Tt?De=ue(Tt):ht&&!pt&&(De=k(He,Qe,gt,"depth","uint32")),Ft?Ke=ue(Ft):pt&&!ht&&(Ke=k(He,Qe,!1,"stencil","uint8")),kt?nt=ue(kt):!Tt&&!Ft&&pt&&ht&&(nt=k(He,Qe,gt,"depth stencil","depth stencil")),y(!!Tt+!!Ft+!!kt<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var yt=null;for(ke=0;ke<ot.length;++ke)if(ge(ot[ke],He,Qe),y(!ot[ke]||ot[ke].texture&&vv.indexOf(ot[ke].texture._texture.format)>=0||ot[ke].renderbuffer&&Sv.indexOf(ot[ke].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+ke+" is invalid"),ot[ke]&&ot[ke].texture){var _r=ii[ot[ke].texture._texture.format]*po[ot[ke].texture._texture.type];yt===null?yt=_r:y(yt===_r,"all color attachments much have the same number of bits per pixel.")}return ge(De,He,Qe),y(!De||De.texture&&De.texture._texture.format===pv||De.renderbuffer&&De.renderbuffer._renderbuffer.format===wv,"invalid depth attachment for framebuffer object"),ge(Ke,He,Qe),y(!Ke||Ke.renderbuffer&&Ke.renderbuffer._renderbuffer.format===_v,"invalid stencil attachment for framebuffer object"),ge(nt,He,Qe),y(!nt||nt.texture&&nt.texture._texture.format===Vf||nt.renderbuffer&&nt.renderbuffer._renderbuffer.format===Vf,"invalid depth-stencil attachment for framebuffer object"),_e(we),we.width=He,we.height=Qe,we.colorAttachments=ot,we.depthAttachment=De,we.stencilAttachment=Ke,we.depthStencilAttachment=nt,je.color=ot.map(H),je.depth=H(De),je.stencil=H(Ke),je.depthStencil=H(nt),je.width=we.width,je.height=we.height,te(we),je}function qe(xe,Ae){y(Y.next!==we,"can not resize a framebuffer which is currently in use");var ke=Math.max(xe|0,1),He=Math.max(Ae|0||ke,1);if(ke===we.width&&He===we.height)return je;for(var Qe=we.colorAttachments,ht=0;ht<Qe.length;++ht)fe(Qe[ht],ke,He);return fe(we.depthAttachment,ke,He),fe(we.stencilAttachment,ke,He),fe(we.depthStencilAttachment,ke,He),we.width=je.width=ke,we.height=je.height=He,te(we),je}return je(le,be),n(je,{resize:qe,_reglType:"framebuffer",_framebuffer:we,destroy:function(){Ge(we),_e(we)},use:function(xe){Y.setFBO({framebuffer:je},xe)}})}function Ce(le){var be=Array(6);function we(qe){var xe;y(be.indexOf(Y.next)<0,"can not update framebuffer which is currently in use");var Ae={color:null},ke=0,He=null,Qe="rgba",ht="uint8",pt=1;if(typeof qe=="number")ke=qe|0;else if(!qe)ke=1;else{y.type(qe,"object","invalid arguments for framebuffer");var tt=qe;if("shape"in tt){var At=tt.shape;y(Array.isArray(At)&&At.length>=2,"invalid shape for framebuffer"),y(At[0]===At[1],"cube framebuffer must be square"),ke=At[0]}else"radius"in tt&&(ke=tt.radius|0),"width"in tt?(ke=tt.width|0,"height"in tt&&y(tt.height===ke,"must be square")):"height"in tt&&(ke=tt.height|0);("color"in tt||"colors"in tt)&&(He=tt.color||tt.colors,Array.isArray(He)&&y(He.length===1||v.webgl_draw_buffers,"multiple render targets not supported")),He||("colorCount"in tt&&(pt=tt.colorCount|0,y(pt>0,"invalid color buffer count")),"colorType"in tt&&(y.oneOf(tt.colorType,de,"invalid color type"),ht=tt.colorType),"colorFormat"in tt&&(Qe=tt.colorFormat,y.oneOf(tt.colorFormat,ie,"invalid color format for texture"))),"depth"in tt&&(Ae.depth=tt.depth),"stencil"in tt&&(Ae.stencil=tt.stencil),"depthStencil"in tt&&(Ae.depthStencil=tt.depthStencil)}var lt;if(He)if(Array.isArray(He))for(lt=[],xe=0;xe<He.length;++xe)lt[xe]=He[xe];else lt=[He];else{lt=Array(pt);var Et={radius:ke,format:Qe,type:ht};for(xe=0;xe<pt;++xe)lt[xe]=U.createCube(Et)}for(Ae.color=Array(lt.length),xe=0;xe<lt.length;++xe){var St=lt[xe];y(typeof St=="function"&&St._reglType==="textureCube","invalid cube map"),ke=ke||St.width,y(St.width===ke&&St.height===ke,"invalid cube map shape"),Ae.color[xe]={target:mo,data:lt[xe]}}for(xe=0;xe<6;++xe){for(var Tt=0;Tt<lt.length;++Tt)Ae.color[Tt].target=mo+xe;xe>0&&(Ae.depth=be[0].depth,Ae.stencil=be[0].stencil,Ae.depthStencil=be[0].depthStencil),be[xe]?be[xe](Ae):be[xe]=K(Ae)}return n(we,{width:ke,height:ke,color:lt})}function je(qe){var xe,Ae=qe|0;if(y(Ae>0&&Ae<=S.maxCubeMapSize,"invalid radius for cube fbo"),Ae===we.width)return we;var ke=we.color;for(xe=0;xe<ke.length;++xe)ke[xe].resize(Ae);for(xe=0;xe<6;++xe)be[xe].resize(Ae);return we.width=we.height=Ae,we}return we(le),n(we,{faces:be,resize:je,_reglType:"framebufferCube",destroy:function(){be.forEach(function(qe){qe.destroy()})}})}function ye(){Y.cur=null,Y.next=null,Y.dirty=!0,sr(se).forEach(function(le){le.framebuffer=f.createFramebuffer(),te(le)})}return n(Y,{getFramebuffer:function(le){if(typeof le=="function"&&le._reglType==="framebuffer"){var be=le._framebuffer;if(be instanceof Ee)return be}return null},create:K,createCube:Ce,clear:function(){sr(se).forEach(Ge)},restore:ye})}var Pv=5126,qf=34962,vo=34963,Xf=["attributes","elements","offset","count","primitive","instances"];function ci(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Pv,this.offset=0,this.stride=0,this.divisor=0}function Mv(f,v,S,U,J,X,Y){for(var ie=S.maxAttributes,ae=new Array(ie),de=0;de<ie;++de)ae[de]=new ci;var me=0,he={},ge={Record:ci,scope:{},state:ae,currentVAO:null,targetVAO:null,restore:ue()?_e:function(){},createVAO:Ge,getVAO:H,destroyBuffer:ce,setVAO:ue()?fe:Se,clear:ue()?se:function(){}};function ce(te){for(var K=0;K<ae.length;++K){var Ce=ae[K];Ce.buffer===te&&(f.disableVertexAttribArray(K),Ce.buffer=null)}}function ue(){return v.oes_vertex_array_object}function k(){return v.angle_instanced_arrays}function H(te){return typeof te=="function"&&te._vao?te._vao:null}function fe(te){if(te!==ge.currentVAO){var K=ue();te?K.bindVertexArrayOES(te.vao):K.bindVertexArrayOES(null),ge.currentVAO=te}}function Se(te){if(te!==ge.currentVAO){if(te)te.bindAttrs();else{for(var K=k(),Ce=0;Ce<ae.length;++Ce){var ye=ae[Ce];ye.buffer?(f.enableVertexAttribArray(Ce),ye.buffer.bind(),f.vertexAttribPointer(Ce,ye.size,ye.type,ye.normalized,ye.stride,ye.offfset),K&&ye.divisor&&K.vertexAttribDivisorANGLE(Ce,ye.divisor)):(f.disableVertexAttribArray(Ce),f.vertexAttrib4f(Ce,ye.x,ye.y,ye.z,ye.w))}Y.elements?f.bindBuffer(vo,Y.elements.buffer.buffer):f.bindBuffer(vo,null)}ge.currentVAO=te}}function se(){sr(he).forEach(function(te){te.destroy()})}function Ee(){this.id=++me,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var te=ue();te?this.vao=te.createVertexArrayOES():this.vao=null,he[this.id]=this,this.buffers=[]}Ee.prototype.bindAttrs=function(){for(var te=k(),K=this.attributes,Ce=0;Ce<K.length;++Ce){var ye=K[Ce];ye.buffer?(f.enableVertexAttribArray(Ce),f.bindBuffer(qf,ye.buffer.buffer),f.vertexAttribPointer(Ce,ye.size,ye.type,ye.normalized,ye.stride,ye.offset),te&&ye.divisor&&te.vertexAttribDivisorANGLE(Ce,ye.divisor)):(f.disableVertexAttribArray(Ce),f.vertexAttrib4f(Ce,ye.x,ye.y,ye.z,ye.w))}for(var le=K.length;le<ie;++le)f.disableVertexAttribArray(le);var be=X.getElements(this.elements);be?f.bindBuffer(vo,be.buffer.buffer):f.bindBuffer(vo,null)},Ee.prototype.refresh=function(){var te=ue();te&&(te.bindVertexArrayOES(this.vao),this.bindAttrs(),ge.currentVAO=null,te.bindVertexArrayOES(null))},Ee.prototype.destroy=function(){if(this.vao){var te=ue();this===ge.currentVAO&&(ge.currentVAO=null,te.bindVertexArrayOES(null)),te.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),he[this.id]&&(delete he[this.id],U.vaoCount-=1)};function _e(){var te=ue();te&&sr(he).forEach(function(K){K.refresh()})}function Ge(te){var K=new Ee;U.vaoCount+=1;function Ce(ye){var le;if(Array.isArray(ye))le=ye,K.elements&&K.ownsElements&&K.elements.destroy(),K.elements=null,K.ownsElements=!1,K.offset=0,K.count=0,K.instances=-1,K.primitive=4;else{if(y(typeof ye=="object","invalid arguments for create vao"),y("attributes"in ye,"must specify attributes for vao"),ye.elements){var be=ye.elements;K.ownsElements?typeof be=="function"&&be._reglType==="elements"?(K.elements.destroy(),K.ownsElements=!1):(K.elements(be),K.ownsElements=!1):X.getElements(ye.elements)?(K.elements=ye.elements,K.ownsElements=!1):(K.elements=X.create(ye.elements),K.ownsElements=!0)}else K.elements=null,K.ownsElements=!1;le=ye.attributes,K.offset=0,K.count=-1,K.instances=-1,K.primitive=4,K.elements&&(K.count=K.elements._elements.vertCount,K.primitive=K.elements._elements.primType),"offset"in ye&&(K.offset=ye.offset|0),"count"in ye&&(K.count=ye.count|0),"instances"in ye&&(K.instances=ye.instances|0),"primitive"in ye&&(y(ye.primitive in kr,"bad primitive type: "+ye.primitive),K.primitive=kr[ye.primitive]),y.optional(()=>{for(var ht=Object.keys(ye),pt=0;pt<ht.length;++pt)y(Xf.indexOf(ht[pt])>=0,'invalid option for vao: "'+ht[pt]+'" valid options are '+Xf)}),y(Array.isArray(le),"attributes must be an array")}y(le.length<ie,"too many attributes"),y(le.length>0,"must specify at least one attribute");var we={},je=K.attributes;je.length=le.length;for(var qe=0;qe<le.length;++qe){var xe=le[qe],Ae=je[qe]=new ci,ke=xe.data||xe;if(Array.isArray(ke)||r(ke)||dr(ke)){var He;K.buffers[qe]&&(He=K.buffers[qe],r(ke)&&He._buffer.byteLength>=ke.byteLength?He.subdata(ke):(He.destroy(),K.buffers[qe]=null)),K.buffers[qe]||(He=K.buffers[qe]=J.create(xe,qf,!1,!0)),Ae.buffer=J.getBuffer(He),Ae.size=Ae.buffer.dimension|0,Ae.normalized=!1,Ae.type=Ae.buffer.dtype,Ae.offset=0,Ae.stride=0,Ae.divisor=0,Ae.state=1,we[qe]=1}else J.getBuffer(xe)?(Ae.buffer=J.getBuffer(xe),Ae.size=Ae.buffer.dimension|0,Ae.normalized=!1,Ae.type=Ae.buffer.dtype,Ae.offset=0,Ae.stride=0,Ae.divisor=0,Ae.state=1):J.getBuffer(xe.buffer)?(Ae.buffer=J.getBuffer(xe.buffer),Ae.size=(+xe.size||Ae.buffer.dimension)|0,Ae.normalized=!!xe.normalized||!1,"type"in xe?(y.parameter(xe.type,tn,"invalid buffer type"),Ae.type=tn[xe.type]):Ae.type=Ae.buffer.dtype,Ae.offset=(xe.offset||0)|0,Ae.stride=(xe.stride||0)|0,Ae.divisor=(xe.divisor||0)|0,Ae.state=1,y(Ae.size>=1&&Ae.size<=4,"size must be between 1 and 4"),y(Ae.offset>=0,"invalid offset"),y(Ae.stride>=0&&Ae.stride<=255,"stride must be between 0 and 255"),y(Ae.divisor>=0,"divisor must be positive"),y(!Ae.divisor||!!v.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in xe?(y(qe>0,"first attribute must not be a constant"),Ae.x=+xe.x||0,Ae.y=+xe.y||0,Ae.z=+xe.z||0,Ae.w=+xe.w||0,Ae.state=2):y(!1,"invalid attribute spec for location "+qe)}for(var Qe=0;Qe<K.buffers.length;++Qe)!we[Qe]&&K.buffers[Qe]&&(K.buffers[Qe].destroy(),K.buffers[Qe]=null);return K.refresh(),Ce}return Ce.destroy=function(){for(var ye=0;ye<K.buffers.length;++ye)K.buffers[ye]&&K.buffers[ye].destroy();K.buffers.length=0,K.ownsElements&&(K.elements.destroy(),K.elements=null,K.ownsElements=!1),K.destroy()},Ce._vao=K,Ce._reglType="vao",Ce(te)}return ge}var Uf=35632,Cv=35633,Ov=35718,Rv=35721;function Lv(f,v,S,U){var J={},X={};function Y(k,H,fe,Se){this.name=k,this.id=H,this.location=fe,this.info=Se}function ie(k,H){for(var fe=0;fe<k.length;++fe)if(k[fe].id===H.id){k[fe].location=H.location;return}k.push(H)}function ae(k,H,fe){var Se=k===Uf?J:X,se=Se[H];if(!se){var Ee=v.str(H);se=f.createShader(k),f.shaderSource(se,Ee),f.compileShader(se),y.shaderError(f,se,Ee,k,fe),Se[H]=se}return se}var de={},me=[],he=0;function ge(k,H){this.id=he++,this.fragId=k,this.vertId=H,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,U.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function ce(k,H,fe){var Se,se,Ee=ae(Uf,k.fragId),_e=ae(Cv,k.vertId),Ge=k.program=f.createProgram();if(f.attachShader(Ge,Ee),f.attachShader(Ge,_e),fe)for(Se=0;Se<fe.length;++Se){var te=fe[Se];f.bindAttribLocation(Ge,te[0],te[1])}f.linkProgram(Ge),y.linkError(f,Ge,v.str(k.fragId),v.str(k.vertId),H);var K=f.getProgramParameter(Ge,Ov);U.profile&&(k.stats.uniformsCount=K);var Ce=k.uniforms;for(Se=0;Se<K;++Se)if(se=f.getActiveUniform(Ge,Se),se){if(se.size>1)for(var ye=0;ye<se.size;++ye){var le=se.name.replace("[0]","["+ye+"]");ie(Ce,new Y(le,v.id(le),f.getUniformLocation(Ge,le),se))}var be=se.name;se.size>1&&(be=be.replace("[0]","")),ie(Ce,new Y(be,v.id(be),f.getUniformLocation(Ge,be),se))}var we=f.getProgramParameter(Ge,Rv);U.profile&&(k.stats.attributesCount=we);var je=k.attributes;for(Se=0;Se<we;++Se)se=f.getActiveAttrib(Ge,Se),se&&ie(je,new Y(se.name,v.id(se.name),f.getAttribLocation(Ge,se.name),se))}U.profile&&(S.getMaxUniformsCount=function(){var k=0;return me.forEach(function(H){H.stats.uniformsCount>k&&(k=H.stats.uniformsCount)}),k},S.getMaxAttributesCount=function(){var k=0;return me.forEach(function(H){H.stats.attributesCount>k&&(k=H.stats.attributesCount)}),k});function ue(){J={},X={};for(var k=0;k<me.length;++k)ce(me[k],null,me[k].attributes.map(function(H){return[H.location,H.name]}))}return{clear:function(){var k=f.deleteShader.bind(f);sr(J).forEach(k),J={},sr(X).forEach(k),X={},me.forEach(function(H){f.deleteProgram(H.program)}),me.length=0,de={},S.shaderCount=0},program:function(k,H,fe,Se){y.command(k>=0,"missing vertex shader",fe),y.command(H>=0,"missing fragment shader",fe);var se=de[H];se||(se=de[H]={});var Ee=se[k];if(Ee&&(Ee.refCount++,!Se))return Ee;var _e=new ge(H,k);return S.shaderCount++,ce(_e,fe,Se),Ee||(se[k]=_e),me.push(_e),n(_e,{destroy:function(){if(_e.refCount--,_e.refCount<=0){f.deleteProgram(_e.program);var Ge=me.indexOf(_e);me.splice(Ge,1),S.shaderCount--}se[_e.vertId].refCount<=0&&(f.deleteShader(X[_e.vertId]),delete X[_e.vertId],delete de[_e.fragId][_e.vertId]),Object.keys(de[_e.fragId]).length||(f.deleteShader(J[_e.fragId]),delete J[_e.fragId],delete de[_e.fragId])}})},restore:ue,shader:ae,frag:-1,vert:-1}}var Fv=6408,vs=5121,Gv=3333,go=5126;function Nv(f,v,S,U,J,X,Y){function ie(me){var he;v.next===null?(y(J.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),he=vs):(y(v.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),he=v.next.colorAttachments[0].texture._texture.type,y.optional(function(){X.oes_texture_float?(y(he===vs||he===go,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),he===go&&y(Y.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):y(he===vs,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var ge=0,ce=0,ue=U.framebufferWidth,k=U.framebufferHeight,H=null;r(me)?H=me:me&&(y.type(me,"object","invalid arguments to regl.read()"),ge=me.x|0,ce=me.y|0,y(ge>=0&&ge<U.framebufferWidth,"invalid x offset for regl.read"),y(ce>=0&&ce<U.framebufferHeight,"invalid y offset for regl.read"),ue=(me.width||U.framebufferWidth-ge)|0,k=(me.height||U.framebufferHeight-ce)|0,H=me.data||null),H&&(he===vs?y(H instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):he===go&&y(H instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),y(ue>0&&ue+ge<=U.framebufferWidth,"invalid width for read pixels"),y(k>0&&k+ce<=U.framebufferHeight,"invalid height for read pixels"),S();var fe=ue*k*4;return H||(he===vs?H=new Uint8Array(fe):he===go&&(H=H||new Float32Array(fe))),y.isTypedArray(H,"data buffer for regl.read() must be a typedarray"),y(H.byteLength>=fe,"data buffer for regl.read() too small"),f.pixelStorei(Gv,4),f.readPixels(ge,ce,ue,k,Fv,he,H),H}function ae(me){var he;return v.setFBO({framebuffer:me.framebuffer},function(){he=ie(me)}),he}function de(me){return!me||!("framebuffer"in me)?ie(me):ae(me)}return de}function Gn(f){return Array.prototype.slice.call(f)}function Nn(f){return Gn(f).join("")}function Dv(){var f=0,v=[],S=[];function U(he){for(var ge=0;ge<S.length;++ge)if(S[ge]===he)return v[ge];var ce="g"+f++;return v.push(ce),S.push(he),ce}function J(){var he=[];function ge(){he.push.apply(he,Gn(arguments))}var ce=[];function ue(){var k="v"+f++;return ce.push(k),arguments.length>0&&(he.push(k,"="),he.push.apply(he,Gn(arguments)),he.push(";")),k}return n(ge,{def:ue,toString:function(){return Nn([ce.length>0?"var "+ce.join(",")+";":"",Nn(he)])}})}function X(){var he=J(),ge=J(),ce=he.toString,ue=ge.toString;function k(H,fe){ge(H,fe,"=",he.def(H,fe),";")}return n(function(){he.apply(he,Gn(arguments))},{def:he.def,entry:he,exit:ge,save:k,set:function(H,fe,Se){k(H,fe),he(H,fe,"=",Se,";")},toString:function(){return ce()+ue()}})}function Y(){var he=Nn(arguments),ge=X(),ce=X(),ue=ge.toString,k=ce.toString;return n(ge,{then:function(){return ge.apply(ge,Gn(arguments)),this},else:function(){return ce.apply(ce,Gn(arguments)),this},toString:function(){var H=k();return H&&(H="else{"+H+"}"),Nn(["if(",he,"){",ue(),"}",H])}})}var ie=J(),ae={};function de(he,ge){var ce=[];function ue(){var se="a"+ce.length;return ce.push(se),se}ge=ge||0;for(var k=0;k<ge;++k)ue();var H=X(),fe=H.toString,Se=ae[he]=n(H,{arg:ue,toString:function(){return Nn(["function(",ce.join(),"){",fe(),"}"])}});return Se}function me(){var he=['"use strict";',ie,"return {"];Object.keys(ae).forEach(function(ue){he.push('"',ue,'":',ae[ue].toString(),",")}),he.push("}");var ge=Nn(he).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),ce=Function.apply(null,v.concat(ge));return ce.apply(null,S)}return{global:ie,link:U,block:J,proc:de,scope:X,cond:Y,compile:me}}var Dn="xyzw".split(""),jf=5121,kn=1,li=2,fi=0,ui=1,di=2,hi=3,yo=4,Hf=5,Yf=6,Zf="dither",Wf="blend.enable",Qf="blend.color",mi="blend.equation",pi="blend.func",Kf="depth.enable",Jf="depth.func",e1="depth.range",t1="depth.mask",vi="colorMask",r1="cull.enable",n1="cull.face",gi="frontFace",yi="lineWidth",s1="polygonOffset.enable",bi="polygonOffset.offset",o1="sample.alpha",a1="sample.enable",wi="sample.coverage",i1="stencil.enable",c1="stencil.mask",_i="stencil.func",xi="stencil.opFront",gs="stencil.opBack",l1="scissor.enable",bo="scissor.box",Mr="viewport",ys="profile",an="framebuffer",bs="vert",ws="frag",cn="elements",ln="primitive",fn="count",wo="offset",_o="instances",_s="vao",Ei="Width",$i="Height",In=an+Ei,Bn=an+$i,kv=Mr+Ei,Iv=Mr+$i,f1="drawingBuffer",u1=f1+Ei,d1=f1+$i,Bv=[pi,mi,_i,xi,gs,wi,Mr,bo,bi],zn=34962,Ai=34963,zv=35632,Vv=35633,h1=3553,qv=34067,Xv=2884,Uv=3042,jv=3024,Hv=2960,Yv=2929,Zv=3089,Wv=32823,Qv=32926,Kv=32928,Si=5126,xo=35664,Eo=35665,$o=35666,Ti=5124,Ao=35667,So=35668,To=35669,Pi=35670,Po=35671,Mo=35672,Co=35673,xs=35674,Es=35675,$s=35676,As=35678,Ss=35680,Mi=4,Ts=1028,un=1029,m1=2304,Ci=2305,Jv=32775,eg=32776,tg=519,Br=7680,p1=0,v1=1,g1=32774,rg=513,y1=36160,ng=36064,wr={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},b1=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Vn={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},zr={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},w1={frag:zv,vert:Vv},Oi={cw:m1,ccw:Ci};function Oo(f){return Array.isArray(f)||r(f)||dr(f)}function _1(f){return f.sort(function(v,S){return v===Mr?-1:S===Mr?1:v<S?-1:1})}function Ct(f,v,S,U){this.thisDep=f,this.contextDep=v,this.propDep=S,this.append=U}function Vr(f){return f&&!(f.thisDep||f.contextDep||f.propDep)}function xt(f){return new Ct(!1,!1,!1,f)}function Wt(f,v){var S=f.type;if(S===fi){var U=f.data.length;return new Ct(!0,U>=1,U>=2,v)}else if(S===yo){var J=f.data;return new Ct(J.thisDep,J.contextDep,J.propDep,v)}else{if(S===Hf)return new Ct(!1,!1,!1,v);if(S===Yf){for(var X=!1,Y=!1,ie=!1,ae=0;ae<f.data.length;++ae){var de=f.data[ae];if(de.type===ui)ie=!0;else if(de.type===di)Y=!0;else if(de.type===hi)X=!0;else if(de.type===fi){X=!0;var me=de.data;me>=1&&(Y=!0),me>=2&&(ie=!0)}else de.type===yo&&(X=X||de.data.thisDep,Y=Y||de.data.contextDep,ie=ie||de.data.propDep)}return new Ct(X,Y,ie,v)}else return new Ct(S===hi,S===di,S===ui,v)}}var x1=new Ct(!1,!1,!1,function(){});function sg(f,v,S,U,J,X,Y,ie,ae,de,me,he,ge,ce,ue){var k=de.Record,H={add:32774,subtract:32778,"reverse subtract":32779};S.ext_blend_minmax&&(H.min=Jv,H.max=eg);var fe=S.angle_instanced_arrays,Se=S.webgl_draw_buffers,se=S.oes_vertex_array_object,Ee={dirty:!0,profile:ue.profile},_e={},Ge=[],te={},K={};function Ce(w){return w.replace(".","_")}function ye(w,m,T){var D=Ce(w);Ge.push(w),_e[D]=Ee[D]=!!T,te[D]=m}function le(w,m,T){var D=Ce(w);Ge.push(w),Array.isArray(T)?(Ee[D]=T.slice(),_e[D]=T.slice()):Ee[D]=_e[D]=T,K[D]=m}ye(Zf,jv),ye(Wf,Uv),le(Qf,"blendColor",[0,0,0,0]),le(mi,"blendEquationSeparate",[g1,g1]),le(pi,"blendFuncSeparate",[v1,p1,v1,p1]),ye(Kf,Yv,!0),le(Jf,"depthFunc",rg),le(e1,"depthRange",[0,1]),le(t1,"depthMask",!0),le(vi,vi,[!0,!0,!0,!0]),ye(r1,Xv),le(n1,"cullFace",un),le(gi,gi,Ci),le(yi,yi,1),ye(s1,Wv),le(bi,"polygonOffset",[0,0]),ye(o1,Qv),ye(a1,Kv),le(wi,"sampleCoverage",[1,!1]),ye(i1,Hv),le(c1,"stencilMask",-1),le(_i,"stencilFunc",[tg,0,-1]),le(xi,"stencilOpSeparate",[Ts,Br,Br,Br]),le(gs,"stencilOpSeparate",[un,Br,Br,Br]),ye(l1,Zv),le(bo,"scissor",[0,0,f.drawingBufferWidth,f.drawingBufferHeight]),le(Mr,Mr,[0,0,f.drawingBufferWidth,f.drawingBufferHeight]);var be={gl:f,context:ge,strings:v,next:_e,current:Ee,draw:he,elements:X,buffer:J,shader:me,attributes:de.state,vao:de,uniforms:ae,framebuffer:ie,extensions:S,timer:ce,isBufferArgs:Oo},we={primTypes:kr,compareFuncs:Vn,blendFuncs:wr,blendEquations:H,stencilOps:zr,glTypes:tn,orientationType:Oi};y.optional(function(){be.isArrayLike=dt}),Se&&(we.backBuffer=[un],we.drawBuffer=nr(U.maxDrawbuffers,function(w){return w===0?[0]:nr(w,function(m){return ng+m})}));var je=0;function qe(){var w=Dv(),m=w.link,T=w.global;w.id=je++,w.batchId="0";var D=m(be),I=w.shared={props:"a0"};Object.keys(be).forEach(function(A){I[A]=T.def(D,".",A)}),y.optional(function(){w.CHECK=m(y),w.commandStr=y.guessCommand(),w.command=m(w.commandStr),w.assert=function(A,x,z){A("if(!(",x,"))",this.CHECK,".commandRaise(",m(z),",",this.command,");")},we.invalidBlendCombinations=b1});var O=w.next={},M=w.current={};Object.keys(K).forEach(function(A){Array.isArray(Ee[A])&&(O[A]=T.def(I.next,".",A),M[A]=T.def(I.current,".",A))});var N=w.constants={};Object.keys(we).forEach(function(A){N[A]=T.def(JSON.stringify(we[A]))}),w.invoke=function(A,x){switch(x.type){case fi:var z=["this",I.context,I.props,w.batchId];return A.def(m(x.data),".call(",z.slice(0,Math.max(x.data.length+1,4)),")");case ui:return A.def(I.props,x.data);case di:return A.def(I.context,x.data);case hi:return A.def("this",x.data);case yo:return x.data.append(w,A),x.data.ref;case Hf:return x.data.toString();case Yf:return x.data.map(function(B){return w.invoke(A,B)})}},w.attribCache={};var _={};return w.scopeAttrib=function(A){var x=v.id(A);if(x in _)return _[x];var z=de.scope[x];z||(z=de.scope[x]=new k);var B=_[x]=m(z);return B},w}function xe(w){var m=w.static,T=w.dynamic,D;if(ys in m){var I=!!m[ys];D=xt(function(M,N){return I}),D.enable=I}else if(ys in T){var O=T[ys];D=Wt(O,function(M,N){return M.invoke(N,O)})}return D}function Ae(w,m){var T=w.static,D=w.dynamic;if(an in T){var I=T[an];return I?(I=ie.getFramebuffer(I),y.command(I,"invalid framebuffer object"),xt(function(M,N){var _=M.link(I),A=M.shared;N.set(A.framebuffer,".next",_);var x=A.context;return N.set(x,"."+In,_+".width"),N.set(x,"."+Bn,_+".height"),_})):xt(function(M,N){var _=M.shared;N.set(_.framebuffer,".next","null");var A=_.context;return N.set(A,"."+In,A+"."+u1),N.set(A,"."+Bn,A+"."+d1),"null"})}else if(an in D){var O=D[an];return Wt(O,function(M,N){var _=M.invoke(N,O),A=M.shared,x=A.framebuffer,z=N.def(x,".getFramebuffer(",_,")");y.optional(function(){M.assert(N,"!"+_+"||"+z,"invalid framebuffer object")}),N.set(x,".next",z);var B=A.context;return N.set(B,"."+In,z+"?"+z+".width:"+B+"."+u1),N.set(B,"."+Bn,z+"?"+z+".height:"+B+"."+d1),z})}else return null}function ke(w,m,T){var D=w.static,I=w.dynamic;function O(_){if(_ in D){var A=D[_];y.commandType(A,"object","invalid "+_,T.commandStr);var x=!0,z=A.x|0,B=A.y|0,W,re;return"width"in A?(W=A.width|0,y.command(W>=0,"invalid "+_,T.commandStr)):x=!1,"height"in A?(re=A.height|0,y.command(re>=0,"invalid "+_,T.commandStr)):x=!1,new Ct(!x&&m&&m.thisDep,!x&&m&&m.contextDep,!x&&m&&m.propDep,function(Fe,Pe){var ne=Fe.shared.context,Z=W;"width"in A||(Z=Pe.def(ne,".",In,"-",z));var Le=re;return"height"in A||(Le=Pe.def(ne,".",Bn,"-",B)),[z,B,Z,Le]})}else if(_ in I){var ve=I[_],Be=Wt(ve,function(Fe,Pe){var ne=Fe.invoke(Pe,ve);y.optional(function(){Fe.assert(Pe,ne+"&&typeof "+ne+'==="object"',"invalid "+_)});var Z=Fe.shared.context,Le=Pe.def(ne,".x|0"),Oe=Pe.def(ne,".y|0"),Ie=Pe.def('"width" in ',ne,"?",ne,".width|0:","(",Z,".",In,"-",Le,")"),at=Pe.def('"height" in ',ne,"?",ne,".height|0:","(",Z,".",Bn,"-",Oe,")");return y.optional(function(){Fe.assert(Pe,Ie+">=0&&"+at+">=0","invalid "+_)}),[Le,Oe,Ie,at]});return m&&(Be.thisDep=Be.thisDep||m.thisDep,Be.contextDep=Be.contextDep||m.contextDep,Be.propDep=Be.propDep||m.propDep),Be}else return m?new Ct(m.thisDep,m.contextDep,m.propDep,function(Fe,Pe){var ne=Fe.shared.context;return[0,0,Pe.def(ne,".",In),Pe.def(ne,".",Bn)]}):null}var M=O(Mr);if(M){var N=M;M=new Ct(M.thisDep,M.contextDep,M.propDep,function(_,A){var x=N.append(_,A),z=_.shared.context;return A.set(z,"."+kv,x[2]),A.set(z,"."+Iv,x[3]),x})}return{viewport:M,scissor_box:O(bo)}}function He(w,m){var T=w.static,D=typeof T[ws]=="string"&&typeof T[bs]=="string";if(D){if(Object.keys(m.dynamic).length>0)return null;var I=m.static,O=Object.keys(I);if(O.length>0&&typeof I[O[0]]=="number"){for(var M=[],N=0;N<O.length;++N)y(typeof I[O[N]]=="number","must specify all vertex attribute locations when using vaos"),M.push([I[O[N]]|0,O[N]]);return M}}return null}function Qe(w,m,T){var D=w.static,I=w.dynamic;function O(x){if(x in D){var z=v.id(D[x]);y.optional(function(){me.shader(w1[x],z,y.guessCommand())});var B=xt(function(){return z});return B.id=z,B}else if(x in I){var W=I[x];return Wt(W,function(re,ve){var Be=re.invoke(ve,W),Fe=ve.def(re.shared.strings,".id(",Be,")");return y.optional(function(){ve(re.shared.shader,".shader(",w1[x],",",Fe,",",re.command,");")}),Fe})}return null}var M=O(ws),N=O(bs),_=null,A;return Vr(M)&&Vr(N)?(_=me.program(N.id,M.id,null,T),A=xt(function(x,z){return x.link(_)})):A=new Ct(M&&M.thisDep||N&&N.thisDep,M&&M.contextDep||N&&N.contextDep,M&&M.propDep||N&&N.propDep,function(x,z){var B=x.shared.shader,W;M?W=M.append(x,z):W=z.def(B,".",ws);var re;N?re=N.append(x,z):re=z.def(B,".",bs);var ve=B+".program("+re+","+W;return y.optional(function(){ve+=","+x.command}),z.def(ve+")")}),{frag:M,vert:N,progVar:A,program:_}}function ht(w,m){var T=w.static,D=w.dynamic,I={},O=!1;function M(){if(_s in T){var Pe=T[_s];return Pe!==null&&de.getVAO(Pe)===null&&(Pe=de.createVAO(Pe)),O=!0,I.vao=Pe,xt(function(Z){var Le=de.getVAO(Pe);return Le?Z.link(Le):"null"})}else if(_s in D){O=!0;var ne=D[_s];return Wt(ne,function(Z,Le){var Oe=Z.invoke(Le,ne);return Le.def(Z.shared.vao+".getVAO("+Oe+")")})}return null}var N=M(),_=!1;function A(){if(cn in T){var Pe=T[cn];if(I.elements=Pe,Oo(Pe)){var ne=I.elements=X.create(Pe,!0);Pe=X.getElements(ne),_=!0}else Pe&&(Pe=X.getElements(Pe),_=!0,y.command(Pe,"invalid elements",m.commandStr));var Z=xt(function(Oe,Ie){if(Pe){var at=Oe.link(Pe);return Oe.ELEMENTS=at,at}return Oe.ELEMENTS=null,null});return Z.value=Pe,Z}else if(cn in D){_=!0;var Le=D[cn];return Wt(Le,function(Oe,Ie){var at=Oe.shared,Bt=at.isBufferArgs,hn=at.elements,Cr=Oe.invoke(Ie,Le),xr=Ie.def("null"),qr=Ie.def(Bt,"(",Cr,")"),mn=Oe.cond(qr).then(xr,"=",hn,".createStream(",Cr,");").else(xr,"=",hn,".getElements(",Cr,");");return y.optional(function(){Oe.assert(mn.else,"!"+Cr+"||"+xr,"invalid elements")}),Ie.entry(mn),Ie.exit(Oe.cond(qr).then(hn,".destroyStream(",xr,");")),Oe.ELEMENTS=xr,xr})}else if(O)return new Ct(N.thisDep,N.contextDep,N.propDep,function(Oe,Ie){return Ie.def(Oe.shared.vao+".currentVAO?"+Oe.shared.elements+".getElements("+Oe.shared.vao+".currentVAO.elements):null")});return null}var x=A();function z(){if(ln in T){var Pe=T[ln];return I.primitive=Pe,y.commandParameter(Pe,kr,"invalid primitve",m.commandStr),xt(function(Z,Le){return kr[Pe]})}else if(ln in D){var ne=D[ln];return Wt(ne,function(Z,Le){var Oe=Z.constants.primTypes,Ie=Z.invoke(Le,ne);return y.optional(function(){Z.assert(Le,Ie+" in "+Oe,"invalid primitive, must be one of "+Object.keys(kr))}),Le.def(Oe,"[",Ie,"]")})}else{if(_)return Vr(x)?x.value?xt(function(Z,Le){return Le.def(Z.ELEMENTS,".primType")}):xt(function(){return Mi}):new Ct(x.thisDep,x.contextDep,x.propDep,function(Z,Le){var Oe=Z.ELEMENTS;return Le.def(Oe,"?",Oe,".primType:",Mi)});if(O)return new Ct(N.thisDep,N.contextDep,N.propDep,function(Z,Le){return Le.def(Z.shared.vao+".currentVAO?"+Z.shared.vao+".currentVAO.primitive:"+Mi)})}return null}function B(Pe,ne){if(Pe in T){var Z=T[Pe]|0;return ne?I.offset=Z:I.instances=Z,y.command(!ne||Z>=0,"invalid "+Pe,m.commandStr),xt(function(Oe,Ie){return ne&&(Oe.OFFSET=Z),Z})}else if(Pe in D){var Le=D[Pe];return Wt(Le,function(Oe,Ie){var at=Oe.invoke(Ie,Le);return ne&&(Oe.OFFSET=at,y.optional(function(){Oe.assert(Ie,at+">=0","invalid "+Pe)})),at})}else if(ne){if(_)return xt(function(Oe,Ie){return Oe.OFFSET=0,0});if(O)return new Ct(N.thisDep,N.contextDep,N.propDep,function(Oe,Ie){return Ie.def(Oe.shared.vao+".currentVAO?"+Oe.shared.vao+".currentVAO.offset:0")})}else if(O)return new Ct(N.thisDep,N.contextDep,N.propDep,function(Oe,Ie){return Ie.def(Oe.shared.vao+".currentVAO?"+Oe.shared.vao+".currentVAO.instances:-1")});return null}var W=B(wo,!0);function re(){if(fn in T){var Pe=T[fn]|0;return I.count=Pe,y.command(typeof Pe=="number"&&Pe>=0,"invalid vertex count",m.commandStr),xt(function(){return Pe})}else if(fn in D){var ne=D[fn];return Wt(ne,function(Ie,at){var Bt=Ie.invoke(at,ne);return y.optional(function(){Ie.assert(at,"typeof "+Bt+'==="number"&&'+Bt+">=0&&"+Bt+"===("+Bt+"|0)","invalid vertex count")}),Bt})}else if(_)if(Vr(x)){if(x)return W?new Ct(W.thisDep,W.contextDep,W.propDep,function(Ie,at){var Bt=at.def(Ie.ELEMENTS,".vertCount-",Ie.OFFSET);return y.optional(function(){Ie.assert(at,Bt+">=0","invalid vertex offset/element buffer too small")}),Bt}):xt(function(Ie,at){return at.def(Ie.ELEMENTS,".vertCount")});var Z=xt(function(){return-1});return y.optional(function(){Z.MISSING=!0}),Z}else{var Le=new Ct(x.thisDep||W.thisDep,x.contextDep||W.contextDep,x.propDep||W.propDep,function(Ie,at){var Bt=Ie.ELEMENTS;return Ie.OFFSET?at.def(Bt,"?",Bt,".vertCount-",Ie.OFFSET,":-1"):at.def(Bt,"?",Bt,".vertCount:-1")});return y.optional(function(){Le.DYNAMIC=!0}),Le}else if(O){var Oe=new Ct(N.thisDep,N.contextDep,N.propDep,function(Ie,at){return at.def(Ie.shared.vao,".currentVAO?",Ie.shared.vao,".currentVAO.count:-1")});return Oe}return null}var ve=z(),Be=re(),Fe=B(_o,!1);return{elements:x,primitive:ve,count:Be,instances:Fe,offset:W,vao:N,vaoActive:O,elementsActive:_,static:I}}function pt(w,m){var T=w.static,D=w.dynamic,I={};return Ge.forEach(function(O){var M=Ce(O);function N(_,A){if(O in T){var x=_(T[O]);I[M]=xt(function(){return x})}else if(O in D){var z=D[O];I[M]=Wt(z,function(B,W){return A(B,W,B.invoke(W,z))})}}switch(O){case r1:case Wf:case Zf:case i1:case Kf:case l1:case s1:case o1:case a1:case t1:return N(function(_){return y.commandType(_,"boolean",O,m.commandStr),_},function(_,A,x){return y.optional(function(){_.assert(A,"typeof "+x+'==="boolean"',"invalid flag "+O,_.commandStr)}),x});case Jf:return N(function(_){return y.commandParameter(_,Vn,"invalid "+O,m.commandStr),Vn[_]},function(_,A,x){var z=_.constants.compareFuncs;return y.optional(function(){_.assert(A,x+" in "+z,"invalid "+O+", must be one of "+Object.keys(Vn))}),A.def(z,"[",x,"]")});case e1:return N(function(_){return y.command(dt(_)&&_.length===2&&typeof _[0]=="number"&&typeof _[1]=="number"&&_[0]<=_[1],"depth range is 2d array",m.commandStr),_},function(_,A,x){y.optional(function(){_.assert(A,_.shared.isArrayLike+"("+x+")&&"+x+".length===2&&typeof "+x+'[0]==="number"&&typeof '+x+'[1]==="number"&&'+x+"[0]<="+x+"[1]","depth range must be a 2d array")});var z=A.def("+",x,"[0]"),B=A.def("+",x,"[1]");return[z,B]});case pi:return N(function(_){y.commandType(_,"object","blend.func",m.commandStr);var A="srcRGB"in _?_.srcRGB:_.src,x="srcAlpha"in _?_.srcAlpha:_.src,z="dstRGB"in _?_.dstRGB:_.dst,B="dstAlpha"in _?_.dstAlpha:_.dst;return y.commandParameter(A,wr,M+".srcRGB",m.commandStr),y.commandParameter(x,wr,M+".srcAlpha",m.commandStr),y.commandParameter(z,wr,M+".dstRGB",m.commandStr),y.commandParameter(B,wr,M+".dstAlpha",m.commandStr),y.command(b1.indexOf(A+", "+z)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+A+", "+z+")",m.commandStr),[wr[A],wr[z],wr[x],wr[B]]},function(_,A,x){var z=_.constants.blendFuncs;y.optional(function(){_.assert(A,x+"&&typeof "+x+'==="object"',"invalid blend func, must be an object")});function B(ne,Z){var Le=A.def('"',ne,Z,'" in ',x,"?",x,".",ne,Z,":",x,".",ne);return y.optional(function(){_.assert(A,Le+" in "+z,"invalid "+O+"."+ne+Z+", must be one of "+Object.keys(wr))}),Le}var W=B("src","RGB"),re=B("dst","RGB");y.optional(function(){var ne=_.constants.invalidBlendCombinations;_.assert(A,ne+".indexOf("+W+'+", "+'+re+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var ve=A.def(z,"[",W,"]"),Be=A.def(z,"[",B("src","Alpha"),"]"),Fe=A.def(z,"[",re,"]"),Pe=A.def(z,"[",B("dst","Alpha"),"]");return[ve,Fe,Be,Pe]});case mi:return N(function(_){if(typeof _=="string")return y.commandParameter(_,H,"invalid "+O,m.commandStr),[H[_],H[_]];if(typeof _=="object")return y.commandParameter(_.rgb,H,O+".rgb",m.commandStr),y.commandParameter(_.alpha,H,O+".alpha",m.commandStr),[H[_.rgb],H[_.alpha]];y.commandRaise("invalid blend.equation",m.commandStr)},function(_,A,x){var z=_.constants.blendEquations,B=A.def(),W=A.def(),re=_.cond("typeof ",x,'==="string"');return y.optional(function(){function ve(Be,Fe,Pe){_.assert(Be,Pe+" in "+z,"invalid "+Fe+", must be one of "+Object.keys(H))}ve(re.then,O,x),_.assert(re.else,x+"&&typeof "+x+'==="object"',"invalid "+O),ve(re.else,O+".rgb",x+".rgb"),ve(re.else,O+".alpha",x+".alpha")}),re.then(B,"=",W,"=",z,"[",x,"];"),re.else(B,"=",z,"[",x,".rgb];",W,"=",z,"[",x,".alpha];"),A(re),[B,W]});case Qf:return N(function(_){return y.command(dt(_)&&_.length===4,"blend.color must be a 4d array",m.commandStr),nr(4,function(A){return+_[A]})},function(_,A,x){return y.optional(function(){_.assert(A,_.shared.isArrayLike+"("+x+")&&"+x+".length===4","blend.color must be a 4d array")}),nr(4,function(z){return A.def("+",x,"[",z,"]")})});case c1:return N(function(_){return y.commandType(_,"number",M,m.commandStr),_|0},function(_,A,x){return y.optional(function(){_.assert(A,"typeof "+x+'==="number"',"invalid stencil.mask")}),A.def(x,"|0")});case _i:return N(function(_){y.commandType(_,"object",M,m.commandStr);var A=_.cmp||"keep",x=_.ref||0,z="mask"in _?_.mask:-1;return y.commandParameter(A,Vn,O+".cmp",m.commandStr),y.commandType(x,"number",O+".ref",m.commandStr),y.commandType(z,"number",O+".mask",m.commandStr),[Vn[A],x,z]},function(_,A,x){var z=_.constants.compareFuncs;y.optional(function(){function ve(){_.assert(A,Array.prototype.join.call(arguments,""),"invalid stencil.func")}ve(x+"&&typeof ",x,'==="object"'),ve('!("cmp" in ',x,")||(",x,".cmp in ",z,")")});var B=A.def('"cmp" in ',x,"?",z,"[",x,".cmp]",":",Br),W=A.def(x,".ref|0"),re=A.def('"mask" in ',x,"?",x,".mask|0:-1");return[B,W,re]});case xi:case gs:return N(function(_){y.commandType(_,"object",M,m.commandStr);var A=_.fail||"keep",x=_.zfail||"keep",z=_.zpass||"keep";return y.commandParameter(A,zr,O+".fail",m.commandStr),y.commandParameter(x,zr,O+".zfail",m.commandStr),y.commandParameter(z,zr,O+".zpass",m.commandStr),[O===gs?un:Ts,zr[A],zr[x],zr[z]]},function(_,A,x){var z=_.constants.stencilOps;y.optional(function(){_.assert(A,x+"&&typeof "+x+'==="object"',"invalid "+O)});function B(W){return y.optional(function(){_.assert(A,'!("'+W+'" in '+x+")||("+x+"."+W+" in "+z+")","invalid "+O+"."+W+", must be one of "+Object.keys(zr))}),A.def('"',W,'" in ',x,"?",z,"[",x,".",W,"]:",Br)}return[O===gs?un:Ts,B("fail"),B("zfail"),B("zpass")]});case bi:return N(function(_){y.commandType(_,"object",M,m.commandStr);var A=_.factor|0,x=_.units|0;return y.commandType(A,"number",M+".factor",m.commandStr),y.commandType(x,"number",M+".units",m.commandStr),[A,x]},function(_,A,x){y.optional(function(){_.assert(A,x+"&&typeof "+x+'==="object"',"invalid "+O)});var z=A.def(x,".factor|0"),B=A.def(x,".units|0");return[z,B]});case n1:return N(function(_){var A=0;return _==="front"?A=Ts:_==="back"&&(A=un),y.command(!!A,M,m.commandStr),A},function(_,A,x){return y.optional(function(){_.assert(A,x+'==="front"||'+x+'==="back"',"invalid cull.face")}),A.def(x,'==="front"?',Ts,":",un)});case yi:return N(function(_){return y.command(typeof _=="number"&&_>=U.lineWidthDims[0]&&_<=U.lineWidthDims[1],"invalid line width, must be a positive number between "+U.lineWidthDims[0]+" and "+U.lineWidthDims[1],m.commandStr),_},function(_,A,x){return y.optional(function(){_.assert(A,"typeof "+x+'==="number"&&'+x+">="+U.lineWidthDims[0]+"&&"+x+"<="+U.lineWidthDims[1],"invalid line width")}),x});case gi:return N(function(_){return y.commandParameter(_,Oi,M,m.commandStr),Oi[_]},function(_,A,x){return y.optional(function(){_.assert(A,x+'==="cw"||'+x+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),A.def(x+'==="cw"?'+m1+":"+Ci)});case vi:return N(function(_){return y.command(dt(_)&&_.length===4,"color.mask must be length 4 array",m.commandStr),_.map(function(A){return!!A})},function(_,A,x){return y.optional(function(){_.assert(A,_.shared.isArrayLike+"("+x+")&&"+x+".length===4","invalid color.mask")}),nr(4,function(z){return"!!"+x+"["+z+"]"})});case wi:return N(function(_){y.command(typeof _=="object"&&_,M,m.commandStr);var A="value"in _?_.value:1,x=!!_.invert;return y.command(typeof A=="number"&&A>=0&&A<=1,"sample.coverage.value must be a number between 0 and 1",m.commandStr),[A,x]},function(_,A,x){y.optional(function(){_.assert(A,x+"&&typeof "+x+'==="object"',"invalid sample.coverage")});var z=A.def('"value" in ',x,"?+",x,".value:1"),B=A.def("!!",x,".invert");return[z,B]})}}),I}function tt(w,m){var T=w.static,D=w.dynamic,I={};return Object.keys(T).forEach(function(O){var M=T[O],N;if(typeof M=="number"||typeof M=="boolean")N=xt(function(){return M});else if(typeof M=="function"){var _=M._reglType;_==="texture2d"||_==="textureCube"?N=xt(function(A){return A.link(M)}):_==="framebuffer"||_==="framebufferCube"?(y.command(M.color.length>0,'missing color attachment for framebuffer sent to uniform "'+O+'"',m.commandStr),N=xt(function(A){return A.link(M.color[0])})):y.commandRaise('invalid data for uniform "'+O+'"',m.commandStr)}else dt(M)?N=xt(function(A){var x=A.global.def("[",nr(M.length,function(z){return y.command(typeof M[z]=="number"||typeof M[z]=="boolean","invalid uniform "+O,A.commandStr),M[z]}),"]");return x}):y.commandRaise('invalid or missing data for uniform "'+O+'"',m.commandStr);N.value=M,I[O]=N}),Object.keys(D).forEach(function(O){var M=D[O];I[O]=Wt(M,function(N,_){return N.invoke(_,M)})}),I}function At(w,m){var T=w.static,D=w.dynamic,I={};return Object.keys(T).forEach(function(O){var M=T[O],N=v.id(O),_=new k;if(Oo(M))_.state=kn,_.buffer=J.getBuffer(J.create(M,zn,!1,!0)),_.type=0;else{var A=J.getBuffer(M);if(A)_.state=kn,_.buffer=A,_.type=0;else if(y.command(typeof M=="object"&&M,"invalid data for attribute "+O,m.commandStr),"constant"in M){var x=M.constant;_.buffer="null",_.state=li,typeof x=="number"?_.x=x:(y.command(dt(x)&&x.length>0&&x.length<=4,"invalid constant for attribute "+O,m.commandStr),Dn.forEach(function(Fe,Pe){Pe<x.length&&(_[Fe]=x[Pe])}))}else{Oo(M.buffer)?A=J.getBuffer(J.create(M.buffer,zn,!1,!0)):A=J.getBuffer(M.buffer),y.command(!!A,'missing buffer for attribute "'+O+'"',m.commandStr);var z=M.offset|0;y.command(z>=0,'invalid offset for attribute "'+O+'"',m.commandStr);var B=M.stride|0;y.command(B>=0&&B<256,'invalid stride for attribute "'+O+'", must be integer betweeen [0, 255]',m.commandStr);var W=M.size|0;y.command(!("size"in M)||W>0&&W<=4,'invalid size for attribute "'+O+'", must be 1,2,3,4',m.commandStr);var re=!!M.normalized,ve=0;"type"in M&&(y.commandParameter(M.type,tn,"invalid type for attribute "+O,m.commandStr),ve=tn[M.type]);var Be=M.divisor|0;y.optional(function(){"divisor"in M&&(y.command(Be===0||fe,'cannot specify divisor for attribute "'+O+'", instancing not supported',m.commandStr),y.command(Be>=0,'invalid divisor for attribute "'+O+'"',m.commandStr));var Fe=m.commandStr,Pe=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(M).forEach(function(ne){y.command(Pe.indexOf(ne)>=0,'unknown parameter "'+ne+'" for attribute pointer "'+O+'" (valid parameters are '+Pe+")",Fe)})}),_.buffer=A,_.state=kn,_.size=W,_.normalized=re,_.type=ve||A.dtype,_.offset=z,_.stride=B,_.divisor=Be}}I[O]=xt(function(Fe,Pe){var ne=Fe.attribCache;if(N in ne)return ne[N];var Z={isStream:!1};return Object.keys(_).forEach(function(Le){Z[Le]=_[Le]}),_.buffer&&(Z.buffer=Fe.link(_.buffer),Z.type=Z.type||Z.buffer+".dtype"),ne[N]=Z,Z})}),Object.keys(D).forEach(function(O){var M=D[O];function N(_,A){var x=_.invoke(A,M),z=_.shared,B=_.constants,W=z.isBufferArgs,re=z.buffer;y.optional(function(){_.assert(A,x+"&&(typeof "+x+'==="object"||typeof '+x+'==="function")&&('+W+"("+x+")||"+re+".getBuffer("+x+")||"+re+".getBuffer("+x+".buffer)||"+W+"("+x+'.buffer)||("constant" in '+x+"&&(typeof "+x+'.constant==="number"||'+z.isArrayLike+"("+x+".constant))))",'invalid dynamic attribute "'+O+'"')});var ve={isStream:A.def(!1)},Be=new k;Be.state=kn,Object.keys(Be).forEach(function(Z){ve[Z]=A.def(""+Be[Z])});var Fe=ve.buffer,Pe=ve.type;A("if(",W,"(",x,")){",ve.isStream,"=true;",Fe,"=",re,".createStream(",zn,",",x,");",Pe,"=",Fe,".dtype;","}else{",Fe,"=",re,".getBuffer(",x,");","if(",Fe,"){",Pe,"=",Fe,".dtype;",'}else if("constant" in ',x,"){",ve.state,"=",li,";","if(typeof "+x+'.constant === "number"){',ve[Dn[0]],"=",x,".constant;",Dn.slice(1).map(function(Z){return ve[Z]}).join("="),"=0;","}else{",Dn.map(function(Z,Le){return ve[Z]+"="+x+".constant.length>"+Le+"?"+x+".constant["+Le+"]:0;"}).join(""),"}}else{","if(",W,"(",x,".buffer)){",Fe,"=",re,".createStream(",zn,",",x,".buffer);","}else{",Fe,"=",re,".getBuffer(",x,".buffer);","}",Pe,'="type" in ',x,"?",B.glTypes,"[",x,".type]:",Fe,".dtype;",ve.normalized,"=!!",x,".normalized;");function ne(Z){A(ve[Z],"=",x,".",Z,"|0;")}return ne("size"),ne("offset"),ne("stride"),ne("divisor"),A("}}"),A.exit("if(",ve.isStream,"){",re,".destroyStream(",Fe,");","}"),ve}I[O]=Wt(M,N)}),I}function lt(w){var m=w.static,T=w.dynamic,D={};return Object.keys(m).forEach(function(I){var O=m[I];D[I]=xt(function(M,N){return typeof O=="number"||typeof O=="boolean"?""+O:M.link(O)})}),Object.keys(T).forEach(function(I){var O=T[I];D[I]=Wt(O,function(M,N){return M.invoke(N,O)})}),D}function Et(w,m,T,D,I){var O=w.static,M=w.dynamic;y.optional(function(){var ne=[an,bs,ws,cn,ln,wo,fn,_o,ys,_s].concat(Ge);function Z(Le){Object.keys(Le).forEach(function(Oe){y.command(ne.indexOf(Oe)>=0,'unknown parameter "'+Oe+'"',I.commandStr)})}Z(O),Z(M)});var N=He(w,m),_=Ae(w),A=ke(w,_,I),x=ht(w,I),z=pt(w,I),B=Qe(w,I,N);function W(ne){var Z=A[ne];Z&&(z[ne]=Z)}W(Mr),W(Ce(bo));var re=Object.keys(z).length>0,ve={framebuffer:_,draw:x,shader:B,state:z,dirty:re,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(ve.profile=xe(w),ve.uniforms=tt(T,I),ve.drawVAO=ve.scopeVAO=x.vao,!ve.drawVAO&&B.program&&!N&&S.angle_instanced_arrays&&x.static.elements){var Be=!0,Fe=B.program.attributes.map(function(ne){var Z=m.static[ne];return Be=Be&&!!Z,Z});if(Be&&Fe.length>0){var Pe=de.getVAO(de.createVAO({attributes:Fe,elements:x.static.elements}));ve.drawVAO=new Ct(null,null,null,function(ne,Z){return ne.link(Pe)}),ve.useVAO=!0}}return N?ve.useVAO=!0:ve.attributes=At(m,I),ve.context=lt(D),ve}function St(w,m,T){var D=w.shared,I=D.context,O=w.scope();Object.keys(T).forEach(function(M){m.save(I,"."+M);var N=T[M],_=N.append(w,m);Array.isArray(_)?O(I,".",M,"=[",_.join(),"];"):O(I,".",M,"=",_,";")}),m(O)}function Tt(w,m,T,D){var I=w.shared,O=I.gl,M=I.framebuffer,N;Se&&(N=m.def(I.extensions,".webgl_draw_buffers"));var _=w.constants,A=_.drawBuffer,x=_.backBuffer,z;T?z=T.append(w,m):z=m.def(M,".next"),D||m("if(",z,"!==",M,".cur){"),m("if(",z,"){",O,".bindFramebuffer(",y1,",",z,".framebuffer);"),Se&&m(N,".drawBuffersWEBGL(",A,"[",z,".colorAttachments.length]);"),m("}else{",O,".bindFramebuffer(",y1,",null);"),Se&&m(N,".drawBuffersWEBGL(",x,");"),m("}",M,".cur=",z,";"),D||m("}")}function Ft(w,m,T){var D=w.shared,I=D.gl,O=w.current,M=w.next,N=D.current,_=D.next,A=w.cond(N,".dirty");Ge.forEach(function(x){var z=Ce(x);if(!(z in T.state)){var B,W;if(z in M){B=M[z],W=O[z];var re=nr(Ee[z].length,function(Be){return A.def(B,"[",Be,"]")});A(w.cond(re.map(function(Be,Fe){return Be+"!=="+W+"["+Fe+"]"}).join("||")).then(I,".",K[z],"(",re,");",re.map(function(Be,Fe){return W+"["+Fe+"]="+Be}).join(";"),";"))}else{B=A.def(_,".",z);var ve=w.cond(B,"!==",N,".",z);A(ve),z in te?ve(w.cond(B).then(I,".enable(",te[z],");").else(I,".disable(",te[z],");"),N,".",z,"=",B,";"):ve(I,".",K[z],"(",B,");",N,".",z,"=",B,";")}}}),Object.keys(T.state).length===0&&A(N,".dirty=false;"),m(A)}function kt(w,m,T,D){var I=w.shared,O=w.current,M=I.current,N=I.gl;_1(Object.keys(T)).forEach(function(_){var A=T[_];if(!(D&&!D(A))){var x=A.append(w,m);if(te[_]){var z=te[_];Vr(A)?x?m(N,".enable(",z,");"):m(N,".disable(",z,");"):m(w.cond(x).then(N,".enable(",z,");").else(N,".disable(",z,");")),m(M,".",_,"=",x,";")}else if(dt(x)){var B=O[_];m(N,".",K[_],"(",x,");",x.map(function(W,re){return B+"["+re+"]="+W}).join(";"),";")}else m(N,".",K[_],"(",x,");",M,".",_,"=",x,";")}})}function gt(w,m){fe&&(w.instancing=m.def(w.shared.extensions,".angle_instanced_arrays"))}function Ye(w,m,T,D,I){var O=w.shared,M=w.stats,N=O.current,_=O.timer,A=T.profile;function x(){return typeof performance>"u"?"Date.now()":"performance.now()"}var z,B;function W(ne){z=m.def(),ne(z,"=",x(),";"),typeof I=="string"?ne(M,".count+=",I,";"):ne(M,".count++;"),ce&&(D?(B=m.def(),ne(B,"=",_,".getNumPendingQueries();")):ne(_,".beginQuery(",M,");"))}function re(ne){ne(M,".cpuTime+=",x(),"-",z,";"),ce&&(D?ne(_,".pushScopeStats(",B,",",_,".getNumPendingQueries(),",M,");"):ne(_,".endQuery();"))}function ve(ne){var Z=m.def(N,".profile");m(N,".profile=",ne,";"),m.exit(N,".profile=",Z,";")}var Be;if(A){if(Vr(A)){A.enable?(W(m),re(m.exit),ve("true")):ve("false");return}Be=A.append(w,m),ve(Be)}else Be=m.def(N,".profile");var Fe=w.block();W(Fe),m("if(",Be,"){",Fe,"}");var Pe=w.block();re(Pe),m.exit("if(",Be,"){",Pe,"}")}function It(w,m,T,D,I){var O=w.shared;function M(_){switch(_){case xo:case Ao:case Po:return 2;case Eo:case So:case Mo:return 3;case $o:case To:case Co:return 4;default:return 1}}function N(_,A,x){var z=O.gl,B=m.def(_,".location"),W=m.def(O.attributes,"[",B,"]"),re=x.state,ve=x.buffer,Be=[x.x,x.y,x.z,x.w],Fe=["buffer","normalized","offset","stride"];function Pe(){m("if(!",W,".buffer){",z,".enableVertexAttribArray(",B,");}");var Z=x.type,Le;if(x.size?Le=m.def(x.size,"||",A):Le=A,m("if(",W,".type!==",Z,"||",W,".size!==",Le,"||",Fe.map(function(Ie){return W+"."+Ie+"!=="+x[Ie]}).join("||"),"){",z,".bindBuffer(",zn,",",ve,".buffer);",z,".vertexAttribPointer(",[B,Le,Z,x.normalized,x.stride,x.offset],");",W,".type=",Z,";",W,".size=",Le,";",Fe.map(function(Ie){return W+"."+Ie+"="+x[Ie]+";"}).join(""),"}"),fe){var Oe=x.divisor;m("if(",W,".divisor!==",Oe,"){",w.instancing,".vertexAttribDivisorANGLE(",[B,Oe],");",W,".divisor=",Oe,";}")}}function ne(){m("if(",W,".buffer){",z,".disableVertexAttribArray(",B,");",W,".buffer=null;","}if(",Dn.map(function(Z,Le){return W+"."+Z+"!=="+Be[Le]}).join("||"),"){",z,".vertexAttrib4f(",B,",",Be,");",Dn.map(function(Z,Le){return W+"."+Z+"="+Be[Le]+";"}).join(""),"}")}re===kn?Pe():re===li?ne():(m("if(",re,"===",kn,"){"),Pe(),m("}else{"),ne(),m("}"))}D.forEach(function(_){var A=_.name,x=T.attributes[A],z;if(x){if(!I(x))return;z=x.append(w,m)}else{if(!I(x1))return;var B=w.scopeAttrib(A);y.optional(function(){w.assert(m,B+".state","missing attribute "+A)}),z={},Object.keys(new k).forEach(function(W){z[W]=m.def(B,".",W)})}N(w.link(_),M(_.info.type),z)})}function ot(w,m,T,D,I,O){for(var M=w.shared,N=M.gl,_={},A,x=0;x<D.length;++x){var z=D[x],B=z.name,W=z.info.type,re=z.info.size,ve=T.uniforms[B];if(re>1){if(!ve)continue;var Be=B.replace("[0]","");if(_[Be])continue;_[Be]=1}var Fe=w.link(z),Pe=Fe+".location",ne;if(ve){if(!I(ve))continue;if(Vr(ve)){var Z=ve.value;if(y.command(Z!==null&&typeof Z<"u",'missing uniform "'+B+'"',w.commandStr),W===As||W===Ss){y.command(typeof Z=="function"&&(W===As&&(Z._reglType==="texture2d"||Z._reglType==="framebuffer")||W===Ss&&(Z._reglType==="textureCube"||Z._reglType==="framebufferCube")),"invalid texture for uniform "+B,w.commandStr);var Le=w.link(Z._texture||Z.color[0]._texture);m(N,".uniform1i(",Pe,",",Le+".bind());"),m.exit(Le,".unbind();")}else if(W===xs||W===Es||W===$s){y.optional(function(){y.command(dt(Z),"invalid matrix for uniform "+B,w.commandStr),y.command(W===xs&&Z.length===4||W===Es&&Z.length===9||W===$s&&Z.length===16,"invalid length for matrix uniform "+B,w.commandStr)});var Oe=w.global.def("new Float32Array(["+Array.prototype.slice.call(Z)+"])"),Ie=2;W===Es?Ie=3:W===$s&&(Ie=4),m(N,".uniformMatrix",Ie,"fv(",Pe,",false,",Oe,");")}else{switch(W){case Si:re===1?y.commandType(Z,"number","uniform "+B,w.commandStr):y.command(dt(Z)&&Z.length===re,"uniform "+B,w.commandStr),A="1f";break;case xo:y.command(dt(Z)&&Z.length&&Z.length%2===0&&Z.length<=re*2,"uniform "+B,w.commandStr),A="2f";break;case Eo:y.command(dt(Z)&&Z.length&&Z.length%3===0&&Z.length<=re*3,"uniform "+B,w.commandStr),A="3f";break;case $o:y.command(dt(Z)&&Z.length&&Z.length%4===0&&Z.length<=re*4,"uniform "+B,w.commandStr),A="4f";break;case Pi:re===1?y.commandType(Z,"boolean","uniform "+B,w.commandStr):y.command(dt(Z)&&Z.length===re,"uniform "+B,w.commandStr),A="1i";break;case Ti:re===1?y.commandType(Z,"number","uniform "+B,w.commandStr):y.command(dt(Z)&&Z.length===re,"uniform "+B,w.commandStr),A="1i";break;case Po:y.command(dt(Z)&&Z.length&&Z.length%2===0&&Z.length<=re*2,"uniform "+B,w.commandStr),A="2i";break;case Ao:y.command(dt(Z)&&Z.length&&Z.length%2===0&&Z.length<=re*2,"uniform "+B,w.commandStr),A="2i";break;case Mo:y.command(dt(Z)&&Z.length&&Z.length%3===0&&Z.length<=re*3,"uniform "+B,w.commandStr),A="3i";break;case So:y.command(dt(Z)&&Z.length&&Z.length%3===0&&Z.length<=re*3,"uniform "+B,w.commandStr),A="3i";break;case Co:y.command(dt(Z)&&Z.length&&Z.length%4===0&&Z.length<=re*4,"uniform "+B,w.commandStr),A="4i";break;case To:y.command(dt(Z)&&Z.length&&Z.length%4===0&&Z.length<=re*4,"uniform "+B,w.commandStr),A="4i";break}re>1?(A+="v",Z=w.global.def("["+Array.prototype.slice.call(Z)+"]")):Z=dt(Z)?Array.prototype.slice.call(Z):Z,m(N,".uniform",A,"(",Pe,",",Z,");")}continue}else ne=ve.append(w,m)}else{if(!I(x1))continue;ne=m.def(M.uniforms,"[",v.id(B),"]")}W===As?(y(!Array.isArray(ne),"must specify a scalar prop for textures"),m("if(",ne,"&&",ne,'._reglType==="framebuffer"){',ne,"=",ne,".color[0];","}")):W===Ss&&(y(!Array.isArray(ne),"must specify a scalar prop for cube maps"),m("if(",ne,"&&",ne,'._reglType==="framebufferCube"){',ne,"=",ne,".color[0];","}")),y.optional(function(){function or(Qt,Ro){w.assert(m,Qt,'bad data or missing for uniform "'+B+'".  '+Ro)}function pn(Qt,Ro){Ro===1&&y(!Array.isArray(ne),"must not specify an array type for uniform"),or("Array.isArray("+ne+") && typeof "+ne+'[0]===" '+Qt+'" || typeof '+ne+'==="'+Qt+'"',"invalid type, expected "+Qt)}function lr(Qt,Ro,Lo){Array.isArray(ne)?y(ne.length&&ne.length%Qt===0&&ne.length<=Qt*Lo,"must have length of "+(Lo===1?"":"n * ")+Qt):or(M.isArrayLike+"("+ne+")&&"+ne+".length && "+ne+".length % "+Qt+" === 0 && "+ne+".length<="+Qt*Lo,"invalid vector, should have length of "+(Lo===1?"":"n * ")+Qt,w.commandStr)}function M1(Qt){y(!Array.isArray(ne),"must not specify a value type"),or("typeof "+ne+'==="function"&&'+ne+'._reglType==="texture'+(Qt===h1?"2d":"Cube")+'"',"invalid texture type",w.commandStr)}switch(W){case Ti:pn("number",re);break;case Ao:lr(2,"number",re);break;case So:lr(3,"number",re);break;case To:lr(4,"number",re);break;case Si:pn("number",re);break;case xo:lr(2,"number",re);break;case Eo:lr(3,"number",re);break;case $o:lr(4,"number",re);break;case Pi:pn("boolean",re);break;case Po:lr(2,"boolean",re);break;case Mo:lr(3,"boolean",re);break;case Co:lr(4,"boolean",re);break;case xs:lr(4,"number",re);break;case Es:lr(9,"number",re);break;case $s:lr(16,"number",re);break;case As:M1(h1);break;case Ss:M1(qv);break}});var at=1;switch(W){case As:case Ss:var Bt=m.def(ne,"._texture");m(N,".uniform1i(",Pe,",",Bt,".bind());"),m.exit(Bt,".unbind();");continue;case Ti:case Pi:A="1i";break;case Ao:case Po:A="2i",at=2;break;case So:case Mo:A="3i",at=3;break;case To:case Co:A="4i",at=4;break;case Si:A="1f";break;case xo:A="2f",at=2;break;case Eo:A="3f",at=3;break;case $o:A="4f",at=4;break;case xs:A="Matrix2fv";break;case Es:A="Matrix3fv";break;case $s:A="Matrix4fv";break}if(A.indexOf("Matrix")===-1&&re>1&&(A+="v",at=1),A.charAt(0)==="M"){m(N,".uniform",A,"(",Pe,",");var hn=Math.pow(W-xs+2,2),Cr=w.global.def("new Float32Array(",hn,")");Array.isArray(ne)?m("false,(",nr(hn,function(or){return Cr+"["+or+"]="+ne[or]}),",",Cr,")"):m("false,(Array.isArray(",ne,")||",ne," instanceof Float32Array)?",ne,":(",nr(hn,function(or){return Cr+"["+or+"]="+ne+"["+or+"]"}),",",Cr,")"),m(");")}else if(at>1){for(var xr=[],qr=[],mn=0;mn<at;++mn)Array.isArray(ne)?qr.push(ne[mn]):qr.push(m.def(ne+"["+mn+"]")),O&&xr.push(m.def());O&&m("if(!",w.batchId,"||",xr.map(function(or,pn){return or+"!=="+qr[pn]}).join("||"),"){",xr.map(function(or,pn){return or+"="+qr[pn]+";"}).join("")),m(N,".uniform",A,"(",Pe,",",qr.join(","),");"),O&&m("}")}else{if(y(!Array.isArray(ne),"uniform value must not be an array"),O){var P1=m.def();m("if(!",w.batchId,"||",P1,"!==",ne,"){",P1,"=",ne,";")}m(N,".uniform",A,"(",Pe,",",ne,");"),O&&m("}")}}}function De(w,m,T,D){var I=w.shared,O=I.gl,M=I.draw,N=D.draw;function _(){var Le=N.elements,Oe,Ie=m;return Le?((Le.contextDep&&D.contextDynamic||Le.propDep)&&(Ie=T),Oe=Le.append(w,Ie),N.elementsActive&&Ie("if("+Oe+")"+O+".bindBuffer("+Ai+","+Oe+".buffer.buffer);")):(Oe=Ie.def(),Ie(Oe,"=",M,".",cn,";","if(",Oe,"){",O,".bindBuffer(",Ai,",",Oe,".buffer.buffer);}","else if(",I.vao,".currentVAO){",Oe,"=",w.shared.elements+".getElements("+I.vao,".currentVAO.elements);",se?"":"if("+Oe+")"+O+".bindBuffer("+Ai+","+Oe+".buffer.buffer);","}")),Oe}function A(){var Le=N.count,Oe,Ie=m;return Le?((Le.contextDep&&D.contextDynamic||Le.propDep)&&(Ie=T),Oe=Le.append(w,Ie),y.optional(function(){Le.MISSING&&w.assert(m,"false","missing vertex count"),Le.DYNAMIC&&w.assert(Ie,Oe+">=0","missing vertex count")})):(Oe=Ie.def(M,".",fn),y.optional(function(){w.assert(Ie,Oe+">=0","missing vertex count")})),Oe}var x=_();function z(Le){var Oe=N[Le];return Oe?Oe.contextDep&&D.contextDynamic||Oe.propDep?Oe.append(w,T):Oe.append(w,m):m.def(M,".",Le)}var B=z(ln),W=z(wo),re=A();if(typeof re=="number"){if(re===0)return}else T("if(",re,"){"),T.exit("}");var ve,Be;fe&&(ve=z(_o),Be=w.instancing);var Fe=x+".type",Pe=N.elements&&Vr(N.elements)&&!N.vaoActive;function ne(){function Le(){T(Be,".drawElementsInstancedANGLE(",[B,re,Fe,W+"<<(("+Fe+"-"+jf+")>>1)",ve],");")}function Oe(){T(Be,".drawArraysInstancedANGLE(",[B,W,re,ve],");")}x&&x!=="null"?Pe?Le():(T("if(",x,"){"),Le(),T("}else{"),Oe(),T("}")):Oe()}function Z(){function Le(){T(O+".drawElements("+[B,re,Fe,W+"<<(("+Fe+"-"+jf+")>>1)"]+");")}function Oe(){T(O+".drawArrays("+[B,W,re]+");")}x&&x!=="null"?Pe?Le():(T("if(",x,"){"),Le(),T("}else{"),Oe(),T("}")):Oe()}fe&&(typeof ve!="number"||ve>=0)?typeof ve=="string"?(T("if(",ve,">0){"),ne(),T("}else if(",ve,"<0){"),Z(),T("}")):ne():Z()}function Ke(w,m,T,D,I){var O=qe(),M=O.proc("body",I);return y.optional(function(){O.commandStr=m.commandStr,O.command=O.link(m.commandStr)}),fe&&(O.instancing=M.def(O.shared.extensions,".angle_instanced_arrays")),w(O,M,T,D),O.compile().body}function nt(w,m,T,D){gt(w,m),T.useVAO?T.drawVAO?m(w.shared.vao,".setVAO(",T.drawVAO.append(w,m),");"):m(w.shared.vao,".setVAO(",w.shared.vao,".targetVAO);"):(m(w.shared.vao,".setVAO(null);"),It(w,m,T,D.attributes,function(){return!0})),ot(w,m,T,D.uniforms,function(){return!0},!1),De(w,m,m,T)}function yt(w,m){var T=w.proc("draw",1);gt(w,T),St(w,T,m.context),Tt(w,T,m.framebuffer),Ft(w,T,m),kt(w,T,m.state),Ye(w,T,m,!1,!0);var D=m.shader.progVar.append(w,T);if(T(w.shared.gl,".useProgram(",D,".program);"),m.shader.program)nt(w,T,m,m.shader.program);else{T(w.shared.vao,".setVAO(null);");var I=w.global.def("{}"),O=T.def(D,".id"),M=T.def(I,"[",O,"]");T(w.cond(M).then(M,".call(this,a0);").else(M,"=",I,"[",O,"]=",w.link(function(N){return Ke(nt,w,m,N,1)}),"(",D,");",M,".call(this,a0);"))}Object.keys(m.state).length>0&&T(w.shared.current,".dirty=true;"),w.shared.vao&&T(w.shared.vao,".setVAO(null);")}function _r(w,m,T,D){w.batchId="a1",gt(w,m);function I(){return!0}It(w,m,T,D.attributes,I),ot(w,m,T,D.uniforms,I,!1),De(w,m,m,T)}function dn(w,m,T,D){gt(w,m);var I=T.contextDep,O=m.def(),M="a0",N="a1",_=m.def();w.shared.props=_,w.batchId=O;var A=w.scope(),x=w.scope();m(A.entry,"for(",O,"=0;",O,"<",N,";++",O,"){",_,"=",M,"[",O,"];",x,"}",A.exit);function z(Fe){return Fe.contextDep&&I||Fe.propDep}function B(Fe){return!z(Fe)}if(T.needsContext&&St(w,x,T.context),T.needsFramebuffer&&Tt(w,x,T.framebuffer),kt(w,x,T.state,z),T.profile&&z(T.profile)&&Ye(w,x,T,!1,!0),D)T.useVAO?T.drawVAO?z(T.drawVAO)?x(w.shared.vao,".setVAO(",T.drawVAO.append(w,x),");"):A(w.shared.vao,".setVAO(",T.drawVAO.append(w,A),");"):A(w.shared.vao,".setVAO(",w.shared.vao,".targetVAO);"):(A(w.shared.vao,".setVAO(null);"),It(w,A,T,D.attributes,B),It(w,x,T,D.attributes,z)),ot(w,A,T,D.uniforms,B,!1),ot(w,x,T,D.uniforms,z,!0),De(w,A,x,T);else{var W=w.global.def("{}"),re=T.shader.progVar.append(w,x),ve=x.def(re,".id"),Be=x.def(W,"[",ve,"]");x(w.shared.gl,".useProgram(",re,".program);","if(!",Be,"){",Be,"=",W,"[",ve,"]=",w.link(function(Fe){return Ke(_r,w,T,Fe,2)}),"(",re,");}",Be,".call(this,a0[",O,"],",O,");")}}function $(w,m){var T=w.proc("batch",2);w.batchId="0",gt(w,T);var D=!1,I=!0;Object.keys(m.context).forEach(function(W){D=D||m.context[W].propDep}),D||(St(w,T,m.context),I=!1);var O=m.framebuffer,M=!1;O?(O.propDep?D=M=!0:O.contextDep&&D&&(M=!0),M||Tt(w,T,O)):Tt(w,T,null),m.state.viewport&&m.state.viewport.propDep&&(D=!0);function N(W){return W.contextDep&&D||W.propDep}Ft(w,T,m),kt(w,T,m.state,function(W){return!N(W)}),(!m.profile||!N(m.profile))&&Ye(w,T,m,!1,"a1"),m.contextDep=D,m.needsContext=I,m.needsFramebuffer=M;var _=m.shader.progVar;if(_.contextDep&&D||_.propDep)dn(w,T,m,null);else{var A=_.append(w,T);if(T(w.shared.gl,".useProgram(",A,".program);"),m.shader.program)dn(w,T,m,m.shader.program);else{T(w.shared.vao,".setVAO(null);");var x=w.global.def("{}"),z=T.def(A,".id"),B=T.def(x,"[",z,"]");T(w.cond(B).then(B,".call(this,a0,a1);").else(B,"=",x,"[",z,"]=",w.link(function(W){return Ke(dn,w,m,W,2)}),"(",A,");",B,".call(this,a0,a1);"))}}Object.keys(m.state).length>0&&T(w.shared.current,".dirty=true;"),w.shared.vao&&T(w.shared.vao,".setVAO(null);")}function j(w,m){var T=w.proc("scope",3);w.batchId="a2";var D=w.shared,I=D.current;St(w,T,m.context),m.framebuffer&&m.framebuffer.append(w,T),_1(Object.keys(m.state)).forEach(function(M){var N=m.state[M],_=N.append(w,T);dt(_)?_.forEach(function(A,x){T.set(w.next[M],"["+x+"]",A)}):T.set(D.next,"."+M,_)}),Ye(w,T,m,!0,!0),[cn,wo,fn,_o,ln].forEach(function(M){var N=m.draw[M];!N||T.set(D.draw,"."+M,""+N.append(w,T))}),Object.keys(m.uniforms).forEach(function(M){var N=m.uniforms[M].append(w,T);Array.isArray(N)&&(N="["+N.join()+"]"),T.set(D.uniforms,"["+v.id(M)+"]",N)}),Object.keys(m.attributes).forEach(function(M){var N=m.attributes[M].append(w,T),_=w.scopeAttrib(M);Object.keys(new k).forEach(function(A){T.set(_,"."+A,N[A])})}),m.scopeVAO&&T.set(D.vao,".targetVAO",m.scopeVAO.append(w,T));function O(M){var N=m.shader[M];N&&T.set(D.shader,"."+M,N.append(w,T))}O(bs),O(ws),Object.keys(m.state).length>0&&(T(I,".dirty=true;"),T.exit(I,".dirty=true;")),T("a1(",w.shared.context,",a0,",w.batchId,");")}function V(w){if(!(typeof w!="object"||dt(w))){for(var m=Object.keys(w),T=0;T<m.length;++T)if(rr.isDynamic(w[m[T]]))return!0;return!1}}function Me(w,m,T){var D=m.static[T];if(!D||!V(D))return;var I=w.global,O=Object.keys(D),M=!1,N=!1,_=!1,A=w.global.def("{}");O.forEach(function(z){var B=D[z];if(rr.isDynamic(B)){typeof B=="function"&&(B=D[z]=rr.unbox(B));var W=Wt(B,null);M=M||W.thisDep,_=_||W.propDep,N=N||W.contextDep}else{switch(I(A,".",z,"="),typeof B){case"number":I(B);break;case"string":I('"',B,'"');break;case"object":Array.isArray(B)&&I("[",B.join(),"]");break;default:I(w.link(B));break}I(";")}});function x(z,B){O.forEach(function(W){var re=D[W];if(!!rr.isDynamic(re)){var ve=z.invoke(B,re);B(A,".",W,"=",ve,";")}})}m.dynamic[T]=new rr.DynamicVariable(yo,{thisDep:M,contextDep:N,propDep:_,ref:A,append:x}),delete m.static[T]}function We(w,m,T,D,I){var O=qe();O.stats=O.link(I),Object.keys(m.static).forEach(function(N){Me(O,m,N)}),Bv.forEach(function(N){Me(O,w,N)});var M=Et(w,m,T,D,O);return yt(O,M),j(O,M),$(O,M),n(O.compile(),{destroy:function(){M.shader.program.destroy()}})}return{next:_e,current:Ee,procs:function(){var w=qe(),m=w.proc("poll"),T=w.proc("refresh"),D=w.block();m(D),T(D);var I=w.shared,O=I.gl,M=I.next,N=I.current;D(N,".dirty=false;"),Tt(w,m),Tt(w,T,null,!0);var _;fe&&(_=w.link(fe)),S.oes_vertex_array_object&&T(w.link(S.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var A=0;A<U.maxAttributes;++A){var x=T.def(I.attributes,"[",A,"]"),z=w.cond(x,".buffer");z.then(O,".enableVertexAttribArray(",A,");",O,".bindBuffer(",zn,",",x,".buffer.buffer);",O,".vertexAttribPointer(",A,",",x,".size,",x,".type,",x,".normalized,",x,".stride,",x,".offset);").else(O,".disableVertexAttribArray(",A,");",O,".vertexAttrib4f(",A,",",x,".x,",x,".y,",x,".z,",x,".w);",x,".buffer=null;"),T(z),fe&&T(_,".vertexAttribDivisorANGLE(",A,",",x,".divisor);")}return T(w.shared.vao,".currentVAO=null;",w.shared.vao,".setVAO(",w.shared.vao,".targetVAO);"),Object.keys(te).forEach(function(B){var W=te[B],re=D.def(M,".",B),ve=w.block();ve("if(",re,"){",O,".enable(",W,")}else{",O,".disable(",W,")}",N,".",B,"=",re,";"),T(ve),m("if(",re,"!==",N,".",B,"){",ve,"}")}),Object.keys(K).forEach(function(B){var W=K[B],re=Ee[B],ve,Be,Fe=w.block();if(Fe(O,".",W,"("),dt(re)){var Pe=re.length;ve=w.global.def(M,".",B),Be=w.global.def(N,".",B),Fe(nr(Pe,function(ne){return ve+"["+ne+"]"}),");",nr(Pe,function(ne){return Be+"["+ne+"]="+ve+"["+ne+"];"}).join("")),m("if(",nr(Pe,function(ne){return ve+"["+ne+"]!=="+Be+"["+ne+"]"}).join("||"),"){",Fe,"}")}else ve=D.def(M,".",B),Be=D.def(N,".",B),Fe(ve,");",N,".",B,"=",ve,";"),m("if(",ve,"!==",Be,"){",Fe,"}");T(Fe)}),w.compile()}(),compile:We}}function og(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var ag=34918,ig=34919,E1=35007,cg=function(f,v){if(!v.ext_disjoint_timer_query)return null;var S=[];function U(){return S.pop()||v.ext_disjoint_timer_query.createQueryEXT()}function J(fe){S.push(fe)}var X=[];function Y(fe){var Se=U();v.ext_disjoint_timer_query.beginQueryEXT(E1,Se),X.push(Se),ce(X.length-1,X.length,fe)}function ie(){v.ext_disjoint_timer_query.endQueryEXT(E1)}function ae(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var de=[];function me(){return de.pop()||new ae}function he(fe){de.push(fe)}var ge=[];function ce(fe,Se,se){var Ee=me();Ee.startQueryIndex=fe,Ee.endQueryIndex=Se,Ee.sum=0,Ee.stats=se,ge.push(Ee)}var ue=[],k=[];function H(){var fe,Se,se=X.length;if(se!==0){k.length=Math.max(k.length,se+1),ue.length=Math.max(ue.length,se+1),ue[0]=0,k[0]=0;var Ee=0;for(fe=0,Se=0;Se<X.length;++Se){var _e=X[Se];v.ext_disjoint_timer_query.getQueryObjectEXT(_e,ig)?(Ee+=v.ext_disjoint_timer_query.getQueryObjectEXT(_e,ag),J(_e)):X[fe++]=_e,ue[Se+1]=Ee,k[Se+1]=fe}for(X.length=fe,fe=0,Se=0;Se<ge.length;++Se){var Ge=ge[Se],te=Ge.startQueryIndex,K=Ge.endQueryIndex;Ge.sum+=ue[K]-ue[te];var Ce=k[te],ye=k[K];ye===Ce?(Ge.stats.gpuTime+=Ge.sum/1e6,he(Ge)):(Ge.startQueryIndex=Ce,Ge.endQueryIndex=ye,ge[fe++]=Ge)}ge.length=fe}}return{beginQuery:Y,endQuery:ie,pushScopeStats:ce,update:H,getNumPendingQueries:function(){return X.length},clear:function(){S.push.apply(S,X);for(var fe=0;fe<S.length;fe++)v.ext_disjoint_timer_query.deleteQueryEXT(S[fe]);X.length=0,S.length=0},restore:function(){X.length=0,S.length=0}}},lg=16384,fg=256,ug=1024,dg=34962,$1="webglcontextlost",A1="webglcontextrestored",S1=1,hg=2,mg=3;function T1(f,v){for(var S=0;S<f.length;++S)if(f[S]===v)return S;return-1}function pg(f){var v=hp(f);if(!v)return null;var S=v.gl,U=S.getContextAttributes(),J=S.isContextLost(),X=mp(S,v);if(!X)return null;var Y=cp(),ie=og(),ae=X.extensions,de=cg(S,ae),me=Fl(),he=S.drawingBufferWidth,ge=S.drawingBufferHeight,ce={tick:0,time:0,viewportWidth:he,viewportHeight:ge,framebufferWidth:he,framebufferHeight:ge,drawingBufferWidth:he,drawingBufferHeight:ge,pixelRatio:v.pixelRatio},ue={},k={elements:null,primitive:4,count:-1,offset:0,instances:-1},H=t2(S,ae),fe=g2(S,ie,v,Ee),Se=M2(S,ae,fe,ie),se=Mv(S,ae,H,ie,fe,Se,k);function Ee(De){return se.destroyBuffer(De)}var _e=Lv(S,Y,ie,v),Ge=av(S,ae,H,function(){Ce.procs.poll()},ce,ie,v),te=iv(S,ae,H,ie,v),K=Tv(S,ae,H,Ge,te,ie),Ce=sg(S,Y,ae,H,fe,Se,Ge,K,ue,se,_e,k,ce,de,v),ye=Nv(S,K,Ce.procs.poll,ce,U,ae,H),le=Ce.next,be=S.canvas,we=[],je=[],qe=[],xe=[v.onDestroy],Ae=null;function ke(){if(we.length===0){de&&de.update(),Ae=null;return}Ae=Ga.next(ke),kt();for(var De=we.length-1;De>=0;--De){var Ke=we[De];Ke&&Ke(ce,null,0)}S.flush(),de&&de.update()}function He(){!Ae&&we.length>0&&(Ae=Ga.next(ke))}function Qe(){Ae&&(Ga.cancel(ke),Ae=null)}function ht(De){De.preventDefault(),J=!0,Qe(),je.forEach(function(Ke){Ke()})}function pt(De){S.getError(),J=!1,X.restore(),_e.restore(),fe.restore(),Ge.restore(),te.restore(),K.restore(),se.restore(),de&&de.restore(),Ce.procs.refresh(),He(),qe.forEach(function(Ke){Ke()})}be&&(be.addEventListener($1,ht,!1),be.addEventListener(A1,pt,!1));function tt(){we.length=0,Qe(),be&&(be.removeEventListener($1,ht),be.removeEventListener(A1,pt)),_e.clear(),K.clear(),te.clear(),se.clear(),Ge.clear(),Se.clear(),fe.clear(),de&&de.clear(),xe.forEach(function(De){De()})}function At(De){y(!!De,"invalid args to regl({...})"),y.type(De,"object","invalid args to regl({...})");function Ke(I){var O=n({},I);delete O.uniforms,delete O.attributes,delete O.context,delete O.vao,"stencil"in O&&O.stencil.op&&(O.stencil.opBack=O.stencil.opFront=O.stencil.op,delete O.stencil.op);function M(N){if(N in O){var _=O[N];delete O[N],Object.keys(_).forEach(function(A){O[N+"."+A]=_[A]})}}return M("blend"),M("depth"),M("cull"),M("stencil"),M("polygonOffset"),M("scissor"),M("sample"),"vao"in I&&(O.vao=I.vao),O}function nt(I,O){var M={},N={};return Object.keys(I).forEach(function(_){var A=I[_];if(rr.isDynamic(A)){N[_]=rr.unbox(A,_);return}else if(O&&Array.isArray(A)){for(var x=0;x<A.length;++x)if(rr.isDynamic(A[x])){N[_]=rr.unbox(A,_);return}}M[_]=A}),{dynamic:N,static:M}}var yt=nt(De.context||{},!0),_r=nt(De.uniforms||{},!0),dn=nt(De.attributes||{},!1),$=nt(Ke(De),!1),j={gpuTime:0,cpuTime:0,count:0},V=Ce.compile($,dn,_r,yt,j),Me=V.draw,We=V.batch,w=V.scope,m=[];function T(I){for(;m.length<I;)m.push(null);return m}function D(I,O){var M;if(J&&y.raise("context lost"),typeof I=="function")return w.call(this,null,I,0);if(typeof O=="function")if(typeof I=="number")for(M=0;M<I;++M)w.call(this,null,O,M);else if(Array.isArray(I))for(M=0;M<I.length;++M)w.call(this,I[M],O,M);else return w.call(this,I,O,0);else if(typeof I=="number"){if(I>0)return We.call(this,T(I|0),I|0)}else if(Array.isArray(I)){if(I.length)return We.call(this,I,I.length)}else return Me.call(this,I)}return n(D,{stats:j,destroy:function(){V.destroy()}})}var lt=K.setFBO=At({framebuffer:rr.define.call(null,S1,"framebuffer")});function Et(De,Ke){var nt=0;Ce.procs.poll();var yt=Ke.color;yt&&(S.clearColor(+yt[0]||0,+yt[1]||0,+yt[2]||0,+yt[3]||0),nt|=lg),"depth"in Ke&&(S.clearDepth(+Ke.depth),nt|=fg),"stencil"in Ke&&(S.clearStencil(Ke.stencil|0),nt|=ug),y(!!nt,"called regl.clear with no buffer specified"),S.clear(nt)}function St(De){if(y(typeof De=="object"&&De,"regl.clear() takes an object as input"),"framebuffer"in De)if(De.framebuffer&&De.framebuffer_reglType==="framebufferCube")for(var Ke=0;Ke<6;++Ke)lt(n({framebuffer:De.framebuffer.faces[Ke]},De),Et);else lt(De,Et);else Et(null,De)}function Tt(De){y.type(De,"function","regl.frame() callback must be a function"),we.push(De);function Ke(){var nt=T1(we,De);y(nt>=0,"cannot cancel a frame twice");function yt(){var _r=T1(we,yt);we[_r]=we[we.length-1],we.length-=1,we.length<=0&&Qe()}we[nt]=yt}return He(),{cancel:Ke}}function Ft(){var De=le.viewport,Ke=le.scissor_box;De[0]=De[1]=Ke[0]=Ke[1]=0,ce.viewportWidth=ce.framebufferWidth=ce.drawingBufferWidth=De[2]=Ke[2]=S.drawingBufferWidth,ce.viewportHeight=ce.framebufferHeight=ce.drawingBufferHeight=De[3]=Ke[3]=S.drawingBufferHeight}function kt(){ce.tick+=1,ce.time=Ye(),Ft(),Ce.procs.poll()}function gt(){Ge.refresh(),Ft(),Ce.procs.refresh(),de&&de.update()}function Ye(){return(Fl()-me)/1e3}gt();function It(De,Ke){y.type(Ke,"function","listener callback must be a function");var nt;switch(De){case"frame":return Tt(Ke);case"lost":nt=je;break;case"restore":nt=qe;break;case"destroy":nt=xe;break;default:y.raise("invalid event, must be one of frame,lost,restore,destroy")}return nt.push(Ke),{cancel:function(){for(var yt=0;yt<nt.length;++yt)if(nt[yt]===Ke){nt[yt]=nt[nt.length-1],nt.pop();return}}}}var ot=n(At,{clear:St,prop:rr.define.bind(null,S1),context:rr.define.bind(null,hg),this:rr.define.bind(null,mg),draw:At({}),buffer:function(De){return fe.create(De,dg,!1,!1)},elements:function(De){return Se.create(De,!1)},texture:Ge.create2D,cube:Ge.createCube,renderbuffer:te.create,framebuffer:K.create,framebufferCube:K.createCube,vao:se.createVAO,attributes:U,frame:Tt,on:It,limits:H,hasExtension:function(De){return H.extensions.indexOf(De.toLowerCase())>=0},read:ye,destroy:tt,_gl:S,_refresh:gt,poll:function(){kt(),de&&de.update()},now:Ye,stats:ie});return v.onDone(null,ot),ot}return pg})}(Sc)),Sc.exports}const uN=lN,dN=Fa,hN=e=>{const r=Object.assign({},{},e.glOptions,{onDone:(a,i)=>{if(a)throw a}}),n=fN()(r),s=new Map,o=a=>{a.rendering=Object.assign({},dN,a.rendering),uN(n)(a,i=>{n.clear({color:a.rendering.background,depth:1}),a.entities&&a.entities.sort((c,l)=>{const u="transparent"in c.visuals?c.visuals.transparent:!1,d="transparent"in l.visuals?l.visuals.transparent:!1;return u===d?0:u?1:-1}).forEach(c=>{const{visuals:l}=c;if(("show"in l?l.show:!0)&&l.drawCmd&&a.drawCommands[l.drawCmd]){let d;l.cacheId?d=s.get(l.cacheId):(l.cacheId=s.size,d=a.drawCommands[l.drawCmd](n,c),s.set(l.cacheId,d));const h={...c,...l,camera:a.camera};d(h)}})})};return function(i){n.poll(),o(i)}};var mN=hN,Tc,nd;function sd(){if(nd)return Tc;nd=1;const e=ur;return Tc=(r,n={})=>{const s=[],o={visuals:{color:[0,0,1,1],fadeOut:!1},ticks:1,size:[16,16],centered:!1,lineWidth:2},a=Object.assign({},o.visuals,n.visuals||{}),{fadeOut:i,color:c}=a,{size:l,ticks:u,centered:d,lineWidth:h}=Object.assign({},o,n),p=l[0],E=l[1];if(d){const g=p*.5,b=E*.5,P=g%u,F=-g+P,R=-F,C=b%u,G=-b+C,L=-G,q=0;for(let ee=F,oe=0;ee<=R;ee+=u,oe+=1)oe%q!==0&&(s.push(G,ee,0),s.push(L,ee,0),s.push(G,ee,0));for(let ee=G,oe=0;ee<=L;ee+=u,oe+=1)oe%q!==0&&(s.push(ee,F,0),s.push(ee,R,0),s.push(ee,F,0))}else{for(let g=-p*.5;g<=p*.5;g+=u)s.push(-E*.5,g,0),s.push(E*.5,g,0),s.push(-E*.5,g,0);for(let g=-E*.5;g<=E*.5;g+=u)s.push(g,-p*.5,0),s.push(g,p*.5,0),s.push(g,-p*.5,0)}return r({vert:`precision mediump float;

    uniform float camNear, camFar;
    uniform mat4 model, view, projection;

    attribute vec3 position;
    varying vec3 fragNormal, fragPosition;
    varying vec4 worldPosition;

    void main() {
      fragPosition = position;
      worldPosition = model * vec4(position, 1);
      vec4 glPosition = projection * view * worldPosition;
      gl_Position = glPosition;
    }`,frag:`precision mediump float;
    uniform vec4 color;
    varying vec3 fragNormal, fragPosition;
    varying vec4 worldPosition;

    uniform vec4 fogColor;
    uniform bool fadeOut;
    void main() {
      float dist = .5;
      if(fadeOut){
        dist = distance( vec2(0.,0.), vec2(worldPosition.x, worldPosition.y));
        dist *= 0.0025;
        dist = sqrt(dist);
      }

      gl_FragColor = mix(color, fogColor, dist);
    }
    `,attributes:{position:r.buffer(s)},count:s.length/3,uniforms:{model:(g,b)=>b&&b.model?b.model:e.identity([]),color:(g,b)=>b&&b.color?b.color:c,fogColor:(g,b)=>b&&b.color?[b.color[0],b.color[1],b.color[2],0]:[c[0],c[1],c[2],0],fadeOut:(g,b)=>b&&b.fadeOut!==void 0?b.fadeOut:i},lineWidth:(g,b)=>Math.min(b&&b.lineWidth?b.lineWidth:h,r.limits.lineWidthDims[1]),primitive:"lines",cull:{enable:!0,face:"front"},polygonOffset:{enable:!0,offset:{factor:1,units:Math.random()*10}},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"}}})},Tc}const pN=(e,t)=>{const r={size:[50,50],ticks:[10,1]},{size:n,ticks:s}=Object.assign({},r,t),o=sd()(e,{size:n,ticks:s[0]}),a=sd()(e,{size:n,ticks:s[1]});return c=>{o(c),a({color:c.subColor,fadeOut:c.fadeOut})}};var vN=pN;const jt=ur,gN=(e,t)=>{const r={xColor:[1,0,0,1],yColor:[0,1,0,1],zColor:[0,0,1,1],size:10,lineWidth:3,alwaysVisible:!0};let{size:n,xColor:s,yColor:o,zColor:a,lineWidth:i,alwaysVisible:c}=Object.assign({},r,t);i>e.limits.lineWidthDims[1]&&(i=e.limits.lineWidthDims[1]);const l=[0,0,0,n,0,0],u={frag:`precision mediump float;
    uniform vec4 color;
    void main() {
      gl_FragColor = color;
    }`,vert:`
    precision mediump float;
    attribute vec3 position;
    uniform mat4 model, view, projection;
    void main() {
      gl_Position = projection * view * model * vec4(position, 1);
    }`,uniforms:{model:(g,b)=>b&&b.model?b.model:jt.identity([]),color:(g,b)=>b.color,angle:(g,b)=>b.angle},attributes:{position:l},count:l.length/3,primitive:"line loop",lineWidth:i,depth:{enable:!c}},d=jt.identity([]),h=jt.rotateZ(jt.create(),jt.identity([]),Math.PI/2),p=jt.rotateY(jt.create(),jt.identity([]),-Math.PI/2),E=e(u);return g=>{const b={model:jt.identity([])};return g=Object.assign({},b,g),E([{color:s,model:jt.multiply(jt.create(),g.model,d)},{color:o,model:jt.multiply(jt.create(),g.model,h)},{color:a,model:jt.multiply(jt.create(),g.model,p)}])}};var yN=gN,Pc,od;function ad(){return od||(od=1,Pc={frag:`
precision mediump float;
varying vec3 surfaceNormal, surfacePosition;

uniform float ambientLightAmount;
uniform float diffuseLightAmount;
uniform float specularLightAmount;

uniform vec3 lightDirection;
uniform vec4 lightColor;
uniform vec3 opacity;
uniform float uMaterialShininess;

varying vec4 vColor;
uniform vec4 ucolor;
uniform float vColorToggler;

uniform vec2 printableArea;
vec4 errorColor = vec4(0.15, 0.15, 0.15, 0.3);//vec4(0.15, 0.15, 0.15, 0.3);
varying vec4 _worldSpacePosition;
varying float ambientAo;

void main () {
  vec4 depth = gl_FragCoord;
  vec4 endColor = vColor * vColorToggler + ucolor * (1.0 - vColorToggler);

  vec3 ambient = ambientLightAmount * endColor.rgb ; //ambientAo * 

  float diffuseWeight = dot(surfaceNormal, lightDirection);
  vec3 diffuse = diffuseLightAmount * endColor.rgb * clamp(diffuseWeight , 0.0, 1.0 );

  //specular
  
  vec4 specularColor = vec4(lightColor);
  vec3 eyeDirection = normalize(surfacePosition.xyz);
  vec3 reflectionDirection = reflect(-lightDirection, -surfaceNormal);
  float specularLightWeight = pow(max(dot(reflectionDirection, eyeDirection), 0.0), uMaterialShininess);
  vec3 specular = specularColor.rgb * specularLightWeight * specularLightAmount;

  gl_FragColor = vec4((ambient + diffuse + specular), endColor.a);
}
`,vert:`
precision mediump float;

uniform float camNear, camFar;
uniform mat4 model, view, projection, unormal;

attribute vec3 position, normal;
attribute vec4 color;

attribute float ao;
varying float ambientAo;

varying vec3 surfaceNormal, surfacePosition;
varying vec4 _worldSpacePosition;
varying vec4 vColor;

void main() {
  surfacePosition = (unormal * vec4(position, 1.0)).xyz;
  surfaceNormal = normalize((unormal * vec4(normal, 1.0)).xyz); //vec4 transformedNormal = uNormalMatrix * vec4(aVertexNormal, 1.0);
  vec4 worldSpacePosition = model * vec4(position, 1);
  _worldSpacePosition = worldSpacePosition;
  //gl_Position = projection * view * worldSpacePosition;

  vColor = color;

  //ambientAo = (1. - ao) * (0.5 * max(normal.x, 0.) + 0.5);

  vec4 glPosition = projection * view * model * vec4(position, 1);
  gl_Position = glPosition;
  //gl_Position = zBufferAdjust(glPosition, camNear, camFar);
}
`}),Pc}var Mc,id;function cd(){return id||(id=1,Mc={vert:`
precision mediump float;

uniform float camNear, camFar;
uniform mat4 model, view, projection;

attribute vec3 position, normal;

varying vec3 surfaceNormal, surfacePosition;
varying vec4 _worldSpacePosition;

void main() {
  surfacePosition = position;
  surfaceNormal = normal;
  vec4 worldSpacePosition = model * vec4(position, 1);
  _worldSpacePosition = worldSpacePosition;

  vec4 glPosition = projection * view * model * vec4(position, 1);
  gl_Position = glPosition;
}
`,frag:`
precision mediump float;
varying vec3 surfaceNormal;
uniform float ambientLightAmount;
uniform float diffuseLightAmount;
uniform vec4 ucolor;
uniform vec3 lightDirection;
uniform vec3 opacity;

varying vec4 _worldSpacePosition;

uniform vec2 printableArea;

vec4 errorColor = vec4(0.15, 0.15, 0.15, 0.3);

void main () {
  vec4 depth = gl_FragCoord;

  float v = 0.8; // shadow value
  vec4 endColor = ucolor;

  vec3 ambient = ambientLightAmount * endColor.rgb;
  float cosTheta = dot(surfaceNormal, lightDirection);
  vec3 diffuse = diffuseLightAmount * endColor.rgb * clamp(cosTheta , 0.0, 1.0 );

  float cosTheta2 = dot(surfaceNormal, vec3(-lightDirection.x, -lightDirection.y, lightDirection.z));
  vec3 diffuse2 = diffuseLightAmount * endColor.rgb * clamp(cosTheta2 , 0.0, 1.0 );

  gl_FragColor = vec4((ambient + diffuse + diffuse2 * v), endColor.a);
}`}),Mc}const Yr=ur,{meshColor:bN}=Fa,wN=(e,t={extras:{}})=>{const r={useVertexColors:!0,dynamicCulling:!0,geometry:void 0,color:bN},{geometry:n,dynamicCulling:s,useVertexColors:o,color:a,transparent:i}=Object.assign({},r,t),c=e.buffer([]),l=!!(n.indices&&n.indices.length>0),u=!!(n.normals&&n.normals.length>0),d=!!(o&&n.colors&&n.colors.length>0),h=n.transforms||Yr.create(),p=Yr.determinant(h)<0,E=s&&p?"front":"back",g=d?ad().vert:cd().vert,b=d?ad().frag:cd().frag,P=Yr.invert(Yr.create(),h);let F={primitive:"triangles",vert:g,frag:b,uniforms:{model:(R,C)=>h,ucolor:(R,C)=>C&&C.color?C.color:a,vColorToggler:(R,C)=>C&&C.useVertexColors&&C.useVertexColors===!0?1:0,unormal:(R,C)=>{const G=Yr.invert(Yr.create(),C.camera.view);return Yr.multiply(G,P,G),Yr.transpose(G,G),G}},attributes:{position:e.buffer({usage:"static",type:"float",data:n.positions}),ao:c},cull:{enable:!0,face:E},depth:{enable:!i}};return i&&(F.blend={enable:!0,func:{src:"src alpha",dst:"one minus src alpha"}}),n.cells?F.elements=n.cells:l?F.elements=e.elements({usage:"static",type:"uint16",data:n.indices}):n.triangles?F.elements=n.triangles:F.count=n.positions.length/3,u&&(F.attributes.normal=e.buffer({usage:"static",type:"float",data:n.normals})),d&&(F.attributes.color=e.buffer({usage:"static",type:"float",data:n.colors})),F=Object.assign({},F,t.extras),e(F)};var _N=wN,Cc,ld;function fd(){return ld||(ld=1,Cc={frag:`
precision mediump float;
varying vec4 vColor;

void main () {
  gl_FragColor = vColor;
}
`,vert:`
precision mediump float;

uniform float camNear, camFar;
uniform mat4 model, view, projection;

attribute vec3 position, normal;
attribute vec4 color;

varying vec3 surfaceNormal, surfacePosition;
varying vec4 _worldSpacePosition;
varying vec4 vColor;

void main() {
  vColor = color;

  surfacePosition = position;
  surfaceNormal = normal;
  vec4 worldSpacePosition = model * vec4(position, 1);
  _worldSpacePosition = worldSpacePosition;

  vec4 glPosition = projection * view * model * vec4(position, 1);
  gl_Position = glPosition;
}
`}),Cc}var Oc,ud;function xN(){return ud||(ud=1,Oc={vert:`
precision mediump float;

uniform float camNear, camFar;
uniform mat4 model, view, projection;

attribute vec3 position, normal;


varying vec3 surfaceNormal, surfacePosition;
varying vec4 _worldSpacePosition;


void main() {


  surfacePosition = position;
  surfaceNormal = normal;
  vec4 worldSpacePosition = model * vec4(position, 1);
  _worldSpacePosition = worldSpacePosition;

  vec4 glPosition = projection * view * model * vec4(position, 1);
  gl_Position = glPosition;
}
`,frag:`
precision mediump float;
varying vec3 surfaceNormal;
uniform float ambientLightAmount;
uniform float diffuseLightAmount;
uniform vec4 ucolor;
uniform vec3 lightDirection;
uniform vec3 opacity;

varying vec4 _worldSpacePosition;

uniform vec2 printableArea;

vec4 errorColor = vec4(0.15, 0.15, 0.15, 0.3);

void main () {
  vec4 depth = gl_FragCoord;

  float v = 0.8; // shadow value
  vec4 endColor = ucolor;

  vec3 ambient = ambientLightAmount * endColor.rgb;
  float cosTheta = dot(surfaceNormal, lightDirection);
  vec3 diffuse = diffuseLightAmount * endColor.rgb * clamp(cosTheta , 0.0, 1.0 );

  float cosTheta2 = dot(surfaceNormal, vec3(-lightDirection.x, -lightDirection.y, lightDirection.z));
  vec3 diffuse2 = diffuseLightAmount * endColor.rgb * clamp(cosTheta2 , 0.0, 1.0 );

  gl_FragColor = vec4((ambient + diffuse + diffuse2 * v), endColor.a);
}`}),Oc}var Rc,dd;function EN(){return dd||(dd=1,Rc={frag:`
precision mediump float;
uniform vec4 ucolor;

void main () {
  gl_FragColor = ucolor;
}
`}),Rc}const $N=ur,{meshColor:AN}=Fa,SN=(e,t={})=>{const r={color:AN,geometry:void 0};let{geometry:n,color:s,transparent:o}=Object.assign({},r,t);"color"in n&&(s=n.color);const a=!!(n.indices&&n.indices.length>0),i=!!(n.normals&&n.normals.length>0),c=!!(n.colors&&n.colors.length>0),l=c?fd().vert:xN().vert,u=c?fd().frag:EN().frag,d={primitive:"lines",vert:l,frag:u,uniforms:{model:(h,p)=>p.model||n.transforms||$N.create(),ucolor:(h,p)=>p&&p.color?p.color:s},attributes:{position:e.buffer({usage:"static",type:"float",data:n.positions})},depth:{enable:!o}};return o&&(d.blend={enable:!0,func:{src:"src alpha",dst:"one minus src alpha"}}),c&&(d.attributes.color=e.buffer({usage:"static",type:"float",data:n.colors})),a&&(d.elements=e.elements({usage:"static",type:"uint16",data:n.indices})),i&&(d.attributes.normal=e.buffer({usage:"static",type:"float",data:n.normals})),e(d)};var TN=SN,_m=1e-6,xm=PN;function PN(){var e=new Float32Array(3);return e[0]=0,e[1]=0,e[2]=0,e}var MN=CN;function CN(e){var t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}var Em=ON;function ON(e,t,r){var n=new Float32Array(3);return n[0]=e,n[1]=t,n[2]=r,n}var $m=RN;function RN(e,t){var r=t[0],n=t[1],s=t[2],o=r*r+n*n+s*s;return o>0&&(o=1/Math.sqrt(o),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o),e}var Am=LN;function LN(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}var FN=NN,hd=Em,md=$m,GN=Am;function NN(e,t){var r=hd(e[0],e[1],e[2]),n=hd(t[0],t[1],t[2]);md(r,r),md(n,n);var s=GN(r,n);return s>1?0:Math.acos(s)}var DN=kN;function kN(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}var IN=BN;function BN(e,t,r,n){return e[0]=t,e[1]=r,e[2]=n,e}var zN=VN,Lc=_m;function VN(e,t){var r=e[0],n=e[1],s=e[2],o=t[0],a=t[1],i=t[2];return Math.abs(r-o)<=Lc*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-a)<=Lc*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(s-i)<=Lc*Math.max(1,Math.abs(s),Math.abs(i))}var qN=XN;function XN(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}var UN=jN;function jN(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}var Sm=HN;function HN(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}var Tm={exports:{}};(function(e){e.exports=Sm})(Tm);var Pm=YN;function YN(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}var Mm={exports:{}};(function(e){e.exports=Pm})(Mm);var Cm=ZN;function ZN(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}var Om={exports:{}};(function(e){e.exports=Cm})(Om);var WN=QN;function QN(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}var KN=JN;function JN(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}var e7=t7;function t7(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}var r7=n7;function n7(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}var s7=o7;function o7(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}var a7=i7;function i7(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}var c7=l7;function l7(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e}var Rm=f7;function f7(e,t){var r=t[0]-e[0],n=t[1]-e[1],s=t[2]-e[2];return Math.sqrt(r*r+n*n+s*s)}var Lm={exports:{}};(function(e){e.exports=Rm})(Lm);var Fm=u7;function u7(e,t){var r=t[0]-e[0],n=t[1]-e[1],s=t[2]-e[2];return r*r+n*n+s*s}var Gm={exports:{}};(function(e){e.exports=Fm})(Gm);var Nm=d7;function d7(e){var t=e[0],r=e[1],n=e[2];return Math.sqrt(t*t+r*r+n*n)}var Dm={exports:{}};(function(e){e.exports=Nm})(Dm);var km=h7;function h7(e){var t=e[0],r=e[1],n=e[2];return t*t+r*r+n*n}var Im={exports:{}};(function(e){e.exports=km})(Im);var m7=p7;function p7(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}var v7=g7;function g7(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}var y7=b7;function b7(e,t,r){var n=t[0],s=t[1],o=t[2],a=r[0],i=r[1],c=r[2];return e[0]=s*c-o*i,e[1]=o*a-n*c,e[2]=n*i-s*a,e}var w7=_7;function _7(e,t,r,n){var s=t[0],o=t[1],a=t[2];return e[0]=s+n*(r[0]-s),e[1]=o+n*(r[1]-o),e[2]=a+n*(r[2]-a),e}var x7=E7;function E7(e,t){t=t||1;var r=Math.random()*2*Math.PI,n=Math.random()*2-1,s=Math.sqrt(1-n*n)*t;return e[0]=Math.cos(r)*s,e[1]=Math.sin(r)*s,e[2]=n*t,e}var $7=A7;function A7(e,t,r){var n=t[0],s=t[1],o=t[2],a=r[3]*n+r[7]*s+r[11]*o+r[15];return a=a||1,e[0]=(r[0]*n+r[4]*s+r[8]*o+r[12])/a,e[1]=(r[1]*n+r[5]*s+r[9]*o+r[13])/a,e[2]=(r[2]*n+r[6]*s+r[10]*o+r[14])/a,e}var S7=T7;function T7(e,t,r){var n=t[0],s=t[1],o=t[2];return e[0]=n*r[0]+s*r[3]+o*r[6],e[1]=n*r[1]+s*r[4]+o*r[7],e[2]=n*r[2]+s*r[5]+o*r[8],e}var P7=M7;function M7(e,t,r){var n=t[0],s=t[1],o=t[2],a=r[0],i=r[1],c=r[2],l=r[3],u=l*n+i*o-c*s,d=l*s+c*n-a*o,h=l*o+a*s-i*n,p=-a*n-i*s-c*o;return e[0]=u*l+p*-a+d*-c-h*-i,e[1]=d*l+p*-i+h*-a-u*-c,e[2]=h*l+p*-c+u*-i-d*-a,e}var C7=O7;function O7(e,t,r,n){var s=r[1],o=r[2],a=t[1]-s,i=t[2]-o,c=Math.sin(n),l=Math.cos(n);return e[0]=t[0],e[1]=s+a*l-i*c,e[2]=o+a*c+i*l,e}var R7=L7;function L7(e,t,r,n){var s=r[0],o=r[2],a=t[0]-s,i=t[2]-o,c=Math.sin(n),l=Math.cos(n);return e[0]=s+i*c+a*l,e[1]=t[1],e[2]=o+i*l-a*c,e}var F7=G7;function G7(e,t,r,n){var s=r[0],o=r[1],a=t[0]-s,i=t[1]-o,c=Math.sin(n),l=Math.cos(n);return e[0]=s+a*l-i*c,e[1]=o+a*c+i*l,e[2]=t[2],e}var N7=D7,Zr=xm();function D7(e,t,r,n,s,o){var a,i;for(t||(t=3),r||(r=0),n?i=Math.min(n*t+r,e.length):i=e.length,a=r;a<i;a+=t)Zr[0]=e[a],Zr[1]=e[a+1],Zr[2]=e[a+2],s(Zr,Zr,o),e[a]=Zr[0],e[a+1]=Zr[1],e[a+2]=Zr[2];return e}var Js={EPSILON:_m,create:xm,clone:MN,angle:FN,fromValues:Em,copy:DN,set:IN,equals:zN,exactEquals:qN,add:UN,subtract:Sm,sub:Tm.exports,multiply:Pm,mul:Mm.exports,divide:Cm,div:Om.exports,min:WN,max:KN,floor:e7,ceil:r7,round:s7,scale:a7,scaleAndAdd:c7,distance:Rm,dist:Lm.exports,squaredDistance:Fm,sqrDist:Gm.exports,length:Nm,len:Dm.exports,squaredLength:km,sqrLen:Im.exports,negate:m7,inverse:v7,normalize:$m,dot:Am,cross:y7,lerp:w7,random:x7,transformMat4:$7,transformMat3:S7,transformQuat:P7,rotateX:C7,rotateY:R7,rotateZ:F7,forEach:N7};const $n=ur,Fc=Js,Bm={view:$n.identity(new Float32Array(16)),projection:$n.identity(new Float32Array(16)),matrix:$n.identity(new Float32Array(16)),near:1,far:18e3,up:[0,0,1],eye:new Float32Array(3),position:[450,550,700],target:[0,0,0],fov:Math.PI/4,aspect:1,viewport:[0,0,0,0],projectionType:"perspective"},zm={},k7=Object.assign({},Bm,zm),I7=(e,t,r)=>{const n=r.width/r.height,s=$n.perspective($n.identity([]),t.fov,n,t.near,t.far),o=[0,0,r.width,r.height],a=e||{};return a.projection=s,a.aspect=n,a.viewport=o,a},B7=(e,t)=>{t||(t=e);const{position:r,target:n,up:s}=t,o=Fc.subtract([],r,n),a=Fc.add(Fc.create(),n,o),i=$n.lookAt($n.create(),a,n,s),c=e||{};return c.position=a,c.view=i,c};var Wc={cameraState:Bm,cameraProps:zm,defaults:k7,setProjection:I7,update:B7};const na=ur,z7={view:na.identity(new Float32Array(16)),projection:na.identity(new Float32Array(16)),matrix:na.identity(new Float32Array(16)),near:1,far:1300,up:[0,0,1],eye:new Float32Array(3),position:[150,250,200],target:[0,0,0],fov:Math.PI/4,aspect:1,viewport:[0,0,0,0],zoom:1,projectionType:"orthographic"},V7={},q7=(e,t)=>{const{width:r,height:n}=t,s=r/n,o=[0,0,r,n],a=e.zoom,i=-r*a,c=r*a,l=-n*a,u=n*a;return{projection:na.ortho([],i,c,l,u,e.near,e.far),aspect:s,viewport:o}};var fa={cameraState:z7,cameraProps:V7,setProjection:q7};const rs=Js,ua=ur,X7=e=>{const{near:t,far:r,fov:n,zoom:s}=e,{viewport:o}=e,a=Wc.setProjection(e,{width:o[2],height:o[3]}),{projectionType:i}=Wc.cameraState;return Object.assign({},e,a,{projectionType:i},{near:t,far:r,fov:n})},U7=e=>{const{fov:t,aspect:r}=e,n=rs.length(rs.subtract([],e.position,e.target))*.3,s=Math.tan(t)*n*r,o=Math.tan(t)*n,{near:a,far:i,viewport:c}=e,l={zoom:1,near:a,far:i},u=fa.cameraState,d=fa.setProjection(l,{width:s,height:o});return Object.assign({},u,e,d,{projectionType:u.projectionType,viewport:c})},j7=({camera:e})=>{const r=rs.distance(e.position,e.target),n=[r,r,r];return{view:ua.lookAt(ua.create(),n,e.target,e.up),position:n}},H7=(e,{camera:t})=>{const r={top:[0,-1e-6,1],bottom:[0,0,-1],front:[0,1,0],back:[0,-1,0],left:[-1,0,0],right:[1,0,0],undefined:[0,0,0]},n=rs.distance(t.position,t.target),s=rs.add(rs.create(),r[e].map(a=>a*n),t.target);return{view:ua.lookAt(ua.create(),s,t.target,t.up),position:s}};var Y7={toPerspectiveView:j7,toPresetView:H7,fromOrthographicToPerspective:X7,fromPerspectiveToOrthographic:U7};const Z7=e=>{if(e.length===0)return[[0,0,0],[0,0,0]];const t=Array.isArray(e)&&Array.isArray(e[0]),r=t?e[0].length:3,n=new Array(r),s=new Array(r);for(let o=0;o<r;o+=1)n[o]=1/0,s[o]=-1/0;if(t)e.forEach(o=>{for(let a=0;a<r;a+=1){const i=t?o[a]:o;s[a]=i>s[a]?i:s[a],n[a]=i<n[a]?i:n[a]}});else for(let o=0;o<e.length;o+=r)for(let a=0;a<r;a+=1){const i=e[a+o];s[a]=i>s[a]?i:s[a],n[a]=i<n[a]?i:n[a]}return[n,s]};var W7=Z7;const ir=Js,{flatten:Q7}=El,K7=W7,J7=(...e)=>{e=Q7(e);let t;e.forEach(c=>{let l=K7(c.positions);l=l.map(u=>ir.transformMat4(u,u,c.transforms)),t?(ir.min(t[0],t[0],l[0]),ir.max(t[1],t[1],l[1])):t=l});const r=ir.min(ir.create(),t[1],t[0]),n=ir.max(ir.create(),t[1],t[0]),s=ir.subtract(ir.create(),n,r);let o=ir.scale(ir.create(),s,.5);return o=ir.add(o,r,o),{dia:ir.distance(o,n),center:[...o],min:[...r],max:[...n],size:[...s]}};var eD=J7,Gc,pd;function tD(){if(pd)return Gc;pd=1,Gc=e;function e(t,r,n){var s=r[0],o=r[1],a=r[2],i=n[0],c=n[1],l=n[2],u=n[3],d=n[4],h=n[5],p=n[6],E=n[7],g=n[8],b=n[9],P=n[10],F=n[11],R=n[12],C=n[13],G=n[14],L=n[15],q=1/(s*u+o*E+a*F+L);return t[0]=(s*i+o*d+a*g+R)*q,t[1]=(s*c+o*h+a*b+C)*q,t[2]=(s*l+o*p+a*P+G)*q,t}return Gc}var Nc,vd;function rD(){if(vd)return Nc;vd=1;var e=tD();Nc=t;function t(r,n,s,o){var a=s[0],i=s[1],c=s[2],l=s[3],u=n[0],d=n[1],h=n[2];return u=u-a,d=l-d-1,d=d-i,r[0]=2*u/c-1,r[1]=2*d/l-1,r[2]=2*h-1,e(r,r,o)}return Nc}const Yt=Js,js=ur,{max:Dc,min:kc,sqrt:gd,PI:nD,sin:Qn,cos:Ko,atan2:Jo}=Math,sD=eD,$l={limits:{minDistance:.01,maxDistance:1e4},drag:.27,EPS:1e-6,zoomToFit:{auto:!0,targets:"all",tightness:1.5},userControl:{zoom:!0,zoomSpeed:1,rotate:!0,rotateSpeed:1,pan:!0,panSpeed:1},autoRotate:{enabled:!1,speed:1},autoAdjustPlanes:!0},Vm={thetaDelta:0,phiDelta:0,scale:1},oD=Object.assign({},Vm,$l),aD=({controls:e,camera:t},r)=>{const{EPS:n,drag:s}=e,{position:o,target:a}=t,i=e.up?e.up:t.up;let c=e.thetaDelta;const l=e.phiDelta,u=e.scale,d=Yt.subtract([],o,a);let h,p;i[2]===1?(h=Jo(d[0],d[1]),p=Jo(gd(d[0]*d[0]+d[1]*d[1]),d[2])):(h=Jo(d[0],d[2]),p=Jo(gd(d[0]*d[0]+d[2]*d[2]),d[1])),e.autoRotate.enabled&&e.userControl.rotate&&(c+=2*Math.PI/60/60*e.autoRotate.speed),h+=c,p+=l,p=Dc(n,kc(nD-n,p));const E=Dc(e.limits.minDistance,kc(e.limits.maxDistance,Yt.length(d)*u));i[2]===1?(d[0]=E*Qn(p)*Qn(h),d[2]=E*Ko(p),d[1]=E*Qn(p)*Ko(h)):(d[0]=E*Qn(p)*Qn(h),d[1]=E*Ko(p),d[2]=E*Qn(p)*Ko(h));const g=Yt.add(Yt.create(),a,d),b=js.lookAt(js.create(),g,a,i),P=1-Dc(kc(s,1),.01),F=Yt.distance(o,g)>.001;return{controls:{thetaDelta:c*P,phiDelta:l*P,scale:1,changed:F},camera:{position:g,view:b}}},iD=({controls:e,camera:t,speed:r=1},n)=>{let{thetaDelta:s,phiDelta:o}=e;return e.userControl.rotate&&(s+=n[0]*r,o+=n[1]*r),{controls:{thetaDelta:s,phiDelta:o},camera:t}},cD=({controls:e,camera:t,speed:r=1},n=0)=>{let{scale:s}=e;if(e.userControl.zoom&&t&&n!==void 0&&n!==0&&!isNaN(n)){const o=Math.sign(n)===0?1:Math.sign(n);n=n/n*o*r;const a=n+e.scale,i=Yt.distance(t.position,t.target)*a;if(i>e.limits.minDistance&&i<e.limits.maxDistance&&(s+=n),t.projectionType==="orthographic"){const c=Yt.length(Yt.subtract([],t.position,t.target))*.3,l=Math.tan(t.fov)*c*t.aspect,u=Math.tan(t.fov)*c;t=fa.setProjection(t,{width:l,height:u})}}return{controls:{scale:s},camera:t}},lD=({controls:e,camera:t,speed:r=1},n)=>{const s=rD(),{projection:o,view:a,viewport:i}=t,c=js.multiply([],o,a),l=js.invert([],c),u=[i[2],i[3],0],d=[i[2]-n[0],i[3]+n[1],0],h=s([],u,i,l),p=s([],d,i,l),E=Yt.distance(t.position,t.eye),g=Yt.subtract([],h,p).map(b=>b*r*E*e.scale);return{controls:e,camera:{position:Yt.add(Yt.create(),t.position,g),target:Yt.add(Yt.create(),t.target,g)}}},fD=({controls:e,camera:t,entities:r})=>{const{zoomToFit:n}=e;if(n.targets!=="all")return{controls:e,camera:t};if(r.length===0)return{controls:e,camera:t};const s=r.map(p=>p.geometry),o=sD(s),{fov:a,target:i,position:c}=t,{tightness:l}=Object.assign({},n,$l.zoomToFit),u=o.dia*l/Math.tan(a/2),d=Yt.distance(i,c),h=u/d;return{camera:{target:o.center},controls:{scale:h}}},uD=({controls:e,camera:t},r)=>({camera:{position:r.camera.position,target:r.camera.target,projection:js.perspective([],t.fov,t.aspect,t.near,t.far),view:r.camera.view},controls:{thetaDelta:r.controls.thetaDelta,phiDelta:r.controls.phiDelta,scale:r.controls.scale}});var dD={controlsProps:$l,controlsState:Vm,defaults:oD,update:aD,rotate:iD,zoom:cD,pan:lD,zoomToFit:fD,reset:uD};const yd=ur,Ic=Math.floor(65535/2),hD=(e,t)=>{let{color:r}=e;const n=t.sides;if(n.length===0)return[];"color"in t&&(r=t.color);const s=r[3]<1,o=[],a=Math.floor(n.length/Ic)+1,i=(l,u)=>{o.push(l,u||l)},c=[];for(let l=0;l<a;l++){const u=l*Ic,d=Math.min(u+Ic,n.length),h=[];for(let b=u;b<d;b++){const P=n[b];if(P.color){if(o.length===0&&h.length>0){const F=h.length;for(let R=0;R<F;R++)o.push(r)}i(P.color,P.endColor)}else o.length&&i(r);h.push([P[0][0],P[0][1],0]),h.push([P[1][0],P[1][1],0])}const p=h.map(b=>[0,0,-1]),E=h.map((b,P)=>P),g=t.transforms?yd.clone(t.transforms):yd.create();c.push({type:"2d",positions:h,normals:p,indices:E,transforms:g,color:r,colors:o,isTransparent:s})}return c};var mD=hD;const Wr=Js,bd=ur,pD=65535,vD=(e,t)=>{let{color:r,smoothLighting:n}=e;"color"in t&&(r=t.color);const s=t.polygons,o=t.transforms?bd.clone(t.transforms):bd.create(),a=[];let i=0;for(;i<s.length;){let c=0,l=i;for(let b=i;b<s.length&&(c+=s[b].vertices.length,!(c>pD));b++)l++;const u=[],d=[],h=[],p=[],E=!0;for(let b=i;b<l;b++){const P=s[b],F=P.vertices,R=yD(P),C=gD(P,r),G=[];for(let L=0;L<F.length;L++){const q=F[L];u.push(q),d.push(R),p.push(C);const ee=u.length-1;G.push(ee)}for(let L=2;L<G.length;L++)h.push([G[0],G[L-1],G[L]])}const g={type:"3d",positions:u,normals:d,indices:h,colors:p,transforms:o,isTransparent:E};a.push(g),i=l}return a},gD=(e,t)=>{let r=t;return e.color&&(r=e.color),r&&r.length<4&&r.push(1),r},yD=e=>{if(e.plane)return Wr.clone(e.plane);const t=e.vertices,r=Wr.create();Wr.subtract(r,t[1],t[0]);const n=Wr.create();Wr.subtract(n,t[2],t[0]);const s=Wr.create();return Wr.cross(s,r,n),Wr.normalize(s,s),s};var bD=vD;const wd=ur,Bc=Math.floor(65535/2)-2,wD=(e,t)=>{let{color:r}=e;const n=t.points;if(n.length===0)return[];"color"in t&&(r=t.color);const s=r[3]<1,o=Math.floor(n.length/Bc)+1,a=[];for(let i=0;i<o;i++){const c=i*Bc,l=Math.min(c+Bc,n.length),u=[];let d;for(let g=c;g<l;g++){const b=n[g];d&&(u.push([d[0],d[1],0]),u.push([b[0],b[1],0])),d=b}if(i+1===o&&t.isClosed&&d){const g=n[0];u.push([d[0],d[1],0]),u.push([g[0],g[1],0])}const h=u.map(g=>[0,0,-1]),p=u.map((g,b)=>b),E=t.transforms?wd.clone(t.transforms):wd.create();a.push({type:"2d",positions:u,normals:h,indices:p,transforms:E,color:r,isTransparent:s})}return a};var _D=wD;const{flatten:xD,toArray:ED}=El,{meshColor:$D}=Fa,AD=mD,SD=bD,TD=_D,PD=e=>e.map(r=>{const n={drawCmd:r.type==="2d"?"drawLines":"drawMesh",show:!0,transparent:r.isTransparent,useVertexColors:!0};return{geometry:r,visuals:n}}),MD=(e,...t)=>{const r={color:$D,smoothNormals:!0},{color:n,smoothNormals:s}=Object.assign({},r,e);t=xD(ED(t)),t=t.filter(a=>a&&a instanceof Object);const o=[];return t.forEach(a=>{let i=[];"sides"in a?i=AD({color:n},a):"points"in a?i=TD({color:n},a):"polygons"in a&&(i=SD({smoothLighting:s,normalThreshold:.3,color:n},a)),o.push(...PD(i))}),o};var CD=MD,Qr={prepareRender:mN,drawCommands:{drawGrid:vN,drawAxis:yN,drawMesh:_N,drawLines:TN},cameras:{camera:Y7,orthographic:fa,perspective:Wc},controls:{orbit:dD},entitiesFromSolids:CD};const ea=Qr.cameras.perspective,ks=Qr.controls.orbit,OD=({containerElement:e,model:t})=>{const r=e.clientWidth,n=e.clientHeight,s={};s.camera=Object.assign({},ea.defaults,{position:[450,550,700],fov:Math.PI/32}),ea.setProjection(s.camera,s.camera,{width:r,height:n}),ea.update(s.camera,s.camera),s.controls=ks.defaults;const o={glOptions:{container:e}},a=Qr.prepareRender(o),i={visuals:{drawCmd:"drawGrid",show:!0},size:[500,500],ticks:[10,1],color:[0,0,1,1],subColor:[0,0,1,.5]},c={visuals:{drawCmd:"drawAxis",show:!0},size:300},l=Qr.entitiesFromSolids({},t),u={camera:s.camera,drawCommands:{drawAxis:Qr.drawCommands.drawAxis,drawGrid:Qr.drawCommands.drawGrid,drawLines:Qr.drawCommands.drawLines,drawMesh:Qr.drawCommands.drawMesh},entities:[i,c,...l]};let d=!0;const h=()=>{if(R[0]||R[1]){const Q=ks.rotate({controls:s.controls,camera:s.camera,speed:b},R);s.controls={...s.controls,...Q.controls},d=!0,R=[0,0]}if(C[0]||C[1]){const Q=ks.pan({controls:s.controls,camera:s.camera,speed:P},C);s.controls={...s.controls,...Q.controls},C=[0,0],s.camera.position=Q.camera.position,s.camera.target=Q.camera.target,d=!0}if(G){const Q=ks.zoom({controls:s.controls,camera:s.camera,speed:F},G);s.controls={...s.controls,...Q.controls},G=0,d=!0}},p=Q=>{if(h(),d){const Te=ks.update({controls:s.controls,camera:s.camera});s.controls={...s.controls,...Te.controls},d=s.controls.changed,s.camera.position=Te.camera.position,ea.update(s.camera),a(u)}window.requestAnimationFrame(p)};window.requestAnimationFrame(p);let E=0,g=0;const b=.002,P=1,F=.08;let R=[0,0],C=[0,0],G=0,L=!1;const q=Q=>{if(!L)return;const Te=E-Q.pageX,Xe=Q.pageY-g;Q.shiftKey===!0||Q.touches!==void 0&&Q.touches.length>2?(C[0]+=Te,C[1]+=Xe):(R[0]-=Te,R[1]-=Xe),E=Q.pageX,g=Q.pageY,Q.preventDefault()},ee=Q=>{L=!0,E=Q.pageX,g=Q.pageY,e.setPointerCapture(Q.pointerId)},oe=Q=>{L=!1,e.releasePointerCapture(Q.pointerId)},pe=Q=>{G+=Q.deltaY,Q.preventDefault()};e.onpointermove=q,e.onpointerdown=ee,e.onpointerup=oe,e.onwheel=pe},_d=document.getElementById("jscad"),qm=eG();_d!==null&&OD({containerElement:_d,model:qm});const RD=async e=>{const t=new File([await e.arrayBuffer()],"model.stl"),r=document.createElement("a");r.style.display="none",r.href=URL.createObjectURL(t),r.download=t.name,document.body.appendChild(r),r.click(),setTimeout(()=>{var n;URL.revokeObjectURL(r.href),(n=r.parentNode)==null||n.removeChild(r)},0)};window.startDownload=()=>{const e=XF.serialize({binary:!0},qm),t=new Blob(e);RD(t).catch(console.error)};
